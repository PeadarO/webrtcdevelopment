"";var rtcConn,containerDiv,tempuserid,detectRTC,webrtcdevIceServers,localStream,localStreamId,remoteStream,remoteStreamId,screen,extensioninstalled,screen_roomid,screen_userid,t="",e=null,n="",selfuserid=null,remoteUserId=null,webcallpeers=[],sessions={},repeatFlagShowButton=null,repeatFlagHideButton=null,repeatFlagRemoveButton=null,localVideo=null,selfVideo=null,remoteVideos=[],RTCPeerConnection=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,selfusername=(sessions={},""),selfemail="",selfcolor="",remoteusername="",remoteemail="",remotecolor="",latitude="",longitude="",operatingsystem="",autoload=!0,sessionid=null,socketAddr="/",incomingAudio=!0,incomingVideo=!0,incomingData=!0,outgoingAudio=!0,outgoingVideo=!0,outgoingData=!0,debug=!1,timerobj=!1,chatobj=!1,chatContainer=null,fileshareobj=!1,screenrecordobj=!1,snapshotobj=!1,videoRecordobj=!1,videoRecordContainer=null,drawCanvasobj=!1,texteditorobj=!1,codeeditorobj=!1,editor=null,reconnectobj=!1,cursorobj=!1,muteobj=!1,minmaxobj=!1,listeninobj=!1,screenshareobj=!1,helpobj=!1,statisticsobj=!1,isScreenOn=0,chromeMediaSourceId=null,role="participant";function init(e,t){e&&!location.hash.replace("#","").length?(location.href=location.href.split("#")[0]+"#"+(100*Math.random()).toString().replace(".",""),location.reload()):e&&location.href.replace("#","").length?t(sessionid=-1<location.href.indexOf("?")?location.hash.substring(0,location.hash.indexOf("?")).replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""):location.hash.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join("")):t(sessionid=prompt("Enter session ",""))}function loadjscssfile(e,t){if("js"==t)(r=document.createElement("script")).setAttribute("type","text/javascript"),r.setAttribute("src",e);else if("css"==t){var r;(r=document.createElement("link")).setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",e)}void 0!==r&&document.getElementsByTagName("head")[0].appendChild(r)}function loadScript(e,t){var r=document.createElement("script");r.src=e,r.async=!0,document.documentElement.appendChild(r)}function isData(e){return!e.audio&&!e.video&&!e.screen&&e.data}function isNull(e){return void 0===e}function isString(e){return"string"==typeof e}function isEmpty(e){var t=0;for(var r in e)t++;return 0==t}function ab2str(e){var t="";try{t=String.fromCharCode.apply(null,new Uint16Array(e))}catch(e){}return t}function str2ab(e){isString(e)||(e=JSON.stringify(e));for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t}function toStr(t){try{return JSON.stringify(t,function(e,t){return t&&t.sdp?(log(t.sdp.type,"\t",t.sdp.sdp),""):t},"\t")}catch(e){return t}}function getLength(e){var t=0;for(var r in e)r&&t++;return t}function getArgsJson(e){var t="";for(i=0;i<e.length;i++)e[i]&&(t+=toStr(e[i]));return t}function isJSON(e){if("string"!=typeof e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}function getElement(e){return document.querySelector(e)}function getRandomColor(){for(var e="0123456789ABCDEF".split(""),t="#",r=0;r<6;r++)t+=e[Math.round(15*Math.random())];return t}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function getUserinfo(e,t){return e?'<video src="'+e+'" autoplay></vide>':'<img src="'+t+'">'}function fireClickEvent(e){var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function bytesToSize(e){if(0==e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}var webrtcdev={},webrtcdevlogs=[];webrtcdev.log=function(){if(isJSON(arguments)){var e=JSON.stringify(arguments,void 0,2);webrtcdevlogs.push("<pre style='color:grey'>[-]"+e+"</pre>")}else{var t=getArgsJson(arguments);webrtcdevlogs.push("<p style='color:grey'>[-]"+t+"</p>")}console.log(arguments)},webrtcdev.info=function(){var e=getArgsJson(arguments);webrtcdevlogs.push("<p style='color:blue'>[INFO]"+e+"</p>"),console.info(arguments)},webrtcdev.debug=function(){if(isJSON(arguments)){var e=JSON.stringify(arguments,void 0,2);webrtcdevlogs.push("<pre style='color:green'>[DEBUG]"+e+"</pre>")}else{var t=getArgsJson(arguments);webrtcdevlogs.push("<p style='color:green'>[DEBUG]"+t+"</p>")}console.debug(arguments)},webrtcdev.warn=function(){var e=getArgsJson(arguments);webrtcdevlogs.push("<p style='color:yellow'>[WARN]"+e+"</p>"),console.warn(arguments)},webrtcdev.error=function(){var e=getArgsJson(arguments);webrtcdevlogs.push("<p style='color:red'>[ERROR]"+e+"</p>"),console.error(arguments)};
"";function shownotification(e,t){if(document.getElementById("alertBox")){var i=document.createElement("div");i.className="warning"==t?"alert alert-warning fade in":"crtical"==t?"alert alert-crtical":"alert alert-success fade in",i.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+e,document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").appendChild(i),setTimeout(function(){document.getElementById("alertBox").hidden=!0},3e3)}else alert(e)}function shownotificationWarning(e){if(document.getElementById("alertBox")){var t=document.createElement("div");t.className="alert alert-warning fade in",t.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+e,document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",document.getElementById("alertBox").appendChild(t),setTimeout(function(){document.getElementById("alertBox").hidden=!0},3e3)}else alert(e)}function showdesktopnotification(){if("Notification"in window)if("granted"===Notification.permission)new Notification("Vilageexperts",{body:"The remote has joined the session"});else"denied"!==Notification.permission&&Notification.requestPermission(function(e){if("granted"===e)new Notification("villageexpsrts")});else alert("This browser does not support desktop notification")}function spawnNotification(e,t,i){new Notification(i,{body:e,icon:t})}Notification.requestPermission().then(function(e){webrtcdev.log(e)});
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function d(r,e){var n="";n+="?userid="+r.userid,n+="&msgEvent="+r.socketMessageEvent,n+="&socketCustomEvent="+r.socketCustomEvent,r.enableScalableBroadcast&&(n+="&enableScalableBroadcast=true",n+="&maxRelayLimitPerUser="+(r.maxRelayLimitPerUser||2)),r.socketCustomParameters&&(n+=r.socketCustomParameters);try{io.sockets={}}catch(e){}try{r.socket=io((r.socketURL||"/")+n)}catch(e){r.socket=io.connect((r.socketURL||"/")+n,r.socketOptions)}var a=r.multiPeersHandler;r.socket.on("extra-data-updated",function(e,n){r.peers[e]&&(r.peers[e].extra=n,r.onExtraDataUpdated({userid:e,extra:n}))}),r.socket.on(r.socketMessageEvent,function(e){if(e.remoteUserId==r.userid){if(r.peers[e.sender]&&r.peers[e.sender].extra!=e.message.extra&&(r.peers[e.sender].extra=e.extra,r.onExtraDataUpdated({userid:e.sender,extra:e.extra})),e.message.streamSyncNeeded&&r.peers[e.sender]){var n=r.streamEvents[e.message.streamid];if(!n||!n.stream)return;var t=e.message.action;if("ended"===t||"stream-removed"===t)return void r.onstreamended(n);var i="both"!=e.message.type?e.message.type:null;return void n.stream[t](i)}if("connectWithAllParticipants"===e.message)return-1===r.broadcasters.indexOf(e.sender)&&r.broadcasters.push(e.sender),void a.onNegotiationNeeded({allParticipants:r.getAllParticipants(e.sender)},e.sender);if("removeFromBroadcastersList"===e.message)return void(-1!==r.broadcasters.indexOf(e.sender)&&(delete r.broadcasters[r.broadcasters.indexOf(e.sender)],r.broadcasters=s(r.broadcasters)));if("dropPeerConnection"===e.message)return void r.deletePeer(e.sender);if(e.message.allParticipants)return-1===e.message.allParticipants.indexOf(e.sender)&&e.message.allParticipants.push(e.sender),void e.message.allParticipants.forEach(function(e){a[r.peers[e]?"renegotiatePeer":"createNewPeer"](e,{localPeerSdpConstraints:{OfferToReceiveAudio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:r.session.oneway?!!r.session.audio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.session.oneway?!!r.session.video||!!r.session.screen:r.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!r.session.oneway||"one-way"===r.direction,isDataOnly:h(r.session)})});if(e.message.newParticipant){if(e.message.newParticipant==r.userid)return;if(r.peers[e.message.newParticipant])return;return void a.createNewPeer(e.message.newParticipant,e.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:r.session.oneway?!!r.session.audio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.session.oneway?!!r.session.video||!!r.session.screen:r.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!r.session.oneway||"one-way"===r.direction,isDataOnly:h(r.session)})}if((e.message.readyForOffer||e.message.addMeAsBroadcaster)&&r.addNewBroadcaster(e.sender),e.message.newParticipationRequest&&e.sender!==r.userid){r.peers[e.sender]&&r.deletePeer(e.sender);var o={extra:e.extra||{},localPeerSdpConstraints:e.message.remotePeerSdpConstraints||{OfferToReceiveAudio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:e.message.localPeerSdpConstraints||{OfferToReceiveAudio:r.session.oneway?!!r.session.audio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.session.oneway?!!r.session.video||!!r.session.screen:r.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==e.message.isOneWay?e.message.isOneWay:!!r.session.oneway||"one-way"===r.direction,isDataOnly:void 0!==e.message.isDataOnly?e.message.isDataOnly:h(r.session),dontGetRemoteStream:void 0!==e.message.isOneWay?e.message.isOneWay:!!r.session.oneway||"one-way"===r.direction,dontAttachLocalStream:!!e.message.dontGetRemoteStream,connectionDescription:e,successCallback:function(){(void 0!==e.message.isOneWay?e.message.isOneWay:!!r.session.oneway||"one-way"===r.direction)&&r.addNewBroadcaster(e.sender,o),(r.session.oneway||"one-way"===r.direction||h(r.session))&&r.addNewBroadcaster(e.sender,o)}};return void r.onNewParticipant(e.sender,o)}return e.message.shiftedModerationControl?void r.onShiftedModerationControl(e.sender,e.message.broadcasters):(e.message.changedUUID&&r.peers[e.message.oldUUID]&&(r.peers[e.message.newUUID]=r.peers[e.message.oldUUID],delete r.peers[e.message.oldUUID]),e.message.userLeft?(a.onUserLeft(e.sender),void(e.message.autoCloseEntireSession&&r.leave())):void a.addNegotiatedMessage(e.message,e.sender))}}),r.socket.on("user-left",function(e){onUserLeft(e),r.onUserStatusChanged({userid:e,status:"offline",extra:r.peers[e]&&r.peers[e].extra||{}}),r.onleave({userid:e,extra:{}})}),r.socket.on("connect",function(){return r.socketAutoReConnect?(r.enableLogs&&webrtcdev.info("socket.io connection is opened."),r.socket.emit("extra-data-updated",r.extra),void(e&&e(r.socket))):void(r.socket=null)}),r.socket.on("disconnect",function(){return r.socketAutoReConnect?void(r.enableLogs&&(webrtcdev.info("socket.io connection is closed"),webrtcdev.warn("socket.io reconnecting"))):void(r.socket=null)}),r.socket.on("join-with-password",function(e){r.onJoinWithPassword(e)}),r.socket.on("invalid-password",function(e,n){r.onInvalidPassword(e,n)}),r.socket.on("password-max-tries-over",function(e){r.onPasswordMaxTriesOver(e)}),r.socket.on("user-disconnected",function(e){e!==r.userid&&(r.onUserStatusChanged({userid:e,status:"offline",extra:r.peers[e]&&r.peers[e].extra||{}}),r.deletePeer(e))}),r.socket.on("user-connected",function(e){e!==r.userid&&r.onUserStatusChanged({userid:e,status:"online",extra:r.peers[e]&&r.peers[e].extra||{}})}),r.socket.on("closed-entire-session",function(e,n){r.leave(),r.onEntireSessionClosed({sessionid:e,userid:e,extra:n})}),r.socket.on("userid-already-taken",function(e,n){r.isInitiator=!1,r.userid=n,r.onUserIdAlreadyTaken(e,n)}),r.socket.on("logs",function(e){r.enableLogs&&webrtcdev.debug("server-logs",e)}),r.socket.on("number-of-broadcast-viewers-updated",function(e){r.onNumberOfBroadcastViewersUpdated(e)})}function f(s){function o(){s.fbr=new FileBufferReader,s.fbr.onProgress=function(e){s.onFileProgress(e)},s.fbr.onBegin=function(e){s.onFileStart(e)},s.fbr.onEnd=function(e){s.onFileEnd(e)}}var r,d=this,i=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function o(){(r=new FileBufferReader).onProgress=function(e){s.onFileProgress(e)},r.onBegin=function(e){s.onFileStart(e)},r.onEnd=function(e){s.onFileEnd(e)}}s.peers={getLength:function(){var e=0;for(var n in this)-1==i.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==i.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)-1==i.indexOf(t)&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(e){n(s.peers[e])})},send:function(n,e){var t=this;if(c(n.size)||c(n.type))if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),e){var i=s.peers[e];if(i)return i.channels.length?void i.channels.forEach(function(e){e.send(n)}):(s.peers[e].createDataChannel(),s.renegotiate(e),void setTimeout(function(){t.send(n,e)},3e3))}this.getAllParticipants().forEach(function(e){if(!t[e].channels.length)return s.peers[e].createDataChannel(),s.renegotiate(e),void setTimeout(function(){t[e].channels.forEach(function(e){e.send(n)})},3e3);t[e].channels.forEach(function(e){e.send(n)})})}else $.send({text:n,channel:this,connection:s,remoteUserId:e});else d.shareFile(n,e)}},this.uuid=s.userid,this.getLocalConfig=function(e,i,n){return n||(n={}),{streamsToShare:n.streamsToShare||{},rtcMultiConnection:s,connectionDescription:n.connectionDescription,userid:i,localPeerSdpConstraints:n.localPeerSdpConstraints,remotePeerSdpConstraints:n.remotePeerSdpConstraints,dontGetRemoteStream:!!n.dontGetRemoteStream,dontAttachLocalStream:!!n.dontAttachLocalStream,renegotiatingPeer:!!n.renegotiatingPeer,peerRef:n.peerRef,channels:n.channels||[],onLocalSdp:function(e){d.onNegotiationNeeded(e,i)},onLocalCandidate:function(e){(e=q.processCandidates(s,e))&&d.onNegotiationNeeded(e,i)},remoteSdp:e,onDataChannelMessage:function(e){if(!r&&s.enableFileSharing&&o(),"string"!=typeof e&&s.enableFileSharing){var n=this;e instanceof ArrayBuffer||e instanceof DataView?r.convertToObject(e,function(e){n.onDataChannelMessage(e)}):e.readyForNextChunk?r.getNextChunk(e.uuid,function(n,e){s.peers[i].channels.forEach(function(e){e.send(n)})},i):r.addChunk(e,function(e){s.peers[i].peer.channel.send(e)})}else d.onDataChannelMessage(e,i)},onDataChannelError:function(e){d.onDataChannelError(e,i)},onDataChannelOpened:function(e){d.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){d.onDataChannelClosed(e,i)},onRemoteStream:function(e){if(s.peers[i].streams.push(e),A&&window.PluginRTC){var n=document.createElement("video"),t=s.videosContainer;return t.insertBefore(n,t.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(n,e)},3e3)}d.onGettingRemoteMedia(e,i)},onRemoteStreamRemoved:function(e){d.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){d.onPeerStateChanged(e),"new"===e.iceConnectionState&&d.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&d.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(d.onUserLeft(i),d.disconnectWith(i))}}},this.createNewPeer=function(e,n){if(!(s.maxParticipantsAllowed<=s.getAllParticipants().length)){if(n=n||{},s.isInitiator&&s.session.audio&&"two-way"===s.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=s.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},e);n=s.setUserPreferences(n,e);var t=this.getLocalConfig(null,e,n);s.peers[e]=new a(t)}},this.createAnsweringPeer=function(e,n,t){t=s.setUserPreferences(t||{},n);var i=this.getLocalConfig(e,n,t);s.peers[n]=new a(i)},this.renegotiatePeer=function(e,n,t){if(s.peers[e]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=s.peers[e].peer,n.channels=s.peers[e].channels;var i=this.getLocalConfig(t,e,n);s.peers[e]=new a(i)}else s.enableLogs&&webrtcdev.error("This peer ("+e+") does not exists. Renegotiation skipped.")},this.replaceTrack=function(n,t,i){if(!s.peers[t])throw"This peer ("+t+") does not exists.";var e=s.peers[t].peer;e.getSenders&&"function"==typeof e.getSenders&&e.getSenders().length?e.getSenders().forEach(function(e){i&&e.track instanceof VideoStreamTrack&&(s.peers[t].peer.lastVideoTrack=e.track,e.replaceTrack(n)),!i&&e.track instanceof AudioStreamTrack&&(s.peers[t].peer.lastAudioTrack=e.track,e.replaceTrack(n))}):(webrtcdev.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(o,r){if(o.type&&o.sdp)return"answer"==o.type&&s.peers[r]&&s.peers[r].addRemoteSdp(o),"offer"==o.type&&(o.renegotiatingPeer?this.renegotiatePeer(r,null,o):this.createAnsweringPeer(o,r)),void(s.enableLogs&&webrtcdev.log("Remote peer's sdp:",o.sdp));if(o.candidate)return s.peers[r]&&s.peers[r].addRemoteCandidate(o),void(s.enableLogs&&webrtcdev.log("Remote peer's candidate pairs:",o.candidate));if(o.enableMedia){if(s.attachStreams.length||s.dontCaptureUserMedia){var n={};return s.attachStreams.forEach(function(e){n[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),o.userPreferences.streamsToShare=n,void d.onNegotiationNeeded({readyForOffer:!0,userPreferences:o.userPreferences},r)}var e={},t=o.userPreferences;t.localPeerSdpConstraints.OfferToReceiveAudio&&(e.audio=s.mediaConstraints.audio),t.localPeerSdpConstraints.OfferToReceiveVideo&&(e.video=s.mediaConstraints.video);var i=t.session||s.session;i.oneway&&i.audio&&"two-way"===i.audio&&(i={audio:!0}),(i.audio||i.video||i.screen)&&(i.screen?s.getScreenConstraints(function(e,n){s.invokeGetUserMedia({audio:!!S(s)&&C(n),video:n,isScreen:!0},!i.audio&&!i.video||S(s)?a:s.invokeGetUserMedia(null,a))}):(i.audio||i.video)&&s.invokeGetUserMedia(null,a,i))}function a(e){var n,t,i;n=o,t=r,i={},s.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),n.userPreferences.streamsToShare=i,d.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},t)}o.readyForOffer&&s.onReadyForOffer(r,o.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(e,n,t){if((t=t.split("|-,-|")).length){var i=t[0];d.onNegotiationNeeded({newParticipant:e,userPreferences:n||!1},i),delete t[0];var o=[];t.forEach(function(e){e&&o.push(e)}),setTimeout(function(){d.connectNewParticipantWithAllBroadcasters(e,n,o.join("|-,-|"))},1e4)}},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(e,n){s.onMediaError(e,n)},this.shareFile=function(t,i){if(alert(" Share File "),!s.enableFileSharing)throw'"connection.enableFileSharing" is false.';o(),r.readAsArrayBuffer(t,function(n){var e=s.getAllParticipants();i&&(e=[i]),e.forEach(function(e){r.getNextChunk(n,function(n){s.peers[e].channels.forEach(function(e){for(x in webcallpeers)if(webcallpeers[x].userid==selfuserid)for(y in webcallpeers[x].filearray)webcallpeers[x].filearray[y].name==t.name&&"progress"==webcallpeers[x].filearray[y].status&&(console.log(" filename ",webcallpeers[x].filearray[y].name," | status ",webcallpeers[x].filearray[y].status),e.send(n))})},e)})},{userid:s.userid,chunkSize:E?15e3:s.chunkSize||0})};var t=new n(s);this.onDataChannelMessage=function(e,n){t.receive(JSON.parse(e),n,s.peers[n]?s.peers[n].extra:{})},this.onDataChannelClosed=function(e,n){e.userid=n,e.extra=s.peers[n]?s.peers[n].extra:{},s.onclose(e)},this.onDataChannelError=function(e,n){e.userid=n,event.extra=s.peers[n]?s.peers[n].extra:{},s.onerror(e)},this.onDataChannelOpened=function(e,n){s.peers[n].channels.length?s.peers[n].channels=[e]:(s.peers[n].channels.push(e),s.onopen({userid:n,extra:s.peers[n]?s.peers[n].extra:{},channel:e}))},this.onPeerStateChanged=function(e){s.onPeerStateChanged(e)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(e){return e=e||s.peers.getAllParticipants()[0],s.peers[e]?s.peers[e].streams:[]},this.isPluginRTC=s.isPluginRTC=A}function v(e,n,t){if("undefined"!=typeof CustomEvent){var i=new CustomEvent(n,{arguments:t,__exposedProps__:t});e.dispatchEvent(i)}}function m(n,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",function(e){(e=n.streamEvents[t.streamid]).session={audio:"audio"===e.muteType,video:"video"===e.muteType},n.onmute(e)},!1),t.stream.addEventListener("unmute",function(e){(e=n.streamEvents[t.streamid]).session={audio:"audio"===e.unmuteType,video:"video"===e.unmuteType},n.onunmute(e)},!1))}function p(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;t<i;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function g(t,e,i){var n=!1;t.getVideoTracks&&!t.getVideoTracks().length&&(n=!0);var o=document.createElement(n?"audio":"video");return A&&window.PluginRTC?(i.videosContainer.insertBefore(o,i.videosContainer.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(o,t),e(o)},1e3)):(o[E?"mozSrcObject":"src"]=E?t:window.URL.createObjectURL(t),o.controls=!0,E&&o.addEventListener("ended",function(){if(H.remove(t.idInstance),"local"===t.type){_.onSyncNeeded(t.streamid,"ended"),i.attachStreams.forEach(function(e,n){t.streamid===e.streamid&&delete i.attachStreams[n]});var n=[];i.attachStreams.forEach(function(e){e&&n.push(e)}),i.attachStreams=n;var e=i.streamEvents[t.streamid];if(e)return void i.onstreamended(e);this.parentNode&&this.parentNode.removeChild(this)}},!1),void e(o))}function w(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function s(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function h(e){return!e.audio&&!e.video&&!e.screen&&e.data}function c(e){return void 0===e}function S(e,n){return(!e.session.audio||"two-way"!==e.session.audio)&&(!(!E||!1===n)||!(!l||I<50)&&(!0===(void 0===n?"undefined":_typeof(n))||!(void 0!==n||!e.session.audio||!e.session.screen||e.session.video)&&(n=!0)))}function C(e){return!!E||!!l&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function e(){if("iOS"===DetectRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),e.registerGlobals()}}function b(e){var n;return n={mandatory:{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo},optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&34<L&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function a(i){if(!N)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var o=i.rtcMultiConnection;this.extra=i.remoteSdp?i.remoteSdp.extra:o.extra,this.userid=i.userid,this.streams=[],this.channels=i.channels||[],this.connectionDescription=i.connectionDescription;var t=this;i.remoteSdp&&(this.connectionDescription=i.remoteSdp.connectionDescription);var r,a={};V.sdpConstraints=b({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var e=!!i.renegotiatingPeer;i.remoteSdp&&(e=!!i.remoteSdp.renegotiatingPeer);var n=[];if(o.attachStreams.forEach(function(e){e&&n.push(e)}),e)r=i.peerRef;else{var s="all";(o.candidates.turn||o.candidates.relay)&&(o.candidates.stun||o.candidates.reflexive||o.candidates.host||(s="relay")),r=new N(navigator.onLine?{iceServers:o.iceServers,iceTransportPolicy:o.iceTransportPolicy||s}:null,window.PluginRTC?null:o.optionalArgument),o.iceServers.length||(r=new N(null,null))}function d(){return r.getLocalStreams()}r.onicecandidate=function(e){if(e.candidate)o.trickleIce&&i.onLocalCandidate({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else if(!o.trickleIce){var n=r.localDescription;i.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:i.remotePeerSdpConstraints||!1,renegotiatingPeer:!!i.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!i.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:m,isFirefoxOffered:E})}};i.remoteSdp&&i.remoteSdp.remotePeerSdpConstraints&&i.remoteSdp.remotePeerSdpConstraints.isFirefoxOffered,n.forEach(function(n){i.remoteSdp&&i.remoteSdp.remotePeerSdpConstraints&&i.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||i.dontAttachLocalStream||(n=o.beforeAddingStream(n))&&(d().forEach&&d().forEach(function(e){n&&e.id==n.id&&(n=null)}),n&&r.addStream(n))}),r.oniceconnectionstatechange=r.onsignalingstatechange=function(){var e=t.extra;o.peers[t.userid]&&(e=o.peers[t.userid].extra||e),r&&i.onPeerStateChanged({iceConnectionState:r.iceConnectionState,iceGatheringState:r.iceGatheringState,signalingState:r.signalingState,extra:e,userid:t.userid})};var c={OfferToReceiveAudio:!!n.length,OfferToReceiveVideo:!!n.length};i.localPeerSdpConstraints&&(c=i.localPeerSdpConstraints),V.sdpConstraints=b(c);var u;r.addEventListener("addstream",function(n){if(n){if(n.streams&&n.streams.length&&!n.stream){if(!u)return void(u=new U);if(n.streams.forEach(function(e){e.getVideoTracks().length&&u.addTrack(e.getVideoTracks()[0]),e.getAudioTracks().length&&u.addTrack(e.getAudioTracks()[0])}),n.stream=u,o.session.audio&&o.session.video&&(!u.getVideoTracks().length||!u.getAudioTracks().length))return;u=null}var e={};i.remoteSdp&&i.remoteSdp.streamsToShare?e=i.remoteSdp.streamsToShare:i.streamsToShare&&(e=i.streamsToShare);var t=e[n.stream.id];t&&(n.stream.isAudio=t.isAudio,n.stream.isVideo=t.isVideo,n.stream.isScreen=t.isScreen),n.stream.streamid=n.stream.id,n.stream.stop||(n.stream.stop=function(){if(E){var e="ended";"oninactive"in n.stream&&(e="inactive"),v(n.stream,e)}}),a[n.stream.id]=n.stream,i.onRemoteStream(n.stream)}},!1),r.onremovestream=function(e){e.stream.streamid=e.stream.id,a[e.stream.id]&&delete a[e.stream.id],i.onRemoteStreamRemoved(e.stream)},this.addRemoteCandidate=function(e){r.addIceCandidate(new B(e))},this.addRemoteSdp=function(n,e){n.sdp=o.processSdp(n.sdp),r.setRemoteDescription(new W(n),e||function(){},function(e){o.enableLogs&&webrtcdev.error(JSON.stringify(e,null,"\t"),"\n",n.type,n.sdp)})};var l=!0;function f(n){n.binaryType="arraybuffer",n.onmessage=function(e){i.onDataChannelMessage(e.data)},n.onopen=function(){i.onDataChannelOpened(n)},n.onerror=function(e){i.onDataChannelError(e)},n.onclose=function(e){i.onDataChannelClosed(e)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},r.channel=n}i.remoteSdp&&(l=!1),this.createDataChannel=function(){f(r.createDataChannel("sctp",{}))},!0!==o.session.data||e||(l?this.createDataChannel():r.ondatachannel=function(e){f(e.channel)}),i.remoteSdp&&(i.remoteSdp.remotePeerSdpConstraints&&(c=i.remoteSdp.remotePeerSdpConstraints),V.sdpConstraints=b(c),this.addRemoteSdp(i.remoteSdp,function(){p("createAnswer")})),"two-way"!=o.session.audio&&"two-way"!=o.session.video&&"two-way"!=o.session.screen||(V.sdpConstraints=b({OfferToReceiveAudio:"two-way"==o.session.audio||i.remoteSdp&&i.remoteSdp.remotePeerSdpConstraints&&i.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==o.session.video||"two-way"==o.session.screen||i.remoteSdp&&i.remoteSdp.remotePeerSdpConstraints&&i.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var m={};function p(e){r[e](function(e){e.sdp=o.processSdp(e.sdp),r.setLocalDescription(e,function(){o.trickleIce&&(i.onLocalSdp({type:e.type,sdp:e.sdp,remotePeerSdpConstraints:i.remotePeerSdpConstraints||!1,renegotiatingPeer:!!i.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!i.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:m,isFirefoxOffered:E}),o.onSettingLocalDescription(t))},function(e){o.enableLogs&&webrtcdev.error("setLocalDescription error",e)})},function(e){o.enableLogs&&webrtcdev.error("sdp-error",e)},V.sdpConstraints)}d().forEach&&d().forEach(function(e){m[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),l&&p("createOffer"),r.nativeClose=r.close,r.close=function(){if(r){try{-1===r.iceConnectionState.search(/closed|failed/gi)&&r.getRemoteStreams().forEach(function(e){e.stop()}),r.nativeClose()}catch(e){}r=null,t.peer=null}},this.peer=r}function t(e){var n="urls";A&&(n="url");var t={};return t[n]=e,t}function i(e,n,t){var i="urls";A&&(i="url");var o={username:n,credential:t};return o[i]=e,o}function o(){var n=[];return window.RMCExternalIceServers.forEach(function(e){e.urls||(e.urls=e.url),-1!==e.urls.search("stun|stuns")&&n.push(t(e.urls)),-1!==e.urls.search("turn|turns")&&n.push(i(e.urls,e.username,e.credential))}),n}function k(o){function n(e,n){var t,i;t=o.localMediaConstraints,i=e,t.mandatory&&t.mandatory.chromeMediaSource?i.isScreen=!0:t.mozMediaSource||t.mediaSource?i.isScreen=!0:t.video?i.isVideo=!0:t.audio&&(i.isAudio=!0),o.onGettingLocalMedia(e,n),e.addEventListener("ended",function(){delete H.streams[r],H.mutex=!1,H.queueRequests.indexOf(o)&&(delete H.queueRequests[H.queueRequests.indexOf(o)],H.queueRequests=s(H.queueRequests))},!1),H.streams[r]={stream:e},H.mutex=!1,H.queueRequests.length&&k(H.queueRequests.shift())}if(!0!==H.mutex){H.mutex=!0;var r=JSON.stringify(o.localMediaConstraints);if(H.streams[r])n(H.streams[r].stream,!0);else{if(A&&window.PluginRTC)return document.createElement("video"),void window.PluginRTC.getUserMedia({audio:!0,video:!0},function(e){e.streamid=e.id||p(),n(e)},function(e){});if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(o.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||p(),e.idInstance=r,n(e)},function(e){o.onLocalMediaError(e,o.localMediaConstraints)});navigator.mediaDevices.getUserMedia(o.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||p(),e.idInstance=r,n(e)}).catch(function(e){o.onLocalMediaError(e,o.localMediaConstraints)})}}else H.queueRequests.push(o)}function T(e){if(e){if(E)return P(e);if("desktop"==J)return e(!0);window.postMessage("webrtcdev-extension-presence","*"),setTimeout(function(){e("screen"!=J)},2e3)}}function P(i){if(i){if(!E)return T(i);var o=!1;window.addEventListener("message",function e(n){var t=n.data;t&&void 0!==t.isScreenCapturingEnabled&&(i((o=!0)===t.isScreenCapturingEnabled),window.removeEventListener("message",e,!1))},!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){o||i(!0)},2e3)}}function R(e,n){if(2!=arguments.length&&(n=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),E)return n("not-chrome");var t=document.createElement("img");t.src="chrome-extension://"+e+"/icon.png",t.onload=function(){J="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==J?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function n(a){var s={};return{receive:function(e,n,t){var i=e.uuid;if(s[i]||(s[i]=[]),s[i].push(e.message),e.last){var o=s[i].join("");e.isobject&&(o=JSON.parse(o));var r={data:o,userid:n,extra:t,latency:(new Date).getTime()-e.sendingTime};a.autoTranslateText?(r.original=r.data,a.Translator.TranslateText(r.data,function(e){r.data=e,a.onmessage(r)})):a.onmessage(r),delete s[i]}}}}var r=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),E=void 0!==window.InstallTrigger,u=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),l=!!window.chrome&&!r,O=!!document.documentMode,M=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);"undefined"!=typeof cordova&&(l=M=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(l=M=!0);var A=!M&&(u||O);A&&"undefined"!=typeof URL&&(URL.createObjectURL=function(){});var I=(window.process&&"object"==_typeof(window.process)&&window.process.versions&&window.process.versions["node-webkit"],50),D=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);l&&D&&D[2]&&(I=parseInt(D[2],10));var L=50;D=navigator.userAgent.match(/Firefox\/(.*)/),E&&D&&D[1]&&(L=parseInt(D[1],10)),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var U=window.MediaStream;void 0===U&&"undefined"!=typeof webkitMediaStream&&(U=webkitMediaStream),void 0!==U&&("getVideoTracks"in U.prototype||(U.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var n=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("video")&&n.push(e)}),n},U.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var n=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("audio")&&n.push(e)}),n}),"stop"in U.prototype||(U.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),function(){function e(e,n){var t=0,i=!1,o=window.setInterval(function(){e()&&(window.clearInterval(o),n(i)),50<t++&&(window.clearInterval(o),n(i=!0))},10)}function n(n){return y?(!s.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(s.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!s.enumerateDevices&&s.enumerateDevices&&(s.enumerateDevices=s.enumerateDevices.bind(s)),s.enumerateDevices?(h=[],S=[],C=[],b=[],void s.enumerateDevices(function(e){e.forEach(function(e){var n,t={};for(var i in e)t[i]=e[i];"audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),h.forEach(function(e){e.id===t.id&&e.kind===t.kind&&(n=!0)}),n||(t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||E||(E=!0),"audioinput"!==t.kind||R||(R=!0)):(t.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(k=!0,-1===S.indexOf(t)&&S.push(t)),"audiooutput"===t.kind&&(T=!0,-1===C.indexOf(t)&&C.push(t)),"videoinput"===t.kind&&(P=!0,-1===b.indexOf(t)&&b.push(t)),-1===h.indexOf(t)&&h.push(t))}),void 0!==x&&(x.MediaDevices=h,x.hasMicrophone=k,x.hasSpeakers=T,x.hasWebcam=P,x.isWebsiteHasWebcamPermissions=E,x.isWebsiteHasMicrophonePermissions=R,x.audioInputDevices=S,x.audioOutputDevices=C,x.videoInputDevices=b),n&&n()})):void(n&&n())):void(n&&n())}var t,i="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";t="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:i,getUserMedia:function(){}},t.window=global),"undefined"==typeof document&&(t.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(t.screen={width:0,height:0}));var s=window.navigator;void 0!==s?(void 0!==s.webkitGetUserMedia&&(s.getUserMedia=s.webkitGetUserMedia),void 0!==s.mozGetUserMedia&&(s.getUserMedia=s.mozGetUserMedia)):s={getUserMedia:function(){},userAgent:i};var o=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(s.userAgent||""),d=!(-1===s.userAgent.indexOf("Edge")||!s.msSaveOrOpenBlob&&!s.msSaveBlob),c=!!window.opera||0<=s.userAgent.indexOf(" OPR/"),u=void 0!==window.InstallTrigger,l=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),f=!!window.chrome&&!c,m=!!document.documentMode&&!d,r={Android:function(){return s.userAgent.match(/Android/i)},BlackBerry:function(){return s.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return s.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return s.userAgent.match(/Opera Mini/i)},Windows:function(){return s.userAgent.match(/IEMobile/i)},any:function(){return r.Android()||r.BlackBerry()||r.iOS()||r.Opera()||r.Windows()},getOsName:function(){var e="Unknown OS";return r.Android()&&(e="Android"),r.BlackBerry()&&(e="BlackBerry"),r.iOS()&&(e="iOS"),r.Opera()&&(e="Opera Mini"),r.Windows()&&(e="Windows"),e}},a="Unknown OS",p="Unknown OS Version";if(r.any())a=r.getOsName();else{var v=function(){var e=s.appVersion,n=s.userAgent,t="-",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var o in i){var r=i[o];if(r.r.test(n)){t=r.s;break}}var a="-";switch(/Windows/.test(t)&&(/Windows (.*)/.test(t)&&(a=/Windows (.*)/.exec(t)[1]),t="Windows"),t){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(a=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(e))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:t,osVersion:a}}();a=v.osName,p=v.osVersion}var g=!1,w=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){!g&&e in document.createElement("canvas")&&(g=!0),!w&&e in document.createElement("video")&&(w=!0)});var h=[],S=[],C=[],b=[];s.mediaDevices&&s.mediaDevices.enumerateDevices&&(s.enumerateDevices=function(e){s.mediaDevices.enumerateDevices().then(e).catch(function(){e([])})});var y=!1;void 0!==j&&"getSources"in j?y=!0:s.mediaDevices&&s.mediaDevices.enumerateDevices&&(y=!0);var k=!1,T=!1,P=!1,R=!1,E=!1;n();var x=window.DetectRTC||{};x.browser=function(){var e,n,t,i=(s.appVersion,s.userAgent),o=s.appName,r=""+parseFloat(s.appVersion),a=parseInt(s.appVersion,10);if(c){o="Opera";try{a=(r=s.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){r="0.0.0.0",a=0}}else m?(n=i.indexOf("MSIE"),o="IE",r=i.substring(n+5)):f?(n=i.indexOf("Chrome"),o="Chrome",r=i.substring(n+7)):l?(n=i.indexOf("Safari"),o="Safari",r=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(r=i.substring(n+8))):u?(n=i.indexOf("Firefox"),o="Firefox",r=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(o=i.substring(e,n),r=i.substring(n+1),o.toLowerCase()===o.toUpperCase()&&(o=s.appName));return d&&(o="Edge",r=parseInt(s.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),-1!==(t=r.indexOf(";"))&&(r=r.substring(0,t)),-1!==(t=r.indexOf(" "))&&(r=r.substring(0,t)),a=parseInt(""+r,10),isNaN(a)&&(r=""+parseFloat(s.appVersion),a=parseInt(s.appVersion,10)),{fullVersion:r,version:a,name:o,isPrivateBrowsing:!1}}(),function(n){var t;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){t=!1},function(e){webrtcdev.log(e),t=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{i=window.indexedDB.open("test")}catch(e){t=!0}void 0===t&&e(function(){return"done"===i.readyState},function(e){e||(t=!i.result)})}else if(function(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&10<=parseInt(t[1],10))}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}e(function(){return void 0!==t},function(e){n(t)})}(function(e){x.browser.isPrivateBrowsing=!!e}),x.browser["is"+x.browser.name]=!0;var O=(window.process&&"object"==_typeof(window.process)&&window.process.versions&&window.process.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){O||e in window&&(O=!0)}),x.isWebRTCSupported=O,x.isORTCSupported="undefined"!=typeof RTCIceGatherer;var M=!1;x.browser.isChrome&&35<=x.browser.version?M=!0:x.browser.isFirefox&&34<=x.browser.version&&(M=!0),"https:"!==location.protocol&&(M=!1),x.isScreenCapturingSupported=M;var A={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){A.isSupported||e in window&&(A.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(A.isCreateMediaStreamSourceSupported=!0))}),x.isAudioContextSupported=A.isSupported,x.isCreateMediaStreamSourceSupported=A.isCreateMediaStreamSourceSupported;var I=!1;x.browser.isChrome&&31<x.browser.version&&(I=!0),x.isRtpDataChannelsSupported=I;var D=!1;x.browser.isFirefox&&28<x.browser.version?D=!0:x.browser.isChrome&&25<x.browser.version?D=!0:x.browser.isOpera&&11<=x.browser.version&&(D=!0),x.isSctpDataChannelsSupported=D,x.isMobileDevice=o;var L=!1;s.getUserMedia?L=!0:s.mediaDevices&&s.mediaDevices.getUserMedia&&(L=!0),x.browser.isChrome&&46<=x.browser.version&&"https:"!==location.protocol&&(x.isGetUserMediaSupported="Requires HTTPs"),x.isGetUserMediaSupported=L,x.osName=a,x.osVersion=p;var U="";screen.width&&(U+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));x.displayResolution=U,x.isCanvasSupportsStreamCapturing=g,x.isVideoSupportsStreamCapturing=w,x.DetectLocalIPAddress=function(n){x.isWebRTCSupported&&(x.isORTCSupported||function(i){function n(e){var n=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(e);if(n){var t=n[1];void 0===o[t]&&i(t),o[t]=!0}else webrtcdev.warn("Could not match IP address in",e)}var o={},e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t=!!window.webkitRTCPeerConnection;if(!e){var r=document.getElementById("iframe");if(!r)throw"NOTE: you need to have an iframe in the page right above the script tag.";var a=r.contentWindow;e=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection,t=!!a.webkitRTCPeerConnection}if(e){var s;t&&(s={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},void 0!==x&&x.browser.isFirefox&&x.browser.version<=38&&(s[0]={url:s[0].urls}));var d=new e(s,{optional:[{RtpDataChannels:!0}]});d.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},d.createDataChannel(""),d.createOffer(function(e){d.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=d.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}}(function(e){n(e.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+e:"Public: "+e)}))},x.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,x.isWebSocketsBlocked=!x.isWebSocketsSupported,x.checkWebSocketsSupport=function(n){n=n||function(){};try{var e=new WebSocket("wss://echo.websocket.org:443/");e.onopen=function(){x.isWebSocketsBlocked=!1,n(),e.close(),e=null},e.onerror=function(){x.isWebSocketsBlocked=!0,n()}}catch(e){x.isWebSocketsBlocked=!0,n()}},x.load=function(e){n(e=e||function(){})},x.MediaDevices=h,x.hasMicrophone=k,x.hasSpeakers=T,x.hasWebcam=P,x.isWebsiteHasWebcamPermissions=E,x.isWebsiteHasMicrophonePermissions=R,x.audioInputDevices=S,x.audioOutputDevices=C,x.videoInputDevices=b;var N=!1;"setSinkId"in document.createElement("video")&&(N=!0),x.isSetSinkIdSupported=N;var V=!1;x.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(V=!0):x.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(V=!0),x.isRTPSenderReplaceTracksSupported=V;var W=!1;x.browser.isFirefox&&38<x.browser.version&&(W=!0),x.isRemoteStreamProcessingSupported=W;var B=!1;void 0!==j&&"applyConstraints"in j.prototype&&(B=!0),x.isApplyConstraintsSupported=B;var F=!1;x.browser.isFirefox&&43<=x.browser.version&&(F=!0),x.isMultiMonitorScreenCapturingSupported=F,x.isPromisesSupported=!!("Promise"in window),void 0===x&&(window.DetectRTC={});var G=window.MediaStream;void 0===G&&"undefined"!=typeof webkitMediaStream&&(G=webkitMediaStream),x.MediaStream=void 0!==G&&Object.keys(G.prototype),x.MediaStreamTrack=void 0!==j&&Object.keys(j.prototype);var q=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;x.RTCPeerConnection=void 0!==q&&Object.keys(q.prototype),window.DetectRTC=x,"undefined"!=typeof module&&(module.exports=x),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return x})}(),document.addEventListener("deviceready",e,!1),e();var N,V={};"undefined"!=typeof mozRTCPeerConnection?N=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?N=webkitRTCPeerConnection:void 0!==window.RTCPeerConnection&&(N=window.RTCPeerConnection);var W=window.RTCSessionDescription||window.mozRTCSessionDescription,B=window.RTCIceCandidate||window.mozRTCIceCandidate,j=window.MediaStreamTrack;window.onPluginRTCInitialized=function(){j=window.PluginRTC.MediaStreamTrack,N=window.PluginRTC.RTCPeerConnection,B=window.PluginRTC.RTCIceCandidate,W=window.PluginRTC.RTCSessionDescription},void 0!==window.PluginRTC&&window.onPluginRTCInitialized();var F=function(){function l(e,n,t){return function(e,n,t,i,o){for(var r=-1!==t?t:e.length,a=n;a<r;++a)if(0===e[a].indexOf(i)&&(!o||-1!==e[a].toLowerCase().indexOf(o.toLowerCase())))return a;return null}(e,0,-1,n,t)}function f(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}var m=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(m=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(m=!0),{removeVPX:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("a=rtpmap:100 VP8/90000\r\n","")).replace("a=rtpmap:101 VP9/90000\r\n","")).replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2")).replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2")).replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2")).replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2")).replace("a=rtcp-fb:120 nack\r\n","")).replace("a=rtcp-fb:120 nack pli\r\n","")).replace("a=rtcp-fb:120 ccm fir\r\n","")).replace("a=rtcp-fb:101 nack\r\n","")).replace("a=rtcp-fb:101 nack pli\r\n","")).replace("a=rtcp-fb:101 ccm fir\r\n","")},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(i,e){if(e&&e.getSenders&&e.getSenders().length){if(!i||"string"!=typeof i)throw"Invalid arguments.";e.getSenders().forEach(function(e){for(var n=e.getParameters(),t=0;t<n.codecs.length;t++)if(n.codecs[t].mimeType==i){n.codecs.unshift(n.codecs.splice(t,1));break}e.setParameters(n)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,t){return i=e,r=t,(o=n)&&(void 0!==E&&E||m||(r&&(o.screen?o.screen<300&&webrtcdev.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):webrtcdev.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),o.screen&&r&&(i=(i=i.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+o.screen+"\r\n")),(o.audio||o.video||o.data)&&(i=i.replace(/b=AS([^\r\n]+\r\n)/g,"")),o.audio&&(i=i.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+o.audio+"\r\n")),o.video&&(i=i.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(r?o.screen:o.video)+"\r\n")))),i;var i,o,r},setVideoBitrates:function(e,n){return function(e,n){if(m)return e;var t,i=(n=n||{}).min,o=n.max,r=e.split("\r\n"),a=l(r,"a=rtpmap","VP8/90000");if(a&&(t=f(r[a])),!t)return e;var s,d=l(r,"a=rtpmap","rtx/90000");if(d&&(s=f(r[d])),!d)return e;var c=l(r,"a=fmtp:"+s.toString());if(null!==c){var u="\r\n";u+="a=fmtp:"+t+" x-google-min-bitrate="+(i||"228")+"; x-google-max-bitrate="+(o||"228"),r[c]=r[c].concat(u),e=r.join("\r\n")}return e}(e,n)},setOpusAttributes:function(e,n){return function(e,n){if(m)return e;n=n||{};var t,i=e.split("\r\n"),o=l(i,"a=rtpmap","opus/48000");if(o&&(t=f(i[o])),!t)return e;var r=l(i,"a=fmtp:"+t.toString());if(null===r)return e;var a="";return a+="; stereo="+(void 0!==n.stereo?n.stereo:"1"),a+="; sprop-stereo="+(void 0!==n["sprop-stereo"]?n["sprop-stereo"]:"1"),void 0!==n.maxaveragebitrate&&(a+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),void 0!==n.maxplaybackrate&&(a+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),void 0!==n.cbr&&(a+="; cbr="+(void 0!==n.cbr?n.cbr:"1")),void 0!==n.useinbandfec&&(a+="; useinbandfec="+n.useinbandfec),void 0!==n.usedtx&&(a+="; usedtx="+n.usedtx),void 0!==n.maxptime&&(a+="\r\na=maxptime:"+n.maxptime),i[r]=i[r].concat(a),i.join("\r\n")}(e,n)},preferVP9:function(e){return-1===e.indexOf("SAVPF 100 101")||-1===e.indexOf("VP9/90000")?e:e.replace("SAVPF 100 101","SAVPF 101 100")},forceStereoAudio:function(e){for(var n=e.split("\r\n"),t=null,i=0;i<n.length;i++)if(-1!==n[i].search("opus/48000")){var o=extractSdp(n[i],/:(\d+) opus\/48000/i);break}for(i=0;i<n.length;i++)if(-1!==n[i].search("a=fmtp")&&extractSdp(n[i],/a=fmtp:(\d+)/)===o){t=i;break}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}}}();window.BandwidthHandler=F;var G,q={processCandidates:function(e,n){var t=n.candidate,i=e.candidates,o=i.stun,r=i.turn;if(c(i.reflexive)||(o=i.reflexive),c(i.relay)||(r=i.relay),(i.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(o||!t.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!t.match(/ udp /g))&&(a.tcp||!t.match(/ tcp /g)))return e.enableLogs&&webrtcdev.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}};void 0!==window.getExternalIceServers&&1==window.getExternalIceServers&&function e(t,n){if(!G){if(!n)return e(t,!0);G=!0;var i=document.createElement("iframe");i.onload=function(){i.isLoaded=!0,w("message",function e(n){n.data&&n.data.iceServers&&(t(n.data.iceServers),window.removeEventListener("message",e))}),i.contentWindow.postMessage("get-ice-servers","*")},i.src="https://cdn.webrtc-experiment.com/getIceServers/",i.style.display="none",(document.body||document.documentElement).appendChild(i)}}(function(e){e&&e.length&&(window.RMCExternalIceServers=e,window.iceServersLoadCallback&&"function"==typeof window.iceServersLoadCallback&&window.iceServersLoadCallback(e))});var z={getIceServers:function(e){var n=[];return n.push(t("stun:stun.l.google.com:19302")),n.push(i("turn:webrtcweb.com:80","muazkh","muazkh")),n.push(i("turn:webrtcweb.com:443","muazkh","muazkh")),window.RMCExternalIceServers?n=n.concat(o()):void 0!==window.getExternalIceServers&&1==window.getExternalIceServers&&(e.iceServers=n,window.iceServersLoadCallback=function(){e.iceServers=e.iceServers.concat(o())}),n}},H={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){var t=(n=n.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=s(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}},_=function(){function a(e){return e?"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0:void 0}return{setHandlers:function(t,i,o){function r(){if(o.streamEvents[t.streamid].mediaElement){var e=o.streamEvents[t.streamid].mediaElement;e.volume=0,function e(n,t,i,o){t<=(o=(o||0)+1)||setTimeout(function(){i(),e(n,t,i,o)},n)}(200,5,function(){e.volume+=.2})}}t&&t.addEventListener&&((void 0===i||1==i)&&t.addEventListener("ended",function(){_.onSyncNeeded(this.streamid,"ended")},!1),t.mute=function(e,n){e=a(e),void 0!==n&&(i=n),(void 0===e||"audio"==e)&&t.getAudioTracks().forEach(function(e){e.enabled=!1,o.streamEvents[t.streamid].isAudioMuted=!0}),(void 0===e||"video"==e)&&t.getVideoTracks().forEach(function(e){e.enabled=!1}),(void 0===i||1==i)&&_.onSyncNeeded(t.streamid,"mute",e),o.streamEvents[t.streamid].muteType=e||"both",v(t,"mute",e)},t.unmute=function(e,n){e=a(e),void 0!==n&&(i=n),r(),(void 0===e||"audio"==e)&&t.getAudioTracks().forEach(function(e){e.enabled=!0,o.streamEvents[t.streamid].isAudioMuted=!1}),(void 0===e||"video"==e)&&(t.getVideoTracks().forEach(function(e){e.enabled=!0}),void 0!==e&&"video"==e&&o.streamEvents[t.streamid].isAudioMuted&&function e(n){n||(n=0),++n<100&&o.streamEvents[t.streamid].isAudioMuted&&(t.mute("audio"),setTimeout(function(){e(n)},50))}()),(void 0===i||1==i)&&_.onSyncNeeded(t.streamid,"unmute",e),o.streamEvents[t.streamid].unmuteType=e||"both",v(t,"unmute",e)})},onSyncNeeded:function(e,n,t){}}}();window.addEventListener("message",function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e)throw J="PermissionDeniedError",new Error("PermissionDeniedError");"rtcmulticonnection-extension-loaded"==e&&(J="desktop"),e.sourceId}(e.data)});var X,J="screen",$={send:function(e){var o=e.connection,r=e.channel,a=e.remoteUserId,n=e.text,s=o.chunkSize||1e3,d="",c=!1;"string"!=typeof n&&(c=!0,n=JSON.stringify(n));var u=p(),l=(new Date).getTime();!function e(n,t){var i={type:"text",uuid:u,sendingTime:l};n&&(t=n,i.packets=parseInt(t.length/s));t.length>s?i.message=t.slice(0,s):(i.message=t,i.last=!0,i.isobject=c);r.send(i,a);d=t.slice(i.message.length);d.length&&setTimeout(function(){e(null,d)},o.chunkInterval||100)}(n)}},Y={handle:function(t){var i={};t.onFileStart=function(e){var n=document.createElement("div");return n.title=e.name,n.innerHTML="<label>0%</label> <progress></progress>",e.remoteUserId&&(n.innerHTML+=" (Sharing with:"+e.remoteUserId+")"),t.filesContainer||(t.filesContainer=document.body||document.documentElement),t.filesContainer.insertBefore(n,t.filesContainer.firstChild),e.remoteUserId?(i[e.uuid]||(i[e.uuid]={}),i[e.uuid][e.remoteUserId]={div:n,progress:n.querySelector("progress"),label:n.querySelector("label")},void(i[e.uuid][e.remoteUserId].progress.max=e.maxChunks)):(i[e.uuid]={div:n,progress:n.querySelector("progress"),label:n.querySelector("label")},void(i[e.uuid].progress.max=e.maxChunks))},t.onFileProgress=function(e){var n=i[e.uuid];n&&(!e.remoteUserId||(n=i[e.uuid][e.remoteUserId]))&&(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}(n.progress,n.label))},t.onFileEnd=function(e){var n=i[e.uuid];if(n){if(!e.remoteUserId||(n=i[e.uuid][e.remoteUserId])){var t=n.div;-1!=e.type.indexOf("image")?t.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':t.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else webrtcdev.error("No such progress-helper element exists.",e)}}},K={handle:function(a){a.autoTranslateText=!1,a.language="en",a.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",a.Translator={TranslateText:function(n,t){var e=document.createElement("script");e.type="text/javascript";var i=encodeURIComponent(n),o="method"+a.token();window[o]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"===e.error.message&&(warn('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var r="https://www.googleapis.com/language/translate/v2?key="+a.googKey+"&target="+(a.language||"en-US")+"&callback=window."+o+"&q="+i;e.src=r,document.getElementsByTagName("head")[0].appendChild(e)}}}};window.RTCMultiConnection=function(e,n){function c(n){if(u.socketAutoReConnect=!0,u.socket)n&&n(u.socket);else{if(void 0===d)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new d(u,function(e){n&&n(u.socket)})}}function t(e,n){u.closeBeforeUnload&&(!0===u.isInitiator&&u.dontMakeMeModerator(),u.peers.getAllParticipants().forEach(function(e){l.onNegotiationNeeded({userLeft:!0},e),u.peers[e]&&u.peers[e].peer&&u.peers[e].peer.close(),delete u.peers[e]}),n||u.closeSocket(),u.broadcasters=[],u.isInitiator=!1)}function i(e,n){return e?(n.audio&&e.getAudioTracks().forEach(function(e){e.applyConstraints(n.audio)}),void(n.video&&e.getVideoTracks().forEach(function(e){e.applyConstraints(n.video)}))):void(u.enableLogs&&webrtcdev.error("No stream to applyConstraints."))}function r(n,e,t){return e?void l.replaceTrack(n,e,t):void u.peers.getAllParticipants().forEach(function(e){l.replaceTrack(n,e,t)})}function o(){if(u.isInitiator&&!u.session.oneway&&!u.session.broadcast&&"many-to-many"===u.direction){var n=u.broadcasters[0],t=[];u.broadcasters.forEach(function(e){e!==n&&t.push(e)}),u.autoCloseEntireSession||u.shiftModerationControl(n,t,!0)}}n=n||{useDefaultDevices:!0};var u=this;u.channel=u.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var l=new f(u);l.onGettingLocalMedia=function(n){n.type="local",u.setStreamEndHandler(n),g(n,function(e){e.id=n.streamid,e.muted=!0,e.volume=0,-1===u.attachStreams.indexOf(n)&&u.attachStreams.push(n),void 0!==_&&_.setHandlers(n,!0,u),u.streamEvents[n.streamid]={stream:n,type:"local",mediaElement:e,userid:u.userid,extra:u.extra,streamid:n.streamid,blobURL:e.src||URL.createObjectURL(n),isAudioMuted:!0},function(t,i){if(!t||!i)throw"Both arguments are required.";if(t.onspeaking&&t.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(i.stream,{onspeaking:function(){t.onspeaking(i)},onsilence:function(){t.onsilence(i)},onvolumechange:function(e,n){t.onvolumechange&&t.onvolumechange(merge({volume:e,threshold:n},i))}})}}(u,u.streamEvents[n.streamid]),m(u,u.streamEvents[n.streamid]),u.onstream(u.streamEvents[n.streamid])},u)},l.onGettingRemoteMedia=function(n,t){n.type="remote",u.setStreamEndHandler(n,"remote-stream"),g(n,function(e){e.id=n.streamid,void 0!==_&&_.setHandlers(n,!1,u),u.streamEvents[n.streamid]={stream:n,type:"remote",userid:t,extra:u.peers[t]?u.peers[t].extra:{},mediaElement:e,streamid:n.streamid,blobURL:e.src||URL.createObjectURL(n)},m(u,u.streamEvents[n.streamid]),u.onstream(u.streamEvents[n.streamid])},u)},l.onRemovingRemoteMedia=function(e,n){var t=u.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:u.peers[n]?u.peers[n].extra:{},streamid:e.streamid,mediaElement:u.streamEvents[e.streamid]?u.streamEvents[e.streamid].mediaElement:null}),u.onstreamended(t),delete u.streamEvents[e.streamid]},l.onNegotiationNeeded=function(e,n,t){c(function(){u.socket.emit(u.socketMessageEvent,"password"in e?e:{remoteUserId:e.remoteUserId||n,message:e,sender:u.userid},t||function(){})})},l.onUserLeft=function(e){u.deletePeer(e)},l.disconnectWith=function(e,n){u.socket&&u.socket.emit("disconnect-with",e,n||function(){}),u.deletePeer(e)},u.broadcasters=[],u.socketOptions={transport:"polling"},u.openOrJoin=function(s,d){u.checkPresence(s,function(e,n){if("function"==typeof d&&(d(e,n),d=null),e){u.sessionid=n;var t,i,o=!!u.session.oneway,r=h(u.session);i={OfferToReceiveAudio:u.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:u.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:o?!!u.session.audio:u.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o?!!u.session.video||!!u.session.screen:u.sdpConstraints.mandatory.OfferToReceiveVideo};var a={remoteUserId:u.sessionid,message:{newParticipationRequest:!0,isOneWay:o,isDataOnly:r,localPeerSdpConstraints:t,remotePeerSdpConstraints:i},sender:u.userid,password:d||!1};l.onNegotiationNeeded(a)}else u.userid,u.userid=u.sessionid=s||u.sessionid,u.userid+="",u.socket.emit("changed-uuid",u.userid),d&&u.socket.emit("set-password",d),u.isInitiator=!0,h(u.session)||u.captureUserMedia()})},u.open=function(e,n){return u.userid,u.userid=u.sessionid=e||u.sessionid,u.userid+="",u.isInitiator=!0,c(function(){u.socket.emit("changed-uuid",u.userid),1==n&&u.becomePublicModerator()}),h(u.session)?void("function"==typeof n&&n()):void u.captureUserMedia("function"==typeof n?n:null)},u.becomePublicModerator=function(){u.isInitiator&&u.socket.emit("become-a-public-moderator")},u.dontMakeMeModerator=function(){u.socket.emit("dont-make-me-moderator")},u.deletePeer=function(n){if(n){if(u.onleave({userid:n,extra:u.peers[n]?u.peers[n].extra:{}}),u.peers[n]){u.peers[n].streams.forEach(function(e){e.stop()});var e=u.peers[n].peer;if(e&&"closed"!==e.iceConnectionState)try{e.close()}catch(e){}u.peers[n]&&(u.peers[n].peer=null,delete u.peers[n])}if(-1!==u.broadcasters.indexOf(n)){var t=[];u.broadcasters.forEach(function(e){e!==n&&t.push(e)}),u.broadcasters=t,o()}}},u.rejoin=function(e){if(!u.isInitiator&&e&&Object.keys(e).length){var n={};u.peers[e.remoteUserId]&&(n=u.peers[e.remoteUserId].extra,u.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(u.join(e.remoteUserId),u.onReConnecting({userid:e.remoteUserId,extra:n}))}},u.join=u.connect=function(e,n){u.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||u.sessionid,u.sessionid+="";var t=!1,i=!1,o=!1,r=!1;if(e&&e.session||!e||"string"==typeof e){var a=e&&e.session||u.session;o=!!a.oneway,r=h(a),i={OfferToReceiveAudio:u.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:u.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:o?!!u.session.audio:u.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o?!!u.session.video||!!u.session.screen:u.sdpConstraints.mandatory.OfferToReceiveVideo}}var s=function(){};"function"==typeof(n=n||{})&&(s=n,n={}),void 0!==n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(o=n.isOneWay),void 0!==n.isDataOnly&&(r=n.isDataOnly);var d={remoteUserId:u.sessionid,message:{newParticipationRequest:!0,isOneWay:o,isDataOnly:r,localPeerSdpConstraints:t,remotePeerSdpConstraints:i},sender:u.userid,password:!1};return c(function(){u.peers[u.sessionid]||(l.onNegotiationNeeded(d),s())}),d},u.connectWithAllParticipants=function(e){l.onNegotiationNeeded("connectWithAllParticipants",e||u.sessionid)},u.removeFromBroadcastersList=function(e){l.onNegotiationNeeded("removeFromBroadcastersList",e||u.sessionid),u.peers.getAllParticipants(e||u.sessionid).forEach(function(e){l.onNegotiationNeeded("dropPeerConnection",e),u.deletePeer(e)}),u.attachStreams.forEach(function(e){e.stop()})},u.getUserMedia=u.captureUserMedia=function(i,o){i=i||function(){};var r=o||u.session;return u.dontCaptureUserMedia||h(r)?void i():void((r.audio||r.video||r.screen)&&(r.screen?u.getScreenConstraints(function(e,n){if(e)throw e;u.invokeGetUserMedia({audio:!!S(u)&&C(n),video:n,isScreen:!0},function(e){if(!r.audio&&!r.video||S(u))i(e);else{var n={};for(var t in r)"screen"!==t&&(n[t]=r[t]);u.invokeGetUserMedia(o,i,n)}})}):(r.audio||r.video)&&u.invokeGetUserMedia(o,i,r)))},u.closeBeforeUnload=!0,window.addEventListener("beforeunload",t,!1),u.userid=p(),u.changeUserId=function(e,n){u.userid=e||p(),u.socket.emit("changed-uuid",u.userid,n||function(){})},u.extra={},u.attachStreams=[],u.session={audio:!0,video:!0},u.enableFileSharing=!1,u.bandwidth={screen:512,audio:128,video:512},u.codecs={audio:"opus",video:"VP9"},u.processSdp=function(e){return M||E||(e=F.setApplicationSpecificBandwidth(e,u.bandwidth,!!u.session.screen),e=F.setVideoBitrates(e,{min:8*u.bandwidth.video*1024,max:8*u.bandwidth.video*1024}),e=F.setOpusAttributes(e,{maxaveragebitrate:8*u.bandwidth.audio*1024,maxplaybackrate:8*u.bandwidth.audio*1024,stereo:1,maxptime:3}),"VP9"===u.codecs.video&&(e=F.preferVP9(e)),"H264"===u.codecs.video&&(e=F.removeVPX(e)),"G722"===u.codecs.audio&&(e=F.removeNonG722(e))),e},void 0!==F&&(u.BandwidthHandler=u.CodecsHandler=F),u.mediaConstraints={audio:{mandatory:{},optional:[{bandwidth:8*u.bandwidth.audio*1024||1048576}]},video:{mandatory:{},optional:[{bandwidth:8*u.bandwidth.video*1024||1048576},{facingMode:"user"}]}},E&&(u.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||M||DetectRTC.load(function(){var n,t;if(DetectRTC.MediaDevices.forEach(function(e){"audioinput"===e.kind&&!1!==u.mediaConstraints.audio&&(n=e),"videoinput"===e.kind&&!1!==u.mediaConstraints.video&&(t=e)}),n){if(E)return void(!0!==u.mediaConstraints.audio?u.mediaConstraints.audio.deviceId=n.id:u.mediaConstraints.audio={deviceId:n.id});1==u.mediaConstraints.audio&&(u.mediaConstraints.audio={mandatory:{},optional:[]}),u.mediaConstraints.audio.optional||(u.mediaConstraints.audio.optional=[]);var e=[{sourceId:n.id}];u.mediaConstraints.audio.optional=e.concat(u.mediaConstraints.audio.optional)}if(t){if(E)return void(!0!==u.mediaConstraints.video?u.mediaConstraints.video.deviceId=t.id:u.mediaConstraints.video={deviceId:t.id});1==u.mediaConstraints.video&&(u.mediaConstraints.video={mandatory:{},optional:[]}),u.mediaConstraints.video.optional||(u.mediaConstraints.video.optional=[]),e=[{sourceId:t.id}],u.mediaConstraints.video.optional=e.concat(u.mediaConstraints.video.optional)}}),u.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},u.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},u.iceServers=z.getIceServers(u),u.candidates={host:!0,stun:!0,turn:!0},u.iceProtocols={tcp:!0,udp:!0},u.onopen=function(e){u.enableLogs&&webrtcdev.info("Data connection has been opened between you & ",e.userid)},u.onclose=function(e){u.enableLogs&&webrtcdev.warn("Data connection has been closed between you & ",e.userid)},u.onerror=function(e){webrtcdev.log("========================",e),u.enableLogs&&webrtcdev.error(e.userid,"data-error",e)},u.onmessage=function(e){u.enableLogs&&webrtcdev.debug("data-message",e.userid,e.data)},u.send=function(e,n){webrtcdev.log("connection send -> connection.peers",u.peers),u.peers.send(e,n)},u.close=u.disconnect=u.leave=function(){t(0,!0)},u.closeEntireSession=function(n){n=n||function(){},u.socket.emit("close-entire-session",function e(){return u.getAllParticipants().length?void setTimeout(e,100):(u.onEntireSessionClosed({sessionid:u.sessionid,userid:u.userid,extra:u.extra}),void u.changeUserId(null,function(){u.close(),n()}))})},u.onEntireSessionClosed=function(e){u.enableLogs&&webrtcdev.info("Entire session is closed: ",e.sessionid,e.extra)},u.onstream=function(e){var n=u.videosContainer;n.insertBefore(e.mediaElement,n.firstChild),e.mediaElement.play(),setTimeout(function(){e.mediaElement.play()},5e3)},u.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},u.direction="many-to-many",u.removeStream=function(n){var t;return u.attachStreams.forEach(function(e){e.id===n&&(t=e)}),t?(u.peers.getAllParticipants().forEach(function(e){var n=u.peers[e];try{n.peer.removeStream(t)}catch(e){}}),void u.renegotiate()):void webrtcdev.warn("No such stream exists.",n)},u.addStream=function(t,n){function i(e){t.streamCallback&&t.streamCallback(e),u.renegotiate(n)}return t.getAudioTracks?(-1===u.attachStreams.indexOf(t)&&(t.streamid||(t.streamid=t.id),u.attachStreams.push(t)),void u.renegotiate(n)):h(t)?void u.renegotiate(n):void((t.audio||t.video||t.screen)&&(t.screen?u.getScreenConstraints(function(e,n){return e?alert(e):void u.invokeGetUserMedia({audio:!!S(u)&&C(n),video:n,isScreen:!0},!t.audio&&!t.video||S(u)?i:u.invokeGetUserMedia(null,i))}):(t.audio||t.video)&&u.invokeGetUserMedia(null,i)))},u.invokeGetUserMedia=function(t,i,e){e||(e=u.session),t||(t=u.mediaConstraints),k({onGettingLocalMedia:function(e){var n=t.video;n&&(n.mediaSource||n.mozMediaSource?e.isScreen=!0:n.mandatory&&n.mandatory.chromeMediaSource&&(e.isScreen=!0)),e.isScreen||(e.isVideo=e.getVideoTracks().length,e.isAudio=!e.isVideo&&e.getAudioTracks().length),l.onGettingLocalMedia(e),i&&i(e)},onLocalMediaError:function(e,n){l.onLocalMediaError(e,n)},localMediaConstraints:t||{audio:!!e.audio&&t.audio,video:!!e.video&&t.video}})},u.applyConstraints=function(n,e){if(j&&j.prototype.applyConstraints){var t;if(e)return u.streamEvents[e]&&(t=u.streamEvents[e].stream),void i(t,n);u.attachStreams.forEach(function(e){i(e,n)})}else alert("track.applyConstraints is NOT supported in your browser.")},u.replaceTrack=function(t,n,i){function o(e){u.replaceTrack(e,n,i||t.video||t.screen)}if(t=t||{},N.prototype.getSenders)if(t instanceof j)r(t,n,i);else{if(t instanceof U)return t.getVideoTracks().length&&r(t.getVideoTracks()[0],n,!0),void(t.getAudioTracks().length&&r(t.getAudioTracks()[0],n,!1));if(h(t))throw"connection.replaceTrack requires audio and/or video and/or screen.";(t.audio||t.video||t.screen)&&(t.screen?u.getScreenConstraints(function(e,n){return e?alert(e):void u.invokeGetUserMedia({audio:!!S(u)&&C(n),video:n,isScreen:!0},!t.audio&&!t.video||S(u)?o:u.invokeGetUserMedia(null,o))}):(t.audio||t.video)&&u.invokeGetUserMedia(null,o))}else u.addStream(t)},u.resetTrack=function(e,t){e||(e=u.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var n=u.peers[e].peer;void 0!==t&&!0!==t||!n.lastVideoTrack||u.replaceTrack(n.lastVideoTrack,e,!0),void 0!==t&&!1!==t||!n.lastAudioTrack||u.replaceTrack(n.lastAudioTrack,e,!1)})},u.renegotiate=function(e){return e?void l.renegotiatePeer(e):void u.peers.getAllParticipants().forEach(function(e){l.renegotiatePeer(e)})},u.setStreamEndHandler=function(n,t){n&&n.addEventListener&&(t=!!t,n.alreadySetEndHandler||(n.alreadySetEndHandler=!0,n.addEventListener("ended",function(){n.idInstance&&H.remove(n.idInstance),t||delete u.attachStreams[u.attachStreams.indexOf(n)];var e=u.streamEvents[n.streamid];e||(e={stream:n,streamid:n.streamid,type:t?"remote":"local",userid:u.userid,extra:u.extra,mediaElement:u.streamEvents[n.streamid]?u.streamEvents[n.streamid].mediaElement:null}),(e.userid!==u.userid||"remote"!==e.type)&&(u.onstreamended(e),delete u.streamEvents[n.streamid])},!1)))},u.onMediaError=function(e,n){u.enableLogs&&webrtcdev.error(e,n)},u.addNewBroadcaster=function(e,n){u.broadcasters.length&&setTimeout(function(){l.connectNewParticipantWithAllBroadcasters(e,n,u.broadcasters.join("|-,-|"))},1e4),u.session.oneway||u.session.broadcast||"many-to-many"!==u.direction||-1!==u.broadcasters.indexOf(e)||(u.broadcasters.push(e),o())},u.autoCloseEntireSession=!1,u.filesContainer=u.videosContainer=document.body||document.documentElement,u.isInitiator=!1,u.shareFile=l.shareFile,void 0!==Y&&Y.handle(u),void 0!==K&&K.handle(u),u.token=p,u.onNewParticipant=function(e,n){u.acceptParticipationRequest(e,n)},u.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),l.createNewPeer(e,n)},u.onShiftedModerationControl=function(e,n){u.acceptModerationControl(e,n)},u.acceptModerationControl=function(n,e){u.isInitiator=!0,u.broadcasters=e,u.peers.getAllParticipants().forEach(function(e){l.onNegotiationNeeded({changedUUID:n,oldUUID:u.userid,newUUID:n},e)}),u.userid=n,u.socket.emit("changed-uuid",u.userid)},u.shiftModerationControl=function(e,n,t){l.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:n,firedOnLeave:!!t},e)},void 0!==_&&(u.StreamsHandler=_),u.onleave=function(e){},u.invokeSelectFileDialog=function(e){(new FileSelector).selectSingleFile(e)},u.getPublicModerators=function(e,n){"function"==typeof e&&(n=e),c(function(){u.socket.emit("get-public-moderators","string"==typeof e?e:"",n)})},u.onmute=function(e){e&&e.mediaElement&&("both"===e.muteType||"video"===e.muteType?(e.mediaElement.src=null,e.mediaElement.pause(),e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===e.muteType&&(e.mediaElement.muted=!0))},u.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.src=URL.createObjectURL(e.stream),e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},u.onExtraDataUpdated=function(e){e.status="online",u.onUserStatusChanged(e,!0)},u.onJoinWithPassword=function(e){webrtcdev.warn(e,"is password protected. Please join with password.")},u.onInvalidPassword=function(e,n){webrtcdev.warn(e,"is password protected. Please join with valid password. Your old password",n,"is wrong.")},u.onPasswordMaxTriesOver=function(e){webrtcdev.warn(e,"is password protected. Your max password tries exceeded the limit.")},u.getAllParticipants=function(e){return u.peers.getAllParticipants(e)},void 0!==_&&(_.onSyncNeeded=function(n,t,i){u.peers.getAllParticipants().forEach(function(e){l.onNegotiationNeeded({streamid:n,action:t,streamSyncNeeded:!0,type:i||"both"},e)})}),u.connectSocket=function(e){c(e)},u.socketAutoReConnect=!0,u.closeSocket=function(){try{io.sockets={}}catch(e){}u.socket&&(u.socketAutoReConnect=!1,"function"==typeof u.socket.disconnect&&u.socket.disconnect(),u.socket=null)},u.getSocket=function(e){return u.socket?e&&e(u.socket):c(e),u.socket},u.getRemoteStreams=l.getRemoteStreams;var a=["selectFirst","selectAll","forEach"];if(u.streamEvents={selectFirst:function(e){if(!e){var n;for(var t in u.streamEvents)-1!==a.indexOf(t)||n||(n=u.streamEvents[t]);return n}},selectAll:function(){}},u.socketURL="/",u.socketMessageEvent="RTCMultiConnection-Message",u.socketCustomEvent="RTCMultiConnection-Custom-Message",u.DetectRTC=DetectRTC,u.setCustomSocketEvent=function(e){e&&(u.socketCustomEvent=e),u.socket&&u.socket.emit("set-custom-socket-event-listener",u.socketCustomEvent)},u.getNumberOfBroadcastViewers=function(e,n){u.socket&&e&&n&&u.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},u.onNumberOfBroadcastViewersUpdated=function(e){u.enableLogs&&u.isInitiator&&webrtcdev.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},u.onUserStatusChanged=function(e,n){u.enableLogs&&!n&&webrtcdev.info(e.userid,e.status)},u.getUserMediaHandler=k,u.multiPeersHandler=l,u.enableLogs=!0,u.setCustomSocketHandler=function(e){void 0!==d&&(d=e)},u.chunkSize=65e3,u.maxParticipantsAllowed=50,u.disconnectWith=l.disconnectWith,u.checkPresence=function(e,n){return u.socket?void u.socket.emit("check-presence",(e||u.sessionid)+"",n):void u.connectSocket(function(){u.checkPresence(e,n)})},u.onReadyForOffer=function(e,n){u.multiPeersHandler.createNewPeer(e,n)},u.setUserPreferences=function(e){return u.dontAttachStream&&(e.dontAttachLocalStream=!0),u.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},u.updateExtraData=function(){u.socket.emit("extra-data-updated",u.extra)},u.enableScalableBroadcast=!1,u.maxRelayLimitPerUser=3,u.dontCaptureUserMedia=!1,u.dontAttachStream=!1,u.dontGetRemoteStream=!1,u.onReConnecting=function(e){u.enableLogs&&webrtcdev.info("ReConnecting with",e.userid,"...")},u.beforeAddingStream=function(e){return e},u.beforeRemovingStream=function(e){return e},void 0!==T&&(u.checkIfChromeExtensionAvailable=T),void 0!==P&&(u.checkIfChromeExtensionAvailable=P),void 0!==R&&(u.getChromeExtensionStatus=R),u.getScreenConstraints=function(t,e){var i,o;S(u,e)&&(e=!0),i=function(e,n){e||(n=u.modifyScreenConstraints(n),t(e,n))},o=e,E?i(null,{mozMediaSource:"window",mediaSource:"window",width:29999,height:8640}):T(function(e){var n={mandatory:{chromeMediaSource:J,maxWidth:29999,maxHeight:8640,minFrameRate:30,maxFrameRate:128,minAspectRatio:1.77},optional:[]};return"desktop"!=J||X?("desktop"==J&&(n.mandatory.chromeMediaSourceId=X),void i(null,n)):void getSourceId(function(){n.mandatory.chromeMediaSourceId=X,i("PermissionDeniedError"==X?X:null,n),X=null},o)})},u.modifyScreenConstraints=function(e){return e},u.onPeerStateChanged=function(e){u.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&webrtcdev.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},u.isOnline=!0,w("online",function(){u.isOnline=!0}),w("offline",function(){u.isOnline=!1}),u.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(u.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),u.isLowBandwidth)){if(u.bandwidth={audio:30,video:30,screen:30},u.mediaConstraints.audio&&u.mediaConstraints.audio.optional&&u.mediaConstraints.audio.optional.length){var s=[];u.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&s.push(e)}),u.mediaConstraints.audio.optional=s}u.mediaConstraints.video&&u.mediaConstraints.video.optional&&u.mediaConstraints.video.optional.length&&(s=[],u.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&s.push(e)}),u.mediaConstraints.video.optional=s)}u.getExtraData=function(e){if(!e)throw"remoteUserId is required.";return u.peers[e]?u.peers[e].extra:{}},n.autoOpenOrJoin&&u.openOrJoin(u.sessionid),u.onUserIdAlreadyTaken=function(e,n){u.enableLogs&&webrtcdev.warn("Userid already taken.",e,"Your new userid:",n),u.join(e)},u.trickleIce=!0,u.onSettingLocalDescription=function(e){u.enableLogs&&webrtcdev.info("Set local description for remote user",e.userid)}}}();
"";var sourceId,screen_constraints,screenStreamId,scrConn,screenCallback,signaler,screen,screenRoomid,screenShareButton,chromeMediaSource="screen",isFirefox=void 0!==window.InstallTrigger,isOpera=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),isChrome=!!window.chrome&&!isOpera,isMobileDevice=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),iceServers=[],screenShareStreamLocal=null;function getSourceId(e,n){if(!e)throw'"callback" parameter is mandatory.';window.postMessage("webrtcdev-extension-getsourceId","*")}function getChromeExtensionStatus(n,t){if(2!=arguments.length&&(t=n,n=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),isFirefox)return t("not-chrome");if(!n)return t("Null extensionID");try{var e=document.createElement("img");e.src="chrome-extension://"+n+"/icon.png",e.onload=function(){webrtcdev.info("screenshare extension ",e.src),chromeMediaSource="screen",window.postMessage("webrtcdev-extension-presence","*"),setTimeout(function(){t("screen"==chromeMediaSource?n==n?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},e.onerror=function(){webrtcdev.error("No screenshare extension ",e.src),t("not-installed")}}catch(e){webrtcdev.error("Screenshare extension image not found chrome-extension://",n,"/icon.png",e),t("not-installed")}}function isChromeExtensionAvailable(e){if(e){if(isFirefox)return isFirefoxExtensionAvailable(e);if("desktop"==chromeMediaSource)return e(!0);window.postMessage("webrtcdev-extension-presence","*"),setTimeout(function(){e("screen"!=chromeMediaSource)},2e3)}}function webrtcdevPrepareScreenShare(e){var n=(new Date).getUTCMilliseconds();null==screenRoomid&&(screenRoomid="screenshare_"+sessionid+"_"+n),webrtcdev.log(" webrtcdevPrepareScreenShare"+screenRoomid),webrtcdev.log(" Screenshare ||  filling up iceServers ",turn,webrtcdevIceServers),scrConn=new RTCMultiConnection,turn&&"none"!=turn&&(webrtcdevIceServers||alert("ICE server not found yet in screenshare session "),scrConn.iceServers=webrtcdevIceServers),scrConn.channel=screenRoomid,scrConn.socketURL=socketAddr,scrConn.session={screen:!0,oneway:!0},scrConn.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!0},scrConn.dontCaptureUserMedia=!1,scrConn.onMediaError=function(e,n){webrtcdev.error(e,n),shownotificationWarning(e.name)},scrConn.onstream=function(e){if(webrtcdev.log(" on stream in _screenshare :",e),"remote"==e.type&&"local"!=e.type){e.userid,e.type;var n=e.stream;e.stream.streamid?(webrtcdev.log("remote screen event.stream.streamId "+e.stream.streamId),screenStreamId=e.stream.streamid):e.streamid&&(webrtcdev.log("remote screen event.streamid "+e.streamid),screenStreamId=e.streamid);var t=document.createElement("video");attachMediaStream(t,n),document.getElementById(screenshareobj.screenshareContainer).appendChild(t),document.getElementById(screenshareobj.screenshareContainer).hidden=!1,rtcConn.send({type:"screenshare",screenid:screenRoomid,message:"screenshareStartedViewing"})}else webrtcdev.log("started streaming local screen"),rtcConn.send({type:"screenshare",screenid:screenRoomid,screenStreamid:screenStreamId,message:"startscreenshare"});onScreenShareStarted()},scrConn.onstreamended=function(e){e&&webrtcdev.log(" onstreamended in _screenshare :",e),document.getElementById(screenshareobj.screenshareContainer)&&(document.getElementById(screenshareobj.screenshareContainer).innerHTML=""),scrConn.removeStream(screenStreamId),screenShareButton&&(screenShareButton.className=screenshareobj.button.shareButton.class_off,screenShareButton.innerHTML=screenshareobj.button.shareButton.html_off)},webrtcdev.log(" webrtcdevscreenshare calling callback for socket.io operations"),alert(" Preparing Screenshare "+screenRoomid),setTimeout(e(screenRoomid),3e3),onScreenShareSEnded()}function webrtcdevSharescreen(){webrtcdev.log("webrtcdevSharescreen . screenRoomid = ",screenRoomid),webrtcdevPrepareScreenShare(function(n){var t="temp_"+(new Date).getUTCMilliseconds();scrConn.dontCaptureUserMedia=!1,scrConn.open(n,function(){webrtcdev.log("Event : open-channel-screenshare"),socket.emit("open-channel-screenshare",{channel:n,sender:t,maxAllowed:6}),shownotification(" Making a new session for screenshare"+n)}),socket.on("open-channel-screenshare-resp",function(e){webrtcdev.log("Event Handler : open-channel-screenshare",e),e&&connectScrWebRTC("open",n,t,[])})}),webrtcdev.log("webrtcdevscreenshare . srcConn = ",scrConn," | rtcConn = ",rtcConn)}function connectScrWebRTC(e,n,t,r){webrtcdev.log("connectScrWebRTC -> ",e,n,t,r),"open"==e?(scrConn.connect(screenRoomid),shownotification("Connected to "+screenRoomid+" for screenshare ")):"join"==e?(scrConn.join(screenRoomid),shownotification("Connected with existing Screenshare channel "+screenRoomid)):shownotification("Connection type not found for Screenshare ")}function webrtcdevScreenConstraints(e){webrtcdev.log(" webrtcdevScreenConstraints  - chromeMediaSourceId: ",e),screen_constraints={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920<window.screen.width?window.screen.width:1920,maxHeight:1080<window.screen.height?window.screen.height:1080},optional:[]}};try{webrtcdev.log(" screen getusermedia "),navigator.getUserMedia(screen_constraints,function(e){webrtcdev.log("screen stream ",e,screenshareobj.screenshareContainer);var n=e;screenShareStreamLocal=e,webrtcdev.log("Stream from getUserMedia",n),n.type="local",getRMCMediaElement(n,function(e){webrtcdev.log(" getRMCMediaElement Callback function --\x3e "+n.streamid+" .. "+n.id),n.streamid?(webrtcdev.log("using streamid"),e.id=n.streamid,e.muted=!0,e.volume=0,-1===scrConn.attachStreams.indexOf(n)&&scrConn.attachStreams.push(n),"undefined"!=typeof StreamsHandler&&StreamsHandler.setHandlers(n,!0,scrConn),scrConn.streamEvents[n.streamid]={stream:n,type:"local",mediaElement:e,userid:scrConn.userid,extra:scrConn.extra,streamid:n.streamid,blobURL:e.src||URL.createObjectURL(n),isAudioMuted:!0},scrConn.onstream(scrConn.streamEvents[n.streamid])):n.id?(webrtcdev.log("using id"),e.id=n.id,e.muted=!0,e.volume=0,-1===scrConn.attachStreams.indexOf(n)&&scrConn.attachStreams.push(n),"undefined"!=typeof StreamsHandler&&StreamsHandler.setHandlers(n,!0,scrConn),scrConn.streamEvents[n.id]={stream:n,type:"local",mediaElement:e,userid:scrConn.userid,extra:scrConn.extra,streamid:n.id,blobURL:e.src||URL.createObjectURL(n),isAudioMuted:!0},webrtcdev.log(scrConn.streamEvents[n.id]),scrConn.onstream(scrConn.streamEvents[n.id])):alert("screenshare has neither streamid not id")},scrConn)},function(e){webrtcdev.error(" Error in webrtcdevScreenConstraints ",e),isChrome&&"http:"===location.protocol?alert("Please test this WebRTC experiment on HTTPS."):isChrome?alert("Screen capturing is either denied or not supported. Please install chrome extension for screen capturing or run chrome with command-line flag: --enable-usermedia-screen-capturing"):navigator.mozGetUserMedia&&alert(Firefox_Screen_Capturing_Warning)})}catch(e){webrtcdev.log(" Error in webrtcdevScreenConstraints ",err)}}function getRMCMediaElement(t,e,r){webrtcdev.log(" getRMCMediaElement ",t,r);var n=!1;t.getVideoTracks&&!t.getVideoTracks().length&&(n=!0);var o=document.createElement(n?"audio":"video");return o.src=t,o.controls=!0,isFirefox&&o.addEventListener("ended",function(){if(currentUserMediaRequest.remove(t.idInstance),"local"===t.type){StreamsHandler.onSyncNeeded(t.streamid,"ended"),r.attachStreams.forEach(function(e,n){t.streamid===e.streamid&&delete r.attachStreams[n]});var n=[];r.attachStreams.forEach(function(e){e&&n.push(e)}),r.attachStreams=n;var e=r.streamEvents[t.streamid];if(e)return void r.onstreamended(e);this.parentNode&&this.parentNode.removeChild(this)}},!1),o.play(),void e(o)}function webrtcdevViewscreen(e){scrConn.join(e)}function webrtcdevStopShareScreen(){try{screenshareobj.screenshareContainer&&(document.getElementById(screenshareobj.screenshareContainer).innerHTML=""),rtcConn.send({type:"screenshare",screenid:screenRoomid,screenStreamid:screenStreamId,message:"stoppedscreenshare"}),window.postMessage("webrtcdev-extension-stopsource","*"),scrConn.onstreamended(),scrConn.close(),scrConn.closeEntireSession(),webrtcdev.log("Sender stopped: screenRoomid "+screenRoomid+" || Screen stoppped ",scrConn,document.getElementById(screenshareobj.screenshareContainer)),screenShareStreamLocal&&(screenShareStreamLocal.stop(),screenShareStreamLocal=null)}catch(e){webrtcdev.error(e)}}function createOrAssignScreenviewButton(){screenshareobj.button.viewButton.id&&document.getElementById(screenshareobj.button.viewButton.id)?assignScreenViewButton():createScreenViewButton()}function createScreenViewButton(){if(!document.getElementById("viewScreenShareButton")){var e=document.createElement("span");if(e.className=screenshareobj.button.viewButton.class_off,e.innerHTML=screenshareobj.button.viewButton.html_off,e.id="viewScreenShareButton",webrtcdevViewscreen(screenRoomid),e.onclick=function(){e.className==screenshareobj.button.viewButton.class_off?(document.getElementById(screenshareobj.screenshareContainer).hidden=!1,e.className=screenshareobj.button.viewButton.class_on,e.innerHTML=screenshareobj.button.viewButton.html_on):e.className==screenshareobj.button.viewButton.class_on&&(document.getElementById(screenshareobj.screenshareContainer).hidden=!0,e.className=screenshareobj.button.viewButton.class_off,e.innerHTML=screenshareobj.button.viewButton.html_off)},document.getElementById("topIconHolder_ul")){var n=document.createElement("li");n.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(n)}}}function assignScreenViewButton(){var e=document.getElementById(screenshareobj.button.viewButton.id);webrtcdevViewscreen(screenRoomid),e.onclick=function(){e.className==screenshareobj.button.viewButton.class_off?(document.getElementById(screenshareobj.screenshareContainer).hidden=!1,e.className=screenshareobj.button.viewButton.class_on,e.innerHTML=screenshareobj.button.viewButton.html_on):e.className==screenshareobj.button.viewButton.class_on&&(document.getElementById(screenshareobj.screenshareContainer).hidden=!0,e.className=screenshareobj.button.viewButton.class_off,e.innerHTML=screenshareobj.button.viewButton.html_off)}}function removeScreenViewButton(){if(document.getElementById("viewScreenShareButton")){var e=document.getElementById("viewScreenShareButton");e.parentElement.removeChild(e)}}function createScreenInstallButton(n){var t=document.createElement("span");t.className=screenshareobj.button.installButton.class_off,t.innerHTML=screenshareobj.button.installButton.html_off,t.id="screeninstallButton",t.onclick=function(e){chrome.webstore.install("https://chrome.google.com/webstore/detail/"+n,function(){webrtcdev.log("Chrome extension inline installation - success . createOrAssignScreenshareButton with ",screenshareobj),getSourceId(function(){},t.hidden=!0),createOrAssignScreenshareButton(screenshareobj)},function(e){webrtcdev.log("Chrome extension inline installation - fail ",e)}),e.preventDefault()};var e=document.createElement("li");e.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(e)}function assignScreenInstallButton(n){var t=document.getElementById(screenshareobj.button.installButton.id);t.onclick=function(e){chrome.webstore.install("https://chrome.google.com/webstore/detail/"+n,function(){webrtcdev.log("Chrome extension inline installation - success from assignScreenInstallButton . Now  createOrAssignScreenshareButton with ",screenshareobj),getSourceId(function(){},t.hidden=!0),createOrAssignScreenshareButton(screenshareobj)},function(e){webrtcdev.error("Chrome extension inline installation - fail ",e)}),e.preventDefault()}}function hideScreenInstallButton(){var e=document.getElementById(screenshareobj.button.installButton.id);e.hidden=!0,e.setAttribute("style","display:none")}function createOrAssignScreenshareButton(e){webrtcdev.log("createOrAssignScreenshareButton ",e),e.button.shareButton.id&&document.getElementById(e.button.shareButton.id)?(assignScreenShareButton(),hideScreenInstallButton(),showScreenShareButton()):createScreenShareButton()}function createScreenshareButton(){(screenShareButton=document.createElement("span")).className=screenshareobj.button.shareButton.class_off,screenShareButton.innerHTML=screenshareobj.button.shareButton.html_off,screenShareButton.id="screenShareButton",screenShareButton.onclick=function(e){screenShareButton.className==screenshareobj.button.shareButton.class_off?(webrtcdevSharescreen(),screenShareButton.className=screenshareobj.button.shareButton.class_on,screenShareButton.innerHTML=screenshareobj.button.shareButton.html_on):screenShareButton.className==screenshareobj.button.shareButton.class_on&&(screenShareButton.className=screenshareobj.button.shareButton.class_off,screenShareButton.innerHTML=screenshareobj.button.shareButton.html_off,webrtcdevStopShareScreen())};var e=document.createElement("li");return e.appendChild(screenShareButton),document.getElementById("topIconHolder_ul").appendChild(e),screenShareButton}function assignScreenShareButton(){webrtcdev.log("assignScreenShareButton");var n=document.getElementById(screenshareobj.button.shareButton.id);return n.onclick=function(e){n.className==screenshareobj.button.shareButton.class_off?(webrtcdevSharescreen(),n.className=screenshareobj.button.shareButton.class_on,n.innerHTML=screenshareobj.button.shareButton.html_on):(n.className=screenshareobj.button.shareButton.class_off,n.innerHTML=screenshareobj.button.shareButton.html_off,webrtcdevStopShareScreen())},n}function hideScreenShareButton(){var e=document.getElementById(screenshareobj.button.shareButton.id);e.hidden=!0,e.setAttribute("style","display:none")}function showScreenShareButton(){var e=document.getElementById(screenshareobj.button.shareButton.id);e.removeAttribute("hidden"),e.setAttribute("style","display:block")}function onScreenshareExtensionCallback(e){webrtcdev.log("onScreenshareExtensionCallback",e),e.data.chromeExtensionStatus&&webrtcdev.log(e.data.chromeExtensionStatus),e.data.sourceId&&("PermissionDeniedError"===e.data.sourceId?webrtcdev.error("permission-denied"):webrtcdevScreenConstraints(e.data.sourceId))}function detectExtension(n,t){return webrtcdev.log("detectExtension  ",n),getChromeExtensionStatus(n,function(e){webrtcdev.log("status extension ",e),webrtcdev.log("reset extension ",n),"not-installed"!=e&&window.postMessage("reset-webrtcdev-extension","*"),t(e)})}function showSrcConn(){webrtcdev.log(" srcConn : ",srcConn),webrtcdev.log(" srcConn.peers.getAllParticipants() : ",srcConn.peers.getAllParticipants())}var counterBeforeFailureNotice=0;function screenshareNotification(e,n){if(document.getElementById("alertBox")){if(document.getElementById("alertBox").innerHTML="","screenshareBegin"==n){var t=document.createElement("div");document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",t.className="alert alert-info",t.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>You have begun sharing screen , waiting for peer to view',document.getElementById("alertBox").appendChild(t),setTimeout(function(){var e=document.createElement("div");document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",e.className="alert alert-danger",e.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Peer was not able to view screen , please retry',document.getElementById("alertBox").appendChild(e)},2e4)}else if("screenshareStartedViewing"==n){t=document.createElement("div");document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",t.className="alert alert-success",t.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Peer has started viewing screen ',document.getElementById("alertBox").appendChild(t)}else if("screenshareError"==n){t=document.createElement("div");document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",t.className="alert alert-danger",t.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>There was a error while sharing screen , please contact support ',document.getElementById("alertBox").appendChild(t)}}else alert(e)}function createExtensionInstallWindow(){try{var e=document.createElement("div");e.className="modal fade",e.setAttribute("role","dialog"),e.id="screensharedialog";var n=document.createElement("div");n.className="modal-dialog";var t=document.createElement("div");t.className="modal-content";var r=document.createElement("div");r.className="modal-header";var o=document.createElement("button");o.className="close",o.setAttribute("data-dismiss","modal"),o.innerHTML="&times;";var s=document.createElement("h4");s.className="modal-title",s.innerHTML="Install extension",r.appendChild(s),r.appendChild(o);var a=document.createElement("div");a.className="modal-body";var c=document.createElement("div");c.innerHTML="install screen share extension ";var i=document.createElement("button");if(i.innerHTML=" Install ",i.onclick=function(e){chrome.webstore.install("https://chrome.google.com/webstore/detail/"+screenshareobj.extensionID,function(){webrtcdev.log("Chrome extension inline installation - success from assignScreenInstallButton . Now  createOrAssignScreenshareButton with ",screenshareobj),window.location.reload()},function(e){webrtcdev.error("Chrome extension inline installation - fail ",e)}),e.preventDefault()},a.appendChild(c),a.appendChild(i),t.appendChild(r),t.appendChild(a),n.appendChild(t),e.appendChild(n),document.getElementById("mainDiv"))document.getElementById("mainDiv").appendChild(e),$("#screensharedialog").modal("show")}catch(e){webrtcdev.error("[ createExtensionInstallWindow - Screenshare.js]",e)}}
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},WebRTCdetect=function(){var e,i="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";e="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:i,getUserMedia:function(){}},e.window=global),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}));var a=window.navigator;void 0!==a?(void 0!==a.webkitGetUserMedia&&(a.getUserMedia=a.webkitGetUserMedia),void 0!==a.mozGetUserMedia&&(a.getUserMedia=a.mozGetUserMedia)):a={getUserMedia:function(){},userAgent:i};var n=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(a.userAgent||""),d=!(-1===a.userAgent.indexOf("Edge")||!a.msSaveOrOpenBlob&&!a.msSaveBlob),c=!!window.opera||0<=a.userAgent.indexOf(" OPR/"),u=void 0!==window.InstallTrigger,w=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),p=!!window.chrome&&!c,f=!!document.documentMode&&!d;function r(e,i){var n=0,o=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),i(o)),50<n++&&(window.clearInterval(r),i(o=!0))},10)}var o={Android:function(){return a.userAgent.match(/Android/i)},BlackBerry:function(){return a.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return a.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return a.userAgent.match(/Opera Mini/i)},Windows:function(){return a.userAgent.match(/IEMobile/i)},any:function(){return o.Android()||o.BlackBerry()||o.iOS()||o.Opera()||o.Windows()},getOsName:function(){var e="Unknown OS";return o.Android()&&(e="Android"),o.BlackBerry()&&(e="BlackBerry"),o.iOS()&&(e="iOS"),o.Opera()&&(e="Opera Mini"),o.Windows()&&(e="Windows"),e}};var t="Unknown OS",s="Unknown OS Version";if(o.any())t=o.getOsName();else{var m=function(){var e=a.appVersion,i=a.userAgent,n="-",o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var r in o){var t=o[r];if(t.r.test(i)){n=t.s;break}}var s="-";switch(/Windows/.test(n)&&(/Windows (.*)/.test(n)&&(s=/Windows (.*)/.exec(n)[1]),n="Windows"),n){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(i)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(i)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(i)&&(s=/Android ([\.\_\d]+)/.exec(i)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(i)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(e))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:n,osVersion:s}}();t=m.osName,s=m.osVersion}var v=!1,S=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){!v&&e in document.createElement("canvas")&&(v=!0),!S&&e in document.createElement("video")&&(S=!0)});var l=[],b=[],C=[],k=[];a.mediaDevices&&a.mediaDevices.enumerateDevices&&(a.enumerateDevices=function(e){a.mediaDevices.enumerateDevices().then(e).catch(function(){e([])})});var h=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?h=!0:a.mediaDevices&&a.mediaDevices.enumerateDevices&&(h=!0);var g=!1,O=!1,W=!1,T=!1,M=!1;function y(i){h?(!a.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(a.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!a.enumerateDevices&&a.enumerateDevices&&(a.enumerateDevices=a.enumerateDevices.bind(a)),a.enumerateDevices?(l=[],b=[],C=[],k=[],a.enumerateDevices(function(e){e.forEach(function(e){var i,n={};for(var o in e)n[o]=e[o];"audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),l.forEach(function(e){e.id===n.id&&e.kind===n.kind&&(i=!0)}),i||(n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||M||(M=!0),"audioinput"!==n.kind||T||(T=!0)):(n.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(g=!0,-1===b.indexOf(n)&&b.push(n)),"audiooutput"===n.kind&&(O=!0,-1===C.indexOf(n)&&C.push(n)),"videoinput"===n.kind&&(W=!0,-1===k.indexOf(n)&&k.push(n)),-1===l.indexOf(n)&&l.push(n))}),void 0!==P&&(P.MediaDevices=l,P.hasMicrophone=g,P.hasSpeakers=O,P.hasWebcam=W,P.isWebsiteHasWebcamPermissions=M,P.isWebsiteHasMicrophonePermissions=T,P.audioInputDevices=b,P.audioOutputDevices=C,P.videoInputDevices=k),i&&i()})):i&&i()):i&&i()}y();var P=window.DetectRTC||{};P.browser=function(){a.appVersion;var e,i,n,o=a.userAgent,r=a.appName,t=""+parseFloat(a.appVersion),s=parseInt(a.appVersion,10);if(c){r="Opera";try{s=(t=a.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){t="0.0.0.0",s=0}}else f?(i=o.indexOf("MSIE"),r="IE",t=o.substring(i+5)):p?(i=o.indexOf("Chrome"),r="Chrome",t=o.substring(i+7)):w?(i=o.indexOf("Safari"),r="Safari",t=o.substring(i+7),-1!==(i=o.indexOf("Version"))&&(t=o.substring(i+8))):u?(i=o.indexOf("Firefox"),r="Firefox",t=o.substring(i+8)):(e=o.lastIndexOf(" ")+1)<(i=o.lastIndexOf("/"))&&(r=o.substring(e,i),t=o.substring(i+1),r.toLowerCase()===r.toUpperCase()&&(r=a.appName));return d&&(r="Edge",t=parseInt(a.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),-1!==(n=t.indexOf(";"))&&(t=t.substring(0,n)),-1!==(n=t.indexOf(" "))&&(t=t.substring(0,n)),s=parseInt(""+t,10),isNaN(s)&&(t=""+parseFloat(a.appVersion),s=parseInt(a.appVersion,10)),{fullVersion:t,version:s,name:r,isPrivateBrowsing:!1}}(),function(i){var n;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){webrtcdev.log(e),n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{o=window.indexedDB.open("test")}catch(e){n=!0}void 0===n&&r(function(){return"done"===o.readyState},function(e){e||(n=!o.result)})}else if(function(e){var i=e.toLowerCase();if(0===i.indexOf("msie")&&0===i.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(i);return!!(n&&10<=parseInt(n[1],10))}(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(e){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){n=!0}void 0===n&&(n=!1,window.localStorage.removeItem("test"))}r(function(){return void 0!==n},function(e){i(n)})}(function(e){P.browser.isPrivateBrowsing=!!e}),P.browser["is"+P.browser.name]=!0;window.process&&"object"===_typeof(window.process)&&window.process.versions&&window.process.versions["node-webkit"];var x=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){x||e in window&&(x=!0)}),P.isWebRTCSupported=x,P.isORTCSupported="undefined"!=typeof RTCIceGatherer;var D=!1;P.browser.isChrome&&35<=P.browser.version?D=!0:P.browser.isFirefox&&34<=P.browser.version&&(D=!0),"https:"!==location.protocol&&(D=!1),P.isScreenCapturingSupported=D;var R={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){R.isSupported||e in window&&(R.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(R.isCreateMediaStreamSourceSupported=!0))}),P.isAudioContextSupported=R.isSupported,P.isCreateMediaStreamSourceSupported=R.isCreateMediaStreamSourceSupported;var A=!1;P.browser.isChrome&&31<P.browser.version&&(A=!0),P.isRtpDataChannelsSupported=A;var I=!1;P.browser.isFirefox&&28<P.browser.version?I=!0:P.browser.isChrome&&25<P.browser.version?I=!0:P.browser.isOpera&&11<=P.browser.version&&(I=!0),P.isSctpDataChannelsSupported=I,P.isMobileDevice=n;var B=!1;a.getUserMedia?B=!0:a.mediaDevices&&a.mediaDevices.getUserMedia&&(B=!0),P.browser.isChrome&&46<=P.browser.version&&"https:"!==location.protocol&&(P.isGetUserMediaSupported="Requires HTTPs"),P.isGetUserMediaSupported=B,P.osName=t,P.osVersion=s;var N="";screen.width&&(N+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));P.displayResolution=N,P.isCanvasSupportsStreamCapturing=v,P.isVideoSupportsStreamCapturing=S,P.DetectLocalIPAddress=function(i){P.isWebRTCSupported&&(P.isORTCSupported||function(o){var r={},e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=!!window.webkitRTCPeerConnection;if(!e){var n=document.getElementById("iframe");if(!n)throw"NOTE: you need to have an iframe in the page right above the script tag.";var t=n.contentWindow;e=t.RTCPeerConnection||t.mozRTCPeerConnection||t.webkitRTCPeerConnection,i=!!t.webkitRTCPeerConnection}if(e){var s;i&&(s={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},void 0!==P&&P.browser.isFirefox&&P.browser.version<=38&&(s[0]={url:s[0].urls}));var a=new e(s,{optional:[{RtpDataChannels:!0}]});a.onicecandidate=function(e){e.candidate&&d(e.candidate.candidate)},a.createDataChannel(""),a.createOffer(function(e){a.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=a.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&d(e)})},1e3)}function d(e){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(e);if(i){var n=i[1];void 0===r[n]&&o(n),r[n]=!0}else webrtcdev.warn("Could not match IP address in",e)}}(function(e){e.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?i("Local: "+e):i("Public: "+e)}))},P.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,P.isWebSocketsBlocked=!P.isWebSocketsSupported,P.checkWebSocketsSupport=function(i){i=i||function(){};try{var e=new WebSocket("wss://echo.websocket.org:443/");e.onopen=function(){P.isWebSocketsBlocked=!1,i(),e.close(),e=null},e.onerror=function(){P.isWebSocketsBlocked=!0,i()}}catch(e){P.isWebSocketsBlocked=!0,i()}},P.load=function(e){y(e=e||function(){})},P.MediaDevices=l,P.hasMicrophone=g,P.hasSpeakers=O,P.hasWebcam=W,P.isWebsiteHasWebcamPermissions=M,P.isWebsiteHasMicrophonePermissions=T,P.audioInputDevices=b,P.audioOutputDevices=C,P.videoInputDevices=k;var E=!1;"setSinkId"in document.createElement("video")&&(E=!0),P.isSetSinkIdSupported=E;var U=!1;P.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(U=!0):P.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(U=!0),P.isRTPSenderReplaceTracksSupported=U;var F=!1;P.browser.isFirefox&&38<P.browser.version&&(F=!0),P.isRemoteStreamProcessingSupported=F;var V=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(V=!0),P.isApplyConstraintsSupported=V;var _=!1;P.browser.isFirefox&&43<=P.browser.version&&(_=!0),P.isMultiMonitorScreenCapturingSupported=_,P.isPromisesSupported=!!("Promise"in window),void 0===P&&(window.DetectRTC={});var z=window.MediaStream;void 0===z&&"undefined"!=typeof webkitMediaStream&&(z=webkitMediaStream),P.MediaStream=void 0!==z&&Object.keys(z.prototype),"undefined"!=typeof MediaStreamTrack?P.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):P.MediaStreamTrack=!1;var X=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;P.RTCPeerConnection=void 0!==X&&Object.keys(X.prototype),window.DetectRTC=P,"undefined"!=typeof module&&(module.exports=P),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return P})};
"";function checkDevices(e){for(x in e.hasMicrophone?webrtcdev.info("has Microphone"):webrtcdev.error("doesnt have  hasMicrophone"),e.hasSpeakers?webrtcdev.info("has Speakers"):webrtcdev.error("doesnt have  Speakers"),e.hasWebcam?webrtcdev.info("has Webcam"):webrtcdev.error("doesnt have Webcam"),webrtcdev.log(" Audio Input Device "),e.audioInputDevices)webrtcdev.info(e.audioInputDevices[x]);for(x in webrtcdev.log(" Audio Output Device "),e.audioOutputDevices)webrtcdev.info(e.audioOutputDevices[x]);for(x in webrtcdev.log(" Video Input Device "),e.videoInputDevices)webrtcdev.info(e.videoInputDevices[x]);webrtcdev.info(" Screen Device "+e.displayResolution),statisticsobj&&statisticsobj.active&&(document.getElementById(statisticsobj.statsConainer).innerHTML+=JSON.stringify(e),document.getElementById(statisticsobj.statsConainer).innerHTML+=JSON.stringify(e.bandwidth),document.getElementById(statisticsobj.statsConainer).innerHTML+=JSON.stringify(e.codecs),alert("detect RTC appended "))}function checkWebRTCSupport(e){webrtcdev.info(" Browser ",e.browser.name+e.browser.fullVersion),e.isWebRTCSupported,e.isAudioContextSupported,e.isScreenCapturingSupported,e.isSctpDataChannelsSupported,e.isRtpDataChannelsSupported}
"";function setSettingsAttributes(){$("#channelname").val(rtcConn.channel),$("#userid").val(rtcConn.userid),$("#inAudio").prop("checked",incomingAudio),$("#inVideo").prop("checked",incomingVideo),$("#inData").prop("checked",incomingData),$("#outAudio").prop("checked",outgoingAudio),$("#outVideo").prop("checked",outgoingVideo),$("#outData").prop("checked",outgoingData),$("#role").val(role),$("#btnGetPeers").click(function(){$("#alllpeerinfo").empty(),$("#allpeerinfo").append("<pre contenteditable>"+JSON.stringify(webcallpeers,null,2)+"<pre>")}),$("#btnDebug").click(function(){$("#allwebrtcdevinfo").empty(),$("#allwebrtcdevinfo").append("<pre contenteditable>"+rtcConn+"<pre>"),webrtcdev.info(rtcConn)})}function createSession(){var e=$("#roleMakeSession").val(),n=$("#appnameMakeSession").val(),o=$("#userNameMakeSession").val(),a=$("#sessionNameMakeSession").val(),i="https://"+window.location.host+window.location.pathname+"#"+a+"?appname="+n+"&role="+e+"&audio=1&video=1&name="+o;$("#sessionlink").val(i),$("#sessionlinkGo").click(function(){window.open($("#sessionlink").val())})}function AddPartner(){var e=$("#roleMakeSession").val(),n=$("#appnameMakeSession").val(),o=$("#partnername").val(),a=$("#sessionNameMakeSession").val(),i="https://"+window.location.host+window.location.pathname+"#"+a+"?appname="+n+"&role="+e+"&audio=1&video=1&name="+o;$("#partnerlink").val(i)}function EmailPartnerLink(){var e=$("#sessionNameMakeSession").val(),n=$("#partnerlink").val();window.open("mailto:test@example.com?subject=join Session "+e+"&body="+n)}function getAllPeerInfo(){webrtcdev.info(webcallpeers)}$("#SettingsButton").click(function(){webrtcdev.info(localobj.userdetails),localobj.userdisplay.latitude&&(localobj.userdisplay.latitude.value=latitude),localobj.userdisplay.longitude&&(localobj.userdisplay.longitude.value=longitude),localobj.userdisplay.operatingsystem&&(localobj.userdisplay.operatingsystem.value=operatingsystem)});
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(){function i(e,o){o=o||function(e){postMessage(e)};var a=e.file;a.uuid||(a.uuid=(100*Math.random()).toString().replace(/\./g,""));var u=e.chunkSize||15e3;e.extra&&e.extra.chunkSize&&(u=e.extra.chunkSize);var c,n=0,t=u,r=Math.floor(Math.min(1e8,t)/u)*u,s=Math.ceil(a.size/u);a.maxChunks=s;var f=0,l=[];o({currentPosition:f,uuid:a.uuid,maxChunks:s,size:a.size,name:a.name,type:a.type,lastModifiedDate:a.lastModifiedDate.toString(),start:!0});var i,A=new FileReader;A.onloadend=function(e){e.target.readyState==FileReader.DONE&&function(e,n,t){c=Math.ceil(n.byteLength/u);for(var r=0;r<c;r++){var i=r*u;l[f]=n.slice(i,Math.min(i+u,n.byteLength)),o({uuid:a.uuid,buffer:l[f],currentPosition:f,maxChunks:s,size:a.size,name:a.name,lastModifiedDate:a.lastModifiedDate.toString(),type:a.type}),f++}f==s&&!0;t()}(a.name,e.target.result,function(){(++n+1)*r<a.size?(i=a.slice(n*r,(n+1)*r),A.readAsArrayBuffer(i)):n*r<a.size?(i=a.slice(n*r,a.size),A.readAsArrayBuffer(i)):(a.url=URL.createObjectURL(a),o({currentPosition:f,uuid:a.uuid,maxChunks:s,size:a.size,name:a.name,lastModifiedDate:a.lastModifiedDate.toString(),url:URL.createObjectURL(a),type:a.type,end:!0}))})},f+=1,i=a.slice(n*r,(n+1)*r),A.readAsArrayBuffer(i)}this.readAsArrayBuffer=function(n,t){var r=t.earlyCallback;function e(e){n.chunks[e.uuid]||(n.chunks[e.uuid]={currentPosition:-1}),t.extra=t.extra||{userid:0},e.userid=t.userid||t.extra.userid||0,e.extra=t.extra,(n.chunks[e.uuid][e.currentPosition]=e).end&&r&&(r(e.uuid),r=null),200<e.maxChunks&&200==e.currentPosition&&r&&(r(e.uuid),r=null)}delete t.earlyCallback,i(t,e)}}function n(a){var u=this;u.chunks={},u.chunksWaiters={},u.receive=function n(t,r){if(t.uuid){if(t.start&&!u.chunks[t.uuid]&&(u.chunks[t.uuid]={},a.onBegin&&a.onBegin(t)),!t.end&&t.buffer&&(u.chunks[t.uuid][t.currentPosition]=t.buffer),t.end){var i=u.chunks[t.uuid],o=[];Object.keys(i).forEach(function(e,n){o.push(i[e])});var e=new Blob(o,{type:t.type});(e=function(e,n){if(e||(e={}),!n)return e;for(var t in n)try{e[t]=n[t]}catch(e){}return e}(e,t)).url=URL.createObjectURL(e),e.uuid=t.uuid,e.size||webrtcdev.error("Something went wrong. Blob Size is 0."),a.onEnd&&a.onEnd(e),delete u.chunks[t.uuid],delete u.chunksWaiters[t.uuid]}t.buffer&&a.onProgress&&a.onProgress(t),t.end||(r(t),u.chunksWaiters[t.uuid]=function(){setTimeout(function e(){t.buffer&&u.chunks[t.uuid]&&(t.currentPosition==t.maxChunks||u.chunks[t.uuid][t.currentPosition]||(r(t),setTimeout(e,5e3)))},5e3)},u.chunksWaiters[t.uuid]())}else a.convertToObject(t,function(e){n(e)})}}var r={ConvertToArrayBuffer:function(e,n){a.pack(e,function(e){n(e.buffer)})},ConvertToObject:function(e,n){a.unpack(e,n)}};var v=Uint8Array.BYTES_PER_ELEMENT,b=Uint16Array.BYTES_PER_ELEMENT,E=Uint32Array.BYTES_PER_ELEMENT,T={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},U=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],t=function(e){var n=0,t=0,r=0,i=new ArrayBuffer(e[0].byte_length+e[0].header_size),o=new DataView(i);for(t=0;t<e.length;t++){e[t].header_size;var a=e[t].type,u=e[t].length,c=e[t].value,s=e[t].byte_length,f=U[a],l=null===f?0:window[f+"Array"].BYTES_PER_ELEMENT;switch(a===T.BUFFER?o.setUint8(n,T.BLOB,!1):o.setUint8(n,a,!1),n+=v,a!==T.ARRAY&&a!==T.OBJECT||(o.setUint16(n,u,!1),n+=b),o.setUint32(n,s,!1),n+=E,a){case T.NULL:case T.UNDEFINED:break;case T.STRING:for(r=0;r<u;r++,n+=l)o.setUint16(n,c.charCodeAt(r),!1);break;case T.NUMBER:case T.BOOLEAN:0,o["set"+f](n,c,!1),n+=l;break;case T.INT8ARRAY:case T.INT16ARRAY:case T.INT32ARRAY:case T.UINT8ARRAY:case T.UINT16ARRAY:case T.UINT32ARRAY:case T.FLOAT32ARRAY:case T.FLOAT64ARRAY:new Uint8Array(o.buffer,n,s).set(new Uint8Array(c.buffer)),n+=s;break;case T.ARRAYBUFFER:case T.BUFFER:new Uint8Array(o.buffer,n,s).set(new Uint8Array(c)),n+=s;break;case T.BLOB:case T.ARRAY:case T.OBJECT:break;default:throw"TypeError: Unexpected type found."}0}return o},i=function e(n,t){var r,i,o,a,u,c=0;r=n.getUint8(t,!1),t+=v,r!==T.ARRAY&&r!==T.OBJECT||(i=n.getUint16(t,!1),t+=b),o=n.getUint32(t,!1),t+=E;var s=U[r],f=null===s?0:window[s+"Array"].BYTES_PER_ELEMENT;switch(r){case T.NULL:case T.UNDEFINED:0,a=null;break;case T.STRING:i=o/f;var l=[];for(c=0;c<i;c++){var A=n.getUint16(t,!1);t+=f,l.push(String.fromCharCode(A))}a=l.join("");break;case T.NUMBER:a=n.getFloat64(t,!1),t+=f;break;case T.BOOLEAN:a=1===n.getUint8(t,!1),t+=f;break;case T.INT8ARRAY:case T.INT16ARRAY:case T.INT32ARRAY:case T.UINT8ARRAY:case T.UINT16ARRAY:case T.UINT32ARRAY:case T.FLOAT32ARRAY:case T.FLOAT64ARRAY:case T.ARRAYBUFFER:u=n.buffer.slice(t,t+o),t+=o,a=r===T.ARRAYBUFFER?u:new window[s+"Array"](u);break;case T.BLOB:if(window.Blob){var d=e(n,t),R=e(n,d.cursor);t=R.cursor,a=new Blob([R.value],{type:d.value})}else u=n.buffer.slice(t,t+o),t+=o,a=new Buffer(u);break;case T.ARRAY:for(a=[],c=0;c<i;c++)t=(u=e(n,t)).cursor,a.push(u.value);break;case T.OBJECT:for(a={},c=0;c<i;c++){var h=e(n,t),y=e(n,h.cursor);t=y.cursor,a[h.value]=y.value}break;default:throw"TypeError: Type not supported."}return{value:a,cursor:t}},A=function(e,i){for(var o=e.length,a=[],u=0,c=0,n=0;n<e.length;n++)!function(r){s(e[r],function(e){if(a[r]=e,c+=e[0].header_size+e[0].byte_length,++u===o){for(var n=[],t=0;t<a.length;t++)n=n.concat(a[t]);i(n,c)}})}(n)},s=function(t,r){var e,i,o=v+E,n=0,a=0,u=t;switch(i=function(e){var n=void 0;if(void 0===e)n=T.UNDEFINED;else if(null===e)n=T.NULL;else{var t=e.constructor.name;if(void 0!==t)n=T[t.toUpperCase()];else switch(void 0===e?"undefined":_typeof(e)){case"string":n=T.STRING;break;case"number":n=T.NUMBER;break;case"boolean":n=T.BOOLEAN;break;case"object":e instanceof Array?n=T.ARRAY:e instanceof Int8Array?n=T.INT8ARRAY:e instanceof Int16Array?n=T.INT16ARRAY:e instanceof Int32Array?n=T.INT32ARRAY:e instanceof Uint8Array?n=T.UINT8ARRAY:e instanceof Uint16Array?n=T.UINT16ARRAY:e instanceof Uint32Array?n=T.UINT32ARRAY:e instanceof Float32Array?n=T.FLOAT32ARRAY:e instanceof Float64Array?n=T.FLOAT64ARRAY:e instanceof ArrayBuffer?n=T.ARRAYBUFFER:e instanceof Blob?n=T.BLOB:e instanceof Buffer?n=T.BUFFER:e instanceof Object&&(n=T.OBJECT)}}return n}(t),e=null==U[i]?0:window[U[i]+"Array"].BYTES_PER_ELEMENT,i){case T.UNDEFINED:case T.NULL:break;case T.NUMBER:case T.BOOLEAN:n=e;break;case T.STRING:n+=(a=t.length)*e;break;case T.INT8ARRAY:case T.INT16ARRAY:case T.INT32ARRAY:case T.UINT8ARRAY:case T.UINT16ARRAY:case T.UINT32ARRAY:case T.FLOAT32ARRAY:case T.FLOAT64ARRAY:n+=(a=t.length)*e;break;case T.ARRAY:return void A(t,function(e,n){r([{type:i,length:t.length,header_size:o+b,byte_length:n,value:null}].concat(e))});case T.OBJECT:var c=[];for(var s in t)t.hasOwnProperty(s)&&(c.push(s),c.push(t[s]),a++);return void A(c,function(e,n){r([{type:i,length:a,header_size:o+b,byte_length:n,value:null}].concat(e))});case T.ARRAYBUFFER:n+=t.byteLength;break;case T.BLOB:var f=t.type,l=new FileReader;return l.onload=function(e){A([f,e.target.result],function(e,n){r([{type:i,length:a,header_size:o,byte_length:n,value:null}].concat(e))})},l.onerror=function(e){throw"FileReader Error: "+e},void l.readAsArrayBuffer(t);case T.BUFFER:n+=t.length;break;default:throw'TypeError: Type "'+t.constructor.name+'" not supported.'}r([{type:i,length:a,header_size:o,byte_length:n,value:u}].concat([]))},o=function(e,n){var t=e instanceof DataView?e:new DataView(e);return i(t,0).value};var a={pack:function(e,n){try{0,s(e,function(e){n(t(e))})}catch(e){throw e}},unpack:function(e,n){try{0;var t=o(e);0,n(t)}catch(e){throw e}}};window.FileConverter=r,window.FileSelector=function(){var o=this;function n(e,n){var t,r,i=document.createElement("input");i.type="file",n&&(i.multiple=!0),i.accept=o.accept,i.onchange=function(){if(n)return i.files.length?void e(i.files):void webrtcdev.error("No file selected.");i.files[0]?(e(i.files[0]),i.parentNode.removeChild(i)):webrtcdev.error("No file selected.")},i.style.display="none",(document.body||document.documentElement).appendChild(i),t=i,r=new window.MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,button:0,buttons:0,mozInputSource:1}),t.dispatchEvent(r)}o.selectSingleFile=n,o.selectMultipleFiles=function(e){n(e,!0)},o.accept="*.*"},window.FileBufferReader=function(){var a=this,i=new e;a.chunks={},a.users={},a.readAsArrayBuffer=function(e,n,t){var r={file:e,earlyCallback:function(e){n(u(e,{currentPosition:-1}))},extra:t||{userid:0}};i.readAsArrayBuffer(a,r)},a.getNextChunk=function(e,n,t){var r;void 0!==e.currentPosition&&(r=e.currentPosition,e=e.uuid);var i=a.chunks[e];if(i){void 0!==t?(a.users[t+""]||(a.users[t+""]={fileUUID:e,userid:t,currentPosition:-1}),void 0!==r&&(a.users[t+""].currentPosition=r),a.users[t+""].currentPosition++,r=a.users[t+""].currentPosition):(void 0!==r&&(a.chunks[e].currentPosition=r),a.chunks[e].currentPosition++,r=a.chunks[e].currentPosition);var o=i[r];if(!o)return delete a.chunks[e],void a.convertToArrayBuffer({chunkMissing:!0,currentPosition:r,uuid:e},n);o=u(o),void 0!==t&&(o.remoteUserId=t+""),o.start&&a.onBegin(o),o.end&&a.onEnd(o),a.onProgress(o),a.convertToArrayBuffer(o,function(e){o.currentPosition!=o.maxChunks?n(e,!1):n(e,!0)})}};var t=new n(a);function u(e,n){if(null==e||"object"!=(void 0===e?"undefined":_typeof(e)))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var t in n=n||new e.constructor,e)n[t]=void 0===n[t]?u(e[t],null):n[t];return n}a.addChunk=function(e,n){e&&t.receive(e,function(e){a.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:e.currentPosition,uuid:e.uuid},n)})},a.chunkMissing=function(e){delete t.chunks[e.uuid],delete t.chunksWaiters[e.uuid]},a.onBegin=function(){},a.onEnd=function(){},a.onProgress=function(){},a.convertToObject=r.ConvertToObject,a.convertToArrayBuffer=r.ConvertToArrayBuffer,a.setMultipleUsers=function(){}}}();
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function MediaStreamRecorder(a){if(!a)throw"MediaStream is mandatory.";var i;this.start=function(t){var e=IsChrome?window.StereoRecorder:window.MediaRecorderWrapper;-1!=this.mimeType.indexOf("video")&&(e=IsChrome?window.WhammyRecorder:window.MediaRecorderWrapper),"image/gif"===this.mimeType&&(e=window.GifRecorder),(i=new e(a)).ondataavailable=this.ondataavailable,i.onstop=this.onstop,i.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,(i=mergeProps(i,this)).start(t)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){i&&i.clearOldRecordedFrames()},this.stop=function(){i&&i.stop()},this.ondataavailable=function(t){webrtcdev.log("ondataavailable..",t)},this.onstop=function(t){webrtcdev.warn("stopped..",t)}}function loadScript(t,e){var a=window.MediaStreamRecorderScriptsDir,i=document.createElement("script");i.src=a+t,i.onload=e||function(){},document.documentElement.appendChild(i)}function mergeProps(t,e){for(var a in e=reformatProps(e))"function"!=typeof e[a]&&(t[a]=e[a]);return t}function reformatProps(t){var e={};for(var a in t)if(-1!=a.indexOf("-")){var i=a.split("-");e[i[0]+i[1].split("")[0].toUpperCase()+i[1].substr(1)]=t[a]}else e[a]=t[a];return e}window.requestAnimationFrame||(requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),window.cancelAnimationFrame||(cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame),window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext),URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream),IsChrome=!!navigator.webkitGetUserMedia;var ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext};function MediaRecorderWrapper(a){if("audio"==this.type&&a.getVideoTracks&&a.getVideoTracks().length&&!navigator.mozGetUserMedia){var t=new AudioContext,e=t.createMediaStreamSource(a),i=t.createMediaStreamDestination();e.connect(i),a=i.stream}var n=!(this.start=function(e){e=e||1e3,n=!1,function t(){n||((o=new MediaRecorder(a)).ondataavailable=function(t){if(webrtcdev.log("ondataavailable",t.data.type,t.data.size,t.data),t.data.size){var e=new window.Blob([t.data],{type:t.data.type||r.mimeType||"audio/ogg"});r.ondataavailable(e)}else webrtcdev.warn("Recording of",t.data.type,"failed.")},o.onstop=function(t){},o.onerror=function(t){webrtcdev.error(t),r.start(e)},o.onwarning=function(t){webrtcdev.warn(t)},o.start(0),setTimeout(function(){o.stop(),t()},e))}()});this.stop=function(){n=!0,r.onstop&&r.onstop({})},this.ondataavailable=this.onstop=function(){};var o,r=this;!r.mimeType&&a.getAudioTracks&&(r.mimeType=a.getAudioTracks().length&&a.getVideoTracks().length?"video/webm":"audio/ogg")}function StereoRecorder(e){var a,i;this.start=function(t){t=t||1e3,(a=new StereoAudioRecorder(e,this)).record(),i=setInterval(function(){a.requestData()},t)},this.stop=function(){a&&(a.stop(),clearTimeout(i))},this.ondataavailable=function(){}}function StereoAudioRecorder(t,u){var e,l=[],w=[],i=!1,m=0,f=u.mono?1:2;function v(t,e){for(var a=new Float32Array(e),i=0,n=t.length,o=0;o<n;o++){var r=t[o];a.set(r,i),i+=r.length}return a}function g(t,e,a){for(var i=a.length,n=0;n<i;n++)t.setUint8(e+n,a.charCodeAt(n))}this.record=function(){i=!0,l.length=w.length=0,m=0},this.requestData=function(){if(0!=m){p=!0;var t=l.slice(0),e=(w.slice(0),m);l.length=w.length=[],m=0,p=!1;var a=v(t,e),i=v(t,e);if(2===f)var n=function(t,e){for(var a=t.length+e.length,i=new Float32Array(a),n=0,o=0;o<a;)i[o++]=t[n],i[o++]=e[n],n++;return i}(a,i);else n=a;var o=new ArrayBuffer(44+2*n.length),r=new DataView(o);g(r,0,"RIFF"),r.setUint32(4,44+2*n.length,!0),g(r,8,"WAVE"),g(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,f,!0),r.setUint32(24,44100,!0),r.setUint32(28,176400,!0),r.setUint16(32,2*f,!0),r.setUint16(34,16,!0),g(r,36,"data"),r.setUint32(40,2*n.length,!0);for(var d=n.length,s=44,c=0;c<d;c++)r.setInt16(s,32767*n[c],!0),s+=2;var h=new Blob([r],{type:"audio/wav"});webrtcdev.debug("audio recorded blob size:",bytesToSize(h.size)),u.ondataavailable(h)}else p=!1},this.stop=function(){i=!1,this.requestData()};var a=ObjectStore.AudioContext;ObjectStore.AudioContextConstructor||(ObjectStore.AudioContextConstructor=new a);var n=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode||(ObjectStore.VolumeGainNode=n.createGain());var o=ObjectStore.VolumeGainNode;ObjectStore.AudioInput||(ObjectStore.AudioInput=n.createMediaStreamSource(t)),ObjectStore.AudioInput.connect(o);var r=u.bufferSize||2048;if(0==u.bufferSize&&(r=0),n.createJavaScriptNode)e=n.createJavaScriptNode(r,f,f);else{if(!n.createScriptProcessor)throw"WebAudio API has no support on this browser.";e=n.createScriptProcessor(r,f,f)}r=e.bufferSize,webrtcdev.debug("using audio buffer-size:",r);var p=!1;window.scriptprocessornode=e,1==f&&webrtcdev.debug("It seems mono audio. All right-channels are skipped."),e.onaudioprocess=function(t){if(i&&!p){var e=t.inputBuffer.getChannelData(0);if(l.push(new Float32Array(e)),2==f){var a=t.inputBuffer.getChannelData(1);w.push(new Float32Array(a))}m+=r}},o.connect(e),e.connect(n.destination)}function WhammyRecorderHelper(e,a){this.record=function(t){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=s.videoWidth||320),this.height||(this.height=s.videoHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),A.width=this.canvas.width,A.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?s=this.video.cloneNode():((s=document.createElement("video")).src=URL.createObjectURL(e),s.width=this.video.width,s.height=this.video.height),s.muted=!0,s.play(),c=(new Date).getTime(),h=new Whammy.Video,webrtcdev.log("canvas resolutions",A.width,"*",A.height),webrtcdev.log("video width/height",s.width||A.width,"*",s.height||A.height),r()};var i=!(this.clearOldRecordedFrames=function(){n=[]});this.requestData=function(){if(n.length){i=!0;var t=n.slice(0);n=[],h.frames=function(t,e,a,i){var n=document.createElement("canvas");n.width=A.width,n.height=A.height;for(var o=n.getContext("2d"),r=[],d=-1===e,s=e&&0<e&&e<=t.length?e:t.length,c={r:0,g:0,b:0},h=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),u=a&&0<=a&&a<=1?a:0,l=i&&0<=i&&i<=1?i:0,w=!1,m=0;m<s;m++){var f,v,g;if(!w){var p=new Image;p.src=t[m].image,o.drawImage(p,0,0,A.width,A.height);var b=o.getImageData(0,0,A.width,A.height);f=0,v=b.data.length,g=b.data.length/4;for(var y=0;y<v;y+=4){var S={r:b.data[y],g:b.data[y+1],b:b.data[y+2]},M=Math.sqrt(Math.pow(S.r-c.r,2)+Math.pow(S.g-c.g,2)+Math.pow(S.b-c.b,2));M<=h*u&&f++}}!w&&g-f<=g*l||(d&&(w=!0),r.push(t[m]))}(r=r.concat(t.slice(s))).length<=0&&r.push(t[t.length-1]);return r}(t,-1);var e=h.compile();a.ondataavailable(e),webrtcdev.debug("video recorded blob size:",bytesToSize(e.size)),i=!1}else i=!1};var n=[],o=!1;function r(){if(!d){if(i)return setTimeout(r,100);var t=(new Date).getTime()-c;if(!t)return r();c=(new Date).getTime(),u.drawImage(s,0,0,A.width,A.height),!d&&n.push({duration:t,image:A.toDataURL("image/webp")}),o||function(t,e,a){var i=document.createElement("canvas");i.width=A.width,i.height=A.height;var n,o,r,d=i.getContext("2d"),s={r:0,g:0,b:0},c=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),h=e&&0<=e&&e<=1?e:0,u=a&&0<=a&&a<=1?a:0,l=new Image;l.src=t.image,d.drawImage(l,0,0,A.width,A.height);var w=d.getImageData(0,0,A.width,A.height);n=0,o=w.data.length,r=w.data.length/4;for(var m=0;m<o;m+=4){var f={r:w.data[m],g:w.data[m+1],b:w.data[m+2]},v=Math.sqrt(Math.pow(f.r-s.r,2)+Math.pow(f.g-s.g,2)+Math.pow(f.b-s.b,2));v<=c*h&&n++}return!(r-n<=r*u)}(n[n.length-1])||(o=!0,a.onStartedDrawingNonBlankFrames()),setTimeout(r,10)}}var d=!1;this.stop=function(){d=!0,this.requestData()};var s,c,h,A=document.createElement("canvas"),u=A.getContext("2d")}function WhammyRecorder(a){var i,n;this.start=function(t){for(var e in t=t||1e3,i=new WhammyRecorderHelper(a,this),this)"function"!=typeof this[e]&&(i[e]=this[e]);i.record(),n=setInterval(function(){i.requestData()},t)},this.stop=function(){i&&(i.stop(),clearTimeout(n))},this.clearOldRecordedFrames=function(){i&&i.clearOldRecordedFrames()},this.ondataavailable=function(){}}var Whammy=function(){function t(t){for(var e,a=function(t){if(!t[0])return void webrtcdev.warn("Something went wrong. Maybe WebP format is not supported in the current browser.");for(var e=t[0].width,a=t[0].height,i=t[0].duration,n=1;n<t.length;n++)i+=t[n].duration;return{duration:i,width:e,height:a}}(t),i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(e=a.duration,[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:a.width,id:176},{data:a.height,id:186}]}]}]}]}],n=0,o=0;n<t.length;){for(var r=[],d=0;r.push(t[n]),d+=t[n].duration,++n<t.length&&d<3e4;);var s=0,c={id:524531317,data:[{data:o,id:231}].concat(r.map(function(t){var e=l({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(s)});return s+=t.duration,{data:e,id:163}}))};i[1].data.push(c),o+=d}return function t(e){var a=[];for(var i=0;i<e.length;i++){var n=e[i].data;"object"==(void 0===n?"undefined":_typeof(n))&&(n=t(n)),"number"==typeof n&&(n=u(n.toString(2))),"string"==typeof n&&(n=new Uint8Array(n.split("").map(function(t){return t.charCodeAt(0)})));var o=n.size||n.byteLength||n.length,r=Math.ceil(Math.ceil(Math.log(o)/Math.log(2))/8),d=o.toString(2),s=new Array(7*r+7+1-d.length).join("0")+d,c=new Array(r).join("0")+"1"+s;a.push(h(e[i].id)),a.push(u(c)),a.push(n)}return new Blob(a,{type:"video/webm"})}(i)}function h(t){for(var e=[];0<t;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function u(t){var e=[];t=(t.length%8?new Array(9-t.length%8).join("0"):"")+t;for(var a=0;a<t.length;a+=8)e.push(parseInt(t.substr(a,8),2));return new Uint8Array(e)}function l(t){var e=0;if(t.keyframe&&(e|=128),t.invisible&&(e|=8),t.lacing&&(e|=t.lacing<<1),t.discardable&&(e|=1),127<t.trackNum)throw"TrackNumber > 127 not supported";return[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map(function(t){return String.fromCharCode(t)}).join("")+t.frame}function e(t){this.frames=[],this.duration=t||1,this.quality=100}return e.prototype.add=function(t,e){if("canvas"in t&&(t=t.canvas),"toDataURL"in t&&(t=t.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:e||this.duration})},e.prototype.compile=function(){return new t(this.frames.map(function(t){var e=function(t){for(var e=t.RIFF[0].WEBP[0],a=e.indexOf("*"),i=0,n=[];i<4;i++)n[i]=e.charCodeAt(a+3+i);return{width:16383&(n[1]<<8|n[0]),height:16383&(n[3]<<8|n[2]),data:e,riff:t}}(function t(e){for(var a=0,i={};a<e.length;){var n=e.substr(a,4),o=parseInt(e.substr(a+4,4).split("").map(function(t){var e=t.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e}).join(""),2),r=e.substr(a+4+4,o);a+=8+o,i[n]=i[n]||[],"RIFF"==n||"LIST"==n?i[n].push(t(r)):i[n].push(r)}return i}(atob(t.image.slice(23))));return e.duration=t.duration,e}))},{Video:e,toWebM:t}}();function GifRecorder(t){if(!window.GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";function e(){Date.now();var t=new Blob([new Uint8Array(s.stream().bin)],{type:"image/gif"});a.ondataavailable(t),s.stream().bin=[]}this.start=function(t){t=t||1e3;var a=this.videoWidth||320,i=this.videoHeight||240;n.width=r.width=a,n.height=r.height=i,(s=new GIFEncoder).setRepeat(0),s.setDelay(this.frameRate||200),s.setQuality(this.quality||1),s.start(),Date.now(),h=requestAnimationFrame(function t(e){h=requestAnimationFrame(t),void 0===(void 0===d?"undefined":_typeof(d))&&(d=e),e-d<90||(o.drawImage(r,0,0,a,i),s.addFrame(o),d=e)}),c=setTimeout(e,t)},this.stop=function(){h&&(cancelAnimationFrame(h),clearTimeout(c),e())},this.ondataavailable=function(){},this.onstop=function(){};var a=this,n=document.createElement("canvas"),o=n.getContext("2d"),r=document.createElement("video");r.muted=!0,r.autoplay=!0,r.src=URL.createObjectURL(t),r.play();var d,s,c,h=null}function MultiStreamRecorder(i){if(!i)throw"MediaStream is mandatory.";var n,o,r=this,d=!!navigator.mozGetUserMedia;this.stream=i,this.start=function(t){for(var e in n=new MediaStreamRecorder(i),o=new MediaStreamRecorder(i),n.mimeType="audio/ogg",o.mimeType="video/webm",this)"function"!=typeof this[e]&&(n[e]=o[e]=this[e]);function a(t){c++,r.ondataavailable(t)}n.ondataavailable=function(t){s[c]||(s[c]={}),s[c].audio=t,s[c].video&&!s[c].posted&&(s[c].posted=!0,a(s[c]))},o.ondataavailable=function(t){if(d)return r.ondataavailable({video:t,audio:t});s[c]||(s[c]={}),s[c].video=t,s[c].audio&&!s[c].invokedOnce&&(s[c].invokedOnce=!0,a(s[c]))},o.onstop=n.onstop=function(t){r.onstop(t)},d||(o.onStartedDrawingNonBlankFrames=function(){webrtcdev.debug("Fired: onStartedDrawingNonBlankFrames"),o.clearOldRecordedFrames(),n.start(t)}),o.start(t)},this.stop=function(){n&&n.stop(),o&&o.stop()},this.ondataavailable=function(t){webrtcdev.log("ondataavailable..",t)},this.onstop=function(t){webrtcdev.warn("stopped..",t)};var s={},c=0}function bytesToSize(t){if(0===t)return"0 Bytes";var e=parseInt(Math.floor(Math.log(t)/Math.log(1e3)),10);return(t/Math.pow(1e3,e)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][e]}function SaveToDisk(t,e){var a=document.createElement("a");a.href=URL.createObjectURL(t),a.target="_blank",a.download=(e||Math.round(9999999999*Math.random())+888888888)+"."+t.type.split("/")[1];var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.dispatchEvent(i),(window.URL||window.webkitURL).revokeObjectURL(a.href)}
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function RecordRTC(i,s){if(!i)throw"MediaStream is mandatory.";s=new RecordRTCConfiguration(i,s=s||{type:"video"});var n=this;function e(e){e&&(s.initCallback=function(){e(),e=s.initCallback=null});var t=new GetRecorderType(i,s);(f=new t(i,s)).record(),s.disableLogs||webrtcdev.debug("Initialized recorderType:",f.constructor.name,"for output-type:",s.type)}function t(r){if(!f)return webrtcdev.warn(d);var a=this;function e(e){for(var t in f)n&&(n[t]=f[t]),a&&(a[t]=f[t]);var i=f.blob;if(!i){if(!e)throw"Recording failed.";f.blob=i=e}if(r){var o=URL.createObjectURL(i);r(o)}i&&!s.disableLogs&&webrtcdev.debug(i.type,"->",bytesToSize(i.size)),s.autoWriteToDisk&&u(function(e){var t={};t[s.type+"Blob"]=e,DiskStorage.Store(t)})}s.disableLogs||webrtcdev.warn("Stopped recording "+s.type+" stream."),"gif"!==s.type?f.stop(e):(f.stop(),e())}function c(e){postMessage((new FileReaderSync).readAsDataURL(e))}function u(t,e){if(!t)throw"Pass a callback function over getDataURL.";var i,o,r,a=e?e.blob:(f||{}).blob;if(!a)return s.disableLogs||webrtcdev.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){u(t,e)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var n=new FileReader;n.readAsDataURL(a),n.onload=function(e){t(e.target.result)}}else{var d=(i=c,o=URL.createObjectURL(new Blob([i.toString(),"this.onmessage =  function (e) {"+i.name+"(e.data);}"],{type:"application/javascript"})),r=new Worker(o),URL.revokeObjectURL(o),r);d.onmessage=function(e){t(e.data)},d.postMessage(a)}}function o(){setTimeout(function(){t(n.onRecordingStopped)},n.recordingDuration)}var f,d='It seems that "startRecording" is not invoked for '+s.type+" recorder.",r={startRecording:function(){return s.disableLogs||webrtcdev.debug("started recording "+s.type+" stream."),f?(f.clearRecordedData(),f.resume(),n.recordingDuration&&o()):e(function(){n.recordingDuration&&o()}),n},stopRecording:t,pauseRecording:function(){if(!f)return webrtcdev.warn(d);f.pause(),s.disableLogs||webrtcdev.debug("Paused recording.")},resumeRecording:function(){if(!f)return webrtcdev.warn(d);f.resume(),s.disableLogs||webrtcdev.debug("Resumed recording.")},initRecorder:e,setRecordingDuration:function(e,t){if(void 0===e)throw"milliseconds is required.";if("number"!=typeof e)throw"milliseconds must be a number.";return n.recordingDuration=e,n.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){n.onRecordingStopped=e}}},clearRecordedData:function(){if(!f)return webrtcdev.warn(d);f.clearRecordedData(),s.disableLogs||webrtcdev.debug("Cleared old recorded data.")},getBlob:function(){return f?f.blob:webrtcdev.warn(d)},getDataURL:u,toURL:function(){return f?URL.createObjectURL(f.blob):webrtcdev.warn(d)},save:function(e){if(!f)return webrtcdev.warn(d);invokeSaveAsDialog(f.blob,e)},getFromDisk:function(e){if(!f)return webrtcdev.warn(d);RecordRTC.getFromDisk(s.type,e)},setAdvertisementArray:function(e){s.advertisement=[];for(var t=e.length,i=0;i<t;i++)s.advertisement.push({duration:i,image:e[i]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return n=r;for(var a in r)this[a]=r[a];return n=this,r}function RecordRTCConfiguration(e,t){return t.recorderType&&!t.type&&(t.recorderType===WhammyRecorder||t.recorderType===CanvasRecorder?t.type="video":t.recorderType===GifRecorder?t.type="gif":t.recorderType===StereoAudioRecorder?t.type="audio":t.recorderType===MediaStreamRecorder&&(e.getAudioTracks().length&&e.getVideoTracks().length?t.type="video":e.getAudioTracks().length&&!e.getVideoTracks().length?t.type="audio":!e.getAudioTracks().length&&e.getVideoTracks().length&&(t.type="audio"))),void 0!==MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function GetRecorderType(e,t){var i;return(isChrome||isEdge||isOpera)&&(i=StereoAudioRecorder),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(i=MediaStreamRecorder),"video"===t.type&&(isChrome||isOpera)&&(i=WhammyRecorder),"gif"===t.type&&(i=GifRecorder),"canvas"===t.type&&(i=CanvasRecorder),isMediaRecorderCompatible()&&i!==CanvasRecorder&&i!==GifRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&e.getVideoTracks().length&&(i=MediaStreamRecorder),t.recorderType&&(i=t.recorderType),!t.disableLogs&&i&&i.name&&webrtcdev.debug("Using recorderType:",i.name||i.constructor.name),i}function MRecordRTC(n){this.addStream=function(e){e&&(n=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,t=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof t.audio&&isMediaRecorderCompatible()&&n.getAudioTracks&&!n.getAudioTracks().length&&(t.audio=!1),"function"!=typeof t.video&&isMediaRecorderCompatible()&&n.getVideoTracks&&!n.getVideoTracks().length&&(t.video=!1),!t.audio&&!t.video)throw"MediaStream must have either audio or video tracks.";if(t.audio&&(e=null,"function"==typeof t.audio&&(e=t.audio),this.audioRecorder=new RecordRTC(n,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:i.audio}),t.video||this.audioRecorder.startRecording()),t.video){e=null,"function"==typeof t.video&&(e=t.video);var o=n;if(isMediaRecorderCompatible()&&t.audio&&"function"==typeof t.audio){var r=n.getVideoTracks()[0];navigator.mozGetUserMedia?((o=new MediaStream).addTrack(r),e&&e===WhammyRecorder&&(e=MediaStreamRecorder)):o=new MediaStream([r])}this.videoRecorder=new RecordRTC(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.video}),t.audio||this.videoRecorder.startRecording()}if(t.audio&&t.video){var a=this;isMediaRecorderCompatible()?(a.audioRecorder=null,a.videoRecorder.startRecording()):a.videoRecorder.initRecorder(function(){a.audioRecorder.initRecorder(function(){a.videoRecorder.startRecording(),a.audioRecorder.startRecording()})})}t.gif&&(e=null,"function"==typeof t.gif&&(e=t.gif),this.gifRecorder=new RecordRTC(n,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.getDataURL=function(i){function o(e,t){if("undefined"!=typeof Worker){var i=function(e){var t,i=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(i);if(void 0!==URL)t=URL;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(i),o}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});i.onmessage=function(e){t(e.data)},i.postMessage(e)}else{var o=new FileReader;o.readAsDataURL(e),o.onload=function(e){t(e.target.result)}}}this.getBlob(function(e){e.audio&&e.video?o(e.audio,function(t){o(e.video,function(e){i({audio:t,video:e})})}):e.audio?o(e.audio,function(e){i({audio:e})}):e.video&&o(e.video,function(e){i({video:e})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}RecordRTC.getFromDisk=function(i,o){if(!o)throw"callback is mandatory.";webrtcdev.log("Getting recorded "+("all"===i?"blobs":i+" blob ")+" from disk!"),DiskStorage.Fetch(function(e,t){"all"!==i&&t===i+"Blob"&&o&&o(e),"all"===i&&o&&o(e,t.replace("Blob",""))})},RecordRTC.writeToDisk=function(e){webrtcdev.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(i){e.video.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:i,videoBlob:t,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){DiskStorage.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){DiskStorage.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){DiskStorage.Store({gifBlob:e})})},"undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,void 0!==RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.webrtcdev||(global.webrtcdev={}),void 0===global.webrtcdev.debug&&(global.webrtcdev.debug=global.webrtcdev.info=global.webrtcdev.error=global.webrtcdev.log=global.webrtcdev.log||function(){webrtcdev.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),void 0===URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)}("undefined"!=typeof global?global:null);var requestAnimationFrame=window.requestAnimationFrame;void 0===requestAnimationFrame&&("undefined"!=typeof webkitRequestAnimationFrame&&(requestAnimationFrame=webkitRequestAnimationFrame),"undefined"!=typeof mozRequestAnimationFrame&&(requestAnimationFrame=mozRequestAnimationFrame));var cancelAnimationFrame=window.cancelAnimationFrame;void 0===cancelAnimationFrame&&("undefined"!=typeof webkitCancelAnimationFrame&&(cancelAnimationFrame=webkitCancelAnimationFrame),"undefined"!=typeof mozCancelAnimationFrame&&(cancelAnimationFrame=mozCancelAnimationFrame));var AudioContext=window.AudioContext;void 0===AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;void 0===URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;function bytesToSize(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var i=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var o=t.split(".");t=o[0],i=o[1]}var r=(t||Math.round(9999999999*Math.random())+888888888)+"."+i;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,r);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,r);var a=document.createElement("a");a.href=URL.createObjectURL(e),a.target="_blank",a.download=r,navigator.mozGetUserMedia&&(a.onclick=function(){(document.body||document.documentElement).removeChild(a)},(document.body||document.documentElement).appendChild(a));var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.dispatchEvent(n),navigator.mozGetUserMedia||URL.revokeObjectURL(a.href)}void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),void 0!==MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("video")&&t.push(e)}),t},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("audio")&&t.push(e)}),t}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})}));var Storage={};function isMediaRecorderCompatible(){var e=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t=!!window.chrome&&!e;if(void 0!==window.InstallTrigger)return!0;navigator.appVersion;var i,o,r=navigator.userAgent,a=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10);return(t||e)&&(i=r.indexOf("Chrome"),a=r.substring(i+7)),-1!==(o=a.indexOf(";"))&&(a=a.substring(0,o)),-1!==(o=a.indexOf(" "))&&(a=a.substring(0,o)),n=parseInt(""+a,10),isNaN(n)&&(a=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),49<=n}function MediaStreamRecorder(t,i){var o,r=this;if("audio"===(i=i||{mimeType:"video/webm"}).type){var e;if(t.getVideoTracks().length&&t.getAudioTracks().length)navigator.mozGetUserMedia?(e=new MediaStream).addTrack(t.getAudioTracks()[0]):e=new MediaStream(t.getAudioTracks()),t=e;i.mimeType&&-1!==i.mimeType.toString().toLowerCase().indexOf("audio")||(i.mimeType=isChrome?"audio/webm":"audio/ogg"),i.mimeType&&"audio/ogg"!==i.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(i.mimeType="audio/ogg")}this.record=function(){r.blob=null;var e=i;i.disableLogs||webrtcdev.log("Passing following config over MediaRecorder API.",e),o&&(o=null),isChrome&&!isMediaRecorderCompatible()&&(e="video/vp8");try{o=new MediaRecorder(t,e)}catch(e){o=new MediaRecorder(t)}"canRecordMimeType"in o&&!1===o.canRecordMimeType(i.mimeType)&&(i.disableLogs||webrtcdev.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType)),o.ignoreMutedMedia=i.ignoreMutedMedia||!1,o.ondataavailable=function(e){r.dontFireOnDataAvailableEvent||!e.data||!e.data.size||e.data.size<100||r.blob||(r.blob=i.getNativeBlob?e.data:new Blob([e.data],{type:i.mimeType||"video/webm"}),r.recordingCallback&&(r.recordingCallback(r.blob),r.recordingCallback=null))},o.onerror=function(e){i.disableLogs||("InvalidState"===e.name?webrtcdev.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?webrtcdev.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?webrtcdev.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?webrtcdev.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?webrtcdev.error("The UA cannot provide the codec or recording option that has been requested.",e):webrtcdev.error("MediaRecorder Error",e)),"inactive"!==o.state&&"stopped"!==o.state&&o.stop()},o.start(36e5),i.onAudioProcessStarted&&i.onAudioProcessStarted(),i.initCallback&&i.initCallback()},this.stop=function(t){o&&(this.recordingCallback=function(e){o=null,t&&t(e)},"recording"===o.state&&o.stop())},this.pause=function(){o&&"recording"===o.state&&o.pause()},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=i.disableLogs;return i.disableLogs=!0,this.record(),void(i.disableLogs=e)}o&&"paused"===o.state&&o.resume()},this.clearRecordedData=function(){o&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};r=this;!function e(){if(o)return!1===function(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}()?(i.disableLogs||webrtcdev.log("MediaStream seems stopped."),void r.stop()):void setTimeout(e,1e3)}()}function StereoAudioRecorder(e,o){if(!e.getAudioTracks().length)throw"Your stream has no audio tracks.";var r,a=this,n=[],d=[],s=!1,c=0,u=2;function f(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function t(e,t){function i(e,t){var i,o=e.numberOfAudioChannels,r=e.leftBuffers.slice(0),a=e.rightBuffers.slice(0),n=e.sampleRate,d=e.internalInterleavedLength;function s(e,t){for(var i=new Float64Array(t),o=0,r=e.length,a=0;a<r;a++){var n=e[a];i.set(n,o),o+=n.length}return i}function c(e,t,i){for(var o=i.length,r=0;r<o;r++)e.setUint8(t+r,i.charCodeAt(r))}2===o&&(r=s(r,d),a=s(a,d)),1===o&&(r=s(r,d)),2===o&&(i=function(e,t){for(var i=e.length+t.length,o=new Float64Array(i),r=0,a=0;a<i;)o[a++]=e[r],o[a++]=t[r],r++;return o}(r,a)),1===o&&(i=r);var u=i.length,f=new ArrayBuffer(44+2*u),l=new DataView(f);c(l,0,"RIFF"),l.setUint32(4,44+2*u,!0),c(l,8,"WAVE"),c(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,o,!0),l.setUint32(24,n,!0),l.setUint32(28,2*n,!0),l.setUint16(32,2*o,!0),l.setUint16(34,16,!0),c(l,36,"data"),l.setUint32(40,2*u,!0);for(var g=u,m=44,h=0;h<g;h++)l.setInt16(m,32767*i[h],!0),m+=2;if(t)return t({buffer:f,view:l});postMessage({buffer:f,view:l})}if(isChrome){var o,r,a,n=(o=i,r=URL.createObjectURL(new Blob([o.toString(),";this.onmessage =  function (e) {"+o.name+"(e.data);}"],{type:"application/javascript"})),(a=new Worker(r)).workerURL=r,a);n.onmessage=function(e){t(e.data.buffer,e.data.view),URL.revokeObjectURL(n.workerURL)},n.postMessage(e)}else i(e,function(e){t(e.buffer,e.view)})}!0===(o=o||{}).leftChannel&&(u=1),1===o.numberOfAudioChannels&&(u=1),o.disableLogs||webrtcdev.debug("StereoAudioRecorder is set to record number of channels: ",u),this.record=function(){if(!1===f())throw"Please make sure MediaStream is active.";n.length=d.length=0,c=0,l&&l.connect(r),b=v=!1,s=!0},this.stop=function(i){s=!1,t({sampleRate:h,numberOfAudioChannels:u,internalInterleavedLength:c,leftBuffers:n,rightBuffers:1===u?[]:d},function(e,t){a.blob=new Blob([t],{type:"audio/wav"}),a.buffer=new ArrayBuffer(t.buffer.byteLength),a.view=t,a.sampleRate=h,a.bufferSize=m,a.length=c,i&&i(),b=!1})},Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext);var i=Storage.AudioContextConstructor,l=i.createMediaStreamSource(e),g=[0,256,512,1024,2048,4096,8192,16384],m=void 0===o.bufferSize?4096:o.bufferSize;if(-1===g.indexOf(m)&&(o.disableLogs||webrtcdev.warn("Legal values for buffer-size are "+JSON.stringify(g,null,"\t"))),i.createJavaScriptNode)r=i.createJavaScriptNode(m,u,u);else{if(!i.createScriptProcessor)throw"WebAudio API has no support on this browser.";r=i.createScriptProcessor(m,u,u)}l.connect(r),o.bufferSize||(m=r.bufferSize);var h=void 0!==o.sampleRate?o.sampleRate:i.sampleRate||44100;(h<22050||96e3<h)&&(o.disableLogs||webrtcdev.warn("sample-rate must be under range 22050 and 96000.")),o.disableLogs||(webrtcdev.log("sample-rate",h),webrtcdev.log("buffer-size",m));var v=!1;this.pause=function(){v=!0},this.resume=function(){if(!1===f())throw"Please make sure MediaStream is active.";if(!s)return o.disableLogs||webrtcdev.info("Seems recording has been restarted."),void this.record();v=!1};var b=!(this.clearRecordedData=function(){this.pause(),n.length=d.length=0,c=0});r.onaudioprocess=function(e){if(!v)if(!1===f()&&(o.disableLogs||webrtcdev.log("MediaStream seems stopped."),r.disconnect(),s=!1),s){b||(b=!0,o.onAudioProcessStarted&&o.onAudioProcessStarted(),o.initCallback&&o.initCallback());var t=e.inputBuffer.getChannelData(0);if(n.push(new Float32Array(t)),2===u){var i=e.inputBuffer.getChannelData(1);d.push(new Float32Array(i))}c+=m}else l.disconnect()},r.connect(i.destination)}function CanvasRecorder(o,a){if("undefined"==typeof html2canvas&&"canvas"!==o.nodeName.toLowerCase())throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";(a=a||{}).frameInterval||(a.frameInterval=10);var r=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(r=!0)});var i,n,d,e=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),t=50,s=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e&&s&&s[2]&&(t=parseInt(s[2],10)),e&&t<52&&(r=!1),r)if(a.disableLogs||webrtcdev.debug("Your browser supports both MediRecorder API and canvas.captureStream!"),o instanceof HTMLCanvasElement)i=o;else{if(!(o instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";i=o.canvas}else navigator.mozGetUserMedia&&(a.disableLogs||webrtcdev.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(d=!0,r){var e;"captureStream"in i?e=i.captureStream(25):"mozCaptureStream"in i?e=i.mozCaptureStream(25):"webkitCaptureStream"in i&&(e=i.webkitCaptureStream(25));try{var t=new MediaStream;t.addTrack(e.getVideoTracks()[0]),e=t}catch(e){}if(!e)throw"captureStream API are NOT available.";(n=new MediaStreamRecorder(e,{mimeType:"video/webm"})).record()}else l.frames=[],f=(new Date).getTime(),u();a.initCallback&&a.initCallback()},this.getWebPImages=function(e){if("canvas"===o.nodeName.toLowerCase()){var r=l.frames.length;l.frames.forEach(function(e,t){var i=r-t;a.disableLogs||webrtcdev.debug(i+"/"+r+" frames remaining"),a.onEncodingCallback&&a.onEncodingCallback(i,r);var o=e.image.toDataURL("image/webp",1);l.frames[t].image=o}),a.disableLogs||webrtcdev.debug("Generating WebM"),e()}else e()};var c=!(this.stop=function(t){d=!1;var i=this;r&&n?n.stop(t):this.getWebPImages(function(){l.compile(function(e){a.disableLogs||webrtcdev.debug("Recording finished!"),i.blob=e,i.blob.forEach&&(i.blob=new Blob([],{type:"video/webm"})),t&&t(i.blob),l.frames=[]})})});function u(){if(c)return f=(new Date).getTime(),setTimeout(u,500);if("canvas"===o.nodeName.toLowerCase()){var e=(new Date).getTime()-f;return f=(new Date).getTime(),l.frames.push({image:(t=document.createElement("canvas"),i=t.getContext("2d"),t.width=o.width,t.height=o.height,i.drawImage(o,0,0),t),duration:e}),void(d&&setTimeout(u,a.frameInterval))}var t,i;html2canvas(o,{grabMouse:void 0===a.showMousePointer||a.showMousePointer,onrendered:function(e){var t=(new Date).getTime()-f;if(!t)return setTimeout(u,a.frameInterval);f=(new Date).getTime(),l.frames.push({image:e.toDataURL("image/webp",1),duration:t}),d&&setTimeout(u,a.frameInterval)}})}this.pause=function(){c=!0},this.resume=function(){c=!1,d||this.record()},this.clearRecordedData=function(){this.pause(),l.frames=[]};var f=(new Date).getTime(),l=new Whammy.Video(100)}function WhammyRecorder(e,o){function i(e){e=void 0!==e?e:10;var t=(new Date).getTime()-d;return t?a?(d=(new Date).getTime(),setTimeout(i,100)):(d=(new Date).getTime(),n.paused&&n.play(),c.drawImage(n,0,0,w.width,w.height),s.frames.push({duration:t,image:w.toDataURL("image/webp")}),void(r||setTimeout(i,e,e))):setTimeout(i,e,e)}(o=o||{}).frameInterval||(o.frameInterval=10),o.disableLogs||webrtcdev.log("Using frames-interval:",o.frameInterval);var r=!(this.record=function(){o.width||(o.width=320),o.height||(o.height=240),o.video||(o.video={width:o.width,height:o.height}),o.canvas||(o.canvas={width:o.width,height:o.height}),w.width=o.canvas.width,w.height=o.canvas.height,c=w.getContext("2d"),o.video&&o.video instanceof HTMLVideoElement?(n=o.video.cloneNode(),o.initCallback&&o.initCallback()):(void 0!==(n=document.createElement("video")).srcObject?n.srcObject=e:n.src=URL.createObjectURL(e),n.onloadedmetadata=function(){o.initCallback&&o.initCallback()},n.width=o.video.width,n.height=o.video.height),n.muted=!0,n.play(),d=(new Date).getTime(),s=new Whammy.Video,o.disableLogs||(webrtcdev.log("canvas resolutions",w.width,"*",w.height),webrtcdev.log("video width/height",n.width||w.width,"*",n.height||w.height)),i(o.frameInterval)}),a=!(this.stop=function(t){r=!0;var i=this;setTimeout(function(){!function(i,e,t,o,r){var a=document.createElement("canvas");a.width=w.width,a.height=w.height;var n,d,s,u=a.getContext("2d"),f=[],l=-1===e,c=e&&0<e&&e<=i.length?e:i.length,g=0,m=0,h=0,v=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),b=t&&0<=t&&t<=1?t:0,p=o&&0<=o&&o<=1?o:0,R=!1;d=-1,s=(n={length:c,functionToLoop:function(e,t){var a,n,d,s=function(){!R&&d-a<=d*p||(l&&(R=!0),f.push(i[t])),e()};if(R)s();else{var c=new Image;c.onload=function(){u.drawImage(c,0,0,w.width,w.height);var e=u.getImageData(0,0,w.width,w.height);a=0,n=e.data.length,d=e.data.length/4;for(var t=0;t<n;t+=4){var i=e.data[t],o=e.data[t+1],r=e.data[t+2];Math.sqrt(Math.pow(i-g,2)+Math.pow(o-m,2)+Math.pow(r-h,2))<=v*b&&a++}s()},c.src=i[t].image}},callback:function(){(f=f.concat(i.slice(c))).length<=0&&f.push(i[i.length-1]),r(f)}}).length,function e(){++d!==s?n.functionToLoop(e,d):n.callback()}()}(s.frames,-1,null,null,function(e){s.frames=e,o.advertisement&&o.advertisement.length&&(s.frames=o.advertisement.concat(s.frames)),s.compile(function(e){i.blob=e,i.blob.forEach&&(i.blob=new Blob([],{type:"video/webm"})),t&&t(i.blob)})})},10)});this.pause=function(){a=!0},this.resume=function(){a=!1,r&&this.record()},this.clearRecordedData=function(){this.pause(),s.frames=[]};var n,d,s,w=document.createElement("canvas"),c=w.getContext("2d")}void 0!==AudioContext?Storage.AudioContext=AudioContext:"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext),void 0!==RecordRTC&&(RecordRTC.Storage=Storage),void 0!==RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder),void 0!==RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder),void 0!==RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder),void 0!==RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function a(e){function c(e,i,t){return[{data:e,id:231}].concat(t.map(function(e){var t=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(i)});return i+=e.duration,{data:t,id:163}}))}function u(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function f(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var i=0;i<e.length;i+=8)t.push(parseInt(e.substr(i,8),2));return new Uint8Array(t)}var t=new function(e){var t=function(e){if(e[0]){for(var t=e[0].width,i=e[0].height,o=e[0].duration,r=1;r<e.length;r++)o+=e[r].duration;return{duration:o,width:t,height:i}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!t)return[];for(var i,o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(i=t.duration,[].slice.call(new Uint8Array(new Float64Array([i]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],r=0,a=0;r<e.length;){for(var n=[],d=0;n.push(e[r]),d+=e[r].duration,++r<e.length&&d<3e4;);var s={id:524531317,data:c(a,0,n)};o[1].data.push(s),a+=d}return function e(t){for(var i=[],o=0;o<t.length;o++){var r=t[o].data;"object"===(void 0===r?"undefined":_typeof(r))&&(r=e(r)),"number"==typeof r&&(r=f(r.toString(2))),"string"==typeof r&&(r=new Uint8Array(r.split("").map(function(e){return e.charCodeAt(0)})));var a=r.size||r.byteLength||r.length,n=Math.ceil(Math.ceil(Math.log(a)/Math.log(2))/8),d=a.toString(2),s=new Array(7*n+7+1-d.length).join("0")+d,c=new Array(n).join("0")+"1"+s;i.push(u(t[o].id)),i.push(f(c)),i.push(r)}return new Blob(i,{type:"video/webm"})}(o)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],i=t.indexOf("*"),o=0,r=[];o<4;o++)r[o]=t.charCodeAt(i+3+o);return{width:16383&(r[1]<<8|r[0]),height:16383&(r[3]<<8|r[2]),data:t,riff:e}}(function e(t){for(var i,o=0,r={};o<t.length;){var a=t.substr(o,4),n=(i=o,parseInt(t.substr(i+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)),d=t.substr(o+4+4,n);o+=8+n,r[a]=r[a]||[],"RIFF"===a||"LIST"===a?r[a].push(e(d)):r[a].push(d)}return r}(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(t)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(t){var e,i,o,r=(e=a,i=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(i),URL.revokeObjectURL(i),o);r.onmessage=function(e){e.data.error?webrtcdev.error(e.data.error):t(e.data)},r.postMessage(this.frames)},{Video:e}}();void 0!==RecordRTC&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){var i=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var o,e=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),t=indexedDB.open(e,1);t.onerror=i.onError,t.onsuccess=function(){((o=t.result).onerror=i.onError,o.setVersion)?1!==o.version?o.setVersion(1).onsuccess=function(){r(o),a()}:a():a()},t.onupgradeneeded=function(e){r(e.target.result)}}else webrtcdev.error("IndexedDB API are not available in this browser.");function r(e){e.createObjectStore(i.dataStoreName)}function a(){var e=o.transaction([i.dataStoreName],"readwrite");function t(t){e.objectStore(i.dataStoreName).get(t).onsuccess=function(e){i.callback&&i.callback(e.target.result,t)}}i.videoBlob&&e.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob"),i.gifBlob&&e.objectStore(i.dataStoreName).put(i.gifBlob,"gifBlob"),i.audioBlob&&e.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob"),t("audioBlob"),t("videoBlob"),t("gifBlob")}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){webrtcdev.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function GifRecorder(e,i){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";i=i||{};var o=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){o||(i.width||(i.width=d.offsetWidth||320),this.height||(i.height=d.offsetHeight||240),i.video||(i.video={width:i.width,height:i.height}),i.canvas||(i.canvas={width:i.width,height:i.height}),a.width=i.canvas.width,a.height=i.canvas.height,d.width=i.video.width,d.height=i.video.height),(c=new GIFEncoder).setRepeat(0),c.setDelay(i.frameRate||200),c.setQuality(i.quality||10),c.start(),Date.now();u=requestAnimationFrame(function e(t){if(r)return setTimeout(function(){e(t)},100);u=requestAnimationFrame(e),void 0===(void 0===s?"undefined":_typeof(s))&&(s=t),t-s<90||(!o&&d.paused&&d.play(),o||n.drawImage(d,0,0,a.width,a.height),i.onGifPreview&&i.onGifPreview(a.toDataURL("image/png")),c.addFrame(n),s=t)}),i.initCallback&&i.initCallback()};var r=!(this.stop=function(){u&&cancelAnimationFrame(u),Date.now(),this.blob=new Blob([new Uint8Array(c.stream().bin)],{type:"image/gif"}),c.stream().bin=[]});this.pause=function(){r=!0},this.resume=function(){r=!1},this.clearRecordedData=function(){c&&(this.pause(),c.stream().bin=[])};var a=document.createElement("canvas"),n=a.getContext("2d");if(o&&(e instanceof CanvasRenderingContext2D?a=(n=e).canvas:e instanceof HTMLCanvasElement&&(n=e.getContext("2d"),a=e)),!o){var d=document.createElement("video");d.muted=!0,d.autoplay=!0,void 0!==d.srcObject?d.srcObject=e:d.src=URL.createObjectURL(e),d.play()}var s,c,u=null}void 0!==RecordRTC&&(RecordRTC.DiskStorage=DiskStorage),void 0!==RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function h2clog(t){_html2canvas.logging&&window.webrtcdev&&window.webrtcdev.log&&window.webrtcdev.log(t)}function backgroundBoundsFactory(t,e,n,a,o,r){var i,l,c,d,s=_html2canvas.Util.getCSS(e,t,o);if(1===s.length&&(d=s[0],(s=[])[0]=d,s[1]=d),-1!==s[0].toString().indexOf("%"))c=parseFloat(s[0])/100,l=n.width*c,"backgroundSize"!==t&&(l-=(r||a).width*c);else if("backgroundSize"===t)if("auto"===s[0])l=a.width;else if(s[0].match(/contain|cover/)){var h=_html2canvas.Util.resizeBounds(a.width,a.height,n.width,n.height,s[0]);l=h.width,i=h.height}else l=parseInt(s[0],10);else l=parseInt(s[0],10);return"auto"===s[1]?i=l/a.width*a.height:-1!==s[1].toString().indexOf("%")?(c=parseFloat(s[1])/100,i=n.height*c,"backgroundSize"!==t&&(i-=(r||a).height*c)):i=parseInt(s[1],10),[l,i]}function h2czContext(t){return{zindex:t,children:[]}}function h2cRenderContext(t,e){var n=[];return{storage:n,width:t,height:e,clip:function(){n.push({type:"function",name:"clip",arguments:arguments})},translate:function(){n.push({type:"function",name:"translate",arguments:arguments})},fill:function(){n.push({type:"function",name:"fill",arguments:arguments})},save:function(){n.push({type:"function",name:"save",arguments:arguments})},restore:function(){n.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){n.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){n.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var t=[];return n.push({type:"function",name:"drawShape",arguments:t}),{moveTo:function(){t.push({name:"moveTo",arguments:arguments})},lineTo:function(){t.push({name:"lineTo",arguments:arguments})},arcTo:function(){t.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){t.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){t.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){n.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){n.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){n.push({type:"variable",name:t,arguments:e})}}}function getMouseXY(t){return IE?(coordX=event.clientX+document.body.scrollLeft,coordY=event.clientY+document.body.scrollTop):(coordX=t.pageX,coordY=t.pageY),coordX<0&&(coordX=0),coordY<0&&(coordY=0),!0}var previousElement,computedCSS,html2canvas,_html2canvas={};_html2canvas.Util={},_html2canvas.Util.trimText=function(e){return function(t){return e?e.apply(t):((t||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim),_html2canvas.Util.parseBackgroundImage=function(t){var e,n,a,o,r,i,l,c,d=[],s=0,h=0,u=function(){e&&('"'===n.substr(0,1)&&(n=n.substr(1,n.length-2)),n&&c.push(n),"-"===e.substr(0,1)&&0<(o=e.indexOf("-",1)+1)&&(a=e.substr(0,o),e=e.substr(o)),d.push({prefix:a,method:e.toLowerCase(),value:r,args:c})),c=[],e=a=n=r=""};u();for(var m=0,g=t.length;m<g;m++)if(i=t[m],!(0===s&&-1<" \r\n\t".indexOf(i))){switch(i){case'"':l?l===i&&(l=null):l=i;break;case"(":if(l)break;if(0===s){s=1,r+=i;continue}h++;break;case")":if(l)break;if(1===s){if(0===h){s=0,r+=i,u();continue}h--}break;case",":if(l)break;if(0===s){u();continue}if(1===s&&0===h&&!e.match(/^url$/i)){c.push(n),n="",r+=i;continue}}r+=i,0===s?e+=i:n+=i}return u(),d},_html2canvas.Util.Bounds=function(t){var e,n={};if(t.getBoundingClientRect)return e=t.getBoundingClientRect(),n.top=e.top,n.bottom=e.bottom||e.top+e.height,n.left=e.left,n.width=e.width||e.right-e.left,n.height=e.height||e.bottom-e.top,n},_html2canvas.Util.getCSS=function(r,t,e){function n(t,e){var n,a=r.runtimeStyle&&r.runtimeStyle[t],o=r.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(e)&&/^-?\d/.test(e)&&(n=o.left,a&&(r.runtimeStyle.left=r.currentStyle.left),o.left="fontSize"===t?"1em":e||0,e=o.pixelLeft+"px",o.left=n,a&&(r.runtimeStyle.left=a)),/^(thin|medium|thick)$/i.test(e)?e:Math.round(parseFloat(e))+"px"}var a,o=t.match(/^background(Size|Position)$/);if(previousElement!==r&&(computedCSS=document.defaultView.getComputedStyle(r,null)),a=computedCSS[t],o)if(a=(a=(a||"").split(","))[e||0]||a[0]||"auto",a=_html2canvas.Util.trimText(a).split(" "),"backgroundSize"!==t||a[0]&&!a[0].match(/cover|contain|auto/)){if(a[0]=-1===a[0].indexOf("%")?n(t+"X",a[0]):a[0],void 0===a[1]){if("backgroundSize"===t)return a[1]="auto",a;a[1]=a[0]}a[1]=-1===a[1].indexOf("%")?n(t+"Y",a[1]):a[1]}else;else if(/border(Top|Bottom)(Left|Right)Radius/.test(t)){var i=a.split(" ");i.length<=1&&(i[1]=i[0]),i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10),a=i}return a},_html2canvas.Util.resizeBounds=function(t,e,n,a,o){var r,i,l=t/e;return o&&"auto"!==o?n/a<l^"contain"===o?r=(i=a)*l:i=(r=n)/l:(r=n,i=a),{width:r,height:i}},_html2canvas.Util.BackgroundPosition=function(t,e,n,a,o){var r=backgroundBoundsFactory("backgroundPosition",t,e,n,a,o);return{left:r[0],top:r[1]}},_html2canvas.Util.BackgroundSize=function(t,e,n,a){var o=backgroundBoundsFactory("backgroundSize",t,e,n,a);return{width:o[0],height:o[1]}},_html2canvas.Util.Extend=function(t,e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},_html2canvas.Util.Children=function(t){var e,n,a;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:(n=t.childNodes,a=[],null!==n&&function(t,e){var n=t.length,a=0;if("number"==typeof e.length)for(var o=e.length;a<o;a++)t[n++]=e[a];else for(;void 0!==e[a];)t[n++]=e[a++];t.length=n}(a,n),a)}catch(t){h2clog("html2canvas.Util.Children failed with exception: "+t.message),e=[]}return e},_html2canvas.Util.Font=function(){var d={};return function(t,e,n){if(void 0!==d[t+"-"+e])return d[t+"-"+e];var a,o,r=n.createElement("div"),i=n.createElement("img"),l=n.createElement("span"),c="Hidden Text";return r.style.visibility="hidden",r.style.fontFamily=t,r.style.fontSize=e,r.style.margin=0,r.style.padding=0,n.body.appendChild(r),i.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",i.width=1,i.height=1,i.style.margin=0,i.style.padding=0,i.style.verticalAlign="baseline",l.style.fontFamily=t,l.style.fontSize=e,l.style.margin=0,l.style.padding=0,l.appendChild(n.createTextNode(c)),r.appendChild(l),r.appendChild(i),a=i.offsetTop-l.offsetTop+1,r.removeChild(l),r.appendChild(n.createTextNode(c)),r.style.lineHeight="normal",i.style.verticalAlign="super",o={baseline:a,lineWidth:1,middle:i.offsetTop-r.offsetTop+1},d[t+"-"+e]=o,n.body.removeChild(r),o}}(),function(){_html2canvas.Generate={};var p=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];_html2canvas.Generate.parseGradient=function(t,e){var n,a,o,r,i,l,c,d,s,h,u,m,g=p.length;for(a=0;a<g&&!(o=t.match(p[a]));a+=1);if(o)switch(o[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(n={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},i=o[2].match(/\w+/g))for(l=i.length,a=0;a<l;a+=1)switch(i[a]){case"top":n.y0=0,n.y1=e.height;break;case"right":n.x0=e.width,n.x1=0;break;case"bottom":n.y0=e.height,n.y1=0;break;case"left":n.x0=0,n.x1=e.width}if(null===n.x0&&null===n.x1&&(n.x0=n.x1=e.width/2),null===n.y0&&null===n.y1&&(n.y0=n.y1=e.height/2),i=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(l=i.length,c=1/Math.max(l-1,1),a=0;a<l;a+=1)(d=i[a].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(r=parseFloat(d[2]),"%"===d[3]?r/=100:r/=e.width):r=a*c,n.colorStops.push({color:d[1],stop:r});break;case"-webkit-gradient":if(n={type:"radial"===o[2]?"circle":o[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},(i=o[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))&&(n.x0=i[1]*e.width/100,n.y0=i[2]*e.height/100,n.x1=i[3]*e.width/100,n.y1=i[4]*e.height/100),i=o[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(l=i.length,a=0;a<l;a+=1)d=i[a].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),r=parseFloat(d[2]),"from"===d[1]&&(r=0),"to"===d[1]&&(r=1),n.colorStops.push({color:d[3],stop:r});break;case"-moz-linear-gradient":if(n={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},(i=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(n.x0=i[1]*e.width/100,n.y0=i[2]*e.height/100,n.x1=e.width-n.x0,n.y1=e.height-n.y0),i=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(l=i.length,c=1/Math.max(l-1,1),a=0;a<l;a+=1)(d=i[a].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/))[2]?(r=parseFloat(d[2]),d[3]&&(r/=100)):r=a*c,n.colorStops.push({color:d[1],stop:r});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(n={type:"circle",x0:0,y0:0,x1:e.width,y1:e.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},(i=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(n.cx=i[1]*e.width/100,n.cy=i[2]*e.height/100),i=o[3].match(/\w+/),d=o[4].match(/[a-z\-]*/),i&&d)switch(d[0]){case"farthest-corner":case"cover":case"":s=Math.sqrt(Math.pow(n.cx,2)+Math.pow(n.cy,2)),h=Math.sqrt(Math.pow(n.cx,2)+Math.pow(n.y1-n.cy,2)),u=Math.sqrt(Math.pow(n.x1-n.cx,2)+Math.pow(n.y1-n.cy,2)),m=Math.sqrt(Math.pow(n.x1-n.cx,2)+Math.pow(n.cy,2)),n.rx=n.ry=Math.max(s,h,u,m);break;case"closest-corner":s=Math.sqrt(Math.pow(n.cx,2)+Math.pow(n.cy,2)),h=Math.sqrt(Math.pow(n.cx,2)+Math.pow(n.y1-n.cy,2)),u=Math.sqrt(Math.pow(n.x1-n.cx,2)+Math.pow(n.y1-n.cy,2)),m=Math.sqrt(Math.pow(n.x1-n.cx,2)+Math.pow(n.cy,2)),n.rx=n.ry=Math.min(s,h,u,m);break;case"farthest-side":"circle"===i[0]?n.rx=n.ry=Math.max(n.cx,n.cy,n.x1-n.cx,n.y1-n.cy):(n.type=i[0],n.rx=Math.max(n.cx,n.x1-n.cx),n.ry=Math.max(n.cy,n.y1-n.cy));break;case"closest-side":case"contain":"circle"===i[0]?n.rx=n.ry=Math.min(n.cx,n.cy,n.x1-n.cx,n.y1-n.cy):(n.type=i[0],n.rx=Math.min(n.cx,n.x1-n.cx),n.ry=Math.min(n.cy,n.y1-n.cy))}if(i=o[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(l=i.length,c=1/Math.max(l-1,1),a=0;a<l;a+=1)(d=i[a].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(r=parseFloat(d[2]),"%"===d[3]?r/=100:r/=e.width):r=a*c,n.colorStops.push({color:d[1],stop:r})}return n},_html2canvas.Generate.Gradient=function(e,t){if(0!==t.width&&0!==t.height){var n,a,o,r,i=document.createElement("canvas"),l=i.getContext("2d");if(i.width=t.width,i.height=t.height,n=_html2canvas.Generate.parseGradient(e,t))if("linear"===n.type){for(a=l.createLinearGradient(n.x0,n.y0,n.x1,n.y1),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(t){h2clog(["failed to add color stop: ",t,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",e])}l.fillStyle=a,l.fillRect(0,0,t.width,t.height)}else if("circle"===n.type){for(a=l.createRadialGradient(n.cx,n.cy,0,n.cx,n.cy,n.rx),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(t){h2clog(["failed to add color stop: ",t,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",e])}l.fillStyle=a,l.fillRect(0,0,t.width,t.height)}else if("ellipse"===n.type){var c=document.createElement("canvas"),d=c.getContext("2d"),s=Math.max(n.rx,n.ry),h=2*s;for(c.width=c.height=h,a=d.createRadialGradient(n.rx,n.ry,0,n.rx,n.ry,s),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(t){h2clog(["failed to add color stop: ",t,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",e])}d.fillStyle=a,d.fillRect(0,0,h,h),l.fillStyle=n.colorStops[o-1].color,l.fillRect(0,0,i.width,i.height),l.drawImage(c,n.cx-n.rx,n.cy-n.ry,2*n.rx,2*n.ry)}return i}},_html2canvas.Generate.ListAlpha=function(t){for(var e,n="";e=t%26,n=String.fromCharCode(e+64)+n,26<26*(t/=26););return n},_html2canvas.Generate.ListRoman=function(t){var e,n=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],a=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],o="",r=n.length;if(t<=0||4e3<=t)return t;for(e=0;e<r;e+=1)for(;a[e]<=t;)t-=a[e],o+=n[e];return o}}(),_html2canvas.Parse=function(n,m){function g(){return Math.max(Math.max(y.body.scrollWidth,y.documentElement.scrollWidth),Math.max(y.body.offsetWidth,y.documentElement.offsetWidth),Math.max(y.body.clientWidth,y.documentElement.clientWidth))}function p(){return Math.max(Math.max(y.body.scrollHeight,y.documentElement.scrollHeight),Math.max(y.body.offsetHeight,y.documentElement.offsetHeight),Math.max(y.body.clientHeight,y.documentElement.clientHeight))}function f(t,e){var n=parseInt(F(t,e),10);return isNaN(n)?0:n}function C(t,e,n,a,o,r){"transparent"!==r&&(t.setVariable("fillStyle",r),t.fillRect(e,n,a,o),1)}function u(t,e,n,a){null!==t&&0<_html2canvas.Util.trimText(t).length&&(a.fillText(t,e,n),1)}function w(t,e,n,a){var o=F(e,"fontWeight"),r=F(e,"fontFamily"),i=F(e,"fontSize");switch(parseInt(o,10)){case 401:o="bold";break;case 400:o="normal"}if(t.setVariable("fillStyle",a),t.setVariable("font",[F(e,"fontStyle"),F(e,"fontVariant"),o,i,r].join(" ")),t.setVariable("textAlign","left"),"none"!==n)return _html2canvas.Util.Font(r,i,y)}function h(t,e,n,a){var o,r,i,l,c;if(b.rangeBounds)"none"===n&&0===_html2canvas.Util.trimText(e).length||(r=e,i=t.node,l=t.textOffset,(c=y.createRange()).setStart(i,l),c.setEnd(i,l+r.length),o=c.getBoundingClientRect()),t.textOffset+=e.length;else if(t.node&&"string"==typeof t.node.nodeValue){var d=a?t.node.splitText(e.length):null;o=function(t){var e=t.parentNode,n=y.createElement("wrapper"),a=t.cloneNode(!0);n.appendChild(t.cloneNode(!0)),e.replaceChild(n,t);var o=_html2canvas.Util.Bounds(n);return e.replaceChild(a,n),o}(t.node),t.node=d}return o}function i(t,e,n){var a,o,r,i=n.ctx,l=F(t,"color"),c=F(t,"textDecoration"),d=F(t,"textAlign"),s={node:e,textOffset:0};0<_html2canvas.Util.trimText(e.nodeValue).length&&(e.nodeValue=function(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(t,e,n){if(0<t.length)return e+n.toUpperCase()});case"uppercase":return t.toUpperCase();default:return t}}(e.nodeValue,F(t,"textTransform")),d=d.replace(["-webkit-auto"],["auto"]),o=!m.letterRendering&&/^(left|right|justify|auto)$/.test(d)&&(r=F(t,"letterSpacing"),/^(normal|none|0px)$/.test(r))?e.nodeValue.split(/(\b| )/):e.nodeValue.split(""),a=w(i,t,c,l),m.chinese&&o.forEach(function(t,e){/.*[\u4E00-\u9FA5].*$/.test(t)&&((t=t.split("")).unshift(e,1),o.splice.apply(o,t))}),o.forEach(function(t,e){var n=h(s,t,c,e<o.length-1);n&&(u(t,n.left,n.bottom,i),function(t,e,n,a,o){switch(e){case"underline":C(t,n.left,Math.round(n.top+a.baseline+a.lineWidth),n.width,1,o);break;case"overline":C(t,n.left,Math.round(n.top),n.width,1,o);break;case"line-through":C(t,n.left,Math.ceil(n.top+a.middle+a.lineWidth),n.width,1,o)}}(i,c,n,a,l))}))}function A(t,e,n){var a,o,r,i,l,c,d,s=e.ctx,h=F(t,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(h)){if(a=function(t,e){var n,a=function(t){var e=-1,n=1,a=t.parentNode.childNodes;if(t.parentNode){for(;a[++e]!==t;)1===a[e].nodeType&&n++;return n}return-1}(t);switch(e){case"decimal":n=a;break;case"decimal-leading-zero":n=1===a.toString().length?a="0"+a.toString():a.toString();break;case"upper-roman":n=_html2canvas.Generate.ListRoman(a);break;case"lower-roman":n=_html2canvas.Generate.ListRoman(a).toLowerCase();break;case"lower-alpha":n=_html2canvas.Generate.ListAlpha(a).toLowerCase();break;case"upper-alpha":n=_html2canvas.Generate.ListAlpha(a)}return n+=". "}(t,h),r=t,i=a,(d=y.createElement("boundelement")).style.display="inline",l=r.style.listStyleType,r.style.listStyleType="none",d.appendChild(y.createTextNode(i)),r.insertBefore(d,r.firstChild),c=_html2canvas.Util.Bounds(d),r.removeChild(d),r.style.listStyleType=l,o=c,w(s,t,"none",F(t,"color")),"inside"!==F(t,"listStylePosition"))return;s.setVariable("textAlign","left"),u(a,n.left,o.bottom,s)}}function S(t){var e=n[t];return!(!e||!0!==e.succeeded)&&e.img}function R(t,e){var n=Math.max(t.left,e.left),a=Math.max(t.top,e.top);return{left:n,top:a,width:Math.min(t.left+t.width,e.left+e.width)-n,height:Math.min(t.top+t.height,e.top+e.height)-a}}function E(t,e,n,a,o){var r=f(e,"paddingLeft"),i=f(e,"paddingTop"),l=f(e,"paddingRight"),c=f(e,"paddingBottom");d(t,n,0,0,n.width,n.height,a.left+r+o[3].width,a.top+i+o[0].width,a.width-(o[1].width+o[3].width+r+l),a.height-(o[0].width+o[2].width+i+c))}function v(l,c,d,s){var h=function(t,e,n){return{x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}};return{start:l,startControl:c,endControl:d,end:s,subdivide:function(t){var e=h(l,c,t),n=h(c,d,t),a=h(d,s,t),o=h(e,n,t),r=h(n,a,t),i=h(o,r,t);return[v(l,e,o,i),v(i,r,a,s)]},curveTo:function(t){t.push(["bezierCurve",c.x,c.y,d.x,d.y,s.x,s.y])},curveToReversed:function(t){t.push(["bezierCurve",d.x,d.y,c.x,c.y,l.x,l.y])}}}function N(t,e,n,a,o,r,i){0<e[0]||0<e[1]?(t.push(["line",a[0].start.x,a[0].start.y]),a[0].curveTo(t),a[1].curveTo(t)):t.push(["line",r,i]),(0<n[0]||0<n[1])&&t.push(["line",o[0].start.x,o[0].start.y])}function B(t,e,n,a,o,r,i){var l=[];return 0<e[0]||0<e[1]?(l.push(["line",a[1].start.x,a[1].start.y]),a[1].curveTo(l)):l.push(["line",t.c1[0],t.c1[1]]),0<n[0]||0<n[1]?(l.push(["line",r[0].start.x,r[0].start.y]),r[0].curveTo(l),l.push(["line",i[0].end.x,i[0].end.y]),i[0].curveToReversed(l)):(l.push(["line",t.c2[0],t.c2[1]]),l.push(["line",t.c3[0],t.c3[1]])),0<e[0]||0<e[1]?(l.push(["line",o[1].end.x,o[1].end.y]),o[1].curveToReversed(l)):l.push(["line",t.c4[0],t.c4[1]]),l}function M(t,e,n){var a,o,r,i,l,c,d,s,h,u,m,g,p,f,w,v,y,b,x,C,A,S,R,E,M,k,T=e.left,I=e.top,L=e.width,U=e.height,_=(k=t,["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){return F(k,"border"+t+"Radius")})),z=(s=_,h=n,u=(d=e).left,m=d.top,g=d.width,p=d.height,f=s[0][0],w=s[0][1],v=s[1][0],y=s[1][1],b=s[2][0],x=s[2][1],C=s[3][0],A=s[3][1],S=g-v,R=p-b,E=g-x,M=p-A,{topLeftOuter:W(u,m,f,w).topLeft.subdivide(.5),topLeftInner:W(u+h[3].width,m+h[0].width,Math.max(0,f-h[3].width),Math.max(0,w-h[0].width)).topLeft.subdivide(.5),topRightOuter:W(u+S,m,v,y).topRight.subdivide(.5),topRightInner:W(u+Math.min(S,g+h[3].width),m+h[0].width,S>g+h[3].width?0:v-h[3].width,y-h[0].width).topRight.subdivide(.5),bottomRightOuter:W(u+E,m+R,x,b).bottomRight.subdivide(.5),bottomRightInner:W(u+Math.min(E,g+h[3].width),m+Math.min(R,p+h[0].width),Math.max(0,x-h[1].width),Math.max(0,b-h[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:W(u,m+M,C,A).bottomLeft.subdivide(.5),bottomLeftInner:W(u+h[3].width,m+M,Math.max(0,C-h[3].width),Math.max(0,A-h[2].width)).bottomLeft.subdivide(.5)}),O={clip:function(t,e,n,a,o){var r=[];switch(F(t,"backgroundClip")){case"content-box":case"padding-box":N(r,a[0],a[1],e.topLeftInner,e.topRightInner,o.left+n[3].width,o.top+n[0].width),N(r,a[1],a[2],e.topRightInner,e.bottomRightInner,o.left+o.width-n[1].width,o.top+n[0].width),N(r,a[2],a[3],e.bottomRightInner,e.bottomLeftInner,o.left+o.width-n[1].width,o.top+o.height-n[2].width),N(r,a[3],a[0],e.bottomLeftInner,e.topLeftInner,o.left+n[3].width,o.top+o.height-n[2].width);break;default:N(r,a[0],a[1],e.topLeftOuter,e.topRightOuter,o.left,o.top),N(r,a[1],a[2],e.topRightOuter,e.bottomRightOuter,o.left+o.width,o.top),N(r,a[2],a[3],e.bottomRightOuter,e.bottomLeftOuter,o.left+o.width,o.top+o.height),N(r,a[3],a[0],e.bottomLeftOuter,e.topLeftOuter,o.left,o.top+o.height)}return r}(t,z,n,_,e),borders:[]};for(a=0;a<4;a++)if(0<n[a].width){switch(o=T,r=I,i=L,l=U-n[2].width,a){case 0:l=n[0].width,c=B({c1:[o,r],c2:[o+i,r],c3:[o+i-n[1].width,r+l],c4:[o+n[3].width,r+l]},_[0],_[1],z.topLeftOuter,z.topLeftInner,z.topRightOuter,z.topRightInner);break;case 1:c=B({c1:[(o=T+L-n[1].width)+(i=n[1].width),r],c2:[o+i,r+l+n[2].width],c3:[o,r+l],c4:[o,r+n[0].width]},_[1],_[2],z.topRightOuter,z.topRightInner,z.bottomRightOuter,z.bottomRightInner);break;case 2:c=B({c1:[o+i,(r=r+U-n[2].width)+(l=n[2].width)],c2:[o,r+l],c3:[o+n[3].width,r],c4:[o+i-n[2].width,r]},_[2],_[3],z.bottomRightOuter,z.bottomRightInner,z.bottomLeftOuter,z.bottomLeftInner);break;case 3:i=n[3].width,c=B({c1:[o,r+l+n[2].width],c2:[o,r],c3:[o+i,r+n[0].width],c4:[o+i,r+l]},_[3],_[0],z.bottomLeftOuter,z.bottomLeftInner,z.topLeftOuter,z.topLeftInner)}O.borders.push({args:c,color:n[a].color})}return O}function k(t,e){var n=t.drawShape();return e.forEach(function(t,e){n[0===e?"moveTo":t[0]+"To"].apply(null,t.slice(1))}),n}function T(e,t,n){var a,o,r=y.createElement("valuewrap");["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(t){try{r.style[t]=F(e,t)}catch(t){h2clog("html2canvas: Parse: Exception caught in renderFormValue: "+t.message)}}),r.style.borderColor="black",r.style.borderStyle="solid",r.style.display="block",r.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(e.type)||"SELECT"===e.nodeName)&&(r.style.lineHeight=F(e,"height")),r.style.top=t.top+"px",r.style.left=t.left+"px",(a="SELECT"===e.nodeName?(e.options[e.selectedIndex]||0).text:e.value)||(a=e.placeholder),o=y.createTextNode(a),r.appendChild(o),x.appendChild(r),i(e,o,n),x.removeChild(r)}function d(t){t.drawImage.apply(t,Array.prototype.slice.call(arguments,1)),1}function I(t,e){var n=window.getComputedStyle(t,e);if(n&&n.content&&"none"!==n.content&&"-moz-alt-content"!==n.content){var a=n.content+"",o=a.substr(0,1);o===a.substr(a.length-1)&&o.match(/'|"/)&&(a=a.substr(1,a.length-2));var r="url"===a.substr(0,3),i=document.createElement(r?"img":"span");return i.className=O+"-before "+O+"-after",Object.keys(n).filter(l).forEach(function(t){i.style[t]=n[t]}),r?i.src=_html2canvas.Util.parseBackgroundImage(a)[0].args[0]:i.innerHTML=a,i}}function l(t){return isNaN(window.parseInt(t,10))}function s(t,e,n,a){var o=Math.round(a.left+n.left),r=Math.round(a.top+n.top);t.createPattern(e),t.translate(o,r),t.fill(),t.translate(-o,-r)}function c(t,e,n,a,o,r,i,l){var c=[];c.push(["line",Math.round(o),Math.round(r)]),c.push(["line",Math.round(o+i),Math.round(r)]),c.push(["line",Math.round(o+i),Math.round(l+r)]),c.push(["line",Math.round(o),Math.round(l+r)]),k(t,c),t.save(),t.clip(),s(t,e,n,a),t.restore()}function L(t,e,n,a,o){var r=_html2canvas.Util.BackgroundSize(t,e,a,o),i=_html2canvas.Util.BackgroundPosition(t,e,a,o,r),l=F(t,"backgroundRepeat").split(",").map(function(t){return t.trim()});switch(a=function(t,e){if(t.width===e.width&&t.height===e.height)return t;var n=y.createElement("canvas");return n.width=e.width,n.height=e.height,d(n.getContext("2d"),t,0,0,t.width,t.height,0,0,e.width,e.height),n}(a,r),l=l[o]||l[0]){case"repeat-x":c(n,a,i,e,e.left,e.top+i.top,99999,a.height);break;case"repeat-y":c(n,a,i,e,e.left+i.left,e.top,a.width,99999);break;case"no-repeat":c(n,a,i,e,e.left+i.left,e.top+i.top,a.width,a.height);break;default:s(n,a,i,{top:e.top,left:e.left,width:a.width,height:a.height})}}function U(t,e,n){var a,o,r,i,l,c,d,s,h=h2cRenderContext(e?n.width:g(),e?n.height:p()),u={ctx:h,zIndex:(c=F(t,"zIndex"),d=e?e.zIndex:null,d?"auto"!==c?(s=h2czContext(c),d.children.push(s),s):d:s=h2czContext(0)),opacity:(o=h,r=t,i=e,l=F(r,"opacity")*(i?i.opacity:1),o.setVariable("globalAlpha",l),l),cssPosition:F(t,"position"),borders:(a=t,["Top","Right","Bottom","Left"].map(function(t){return{width:f(a,"border"+t+"Width"),color:F(a,"border"+t+"Color")}})),clip:e&&e.clip?_html2canvas.Util.Extend({},e.clip):null};return!0===m.useOverflow&&!0===/(hidden|scroll|auto)/.test(F(t,"overflow"))&&!1===/(BODY)/i.test(t.nodeName)&&(u.clip=u.clip?R(u.clip,n):n),u.zIndex.children.push(u),u}function o(t,e,n){var a,o,r,i,l,c,d,s,h,u,m,g=_html2canvas.Util.Bounds(t),p=z.test(t.nodeName)?"#efefef":F(t,"backgroundColor"),f=U(t,e,g),w=f.borders,v=f.ctx,y=(o=w,r=g,i=f.clip,l={left:r.left+o[3].width,top:r.top+o[0].width,width:r.width-(o[1].width+o[3].width),height:r.height-(o[0].width+o[2].width)},i&&(l=R(l,i)),l),b=M(t,g,w);switch(k(v,b.clip),v.save(),v.clip(),0<y.height&&0<y.width&&(d=p,C(v,(c=g).left,c.top,c.width,c.height,d),function(t,e,n){for(var a,o=F(t,"backgroundImage"),r=_html2canvas.Util.parseBackgroundImage(o),i=r.length;i--;)(o=r[i]).args&&0!==o.args.length&&((a=S("url"===o.method?o.args[0]:o.value))?L(t,e,n,a,i):h2clog("html2canvas: Error loading background:",o))}(t,y,v)),v.restore(),b.borders.forEach(function(t){var e,n,a;e=v,n=t.args,"transparent"!==(a=t.color)&&(e.setVariable("fillStyle",a),k(e,n),e.fill(),1)}),n||(h=f,u=I(s=t,":before"),m=I(s,":after"),(u||m)&&(u&&(s.className+=" "+O+"-before",s.parentNode.insertBefore(u,s),_(u,h,!0),s.parentNode.removeChild(u),s.className=s.className.replace(O+"-before","").trim()),m&&(s.className+=" "+O+"-after",s.appendChild(m),_(m,h,!0),s.removeChild(m),s.className=s.className.replace(O+"-after","").trim()))),t.nodeName){case"IMG":(a=S(t.getAttribute("src")))?E(v,t,a,g,w):h2clog("html2canvas: Error loading <img>:"+t.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&0<(t.value||t.placeholder).length&&T(t,g,f);break;case"TEXTAREA":0<(t.value||t.placeholder||"").length&&T(t,g,f);break;case"SELECT":0<(t.options||t.placeholder||"").length&&T(t,g,f);break;case"LI":A(t,f,y);break;case"VIDEO":var x=document.createElement("canvas");x.width=t.videoWidth||t.clientWidth||320,x.height=t.videoHeight||t.clientHeight||240,x.getContext("2d").drawImage(t,0,0,x.width,x.height),E(v,x,x,g,w);break;case"CANVAS":E(v,t,t,g,w)}return f}function _(e,n,a){var t;"none"===F(t=e,"display")||"hidden"===F(t,"visibility")||t.hasAttribute("data-html2canvas-ignore")||(n=o(e,n,a)||n,z.test(e.nodeName)||("IFRAME"==e.tagName&&(e=e.contentDocument),_html2canvas.Util.Children(e).forEach(function(t){1===t.nodeType?_(t,n,a):3===t.nodeType&&i(e,t,n)})))}var t=void 0===m.elements?document.body:m.elements[0],y=t.ownerDocument,b=_html2canvas.Util.Support(m,y),z=new RegExp("("+m.ignoreElements+")"),x=y.body,F=_html2canvas.Util.getCSS,O="___html2canvas___pseudoelement",e=y.createElement("style");e.innerHTML="."+O+'-before:before { content: "" !important; display: none !important; }.'+O+'-after:after { content: "" !important; display: none !important; }',x.appendChild(e),n=n||{};var P,a,r,V,G,Y,D,q,W=(P=(Math.sqrt(2)-1)/3*4,function(t,e,n,a){var o=n*P,r=a*P,i=t+n,l=e+a;return{topLeft:v({x:t,y:l},{x:t,y:l-r},{x:i-o,y:e},{x:i,y:e}),topRight:v({x:t,y:e},{x:t+o,y:e},{x:i,y:l-r},{x:i,y:l}),bottomRight:v({x:i,y:e},{x:i,y:e+r},{x:t+o,y:l},{x:t,y:l}),bottomLeft:v({x:i,y:l},{x:i-o,y:l},{x:t,y:e+r},{x:t,y:e})}});return q=o(t,null),b.svgRendering&&(a=document.documentElement,r=q,V=new Image,G=g(),Y=p(),D="",function t(e){var n,a,o,r,i,l=_html2canvas.Util.Children(e),c=l.length;for(i=0;i<c;i+=1)if(3===(r=l[i]).nodeType)D+=r.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");else if(1===r.nodeType&&!/^(script|meta|title)$/.test(r.nodeName.toLowerCase())){if(D+="<"+r.nodeName.toLowerCase(),r.hasAttributes())for(o=(n=r.attributes).length,a=0;a<o;a+=1)D+=" "+n[a].name+'="'+n[a].value+'"';D+=">",t(r),D+="</"+r.nodeName.toLowerCase()+">"}}(a),V.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+G+"' height='"+Y+"'>","<foreignObject width='"+G+"' height='"+Y+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",D.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join(""),V.onload=function(){r.svgRender=V}),Array.prototype.slice.call(t.children,0).forEach(function(t){_(t,q)}),q.backgroundColor=F(document.documentElement,"backgroundColor"),x.removeChild(e),q},_html2canvas.Preload=function(i){function l(){h2clog("html2canvas: start: images: "+u.numLoaded+" / "+u.numTotal+" (failed: "+u.numFailed+")"),!u.firstRun&&u.numLoaded>=u.numTotal&&(h2clog("Finished loading images: # "+u.numTotal+" (failed: "+u.numFailed+")"),"function"==typeof i.complete&&i.complete(u))}function o(t,e,n){var a,o,r=i.proxy;w.href=t,t=w.href,a="html2canvas_"+m++,n.callbackname=a,-1<r.indexOf("?")?r+="&":r+="?",r+="url="+encodeURIComponent(t)+"&callback="+a,o=g.createElement("script"),window[a]=function(t){"error:"===t.substring(0,6)?(n.succeeded=!1,u.numLoaded++,u.numFailed++,l()):(d(e,n),e.src=t),window[a]=void 0;try{delete window[a]}catch(t){}o.parentNode.removeChild(o),o=null,delete n.script,delete n.callbackname},o.setAttribute("type","text/javascript"),o.setAttribute("src",r),n.script=o,window.document.body.appendChild(o)}function r(t,e){var n=window.getComputedStyle(t,e),a=n.content;"url"===a.substr(0,3)&&h.loadImage(_html2canvas.Util.parseBackgroundImage(a)[0].args[0]),c(n.backgroundImage,t)}function e(t){return t&&t.method&&t.args&&0<t.args.length}function c(t,o){var r;_html2canvas.Util.parseBackgroundImage(t).filter(e).forEach(function(t){var e,n,a;"url"===t.method?h.loadImage(t.args[0]):t.method.match(/\-?gradient$/)&&(void 0===r&&(r=_html2canvas.Util.Bounds(o)),e=t.value,n=r,void 0!==(a=_html2canvas.Generate.Gradient(e,n))&&(u[e]={img:a,succeeded:!0},u.numTotal++,u.numLoaded++,l()))})}function d(e,n){e.onload=function(){void 0!==n.timer&&window.clearTimeout(n.timer),u.numLoaded++,n.succeeded=!0,e.onerror=e.onload=null,l()},e.onerror=function(){if("anonymous"===e.crossOrigin&&(window.clearTimeout(n.timer),i.proxy)){var t=e.src;return e=new Image,(n.img=e).src=t,void o(e.src,e,n)}u.numLoaded++,u.numFailed++,n.succeeded=!1,e.onerror=e.onload=null,l()}}var s,h,t,n,u={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},m=0,a=i.elements[0]||document.body,g=a.ownerDocument,p=g.images,f=p.length,w=g.createElement("a"),v=void 0!==(new Image).crossOrigin;for(w.href=window.location.href,s=w.protocol+w.host,h={loadImage:function(t){var e,n,a;t&&void 0===u[t]&&(e=new Image,t.match(/data:image\/.*;base64,/i)?(e.src=t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),n=u[t]={img:e},u.numTotal++,d(e,n)):(a=t,w.href=a,w.href=w.href,w.protocol+w.host===s||!0===i.allowTaint?(n=u[t]={img:e},u.numTotal++,d(e,n),e.src=t):v&&!i.allowTaint&&i.useCORS?(e.crossOrigin="anonymous",n=u[t]={img:e},u.numTotal++,d(e,n),e.src=t,e.customComplete=function(){this.img.complete?this.img.onerror():this.timer=window.setTimeout(this.img.customComplete,100)}.bind(n),e.customComplete()):i.proxy&&(n=u[t]={img:e},u.numTotal++,o(t,e,n))))},cleanupDOM:function(t){var e,n;if(!u.cleanupDone){for(n in h2clog(t&&"string"==typeof t?"html2canvas: Cleanup because: "+t:"html2canvas: Cleanup after timeout: "+i.timeout+" ms."),u)if(u.hasOwnProperty(n)&&"object"===(void 0===(e=u[n])?"undefined":_typeof(e))&&e.callbackname&&void 0===e.succeeded){window[e.callbackname]=void 0;try{delete window[e.callbackname]}catch(t){}e.script&&e.script.parentNode&&(e.script.setAttribute("src","about:blank"),e.script.parentNode.removeChild(e.script)),u.numLoaded++,u.numFailed++,h2clog("html2canvas: Cleaned up failed img: '"+n+"' Steps: "+u.numLoaded+" / "+u.numTotal)}void 0!==window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),void 0!==document.close&&document.close(),u.cleanupDone=!0,t&&"string"==typeof t||l()}},renderingDone:function(){n&&window.clearTimeout(n)}},0<i.timeout&&(n=window.setTimeout(h.cleanupDOM,i.timeout)),h2clog("html2canvas: Preload starts: finding background-images"),u.firstRun=!0,function e(t){var n,a=!1;try{_html2canvas.Util.Children(t).forEach(function(t){e(t)})}catch(t){}try{a=t.nodeType}catch(t){a=!1,h2clog("html2canvas: failed to access some element's nodeType - Exception: "+t.message)}if(1===a||void 0===a){r(n=t,":before"),r(n,":after");try{c(_html2canvas.Util.getCSS(t,"backgroundImage"),t)}catch(t){h2clog("html2canvas: failed to get background-image - Exception: "+t.message)}c(t)}}(a),h2clog("html2canvas: Preload: Finding images"),t=0;t<f;t+=1)h.loadImage(p[t].getAttribute("src"));return u.firstRun=!1,h2clog("html2canvas: Preload: Done."),u.numTotal===u.numLoaded&&l(),h},_html2canvas.Renderer=function(t,n){return function(t){var e;if("string"==typeof n.renderer&&void 0!==_html2canvas.Renderer[t])e=_html2canvas.Renderer[t](n);else{if("function"!=typeof t)throw new Error("Unknown renderer");e=t(n)}if("function"!=typeof e)throw new Error("Invalid renderer defined");return e}(n.renderer)(t,n,document,(a=[],function t(e){var o=[],n=[];e.children.forEach(function(t){t.children&&0<t.children.length?(o.push(t),n.push(t.zindex)):a.push(t)}),n.sort(function(t,e){return t-e}),n.forEach(function(n){var a;o.some(function(t,e){return a=e,t.zindex===n}),t(o.splice(a,1)[0])})}(t.zIndex),a),_html2canvas);var a},_html2canvas.Util.Support=function(t,a){return{rangeBounds:(o=!1,a.createRange&&(e=a.createRange()).getBoundingClientRect&&((n=a.createElement("boundtest")).style.height="123px",n.style.display="block",a.body.appendChild(n),e.selectNode(n),123===e.getBoundingClientRect().height&&(o=!0),a.body.removeChild(n)),o),svgRendering:t.svgRendering&&function(){var t=new Image,e=a.createElement("canvas"),n=void 0!==e.getContext&&e.getContext("2d");if(!1===n)return!1;e.width=e.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{n.drawImage(t,0,0),e.toDataURL()}catch(t){return!1}return h2clog("html2canvas: Parse: SVG powered rendering available"),!0}()};var e,n,o},window.html2canvas=function(t,e){var n,a,o={logging:!1,elements:t=t.length?t:[t],background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"};return o=_html2canvas.Util.Extend(e,o),_html2canvas.logging=o.logging,o.complete=function(t){if(!("function"==typeof o.onpreloaded&&!1===o.onpreloaded(t)||(n=_html2canvas.Parse(t,o),"function"==typeof o.onparsed&&!1===o.onparsed(n)||(a=_html2canvas.Renderer(n,o),"function"!=typeof o.onrendered))))if(void 0===o.grabMouse||o.grabMouse){var e=new Image(25,25);e.onload=function(){a.getContext("2d").drawImage(e,coordX,coordY,25,25),o.onrendered(a)},e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAzZJREFUSEut1EtME1EUANBiTTFaivRDKbaFFgiILgxx0bQllYItYKFIgEYoC2oEwqeCC4gG1xg2dmEwEQMJujIxwQ24wA2uCFAB3SBBfqWuyqd/CuV634QSPgOFxElu+mZye+a++948BgAw/mccYAwGIyY7O1vR3NzSiuMLX5GiDoO8tLQ0QzAYDLW1tT2/qEgHJslk8rKtLU9odzcMTU3N7RdB6UBhRkZG6fz8QrCuzgJutwfq6xtazovSgunp6SUOhzPI5XJBr9fD9nYojHjDeVA6MJH0EMGARCIBRKC8vJygO2ZzrSUaSgumpqY+cDjWAlJpCgWSMJlMiO6EqqpMtWehtKBUKi1eXV3zI3wAEhQrJJUGseJHp6G0IE61CKfsl8lkR0CCWiyPAXeU32AwVNChdKAAwUIEfXK5/ARI0IaGRkS3vXp9ofE4SguKxWL92tpfH642LUjQ1lYr+P0Bt1abX3wYPQv04n48FSRoe/sz8Pn8G7m5uboISgfyk5OT72OF3szMzBMgk8k88qyjowPW1zddCoVCS1BaUCQSEdCTlZV18GcOh0ONq6trYGbmJ0xMTO3Z7dMwPj4B4XAYXC7XhkqlKqAFBQJBAS6KB08dClEqlTA8/JUak5cEAkHo6nppMxqN7ZWVVZ0GQ0lnRUXlC6VSVXoamI+gm/RQKEyChYU/u5gYUqvVFDo09AVsNttrHMdh3MAQYyRhxNIeX3y+QLu0tLKlVufC5OQU9Pa+/TgwMPCpv7+fAouKigG/pFX81qV4H4PBwrh8Wg95eOUtLi5vLi+v4FSHRzExRafTNZJ7NptNobOzs2C1Wp+eZx/yEhIS8jwer99ut//icOJvk+mwWCzF3NzvebPZTIF4+ILd/mMcx1ei7UOeUCjUjY19n8YvRYPJVzG4GGk9PT3vRkZGKJDH44PT6STTfxgNjGez4+4idg8Tr+8nx+KvNCcnx4y926mpMUNf33vY2wPo7n71JhpImszer4x5KFmE4zujo98m3W6ve3Dww2eNRvMEW3GLrG4kj26Vj/c5ch+Pg5t4ApXhopFWSDASMcjzg+siIKmWVJm839Nr+Hvp+Nsj4D+5Hdf43ZzjNQAAAABJRU5ErkJggg=="}else o.onrendered(a)},window.setTimeout(function(){_html2canvas.Preload(o)},0),{render:function(t,e){return _html2canvas.Renderer(t,_html2canvas.Util.Extend(e,o))},parse:function(t,e){return _html2canvas.Parse(t,_html2canvas.Util.Extend(e,o))},preload:function(t){return _html2canvas.Preload(_html2canvas.Util.Extend(t,o))},log:h2clog}},window.html2canvas.log=h2clog,window.html2canvas.Renderer={Canvas:void 0},_html2canvas.Renderer.Canvas=function(o){function m(t,e){switch(e.type){case"variable":t[e.name]=e.arguments;break;case"function":if("createPattern"===e.name){if(0<e.arguments[0].width&&0<e.arguments[0].height)try{t.fillStyle=t.createPattern(e.arguments[0],"repeat")}catch(t){h2clog("html2canvas: Renderer: Error creating pattern",t.message)}}else"drawShape"===e.name?(n=t,a=e.arguments,n.beginPath(),a.forEach(function(t){n[t.name].apply(n,t.arguments)}),n.closePath()):"drawImage"===e.name?0<e.arguments[8]&&0<e.arguments[7]&&(!o.taintTest||o.taintTest&&function(t){if(-1===i.indexOf(t.arguments[0].src)){c.drawImage(t.arguments[0],0,0);try{c.getImageData(0,0,1,1)}catch(t){return l=r.createElement("canvas"),c=l.getContext("2d"),!1}i.push(t.arguments[0].src)}return!0}(e))&&t.drawImage.apply(t,e.arguments):t[e.name].apply(t,e.arguments)}var n,a}o=o||{};var r=document,i=[],l=document.createElement("canvas"),c=l.getContext("2d"),g=o.canvas||r.createElement("canvas");return function(t,e,n,a,o){var r,i,l,c,d,s,h,u=g.getContext("2d");if(g.width=g.style.width=e.width||t.ctx.width,g.height=g.style.height=e.height||t.ctx.height,s=u.fillStyle,u.fillStyle="transparent"!==(h=t.backgroundColor)&&"rgba(0, 0, 0, 0)"!==h||void 0===e.background?t.backgroundColor:e.background,u.fillRect(0,0,g.width,g.height),u.fillStyle=s,e.svgRendering&&void 0!==t.svgRender)u.drawImage(t.svgRender,0,0);else for(i=0,l=a.length;i<l;i+=1)(r=a.splice(0,1)[0]).canvasPosition=r.canvasPosition||{},u.textBaseline="bottom",r.clip&&(u.save(),u.beginPath(),u.rect(r.clip.left,r.clip.top,r.clip.width,r.clip.height),u.clip()),r.ctx.storage&&r.ctx.storage.forEach(m.bind(null,u)),r.clip&&u.restore();return h2clog("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===(l=e.elements.length)&&"object"===_typeof(e.elements[0])&&"BODY"!==e.elements[0].nodeName?(d=o.Util.Bounds(e.elements[0]),(c=n.createElement("canvas")).width=d.width,c.height=d.height,(u=c.getContext("2d")).drawImage(g,d.left,d.top,d.width,d.height,0,0,d.width,d.height),g=null,c):g}},function(){for(var r=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"RequestCancelAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=(new Date).getTime(),a=Math.max(0,16-(n-r)),o=window.setTimeout(function(){t(n+a)},a);return r=n+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var IE=!!document.all;IE||document.captureEvents(Event.MOUSEMOVE),document.addEventListener("mousemove",getMouseXY,!1);var coordX=0,coordY=0;
"";function createSnapshotButton(t,e){var n=document.createElement("div");return n.id=t+"snapshotButton",n.setAttribute("title","Snapshot"),n.setAttribute("data-placement","bottom"),n.setAttribute("data-toggle","tooltip"),n.setAttribute("data-container","body"),n.className=snapshotobj.button.class_on,n.innerHTML=snapshotobj.button.html_on,n.onclick=function(){takeSnapshot(e,function(t){var e,n="snapshot"+(new Date).getTime();(e=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid)).filearray.push(n),document.createElement("div").value=e.filearray.length,fileshareobj.active&&(syncSnapshot(t,"imagesnapshot",n),displayList(e.uuid,e,t,n,"imagesnapshot")),displayFile(e.uuid,e,t,n,"imagesnapshot")})},n}function takeSnapshot(t,n){try{return t.videoContainer?function(t){if(t){var e=document.createElement("canvas");e.width=t.videoWidth||t.clientWidth,e.height=t.videoHeight||t.clientHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height),n(e.toDataURL("image/png"))}else n("")}(document.getElementById(t.videoContainer)):"empty"}catch(t){webrtcdev.error(" [Snapshot - take snapshot] ",t)}}function syncSnapshot(t,e,n){rtcConn.send({type:e,message:t,name:n})}
"";function showPosition(o){webrtcdev.log("Latitude: "+o.coords.latitude+"<br>Longitude: "+o.coords.longitude),latitude=o.coords.latitude,longitude=o.coords.longitude}function showError(o){switch(o.code){case o.PERMISSION_DENIED:shownotification("User denied the request for Geolocation.");break;case o.POSITION_UNAVAILABLE:shownotification("Location information is unavailable.");break;case o.TIMEOUT:shownotification("The request to get user location timed out.");break;case o.UNKNOWN_ERROR:shownotification("An unknown error occurred.")}}navigator.geolocation?(operatingsystem=navigator.platform,navigator.geolocation.getCurrentPosition(showPosition,showError)):x.innerHTML="Geolocation is not supported by this browser.";
"";function createChatButton(e){var t=document.createElement("span");t.className=chatobj.button.class_on,t.innerHTML=chatobj.button.html_on,t.onclick=function(){t.className==chatobj.button.class_off?(document.getElementById(chatobj.container.id).hidden=!0,t.className=chatobj.button.class_on,t.innerHTML=chatobj.button.html_on):t.className==chatobj.button.class_on&&(document.getElementById(chatobj.container.id).hidden=!1,t.className=chatobj.button.class_off,t.innerHTML=chatobj.button.html_off)};var n=document.createElement("li");n.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(n)}function createChatBox(e){var t=document.createElement("div"),n=document.createElement("input");n.setAttribute("type","text"),n.className="form-control chatInputClass",n.id="chatInput",n.onkeypress=function(e){13==e.keyCode&&(sendChatMessage(n.value),n.value="")};var a=document.createElement("span");a.className="btn btn-primary",a.innerHTML="Enter",a.onclick=function(){var e=document.getElementById("chatInput");sendChatMessage(e.value),e.value=""};var o=document.createElement("div");o.className="whoTypingClass",o.id="whoTyping",t.appendChild(n),t.appendChild(a),t.appendChild(o),document.getElementById(chatobj.container.id).appendChild(t);var c=document.createElement("div");c.className="chatMessagesClass",c.setAttribute("contenteditable",!0),c.id=chatobj.chatBox.id,document.getElementById(chatobj.container.id).appendChild(c)}function assignChatBox(e){var n=document.getElementById(chatobj.inputBox.text_id);(n.onkeypress=function(e){if(13==e.keyCode){var t=findPeerInfo(selfuserid);webrtcdev.log(" chat ",selfuserid,t),sendChatMessage(n.value,t),n.value=""}},document.getElementById(chatobj.inputBox.sendbutton_id))&&(document.getElementById(chatobj.inputBox.sendbutton_id).onclick=function(e){var t=findPeerInfo(selfuserid),n=document.getElementById(chatobj.inputBox.text_id);sendChatMessage(n.value,t),n.value=""});document.getElementById(chatobj.inputBox.minbutton_id)&&(document.getElementById(chatobj.inputBox.minbutton_id).onclick=function(e){document.getElementById(chatobj.container.id).hidden?document.getElementById(chatobj.container.id).hidden=!1:document.getElementById(chatobj.container.id).hidden=!0})}function updateWhotyping(e){document.getElementById("whoTyping").innerHTML=e}function sendChatMessage(e,t){addNewMessagelocal({header:rtcConn.extra.username,message:e,userinfo:t,color:rtcConn.extra.color}),rtcConn.send({type:"chat",userinfo:t,message:e})}function replaceURLWithHTMLLinks(e){return e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1'>$1</a>")}function addNewMessagelocal(e){""!=e.message&&" "!=e.message&&addMessageSnapshotFormat("user-activity user-activity-right localMessageClass",e.userinfo,e.message,chatobj.chatBox.id)}function addNewMessage(e){""!=e.message&&" "!=e.message&&addMessageSnapshotFormat("user-activity user-activity-right remoteMessageClass",e.userinfo,e.message,chatobj.chatBox.id)}function addMessageSnapshotFormat(e,t,a,n){var o=document.createElement("div");o.className=e,webrtcdev.log("addNewMessagelocal",t),takeSnapshot(t,function(e){var t=document.createElement("img");t.src=e,t.style.height="40px";var n=document.createElement("span");n.innerHTML=replaceURLWithHTMLLinks(a),o.appendChild(t),o.appendChild(n)}),document.getElementById(n).insertBefore(o,document.getElementById(n).firstChild)}function addMessageLineformat(e,t,n,a){var o=document.createElement("div");o.className=e,o.innerHTML=t?t+" : "+replaceURLWithHTMLLinks(n):replaceURLWithHTMLLinks(n),document.getElementById(a).insertBefore(o,document.getElementById(a).firstChild)}function addMessageBlockFormat(e,t,n,a,o){var c=document.createElement("div");c.className=e,c.innerHTML='<div class="chatusername">'+t+"</div>";var s=document.createElement("div");s.className=n,s.innerHTML=a,c.appendChild(s),$("#"+o).append(s)}$("#chatbox").css("max-height",$("#leftVideo").height()+80),$("#chatBoard").css("max-height",$("#leftVideo").height()),$("#chatBoard").css("overflow-y","scroll");
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function appendVideo(o,n){createVideoContainer(o,n,function(t){var e=document.createElement("video");e.className=n,e.setAttribute("style","height:auto;opacity:1;"),e.controls=!1,e.id=o.userid,e.src=URL.createObjectURL(o.stream),viden.hidden=!1;document.getElementById("remote");t.appendChild(e),e.play()})}function createVideoContainer(t,e,o){var n=document.createElement("div");n.setAttribute("style",e||"float:left;opacity: 1;width: 32%;"),remote.insertBefore(n,remote.firstChild),o&&o(n)}function attachUserDetails(t,e){var o=document.createElement("div");o.setAttribute("style","background-color:"+e.color),o.className="videoHeaderClass",o.innerHTML=e.name+"<br/>",t.parentNode.insertBefore(o,t.parentNode.firstChild)}function attachMetaUserDetails(t,e){webrtcdev.log(e.userid+":"+e.type);var o=document.createElement("span");o.setAttribute("style","background-color:"+e.color),o.innerHTML=e.userid+":"+e.type+"<br/>",t.parentNode.insertBefore(o,t.parentNode.firstChild)}function attachControlButtons(t,e){var o=e.stream,n=e.streamid,a=e.controlBarName,r=(e.fileSharingContainer,t.parentNode.childNodes);for(i=0;i<r.length;i++)webrtcdev.log("ChildNode of video Parent ",r[i]),"DIV"==r[i].nodeName&&null!=r[i].id&&-1<r[i].id.indexOf("control")&&(webrtcdev.log("control bar exists already  , delete the previous one before adding new one"),t.parentNode.removeChild(r[i]));var c=document.createElement("div");if(c.id=a,"local"==e.type?c.className="localVideoControlBarClass":c.className="remoteVideoControlBarClass",muteobj.active&&(muteobj.audio.active&&c.appendChild(createAudioMuteButton(a,e)),muteobj.video.active&&c.appendChild(createVideoMuteButton(a,e))),snapshotobj.active&&c.appendChild(createSnapshotButton(a,e)),videoRecordobj.active&&c.appendChild(createRecordButton(a,e,n,o)),cursorobj.active&&c.appendChild(createCursorButton(a,e)),minmaxobj.active&&(c.appendChild(createFullScreenButton(a,e,n,o)),c.appendChild(createMinimizeVideoButton(a,e,n,o))),debug){var m=document.createElement("span");m.innerHTML=t.id,c.appendChild(m)}t.parentNode.appendChild(c)}function createFullScreenButton(t,e,o,n){var a=document.createElement("span");return a.id=t+"fullscreeButton",a.className=minmaxobj.max.button.class_off,a.innerHTML=minmaxobj.max.button.html_off,a.onclick=function(){a.className==minmaxobj.max.button.class_off?(document.getElementById(e.videoContainer).webkitRequestFullScreen(),a.className=minmaxobj.max.button.class_on,a.innerHTML=minmaxobj.max.button.html_on):(a.className=minmaxobj.max.button.class_off,a.innerHTML=minmaxobj.max.button.html_off)},a}function createMinimizeVideoButton(t,e,o,n){var a=document.createElement("span");a.id=t+"minmizevideoButton",a.className=minmaxobj.min.button.class_off,a.innerHTML=minmaxobj.min.button.html_off;var i=document.getElementById(e.videoContainer);return a.onclick=function(){a.className==minmaxobj.min.button.class_off?(i.hidden=!0,a.className=minmaxobj.min.button.class_on,a.innerHTML=minmaxobj.min.button.html_on):(i.hidden=!1,a.className=minmaxobj.min.button.class_off,a.innerHTML=minmaxobj.min.button.html_off)},a}function createAudioMuteButton(t,e){var o=document.createElement("span");return o.id=t+"audioButton",o.setAttribute("data-val","mute"),o.setAttribute("title","Toggle Audio"),o.setAttribute("data-placement","bottom"),o.setAttribute("data-toggle","tooltip"),o.setAttribute("data-container","body"),o.className=muteobj.audio.button.class_on,o.innerHTML=muteobj.audio.button.html_on,o.onclick=function(){o.className==muteobj.audio.button.class_on?(e.stream.mute({audio:!0}),o.className=muteobj.audio.button.class_off,o.innerHTML=muteobj.audio.button.html_off):(e.stream.unmute({audio:!0}),o.className=muteobj.audio.button.class_on,o.innerHTML=muteobj.audio.button.html_on),syncButton(o.id)},o}function createVideoMuteButton(t,e){var o=document.createElement("span");return o.id=t+"videoButton",o.setAttribute("title","Toggle Video"),o.setAttribute("data-container","body"),o.className=muteobj.video.button.class_on,o.innerHTML=muteobj.video.button.html_on,o.onclick=function(t){o.className==muteobj.video.button.class_on?(e.stream.mute({video:!0}),o.innerHTML=muteobj.video.button.html_off,o.className=muteobj.video.button.class_off):(e.stream.unmute({video:!0}),o.innerHTML=muteobj.video.button.html_on,o.className=muteobj.video.button.class_on),syncButton(o.id)},o}function waitForRemoteVideo(t,e,o,n){0===t.getVideoTracks().length||0<e.currentTime?transitionToActive(e,o,n):setTimeout(function(){waitForRemoteVideo(t,e,o,n)},100)}function transitionToActive(t,e,o){t.style.opacity=1,null!=localVideo&&setTimeout(function(){e.src=""},500),null!=miniVideo&&setTimeout(function(){o.style.opacity=1},1e3)}function transitionToWaiting(){card.style.webkitTransform="rotateY(0deg)",setTimeout(function(){localVideo.src=miniVideo.src,localVideo.muted=!0,miniVideo.src="",remoteVideo.src="",localVideo.style.opacity=1},500),miniVideo.style.opacity=0,remoteVideo.style.opacity=0}function attachMediaStream(t,e){try{webrtcdev.log("[ Mediacontrol - attachMediaStream ] element.src",_typeof(t.src),_typeof(t.srcObject)," || stream "+e),e?("string"==typeof t.src?t.src=URL.createObjectURL(e):"object"==_typeof(t.srcObject)?t.srcObject=e:webrtcdev.log("Error attaching stream to element.",t,e),webrtcdev.log(" Media Stream attached to ",t," succesfully")):webrtcdev.debug(" Media Stream not attached to ",t," as stream is not valid ",e)}catch(t){webrtcdev.error(" [ Mediacontrol - attachMediaStream ]  error",t)}}function reattachMediaStream(t,e){t.src=e.src}
"";function createRecordButton(e,o,r,t){var d=document.createElement("div");return d.id=e+"recordButton",d.setAttribute("title","Record"),d.setAttribute("data-placement","bottom"),d.setAttribute("data-toggle","tooltip"),d.setAttribute("data-container","body"),d.className=videoRecordobj.button.class_off,d.innerHTML=videoRecordobj.button.html_off,d.onclick=function(e){d.className==videoRecordobj.button.class_on?(d.className=videoRecordobj.button.class_off,d.innerHTML=videoRecordobj.button.html_off,stopRecord(o,r,t)):d.className==videoRecordobj.button.class_off&&(d.className=videoRecordobj.button.class_on,d.innerHTML=videoRecordobj.button.html_on,startRecord(o,r,t))},d}var listOfRecorders={};function startRecord(e,o,r){var t=RecordRTC(r,{type:"video",recorderType:MediaStreamRecorder});t.startRecording(),listOfRecorders[o]=t}function stopRecord(t,e,o){listOfRecorders[e]||webrtcdev.log("wrong stream id ");var d=listOfRecorders[e];d.stopRecording(function(){var e=d.getBlob();t||(t=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid));var o="recordedvideo"+(new Date).getTime();t.filearray.push(o),document.createElement("div").value=t.filearray.length;var r=URL.createObjectURL(e);displayList(t.uuid,t,r,o,"videoRecording"),displayFile(t.uuid,t,r,o,"videoRecording")})}function stopSessionRecord(e,o,r,t,d){listOfRecorders[o]||webrtcdev.log("wrong stream id scrrecordStreamid"),listOfRecorders[t]||webrtcdev.log("wrong stream id scrrecordAudioStreamid");var c=listOfRecorders[o];c.stopRecording(function(){var e=c.getBlob();webrtcdev.log(" scrrecordStreamid stopped recoridng blob is ",e)});var i=listOfRecorders[t];i.stopRecording(function(){var e=i.getBlob();webrtcdev.log(" scrrecordStreamid stopped recoridng blob is ",e)})}
"";var scrrecordStream=null,scrrecordStreamid=null,scrrecordAudioStream=null,scrrecordAudioStreamid=null;function syncVideoScreenRecording(e,r,o){rtcMultiConnection.send({type:r,message:e,name:o})}function autorecordScreenVideo(){}function assignScreenRecordButton(){var a=document.getElementById(screenrecordobj.button.id);a.onclick=function(){if(a.className==screenrecordobj.button.class_off)a.className=screenrecordobj.button.class_on,a.innerHTML=screenrecordobj.button.html_on,webrtcdevRecordScreen();else if(a.className==screenrecordobj.button.class_on){var e,r,o;e=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid),a.className=screenrecordobj.button.class_off,a.innerHTML=screenrecordobj.button.html_off,webrtcdevStopRecordScreen(),stopRecord(e,scrrecordStreamid,scrrecordStream,scrrecordAudioStreamid,scrrecordAudioStream);var t=listOfRecorders[scrrecordStreamid];t.stopRecording(function(){r=t.getBlob()});var n=listOfRecorders[scrrecordAudioStreamid];n.stopRecording(function(){o=n.getBlob()}),setTimeout(function(){webrtcdev.log(" ===2 blobs====",r,o),mergeStreams(r,o),scrrecordAudioStream=scrrecordAudioStreamid=scrrecordStream=scrrecordStreamid=null},5e3)}}}function getSourceIdScreenrecord(e,r){if(!e)throw'"callback" parameter is mandatory.';window.postMessage("webrtcdev-extension-getsourceId-audio-plus-tab","*")}function onScreenrecordExtensionCallback(e){webrtcdev.log("onScreenrecordExtensionCallback",e),e.data.chromeExtensionStatus&&webrtcdev.log(e.data.chromeExtensionStatus),e.data.sourceId&&("PermissionDeniedError"===e.data.sourceId?webrtcdev.log("permission-denied"):webrtcdevScreenRecordConstraints(e.data.sourceId))}function webrtcdevScreenRecordConstraints(e){webrtcdev.log(" webrtcdevScreenRecordConstraints :"+e),navigator.getUserMedia({audio:!0,video:!1},function(e){var r;r=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid),scrrecordAudioStreamid=e.id,scrrecordAudioStream=e,startRecord(r,scrrecordAudioStreamid,scrrecordAudioStream)},function(e){webrtcdev.log(" Error in webrtcdevScreenRecordConstraints ",e),isChrome&&"http:"===location.protocol?alert("Please test this WebRTC experiment on HTTPS."):isChrome?alert("Screen capturing is either denied or not supported. Please install chrome extension for screen capturing or run chrome with command-line flag: --enable-usermedia-screen-capturing"):navigator.mozGetUserMedia&&alert(Firefox_Screen_Capturing_Warning)}),navigator.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920<window.screen.width?window.screen.width:1920,maxHeight:1080<window.screen.height?window.screen.height:1080},optional:[]}},function(e){var r;r=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid),scrrecordStreamid=e.id,scrrecordStream=e,startRecord(r,scrrecordStreamid,scrrecordStream)},function(e){webrtcdev.log(" Error in webrtcdevScreenRecordConstraints ",e),isChrome&&"http:"===location.protocol?alert("Please test this WebRTC experiment on HTTPS."):isChrome?alert("Screen capturing is either denied or not supported. Please install chrome extension for screen capturing or run chrome with command-line flag: --enable-usermedia-screen-capturing"):navigator.mozGetUserMedia&&alert(Firefox_Screen_Capturing_Warning)})}function webrtcdevRecordScreen(){webrtcdev.log("webrtcdevRecordScreen"),getSourceIdScreenrecord(function(){},!0)}function webrtcdevStopRecordScreen(){webrtcdev.log("webrtcdevStopRecordScreen screenRoomid"),window.postMessage("webrtcdev-extension-stopsource-screenrecord","*"),scrrecordStream?scrrecordStream.stop():alert(" screen video recoridng was not succesfull"),scrrecordAudioStream?scrrecordAudioStream.stop():alert(" screen audio recording was not successfull")}var worker,workerPath="https://archive.org/download/ffmpeg_asm/ffmpeg_asm.js";function processInWebWorker(){var e=URL.createObjectURL(new Blob(['importScripts("'+workerPath+'");var now = Date.now;function print(text) {postMessage({"type" : "stdout","data" : text});};onmessage = function(event) {var message = event.data;if (message.type === "command") {var Module = {print: print,printErr: print,files: message.files || [],arguments: message.arguments || [],TOTAL_MEMORY: message.TOTAL_MEMORY || false};postMessage({"type" : "start","data" : Module.arguments.join(" ")});postMessage({"type" : "stdout","data" : "Received command: " +Module.arguments.join(" ") +((Module.TOTAL_MEMORY) ? ".  Processing with " + Module.TOTAL_MEMORY + " bits." : "")});var time = now();var result = ffmpeg_run(Module);var totalTime = now() - time;postMessage({"type" : "stdout","data" : "Finished processing (took " + totalTime + "ms)"});postMessage({"type" : "done","data" : result,"time" : totalTime});}};postMessage({"type" : "ready"});'],{type:"application/javascript"})),r=new Worker(e);return URL.revokeObjectURL(e),r}var videoFile=navigator.mozGetUserMedia?"video.gif":"video.webm";function mergeStreams(e,r){var o;o=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid);var t="recordedvideo"+(new Date).getTime();o.filearray.push(t),document.createElement("div").value=o.filearray.length;var n=URL.createObjectURL(e),a="recordedaudio"+(new Date).getTime();o.filearray.push(a),document.createElement("div").value=o.filearray.length;var d={videofileurl:n,audiofileurl:URL.createObjectURL(r)},i={videoname:t,audioname:a};displayList(o.uuid,o,d,i,"sessionRecording"),displayFile(o.uuid,o,d,i,"sessionRecording")}function convertStreams(e,r){var o,t,n,a,d=!1,i=new FileReader;i.onload=function(){o=this.result,t&&(n=!0),n&&a&&!d&&s()};var c=new FileReader;c.onload=function(){t=this.result,o&&(n=!0),n&&a&&!d&&s()},webrtcdev.log("videoBlob ",e),webrtcdev.log("audioBlob ",r),i.readAsArrayBuffer(e),c.readAsArrayBuffer(r),worker||(worker=processInWebWorker()),worker.onmessage=function(e){var r=e.data;if("ready"==r.type)webrtcdev.log('<a href="'+workerPath+'" download="ffmpeg-asm.js">ffmpeg-asm.js</a> file has been loaded.'),a=!0,n&&s();else if("stdout"==r.type)webrtcdev.log(r.data);else if("start"==r.type)webrtcdev.log('<a href="'+workerPath+'" download="ffmpeg-asm.js">ffmpeg-asm.js</a> file received ffmpeg command.');else if("done"==r.type){webrtcdev.log(JSON.stringify(r));var o=r.data[0];webrtcdev.log(JSON.stringify(o));var t=new Blob([o.data],{type:"video/mp4"});webrtcdev.log(JSON.stringify(t)),PostBlob(t)}};var s=function(){d=!0,worker.postMessage({type:"command",arguments:["-i",videoFile,"-i","audio.wav","-c:v","mpeg4","-c:a","vorbis","-b:v","6400k","-b:a","4800k","-strict","experimental","output.mp4"],files:[{data:new Uint8Array(o),name:videoFile},{data:new Uint8Array(t),name:"audio.wav"}]})}}function PostBlob(e){var r;r=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid);var o="recordedvideo"+(new Date).getTime();r.filearray.push(o),document.createElement("div").value=r.filearray.length;URL.createObjectURL(e);var t=document.createElement("video");t.controls=!0;var n=document.createElement("source");n.src=URL.createObjectURL(e),n.type="video/mp4; codecs=mpeg4",t.appendChild(n),t.download="Play mp4 in VLC Player.mp4",document.body.appendChild(t),t.tabIndex=0,t.focus(),t.play()}
"";var progressHelper={};function createFileShareButton(e){widgetholder="topIconHolder_ul";var i=document.createElement("span");i.setAttribute("data-provides","fileinput"),i.className=e.button.class,i.innerHTML=e.button.html,i.onclick=function(){(new FileSelector).selectSingleFile(function(e){for(x in webcallpeers)webcallpeers[x].userid==selfuserid&&webcallpeers[x].filearray.push({name:e.name,status:"progress"});sendFile(e)})};var t=document.createElement("li");t.appendChild(i),document.getElementById(widgetholder).appendChild(t)}function assignFileShareButton(e){document.getElementById(e.button.id).onclick=function(){(new FileSelector).selectSingleFile(function(e){for(x in webcallpeers)webcallpeers[x].userid==selfuserid&&webcallpeers[x].filearray.push({name:e.name,status:"progress"});sendFile(e)})}}function initFileBufferReader(){rtcConn.fbr=new FileBufferReader,rtcConn.fbr.onProgress=function(e){connection.onFileProgress(e)},rtcConn.fbr.onBegin=function(e){connection.onFileStart(e)},rtcConn.fbr.onEnd=function(e){connection.onFileEnd(e)}}function sendFile(e){webrtcdev.log(" [filehsraing js] Send file - ",e),rtcConn.send(e)}function stopSendFile(e){for(x in webrtcdev.log(" [filehsraing js] Stop Sending file - ",e),webcallpeers)if(webcallpeers[x].userid==selfuserid)for(y in webcallpeers[x].filearray)webcallpeers[x].filearray[y].name==e.name&&"progress"==webcallpeers[x].filearray[y].status&&(webcallpeers[x].filearray[y].status,console.log(" filename ",webcallpeers[x].filearray[y].name," | status ",webcallpeers[x].filearray[y].status))}function addProgressHelper(e,i,t,n,l){try{if(!i)return void webrtcdev.error(" [filehsraingJs]Progress helpler cannot be added for one peer as its absent");if(!i.fileList.container||!document.getElementById(i.fileList.container))return void webrtcdev.error(" [filehsraingJs] Progress helpler cannot be added , missing fileListcontainer ");if(document.getElementById(t))webrtcdev.log(" Not creating progress bar div as it already exists ");else{webrtcdev.log(" [filehsraingJs] progresshelper ",e,i,t,n,l);var a=document.createElement("div");a.id=t,a.title=e+t,a.setAttribute("class",l),a.innerHTML="<label>0%</label><progress></progress>",document.getElementById(i.fileList.container).appendChild(a),progressHelper[e]={div:a,progress:a.querySelector("progress"),label:a.querySelector("label")},progressHelper[e].progress.max=n}}catch(e){webrtcdev.error(" [filehsraingJs] problem in progress helper ",e)}}function requestOldFiles(){try{rtcConn.send({type:"syncOldFiles"})}catch(e){webrtcdev.error("[filesharing js ] syncOldFiles",e)}}function sendOldFiles(){var e=[];for(x in webcallpeers){webrtcdev.log(" Checking Old Files in index ",x);var i=webcallpeers[x];if(i.filearray&&0<i.filearray.length)for(y in i.filearray){for(o in e)if(e[o].name==i.filearray[y].name)break;webrtcdev.log(" ======== user.filearray[y]",i.filearray[y]),e.push(i.filearray[y])}}setTimeout(function(){if(0<e.length)for(f in webrtcdev.log(" [filehsraing js] sendOldFiles ",e),e)sendFile(e[f])},2e4)}function addNewFileLocal(e){webrtcdev.log("addNewFileLocal message ",e),""!=e.message&&" "!=e.message&&webrtcdev.log("addNewFileLocal")}function addNewFileRemote(e){webrtcdev.log("addNewFileRemote message ",e),""!=e.message&&" "!=e.message&&webrtcdev.log("addNewFileRemote")}function updateLabel(e,i){if(-1!=e.position){var t=+e.position.toFixed(2).split(".")[1]||100;i.innerHTML=t+"%"}}function simulateClick(e){return document.getElementById(e).click(),webrtcdev.log("simulateClick on "+e),!0}function displayList(e,i,t,n,l){try{webrtcdev.log("DisplayList peerinfo->",i,t,n,l);var a=i.fileList.container,r=i.fileShare.container,o=(i.filearray.length,null);"sessionRecording"==l&&(n=n.videoname+"_"+n.audioname,o=n);var d=document.createElement("div");d.innerHTML=n,d.title=l+" shared by "+i.name,d.className="filenameClass",d.id="name"+n;var s=document.createElement("div");if(s.id="downloadButton"+n,s.style.float="right",fileshareobj.filelist.saveicon)(m=document.createElement("img")).src=fileshareobj.filelist.downloadicon,s.appendChild(m);else s.innerHTML='<i class="fa fa-download" style=" color: #615aa8;padding: 10px; font-size: larger;"></i>';s.onclick=function(){downloadFile(e,r,t,o,l)};var c=document.createElement("div");if(c.id="saveButton"+n,c.style.float="right",c.setAttribute("data-toggle","modal"),c.setAttribute("data-target","#saveModal"),fileshareobj.filelist.saveicon)(m=document.createElement("img")).src=fileshareobj.filelist.saveicon,c.appendChild(m);else c.innerHTML='<i class="fa fa-floppy-o" style="color: #615aa8;padding: 10px; font-size: larger;"></i>';c.onclick=function(){createModalPopup(l)};var m,f=document.createElement("div");if(f.id="showButton"+n,f.style.float="right",fileshareobj.filelist.saveicon)(m=document.createElement("img")).src=fileshareobj.filelist.showicon,f.appendChild(m);else f.innerHTML='<i class="fa fa-eye-slash" style="color: #615aa8;padding: 10px; font-size: larger;"></i>';var p=0;repeatFlagHideButton=n,repeatFlagShowButton="",f.onclick=function(){showHideFile(e,r,t,n,l,f,++p)};var u,h,g=document.createElement("div");g.id="removeButton"+n,g.style.float="right",g.innerHTML='<i class="fa fa-trash-o" style="color: #615aa8;padding: 10px; font-size: larger;"></i>',g.onclick=function(e){if(repeatFlagRemoveButton!=n){hideFile(r,n);var i=n;rtcConn.send({type:"shareFileRemove",_element:i,_filename:n}),removeFile(i),repeatFlagRemoveButton=n}else repeatFlagRemoveButton==n&&(repeatFlagRemoveButton="")},document.getElementById(n)?h=document.getElementById(n):(u=document.getElementById(a)?document.getElementById(a):document.body,h=document.createElement("div")),fileshareobj.active&&(h.id=n,h.innerHTML="",h.className="row",h.appendChild(d),h.appendChild(s),h.appendChild(f),h.appendChild(c),h.appendChild(g)),u&&u.appendChild(h)}catch(e){webrtcdev.error(" [filesharing ] Display list exception ",e)}}function getFileElementDisplayByType(e,i,t){var n;if(-1<e.indexOf("msword")||-1<e.indexOf("officedocument")){var l=document.createElement("div");l.className="alert alert-warning",l.innerHTML="Microsoft and Libra word file cannot be opened in browser. Click bottom DOWNLOAD in UF box . File shows up below the UF box. Click arrow on right, then select OPEN  . File Opens in New Window, then 'Save As'.",n=l}else if(-1<e.indexOf("image")){var a=document.createElement("img");a.src=i,a.style.width="100%",a.title=t,a.id="display"+t,n=a}else if("sessionRecording"==e){alert(" Session Reording");t=t.videoname+"_"+t.audioname;var r=document.createElement("div");r.setAttribute("background-color","black"),r.id="display"+t,r.title=t,(d=document.createElement("video")).src=i.videofileurl,d.setAttribute("type","audvideo/webm"),d.setAttribute("name","videofile"),d.controls="controls",d.title=t.videoname+".webm";var o=document.createElement("audio");o.src=i.audiofileurl,o.setAttribute("type","audio/wav"),o.controls="controls",o.title=t.videoname+".wav",r.appendChild(d),r.appendChild(o),n=r,d.play(),o.play()}else if(-1<e.indexOf("videoScreenRecording")){webrtcdev.log("videoScreenRecording ",i),(d=document.createElement("video")).src=i,d.setAttribute("controls","controls"),d.style.width="100%",d.title=t,d.id="display"+t,n=d}else if(-1<e.indexOf("video")){var d;webrtcdev.log("videoRecording ",i),(d=document.createElement("video")).src=i,d.setAttribute("controls","controls"),d.style.width="100%",d.title=t,d.id="display"+t,n=d}else{var s=document.createElement("iframe");s.style.width="100%",s.src=i,s.className="viewerIframeClass",s.title=t,s.id="display"+t,n=s}return n}function displayFile(e,i,t,n,l){try{if(!i||!i.fileShare)return;var a=document.getElementById(i.fileShare.container),o=getFileElementDisplayByType(l,t,n);if(a)a.innerHTML="",a.appendChild(o);else if("inspector"==role)for(r in webcallpeers){var d=++r;if(document.getElementById(webcallpeers[d].fileShare.container)){(a=document.getElementById(webcallpeers[d].fileShare.container)).innerHTML="",a.appendChild(o);break}}else document.body.appendChild(o)}catch(e){webrtcdev.error("[filehsaring js] displayFile ",e)}}function syncButton(e){var i=document.getElementById(e);for(x in webcallpeers)if(i.getAttribute("lastClickedBy")==webcallpeers[x].userid)return void i.setAttribute("lastClickedBy","");""==i.getAttribute("lastClickedBy")&&(i.setAttribute("lastClickedBy",rtcConn.userid),rtcConn.send({type:"buttonclick",buttonName:e}))}function showHideFile(e,i,t,n,l,a,r){webrtcdev.log(" filehsare - show/hide button ",n," || ",r),r%2==1?(showFile(i,t,n,l),a.innerHTML='<i class="fa fa-eye-slash" style="color: #615aa8;padding: 10px; font-size: larger;"></i>',webrtcdev.log(" Executed script to show the file")):r%2==0&&(hideFile(i,n),a.innerHTML='<i class="fa fa-eye" style="color: #615aa8;padding: 10px; font-size: larger;"></i>',webrtcdev.log(" Executed script to hide the file "))}function showFile(e,i,t,n){$("#"+e).html(getFileElementDisplayByType(n,i,t))}function hideFile(e,i){$("#"+e).has("#display"+i)?(webrtcdev.log("hidefile ",i," from ",e),document.getElementById(e).innerHTML=""):webrtcdev.log(" file is not displayed to hide  ")}function removeFile(e){document.getElementById(e).hidden=!0}function downloadFile(e,i,t,n,l){if(webrtcdev.log(" downloadButton _filename ",n,"  filetype ",l),"sessionRecording"==l){var a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=t.audiofileurl,a.download=peerinfo.filearray[0]+".wav",a.click(),window.URL.revokeObjectURL(t.audiofileurl);var r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=t.videofileurl,r.download=peerinfo.filearray[1]+".webm",r.click(),window.URL.revokeObjectURL(t.videofileurl)}else window.open(t,"downloadedDocument")}function createFileSharingBox(i,e){try{if(webrtcdev.log(" [ filehsreing js ]  createFileSharingBox ",i,e),document.getElementById(i.fileShare.outerbox))return;var t=document.createElement("div");"single"==fileshareobj.props.fileList?t.className="col-md-12 fileviewing-box":t.className="fileviewing-box",t.setAttribute("style","background-color:"+i.color),t.id=i.fileShare.outerbox;var n=document.createElement("p");n.id=i.fileShare.container+"controlBar",n.appendChild(document.createTextNode(i.name));var l=document.createElement("span");if(fileshareobj.fileshare.minicon)(o=document.createElement("img")).src=fileshareobj.fileshare.minicon,l.appendChild(o);else l.innerHTML='<i class="fa fa-minus-square" style="font-size: 25px;"></i>';l.id=i.fileShare.minButton,l.style.float="right",l.style.display="none",l.setAttribute("lastClickedBy",""),l.onclick=function(){resizeFV(i.userid,l.id,i.fileShare.outerbox),l.style.display="none",a.style.display="block"};var a=document.createElement("span");if(fileshareobj.fileshare.minicon)(o=document.createElement("img")).src=fileshareobj.fileshare.maxicon,a.appendChild(o);else a.innerHTML='<i class="fa fa-external-link-square" style="font-size: 25px;"></i>';a.id=i.fileShare.maxButton,a.style.float="right",a.style.display="block",a.setAttribute("lastClickedBy",""),a.onclick=function(){maxFV(i.userid,a.id,i.fileShare.outerbox),a.style.display="none",l.style.display="block"};var r=document.createElement("span");if(fileshareobj.fileshare.closeicon)(o=document.createElement("img")).src=fileshareobj.fileshare.closeicon,r.appendChild(o);else r.innerHTML='<i class="fa fa-times-circle" style="font-size: 25px;"></i>';r.id=i.fileShare.closeButton,r.style.float="right",r.setAttribute("lastClickedBy",""),r.onclick=function(){closeFV(i.userid,r.id,i.fileShare.container)};var o,d=0,s=document.createElement("span");if(fileshareobj.fileshare.rotateicon)(o=document.createElement("img")).src=fileshareobj.fileshare.rotateicon,s.appendChild(o);else s.innerHTML='<i class="fa fa-mail-forward" style="font-size: 25px;"></i>';s.id="btnRotate",s.style.float="right",s.onclick=function(){var e=document.getElementById(i.fileShare.container).firstChild;d=(d+90)%360,e.className="rotate"+d},n.appendChild(s),n.appendChild(l),n.appendChild(a),n.appendChild(r);var c=document.createElement("div");c.className="filesharingWidget",c.id=i.fileShare.container;var m=document.createElement("p");if(m.className="filler",debug){var f=document.createElement("span");f.innerHTML="<br/>"+c.id+"<br/>",t.appendChild(f)}linebreak=document.createElement("br"),t.appendChild(n),t.appendChild(linebreak),t.appendChild(linebreak),t.appendChild(c),t.appendChild(m),e.appendChild(t)}catch(e){webrtcdev.error(" createFileSharingBox ",e)}}function createFileListingBox(e,i){try{if(document.getElementById(e.fileList.outerbox))return;var t=document.createElement("div");"single"==fileshareobj.props.fileList?t.className="col-sm-12 filesharing-box":t.className="col-sm-6 filesharing-box",t.id=e.fileList.outerbox;var n=document.createElement("p"),l=document.createElement("span");l.innerHTML='<i class="fa fa-minus-square" style="font-size: 20px;></i>',l.id=e.fileShare.minButton,l.setAttribute("lastClickedBy",""),l.onclick=function(){resizeFV(e.userid,l.id,e.fileShare.outerbox)};var a=document.createElement("span");a.innerHTML='<i class="fa fa-external-link-square" style="font-size: 20px;></i>',a.id=e.fileShare.maxButton,a.setAttribute("lastClickedBy",""),a.onclick=function(){maxFV(e.userid,a.id,e.fileShare.outerbox)};var r=document.createElement("span");r.innerHTML='<i class="fa fa-times-circle" style="font-size: 20px;></i>',r.id=e.fileShare.closeButton,r.setAttribute("lastClickedBy",""),r.onclick=function(){closeFV(e.userid,r.id,e.fileShare.container)},n.appendChild(l),n.appendChild(a),n.appendChild(r);var o=document.createElement("div");o.id=e.fileList.container;var d=document.createElement("div");if(debug){var s=document.createElement("span");s.innerHTML=o.id,t.appendChild(s)}t.appendChild(n),t.appendChild(o),t.appendChild(d),i.appendChild(t)}catch(e){webrtcdev.error(" createFileListingBox ",e)}}function createFileSharingDiv(e){if(webrtcdev.log(" -------createFileSharingDiv  ",e),"inspector"!=e.role||"inspector"==role){if(!document.getElementById(e.fileShare.outerbox))createFileSharingBox(e,document.getElementById(fileshareobj.fileShareContainer));if(!document.getElementById(e.fileList.outerbox))createFileListingBox(e,document.getElementById(fileshareobj.fileListContainer))}}function closeFV(e,i,t){document.getElementById(t).innerHTML=""}function resizeFV(e,i,t){for(x in webcallpeers)webcallpeers[x].fileShare.outerbox==t?(document.getElementById(t).hidden=!1,document.getElementById(t).style.width="50%"):(document.getElementById(webcallpeers[x].fileShare.outerbox).hidden=!1,document.getElementById(webcallpeers[x].fileShare.outerbox).style.width="50%")}function minFV(e,i,t){document.getElementById(t).hidden=!1,document.getElementById(t).style.width="50%",document.getElementById(t).style.height="10%"}function maxFV(e,i,t){for(x in webcallpeers)webcallpeers[x].fileShare.outerbox==t?(document.getElementById(t).hidden=!1,document.getElementById(t).style.width="100%"):(document.getElementById(webcallpeers[x].fileShare.outerbox).hidden=!0,document.getElementById(webcallpeers[x].fileShare.outerbox).style.width="0%")}function createModalPopup(e){webrtcdev.log(" create Modal popup for filetype ",e);var i=document.getElementById("mainDiv");document.getElementById("saveModal")&&i.removeChild(document.getElementById("saveModal"));var t=document.createElement("div");t.className="modal fade",t.setAttribute("role","dialog"),t.id="saveModal";var n=document.createElement("div");n.className="modal-dialog";var l=document.createElement("div");l.className="modal-content";var a=document.createElement("div");a.className="modal-header";var r=document.createElement("button");r.className="close",r.setAttribute("data-dismiss","modal"),r.innerHTML="&times;";var o=document.createElement("h4");o.className="modal-title",o.innerHTML="Save File",o.setAttribute("float","left"),a.appendChild(o),a.appendChild(r);var d=document.createElement("div");d.className="modal-body",d.innerHTML="";var s=document.createElement("div");switch(e){case"blobcanvas":o.innerHTML="Save Drawing",(m=document.createElement("div")).innerHTML="Right Click on Save, pop up window gives following info: Right Click on Draw image, Click Save As when window opens up.",s.appendChild(m);break;case"application/pdf":o.innerHTML="Save PDF",(m=document.createElement("div")).innerHTML="Click DOWNLOAD on top of the doc . Click SAVE AS when window opens up";var c=document.createElement("img");c.src="images/savefile.PNG",s.appendChild(m),s.appendChild(c);break;case"image/jpeg":case"image/png":case"video/mov":case"video/webm":case"imagesnapshot":o.innerHTML="Save Picture / Video",(m=document.createElement("div")).innerHTML="Right Click on the FILE . Click SAVE AS when window opens up",s.appendChild(m);break;case"audio/mp3":o.innerHTML="Save Music File",(m=document.createElement("div")).innerHTML="Right Click on the FILE (play display line). Click SAVE AS when window opens up",s.appendChild(m);break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"video/x-ms-wmv":o.innerHTML="Save Microsoft Office / Libra / Open Office Documents",(m=document.createElement("div")).innerHTML="Click bottom DOWNLOAD in Uploaded Files box . File shows up below the Uploaded Files box. Click arrow on right, then select OPEN  . File Opens in New Window, then 'Save As'.",s.appendChild(m);break;case"sessionRecording":o.innerHTML="Save Session Recording",(m=document.createElement("div")).innerHTML="Extract the video and audio recording from the dowloaded compresed file and play together ",s.appendChild(m);break;default:var m;(m=document.createElement("div")).innerHTML="Document is Unrecognizable, cannot be saved, but can be shared with Remote. Use/Click Screen Share for Remote to view your screen. Then open the document on your screen.",s.appendChild(m)}d.appendChild(s),l.appendChild(a),l.appendChild(d),n.appendChild(l),t.appendChild(n),i.appendChild(t)}
"";var CanvasDesigner,isDrawOpened=!1;function webrtcdevCanvasDesigner(e){if(document.getElementById(e.drawCanvasContainer).innerHTML.indexOf("iframe")<0)try{CanvasDesigner.addSyncListener(function(e){rtcConn.send({type:"canvas",draw:e})}),CanvasDesigner.setSelected("pencil"),CanvasDesigner.setTools({pencil:!0,eraser:!0}),CanvasDesigner.appendTo(document.getElementById(e.drawCanvasContainer))}catch(e){webrtcdev.error(" Canvas drawing not supported ",e)}else webrtcdev.log("CanvasDesigner already started .iframe is attached ")}function syncDrawBoard(e){document.getElementById(e.button.id)?document.getElementById(e.button.id).click():webrtcdev.error(" Receieved sync board evenet but no button id found")}function createdrawButton(n){var t=document.createElement("span");t.className=n.button.class_off,t.innerHTML=n.button.html_off,t.onclick=function(){if(t.className==n.button.class_off&&document.getElementById(n.drawCanvasContainer).hidden){if(alert(" Draw Board Opened "),t.className=n.button.class_on,t.innerHTML=n.button.html_on,document.getElementById(n.container.id)?document.getElementById(n.container.id).hidden=!1:webrtcdev.error("Draw : container-",n.container.id," doesnt exist"),document.getElementById(n.drawCanvasContainer)){document.getElementById(n.drawCanvasContainer).hidden=!1,document.getElementById(n.drawCanvasContainer).focus();var e={event:"open",from:"remote",board:n.drawCanvasContainer,button:n.button};rtcConn.send({type:"canvas",board:e})}else webrtcdev.error("Draw : canvascontainer-",n.drawCanvasContainer," doesnt exist");webrtcdevCanvasDesigner(n)}else t.className!=n.button.class_on||document.getElementById(n.drawCanvasContainer).hidden||(t.className=n.button.class_off,t.innerHTML=n.button.html_off,document.getElementById(n.container.id)?document.getElementById(n.container.id).hidden=!0:webrtcdev.error("Draw : container-",n.container.id," doesnt exist"),document.getElementById(n.drawCanvasContainer)?document.getElementById(n.drawCanvasContainer).hidden=!0:webrtcdev.error("Draw : canvascontainer-",n.drawCanvasContainer," doesnt exist"))};var e=document.createElement("li");e.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(e)}function assigndrawButton(n){drawButton=document.getElementById(n.button.id),drawButton.className=n.button.class_off,drawButton.innerHTML=n.button.html_off,drawButton.onclick=function(){if(drawButton.className==n.button.class_off&&document.getElementById(n.drawCanvasContainer).hidden){if(drawButton.className=n.button.class_on,drawButton.innerHTML=n.button.html_on,document.getElementById(n.container.id)?document.getElementById(n.container.id).hidden=!1:webrtcdev.error("Draw : container-",n.container.id," doesnt exist"),document.getElementById(n.drawCanvasContainer)){document.getElementById(n.drawCanvasContainer).hidden=!1,document.getElementById(n.drawCanvasContainer).focus(),isDrawOpened=!0;var e={event:"open",from:"remote",board:n.drawCanvasContainer,button:n.button};rtcConn.send({type:"canvas",board:e})}else webrtcdev.error("Draw : canvascontainer-",n.drawCanvasContainer," doesnt exist");webrtcdevCanvasDesigner(n)}else if(drawButton.className==n.button.class_on&&!document.getElementById(n.drawCanvasContainer).hidden)if(drawButton.className=n.button.class_off,drawButton.innerHTML=n.button.html_off,document.getElementById(n.container.id)?document.getElementById(n.container.id).hidden=!0:webrtcdev.error("Draw : container-",n.container.id," doesnt exist"),document.getElementById(n.drawCanvasContainer)){document.getElementById(n.drawCanvasContainer).hidden=!0,isDrawOpened=!1;e={event:"close",from:"remote",board:n.drawCanvasContainer,button:n.button};rtcConn.send({type:"canvas",board:e})}else webrtcdev.error("Draw : canvascontainer-",n.drawCanvasContainer," doesnt exist")}}var saveButtonCanvas=document.createElement("div");saveButtonCanvas.id="saveButtonCanvasDraw",saveButtonCanvas.setAttribute("data-toggle","modal"),saveButtonCanvas.setAttribute("data-target","#saveModal"),saveButtonCanvas.onclick=function(){createModalPopup("blobcanvas")},document.body.appendChild(saveButtonCanvas);
"";function createButtonRedial(){var n=document.createElement("span");n.className=reconnectobj.button.class,n.innerHTML=reconnectobj.button.html,n.onclick=function(){1==confirm("Do you want to reconnet ?")&&($(this).html('<img src="http://www.bba-reman.com/images/fbloader.gif" />'),setTimeout(function(){$(this).html(reconnectobj.button.html)},3e3))};var t=document.createElement("li");t.appendChild(n),document.getElementById("topIconHolder_ul").appendChild(t)}function assignButtonRedial(n){document.getElementById(n).onclick=function(){if(1==confirm("Do you want to reconnect ?")){if(!rtcConn.peers[rtcConn.connectionDescription.remoteUserId])return;rtcConn.peers[rtcConn.connectionDescription.remoteUserId].peer.close(),rtcConn.rejoin(rtcConn.connectionDescription),$(this).html('<img src="http://www.bba-reman.com/images/fbloader.gif" />'),setTimeout(function(){document.getElementById(n).innerHTML=reconnectobj.button.html},3e3)}}}
"";if(document.getElementById("ListenInButton")){var listeninLink=window.location+"?appname=webrtcwebcall&role=inspector&audio=0&video=0",modalBox=document.createElement("div");modalBox.className="modal fade",modalBox.setAttribute("role","dialog"),modalBox.id="myModal";var modalinnerBox=document.createElement("div");modalinnerBox.className="modal-dialog";var modal=document.createElement("div");modal.className="modal-content";var modalheader=document.createElement("div");modalheader.className="modal-header";var closeButton=document.createElement("button");closeButton.className="close",closeButton.setAttribute("data-dismiss","modal"),closeButton.innerHTML="&times;";var title=document.createElement("h4");title.className="modal-title",title.innerHTML="Listen-In Link",modalheader.appendChild(title),modalheader.appendChild(closeButton);var modalbody=document.createElement("div");modalbody.className="modal-body";var link=document.createElement("div");link.innerHTML=window.location+"?appname=webrtcwebcall&role=inspector&audio=0&video=0";var mail=document.createElement("div");mail.innerHTML='<a href="mailto:?Subject=Hello%20again" target="_top">Send Mail</a>',modalbody.appendChild(link),modalbody.appendChild(mail),modal.appendChild(modalheader),modal.appendChild(modalbody),modalinnerBox.appendChild(modal),modalBox.appendChild(modalinnerBox);var mainDiv=document.getElementById("mainDiv");mainDiv.appendChild(modalBox),webrtcdev.log(" -----------------sppenedd modal dialog ListenIn",modalBox)}if(document.getElementById("listenInLink"))try{var currSession=window.location.href;webrtcdev.log(" Current Session ",currSession);var listeninSession=currSession+"?appname=webrtcwebcall&role=inspector&audio=0&video=0";webrtcdev.log(" Inspector Link ",listeninSession),document.getElementById("listenInLink").value=listeninSession}catch(e){webrtcdev.error(" Listen In :".e)}
"";var cursorX,cursorY,cursorinterval;function placeCursor(r,t,o){r.style.position="absolute",r.style.left=t+"px",r.style.top=o+"px"}function startShareCursor(){document.getElementById("cursor1").setAttribute("style","display:block"),document.onmousemove=function(r){cursorX=r.pageX+10,cursorY=r.pageY},cursorinterval=setInterval(shareCursor,500)}function stopShareCursor(){document.getElementById("cursor1").setAttribute("style","display:none"),rtcConn.send({type:"pointer",action:"stopCursor"}),clearInterval(cursorinterval)}function shareCursor(){var r=document.getElementById("cursor1");r.hidden=!1,placeCursor(r,cursorX,cursorY),rtcConn.send({type:"pointer",action:"startCursor",corX:cursorX,corY:cursorY})}function createCursorButton(r,t,o,e){var s=document.createElement("span");return s.id=r+"cursorButton",s.setAttribute("data-val","mute"),s.setAttribute("title","Pointer"),s.className=cursorobj.button.class_on,s.innerHTML=cursorobj.button.html_on,s.onclick=function(){var r,t=s.id;r=selfuserid?findPeerInfo(selfuserid):findPeerInfo(rtcConn.userid),-1<t.indexOf(r.controlBarName)?s.className==cursorobj.button.class_on?(startShareCursor(),s.className=cursorobj.button.class_off,s.innerHTML=cursorobj.button.html_off):s.className==cursorobj.button.class_off&&(stopShareCursor(),s.className=cursorobj.button.class_on,s.innerHTML=cursorobj.button.html_on):alert(" Use Local Pointer button ")},s}
"";function createCodeEditorButton(){var e=document.createElement("span");for(x in e.className=codeeditorobj.button.class_off,e.innerHTML=codeeditorobj.button.html_off,codeeditorobj.languages)document.getElementById("CodeStyles").innerHTML=document.getElementById("CodeStyles").innerHTML+codeeditorobj.languages[x];document.getElementById("codeArea").value;editor=CodeMirror.fromTextArea(document.getElementById("codeArea"),{mode:"text/javascript",styleActiveLine:!0,lineNumbers:!1,lineWrapping:!0}),editor.setOption("theme","mdn-like"),e.onclick=function(){e.className==codeeditorobj.button.class_off?(e.className=codeeditorobj.button.class_on,e.innerHTML=codeeditorobj.button.html_on,startWebrtcdevcodeeditorSync(),document.getElementById(codeeditorobj.codeeditorContainer).hidden=!1):e.className==codeeditorobj.button.class_on&&(e.className=codeeditorobj.button.class_off,e.innerHTML=codeeditorobj.button.html_off,stopWebrtcdevcodeeditorSync(),document.getElementById(codeeditorobj.codeeditorContainer).hidden=!0)};var t=document.createElement("li");t.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(t)}function sendWebrtcdevCodeeditorSync(e){if(37==e.which||38==e.which||39==e.which||40==e.which||17==e.which||18==e.which||16==e.which)return!0;var t={option:"text",codeContent:editor.getValue()};webrtcdev.log(" sending ",t),rtcMultiConnection.send({type:"codeeditor",data:t})}function sendWebrtcdevCodeeditorStyleSync(e){$("#CodeStyles option:selected").each(function(){var e=CodeMirror.findModeByMIME($(this).attr("mime"));e&&(mode=e.mode,spec=$(this).attr("mime"),editor.setOption("mode",spec),CodeMirror.autoLoadMode(editor,mode))});var t={option:"menu",codeMode:mode,codeSpec:spec};webrtcdev.log(" sending ",t),rtcMultiConnection.send({type:"codeeditor",data:t})}function receiveWebrtcdevCodeeditorSync(e){if(webrtcdev.log("codeeditor ",e),"text"==e.option){var t=editor.getCursor();editor.setValue(e.codeContent),editor.setCursor(t)}else"menu"==e.option&&(editor.setOption("mode",evt.data.codeSpec),CodeMirror.autoLoadMode(editor,evt.data.codeMode))}function startWebrtcdevcodeeditorSync(){document.getElementById(codeeditorobj.codeeditorContainer).addEventListener("keyup",sendWebrtcdevCodeeditorSync,!1),document.getElementById("CodeStyles").addEventListener("change",sendWebrtcdevCodeeditorStyleSync,!1)}function stopWebrtcdevcodeeditorSync(){document.getElementById(codeeditorobj.codeeditorContainer).removeEventListener("keyup",sendWebrtcdevCodeeditorSync,!1)}
"";function createTextEditorButton(){var t=document.createElement("span");t.className=texteditorobj.button.class_off,t.innerHTML=texteditorobj.button.html_off,t.onclick=function(){t.className==texteditorobj.button.class_off?(t.className=texteditorobj.button.class_on,t.innerHTML=texteditorobj.button.html_on,startWebrtcdevTexteditorSync(),document.getElementById(texteditorobj.texteditorContainer).hidden=!1):t.className==texteditorobj.button.class_on&&(t.className=texteditorobj.button.class_off,t.innerHTML=texteditorobj.button.html_off,stopWebrtcdevTexteditorSync(),document.getElementById(texteditorobj.texteditorContainer).hidden=!0)};var e=document.createElement("li");e.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(e)}function sendWebrtcdevTexteditorSync(t){if(37==t.which||38==t.which||39==t.which||40==t.which||17==t.which||18==t.which||16==t.which)return!0;var e={option:"text",content:document.getElementById(texteditorobj.texteditorContainer).value};webrtcdev.log(" sending ",document.getElementById(texteditorobj.texteditorContainer).value),rtcMultiConnection.send({type:"texteditor",data:e})}function receiveWebrtcdevTexteditorSync(t){webrtcdev.log("texteditor ",t),"text"==t.option&&(document.getElementById(texteditorobj.texteditorContainer).value=t.content)}function startWebrtcdevTexteditorSync(){document.getElementById(texteditorobj.texteditorContainer).addEventListener("keyup",sendWebrtcdevTexteditorSync,!1)}function stopWebrtcdevTexteditorSync(){document.getElementById(texteditorobj.texteditorContainer).removeEventListener("keyup",sendWebrtcdevTexteditorSync,!1)}
"";var iceServers=[];function createCORSRequest(e,r){var t=new XMLHttpRequest;return"withCredentials"in t?t.open(e,r,!0):"undefined"!=typeof XDomainRequest?(t=new XDomainRequest).open(e,r):t=null,t}function getICEServer(e,r,t,n,s,a){$.ajax({url:"https://global.xirsys.net/_turn/Amplechat/",type:"PUT",async:!1,headers:{Authorization:"Basic "+btoa("farookafsari:e35af4d2-dbd5-11e7-b927-0c3f27cba33f")},success:function(e){webrtcdevIceServers=e.v.iceServers,webrtcdev.log(" [ Turn.js ] obtained iceServers",webrtcdevIceServers)}})}
"";var hours,mins,secs,today=new Date,zone="";function startsessionTimer(e){e.counter.hours&&e.counter.minutes&&e.counter.seconds?(hours=document.getElementById(e.counter.hours),mins=document.getElementById(e.counter.minutes),secs=document.getElementById(e.counter.seconds),"forward"==e.type?(startForwardTimer(),hours.innerHTML=0,mins.innerHTML=0,secs.innerHTML=0):"backward"==e.type&&(hours.innerHTML=0,mins.innerHTML=3,secs.innerHTML=0,startBackwardTimer())):webrtcdev.error(" timerobj.counter DOM elemnts not found ")}function startBackwardTimer(){webrtcdev.log("startBackwardTimer",hours,mins,secs);var e=mins;btimer(secs,parseInt(secs.innerHTML,10),e,parseInt(e.innerHTML,10))}function startForwardTimer(){webrtcdev.log("forward vtime started ");var e=mins;ftimer(secs,parseInt(secs.innerHTML,10),e,parseInt(e.innerHTML,10))}function ftimer(e,t,n,r){setInterval(function(){t++,60==(secs.innerHTML=t)&&(t=0,r++,mins.innerHTML=r)},1e3)}function btimer(e,t,n,r){var i=setInterval(function(){t--,0==(secs.innerHTML=t)&&(t=60,r--,(mins.innerHTML=r)<0&&clearInterval(i))},1e3)}function getDate(){return new Date}function prepareTime(){}function startTime(){try{var e=today.getHours(),t=today.getMinutes(),n=today.getSeconds();if(t=checkTime(t),n=checkTime(n),timerobj.span.currentTime_id&&document.getElementById(timerobj.span.currentTime_id)){document.getElementById(timerobj.span.currentTime_id).innerHTML=e+":"+t+":"+n;setTimeout(startTime,500)}else webrtcdev.error(" No place for timerobj.span.currentTime_id")}catch(e){webrtcdev.error(e)}}function timeZone(){try{if(timerobj.span.currentTimeZone_id&&document.getElementById(timerobj.span.currentTimeZone_id))zone=Intl.DateTimeFormat().resolvedOptions().timeZone,document.getElementById(timerobj.span.currentTimeZone_id).innerHTML=zone;else webrtcdev.error(" timerobj.span.currentTimeZone_id DOM doesnt exist ")}catch(e){webrtcdev.error(e)}}function shareTimePeer(){try{var e={type:"timer",time:today.toJSON(),zone:zone};rtcConn.send(e)}catch(e){webrtcdev.error(e)}}function startPeersTime(e,t){try{if(webrtcdev.log(" startPeersTime ",e,t),timerobj.span.remoteTimeZone_id&&document.getElementById(timerobj.span.remoteTimeZone_id))document.getElementById(timerobj.span.remoteTimeZone_id).innerHTML=t;else webrtcdev.error("timerobj.span.remoteTimeZone_id DOM doesnt exist ");if(timerobj.span.remoteTime_id&&document.getElementById(timerobj.span.remoteTime_id)){var n=new Date(e);webrtcdev.log(" remotedate :",n);var r=n.getHours(),i=n.getMinutes(),o=n.getSeconds();r=checkTime(r),i=checkTime(i),o=checkTime(o),document.getElementById(timerobj.span.remoteTime_id).innerHTML=r+":"+i+":"+o;setTimeout(startTime,500)}else webrtcdev.error(" timerobj.span.remoteTime_id DOM does not exist")}catch(e){webrtcdev.error(e)}}function activateBttons(t){t.container.minbutton_id&&document.getElementById(t.container.minbutton_id)&&(document.getElementById(t.container.minbutton_id).onclick=function(e){document.getElementById(t.container.id).hidden?document.getElementById(t.container.id).hidden=!1:document.getElementById(t.container.id).hidden=!0})}function checkTime(e){return e<10&&(e="0"+e),e}
"";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function getStats(e,c,s){var g=this;if(e instanceof RTCMultiConnection){if(g=e,navigator.mozGetUserMedia&&(e=c,c=s,s=arguments[3]),!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack."}else if(!(e instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var p={audio:{},video:{}},l=!1;!function d(){!function(n){if(webrtcdev.log("peer ",g),!g.getStats())return;navigator.mozGetUserMedia?g.getStats(e,function(e){var t=[];e.forEach(function(e){t.push(e)}),n(t)},n):g.getStats(function(e){var o=[];e.result().forEach(function(t){var n={};t.names().forEach(function(e){n[e]=t.stat(e)}),n.id=t.id,n.type=t.type,n.timestamp=t.timestamp,o.push(n)}),n(o)})}(function(e){for(var t={audio:{},video:{},results:e,nomore:function(){l=!0}},n=0;n<e.length;++n){var o=e[n];if(o.datachannelid&&"datachannel"===o.type&&(t.datachannel={state:o.state}),"googLibjingleSession"===o.type&&(t.isOfferer=o.googInitiator),"googCertificate"==o.type&&(t.encryption=o.googFingerprintAlgorithm),"opus"==o.googCodecName&&o.bytesSent){var i=0;if(o.bytesSent){p.audio.prevBytesSent||(p.audio.prevBytesSent=o.bytesSent);var a=o.bytesSent-p.audio.prevBytesSent;p.audio.prevBytesSent=o.bytesSent,i=a/1024}t.audio||(t.audio=o),t.audio.availableBandwidth=i.toFixed(1)}if("VP8"==o.googCodecName){i=0;if(o.bytesSent){p.video.prevBytesSent||(p.video.prevBytesSent=o.bytesSent);a=o.bytesSent-p.video.prevBytesSent;p.video.prevBytesSent=o.bytesSent,i=a/1024}t.video||(t.video=o),t.video.availableBandwidth=i.toFixed(1),o.googFrameHeightReceived&&o.googFrameWidthReceived&&(t.resolutions={width:o.googFrameWidthReceived,height:o.googFrameHeightReceived})}"VideoBwe"==o.type&&(t.video.bandwidth={googActualEncBitrate:o.googActualEncBitrate,googAvailableSendBandwidth:o.googAvailableSendBandwidth,googAvailableReceiveBandwidth:o.googAvailableReceiveBandwidth,googRetransmitBitrate:o.googRetransmitBitrate,googTargetEncBitrate:o.googTargetEncBitrate,googBucketDelay:o.googBucketDelay,googTransmitBitrate:o.googTransmitBitrate}),"googCandidatePair"==o.type&&"true"==o.googActiveConnection&&(t.connectionType={local:{candidateType:o.googLocalCandidateType,ipAddress:o.googLocalAddress},remote:{candidateType:o.googRemoteCandidateType,ipAddress:o.googRemoteAddress},transport:o.googTransportType});var r=((navigator.connection||{}).type||"unknown").toString().toLowerCase();"localcandidate"===o.type&&(t.connectionType||(t.connectionType={}),t.connectionType.local={candidateType:o.candidateType,ipAddress:o.ipAddress+":"+o.portNumber,networkType:o.networkType||"unknown",transport:o.transport}),"remotecandidate"===o.type&&(t.connectionType||(t.connectionType={}),t.connectionType.local={candidateType:o.candidateType,ipAddress:o.ipAddress+":"+o.portNumber,networkType:o.networkType||r,transport:o.transport})}try{-1!==g.iceConnectionState.search(/failed|closed/gi)&&(l=!0)}catch(e){l=!0}!0===l&&(t.datachannel&&(t.datachannel.state="close"),t.ended=!0),c(t),l||null!=(void 0===s?"undefined":_typeof(s))&&s&&setTimeout(d,s||1e3)})}()}function merge(e,t){if(e||(e={}),!t)return e;for(var n in t)e[n]=t[n];return e}function activateBandwidthButtons(e){document.getElementById("minimizeBandwidthButton")&&(document.getElementById("minimizeBandwidthButton").onclick=function(e){document.getElementById("bandwidthContainer").hidden?document.getElementById("bandwidthContainer").hidden=!1:document.getElementById("bandwidthContainer").hidden=!0})}function showStatus(e){getStats(rtcConn,function(e){alert("getstats Result"),webrtcdev.log(e.connectionType.remote.ipAddress),webrtcdev.log(e.connectionType.remote.candidateType),webrtcdev.log(e.connectionType.transport)}),alert("got stats ",result.connectionType.transport),webrtcdev.log("WebcallPeers ",webcallpeers)}function rtpstats(){try{for(x=0;x<rtcConn.peers.getLength();x++){var e=rtcConn.peers.getAllParticipants()[x],t=JSON.stringify(rtcConn.peers[e],void 0,2);document.getElementById(statisticsobj.statsConainer).innerHTML+="<pre >"+t+"</pre>"}}catch(e){webrtcdev.error("rtpstats",e)}}function showRtcConn(){webrtcdev.log(" rtcConn : ",rtcConn),webrtcdev.log(" rtcConn.peers.getAllParticipants() : ",rtcConn.peers.getAllParticipants())}"undefined"!=typeof module&&(module.exports=getStats),"undefined"!=typeof window&&(window.getStats=getStats);
"";var channelpresence=!1,localVideoStreaming=null,turn="none",localobj={},remoteobj={},WebRTCdev=function(e,t,o,n,r,i){return sessionid=r.sessionid,socketAddr=r.socketAddr,localobj=e,remoteobj=t,webrtcdev.log("WebRTCdev --\x3e Session ",r),turn=r.hasOwnProperty("turn")?r.turn:null,webrtcdev.log("WebRTCdev --\x3e TURN ",turn),null!=turn&&"none"!=turn?getICEServer(turn.username,turn.secretkey,turn.domain,turn.application,turn.room,turn.secure):webrtcdev.log("WebRTCdev --\x3e TURN not applied "),i&&(webrtcdev.log(" WebRTCdev --\x3e widgets  ",i),i.debug&&(debug=i.debug||!1),i.chat&&(chatobj=i.chat||null),i.fileShare&&(fileshareobj=i.fileShare||null),i.screenrecord&&(screenrecordobj=i.screenrecord||null),i.screenshare&&(screenshareobj=i.screenshare||null),i.snapshot&&(snapshotobj=i.snapshot||null),i.videoRecord&&(videoRecordobj=i.videoRecord||null),i.reconnect&&(reconnectobj=i.reconnect||null),i.drawCanvas&&(drawCanvasobj=i.drawCanvas||null),i.texteditor&&(texteditorobj=i.texteditor||null),i.codeeditor&&(codeeditorobj=i.codeeditor||null),i.mute&&(muteobj=i.mute||null),i.timer&&(timerobj=i.timer||null),i.listenin&&(listeninobj=i.listenin||null),i.cursor&&(cursorobj=i.cursor||null),i.minmax&&(minmaxobj=i.minmax||null),i.help&&(helpobj=i.help||null),i.statistics&&(statisticsobj=i.statistics||null)),{sessionid:sessionid,socketAddr:socketAddr,turn:turn,widgets:i,startwebrtcdev:funcStartWebrtcdev,rtcConn:rtcConn}};function funcStartWebrtcdev(){return webrtcdev.log(" startwebrtcdev "),new Promise(function(e,t){detectRTC=DetectRTC,webrtcdev.log(" [ startJS webrtcdom ] : DetectRTC ",detectRTC),detectRTC.hasWebcam||(shownotification(" Your browser doesnt have webcam","warning"),outgoing.video=!1),detectRTC.isWebsiteHasWebcamPermissions||(shownotification(" Your browser doesnt have permission for accessing webcam","warning"),outgoing.video=!1),detectRTC.hasMicrophone||(shownotification(" Your browser doesnt have microphone","warning"),outgoing.audio=!1),detectRTC.isWebsiteHasMicrophonePermissions||(shownotification(" Your browser doesnt have permission for accessing microphone","warning"),outgoing.audio=!1),detectRTC.hasSpeakers||shownotification(" Your browser doesnt have speakers","warning"),e("done")}).then(navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).then(function(e){return webrtcdev.log(" [ startJS webrtcdom ] : incoming ",incoming),webrtcdev.log(" [ startJS webrtcdom ] : outgoing ",outgoing),new Promise(function(e,t){incoming&&(incomingAudio=incoming.audio,incomingVideo=incoming.video,incomingData=incoming.data),outgoing&&(outgoingAudio=outgoing.audio,outgoingVideo=outgoing.video,outgoingData=outgoing.data),e("done")})}).then(function(e){return webrtcdev.log(" [ startJS webrtcdom ] : localobj ",localobj),webrtcdev.log(" [ startJS webrtcdom ] : remoteobj ",remoteobj),new Promise(function(e,t){localVideo=localobj.video;var o=remoteobj.videoarr;if(outgoingVideo&&(selfVideo=o[0]),!remoteobj.dynamicVideos)for(var n=1;n<o.length;n++)remoteVideos.push(o[n]);e("done")})}).then(function(e){return new Promise(function(e,t){if(localobj.hasOwnProperty("userdetails")){var o=localobj.userdetails;webrtcdev.info("localobj userdetails ",o),selfusername=o.username||"LOCAL",selfcolor=o.usercolor||"orange",selfemail=o.useremail||"unknown",role=o.role||"participant"}else webrtcdev.warning("localobj has no userdetails ");if(remoteobj.hasOwnProperty("userdetails")){var n=remoteobj.userdetails;webrtcdev.info("remoteobj userdetails ",n),remoteusername=n.username||"REMOTE",remotecolor=n.usercolor||"orange",remoteemail=n.useremail||"unknown"}else webrtcdev.warning("remoteobj has no userdetails ");e("done")})}).then(setRtcConn(sessionid)).then(setWidgets(rtcConn)).then(startSocketSession(rtcConn,socketAddr,sessionid)).catch(function(e){webrtcdev.error(" Promise rejected ",e)})}function startSocketSession(n,e,t){webrtcdev.log("StartSession"+t);try{var o="/";"/"!=e&&(o=e),socket=io.connect(o,{transports:["websocket"]})}catch(e){webrtcdev.error(" problem in socket connnection",e),alert(" problem in socket connnection")}if(!t)return webrtcdev.error(" Session id undefined "),void alert("rtcCon channel / session id undefined ");shownotification(" Checking status of  : "+t),socket.emit("presence",{channel:t}),socket.on("connect",function(){socket.on("disconnected",function(){shownotification("Disconnected from signaller ")})}),socket.on("presence",function(e){webrtcdev.log("presence for sessionid ",e),(channelpresence=e)?joinWebRTC(t,selfuserid):openWebRTC(t,selfuserid)}),socket.on("open-channel-resp",function(e){(webrtcdev.log(" opened-channel",e,e.status,e.channel==t),e.status&&e.channel==t)?new Promise(function(e,t){webrtcdev.log(" [open-channel-resp ] "," Session video:",outgoingVideo," audio: ",outgoingAudio," data: ",outgoingData," OfferToReceiveAudio: ",incomingAudio," OfferToReceiveVideo: ",incomingVideo),n.connectionType="open",n.session={video:outgoingVideo,audio:outgoingAudio,data:outgoingData},n.sdpConstraints.mandatory={OfferToReceiveAudio:incomingAudio,OfferToReceiveVideo:incomingVideo},e()}).then(n.open(e.channel,function(){null==selfuserid&&(selfuserid=n.userid,tempuserid!=selfuserid&&socket.emit("update-channel",{type:"change-userid",channel:n.channel,sender:selfuserid,extra:{old:tempuserid,new:selfuserid}}))})).then(function(e){updatePeerInfo(selfuserid,selfusername,selfcolor,selfemail,"role","local"),webrtcdev.info(" Trying to open a channel on WebRTC SDP ")}).then(getCamMedia()).catch(function(e){webrtcdev.error("Handle rejected promise ("+e+")")}):alert(" signaller doesnt allow channel open");shownotification(e.msgtype+" : "+e.message)}),socket.on("join-channel-resp",function(o){(webrtcdev.log("joined-channel",o),o.status&&o.channel==t)?new Promise(function(e,t){webrtcdev.log(" [ join-channel-resp ] "," Session video:",outgoingVideo," audio: ",outgoingAudio," data: ",outgoingData," OfferToReceiveAudio: ",incomingAudio," OfferToReceiveVideo: ",incomingVideo),n.connectionType="join",n.session={video:outgoingVideo,audio:outgoingAudio,data:outgoingData},n.sdpConstraints.mandatory={OfferToReceiveAudio:incomingAudio,OfferToReceiveVideo:incomingVideo},n.remoteUsers=o.users,e()}).then(n.connectionDescription=n.join(o.channel)).then(updatePeerInfo(n.userid,selfusername,selfcolor,selfemail,role,"local"),webrtcdev.info(" Trying to join a channel on WebRTC SDP ")).then(function(e){for(x in n.remoteUsers)updatePeerInfo(n.remoteUsers[x],remoteusername,remotecolor,remoteemail,"participant","remote"),"inspector"==role&&shownotificationWarning("This session is being inspected ")}).then(getCamMedia()).catch(function(e){webrtcdev.error("Handle rejected promise ("+e+")")}):alert(" signaller doesnt allow channel Join");shownotification(o.msgtype+" : "+o.message)}),socket.on("channel-event",function(e){(webrtcdev.log("channel-event",e),"new-join"==e.type)&&(e.status?findPeerInfo(e.data.sender)||("LOCAL"==e.data.extra.name&&(e.data.extra.name="REMOTE",e.data.extra.color=remotecolor),updatePeerInfo(e.data.sender,e.data.extra.name,e.data.extra.color,e.data.extra.email,e.data.extra.role,"remote"),shownotification(e.data.extra.role+"  "+e.type)):shownotification(e.msgtype+" : "+e.message))})}var setRtcConn=function(o){return new Promise(function(e,t){webrtcdev.log("initiating RTcConn"),rtcConn=new RTCMultiConnection,rtcConn.onNewParticipant=function(e,t){webrtcdev.log("onNewParticipant",e,t),shownotification(remoteusername+" requests new participantion "),webcallpeers.length<=remoteobj.maxAllowed?updatePeerInfo(e,remoteusername,remotecolor,"","role","remote"):shownotification("Another user is trying to join this channel but max count [ "+remoteobj.maxAllowed+" ] is reached","warning"),rtcConn.acceptParticipationRequest(e,t)},rtcConn.onopen=function(e){webrtcdev.log("rtcconn onopen "+rtcConn.connectionType);try{"open"==rtcConn.connectionType?connectWebRTC("open",o,selfuserid,[]):"join"==rtcConn.connectionType?connectWebRTC("join",o,selfuserid,rtcConn.remoteUsers):shownotification("connnection type is neither open nor join","warning"),timerobj&&timerobj.active&&(startsessionTimer(timerobj),shareTimePeer()),shownotification(e.extra.name+" joined session ","info"),showdesktopnotification(),onSessionConnect(),statisticsobj&&statisticsobj.active&&rtpstats()}catch(e){shownotification("problem in on session open "+e.message,"warning"),webrtcdev.error("problem in on session open",e)}},rtcConn.onMediaError=function(e,t){webrtcdev.error("[startJS onMediaError] ",e,t),shownotification(e.name+" Joining without camera Stream ","warning"),localVideoStreaming=!1;var o=webcallpeers[0];o.type="Local",o.stream=null,o.streamid="nothing01",updateWebCallView(o),onLocalConnect()},rtcConn.onstream=function(e){webrtcdev.log("[startJs on stream ] on stream Started event ",e),"local"==e.type&&(localVideoStreaming=!0);var t=findPeerInfo(e.userid);t?(t.type=e.type,t.stream=e.stream,t.streamid=e.stream.streamid,updateWebCallView(t)):(console.error(" PeerInfo not present in webcallpeers ",e.userid,rtcConn),alert(" Cannot create session for Peer")),onLocalConnect()},rtcConn.onstreamended=function(e){webrtcdev.log(" On streamEnded event ",e);var t=document.getElementById(e.streamid);t&&t.parentNode.removeChild(t)},rtcConn.chunkSize=5e4,rtcConn.onmessage=function(e){if(webrtcdev.log(" on message ",e),e.data.typing)updateWhotyping(e.extra.name+" is typing ...");else if(e.data.stoppedTyping)updateWhotyping("");else switch(e.data.type){case"screenshare":if("stoppedscreenshare"==e.data.message)shownotification("Screenshare has stopped : "+e.data.screenStreamid),(t=document.getElementById(screenshareobj.button.shareButton.id)).className=screenshareobj.button.shareButton.class_off,t.innerHTML=screenshareobj.button.shareButton.html_off,t.disabled=!1,scrConn.onstreamended(),scrConn.removeStream(e.data.screenStreamid),scrConn.close();else if("screenshareStartedViewing"==e.data.message)screenshareNotification("","screenshareStartedViewing");else{var t;shownotification("screen is getting shared "+e.data.screenid),(t=document.getElementById(screenshareobj.button.shareButton.id)).className=screenshareobj.button.shareButton.class_busy,t.innerHTML=screenshareobj.button.shareButton.html_busy,t.disabled=!0,screenRoomid=e.data.screenid;var o="temp_"+(new Date).getUTCMilliseconds();webrtcdevPrepareScreenShare(function(e){connectScrWebRTC("join",e,o,[])})}break;case"chat":updateWhotyping(e.extra.name+" has send message"),addNewMessage({header:e.extra.name,message:e.data.message,userinfo:e.data.userinfo,color:e.extra.color});break;case"imagesnapshot":var n=findPeerInfo(e.userid);displayList(null,n,e.data.message,e.data.name,"imagesnapshot"),displayFile(null,n,e.data.message,e.data.name,"imagesnapshot");break;case"videoRecording":n=findPeerInfo(e.userid);displayList(null,n,e.data.message,e.data.name,"videoRecording"),displayFile(null,n,e.data.message,e.data.name,"videoRecording");break;case"videoScreenRecording":n=findPeerInfo(e.userid);displayList(null,n,e.data.message,e.data.name,"videoScreenRecording"),displayFile(null,n,e.data.message,e.data.name,"videoScreenRecording");break;case"file":addNewMessage({header:e.extra.name,message:e.data.message,userinfo:getUserinfo(rtcConn.blobURLs[e.userid],"chat-message.png"),color:e.extra.color});break;case"canvas":e.data.draw?CanvasDesigner.syncData(e.data.draw):e.data.board?(webrtcdev.log(" Canvas : ",e.data),"remote"==e.data.board.from&&("open"==e.data.board.event&&1!=isDrawOpened?syncDrawBoard(e.data.board):"close"==e.data.board.event&&1==isDrawOpened&&syncDrawBoard(e.data.board))):webrtcdev.warn(" Board data mismatch",e.data);break;case"texteditor":receiveWebrtcdevTexteditorSync(e.data.data);break;case"codeeditor":receiveWebrtcdevCodeeditorSync(e.data.data);break;case"pointer":var r=document.getElementById("cursor2");r?"startCursor"==e.data.action?(r.setAttribute("style","display:block"),placeCursor(r,e.data.corX,e.data.corY)):"stopCursor"==e.data.action&&r.setAttribute("style","display:none"):alert(" Cursor for remote is not present ");break;case"timer":startPeersTime(e.data.time,e.data.zone);break;case"buttonclick":var i=document.getElementById(e.data.buttonName);i.getAttribute("lastClickedBy")!=rtcConn.userid&&(i.setAttribute("lastClickedBy",e.userid),i.click());break;case"syncOldFiles":sendOldFiles();break;case"shareFileRemove":var a=e.data._element,s=e.data._filename;removeFile(a),removeButton="removeButton"+s,document.getElementById(removeButton).hidden=!0;break;default:webrtcdev.warn(" unrecognizable message from peer  ",e)}},rtcConn.sendMessage=function(e){webrtcdev.log(" sendMessage ",e),e.userid=rtcConn.userid,e.extra=rtcConn.extra,rtcConn.sendCustomMessage(e)},rtcConn.onleave=function(e){var t=findPeerInfo(e.userid);webrtcdev.log(" RTCConn onleave user",e," his peerinfo ",t," rom webcallpeers ",webcallpeers),"undefined"!=e.extra.name&&shownotification(e.extra.name+"  left the conversation.")},rtcConn.onclose=function(e){webrtcdev.log(" RTCConn on close conversation ",e)},rtcConn.onEntireSessionClosed=function(e){rtcConn.attachStreams.forEach(function(e){e.stop()}),alert(" Entire Session Disconneted ")},rtcConn.onFileStart=function(e){webrtcdev.log("[start] on File start "+e.name),webrtcdev.log("file description ",e);var t=findPeerInfo(e.userid);t&&"inspector"==t.role||addProgressHelper(e.uuid,t,e.name,e.maxChunks,"fileBoxClass")},rtcConn.onFileProgress=function(e){webrtcdev.log("[start] on File progress ",e);try{var t=progressHelper[e.uuid];t&&(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,updateLabel(t.progress,t.label))}catch(e){webrtcdev.error(" Prolem in progressHelper ",e)}},rtcConn.onFileEnd=function(e){var t=e.name;for(x in webrtcdev.log("[start] On file End "+t),webcallpeers)for(y in webcallpeers[x].filearray)if(webrtcdev.log(" Duplicate find , Files shared  so far ",webcallpeers[x].filearray[y].name),webcallpeers[x].filearray[y].name==t)return void webrtcdev.error("duplicate file shared ");var o=findPeerInfo(e.userid);null!=o&&o.filearray.push(e),displayFile(e.uuid,o,e.url,t,e.type),displayList(e.uuid,o,e.url,t,e.type)},rtcConn.takeSnapshot=function(e,t){takeSnapshot({userid:e,connection:connection,callback:t})},rtcConn.connectionType=null,rtcConn.remoteUsers=[],rtcConn.extra={uuid:tempuserid,name:selfusername||"",color:selfcolor||"",email:selfemail||""},rtcConn.channel=this.sessionid,rtcConn.socketURL="/",rtcConn.socketMessageEvent="RTCMultiConnection-Message",rtcConn.socketCustomEvent="RTCMultiConnection-Custom-Message",rtcConn.enableFileSharing=!0,rtcConn.filesContainer=document.body||document.documentElement,rtcConn.dontCaptureUserMedia=!0,tempuserid=supportSessionRefresh(),webrtcdev.log(" RTCConn : ",rtcConn),rtcConn?e(rtcConn):t("failed")})};function supportSessionRefresh(){return localStorage.getItem("channel")==rtcConn.channel&&localStorage.getItem("userid")?(selfuserid=localStorage.getItem("userid"),webrtcdev.log(" [startJS ] check for supportSessionRefresh - user refreshed , old userid is  ",selfuserid),selfuserid):rtcConn.userid}function getCamMedia(){return webrtcdev.log(" [startJS] getCamMedia  role :",role," and outgoingVideo : ",outgoingVideo),new Promise(function(e,t){"inspector"==role?webrtcdev.log("Joining as inspector without camera Video"):outgoingVideo||!outgoingVideo?(webrtcdev.log("getCamMedia - Capture Media "),rtcConn.dontCaptureUserMedia=!1,rtcConn.getUserMedia()):(webrtcdev.error(" getCamMedia - dont Capture outgoing video ",outgoingVideo),onNoCameraCard()),e("success")}).catch(function(e){webrtcdev.error("getCamMedia rejected promise ("+e+")")})}var setWidgets=function(o){return new Promise(function(e,t){if(chatobj.active?(chatobj.inputBox&&chatobj.inputBox.text_id&&document.getElementById(chatobj.inputBox.text_id)?(webrtcdev.log("Assign chat Box "),assignChatBox(chatobj)):(webrtcdev.log("Create chat Box "),createChatBox(chatobj)),webrtcdev.log("chat widget loaded ")):webrtcdev.log(" chat widget not loaded "),screenrecordobj&&screenrecordobj.active?(detectExtension(screenshareobj.extensionID,function(e){extensioninstalled=e,webrtcdev.log("is screenshareobj extension installed  ? ",e),"not-installed"==e?(shownotification(" Sessions recoridng cannot start as there is not extension installed ","warning"),createExtensionInstallWindow()):"installed-enabled"==e?screenrecordobj.button.id&&document.getElementById(screenrecordobj.button.id)?(webrtcdev.log("Assign Record Button "),assignScreenRecordButton(screenrecordobj)):(webrtcdev.log("Create Record Button "),createScreenRecordButton(screenrecordobj)):"installed-disabled"==extensioninstalled?(shownotification("chrome extension is installed but disabled.","warning"),screenrecordobj.button.id&&document.getElementById(screenrecordobj.button.id)?(assignScreenRecordButton(screenrecordobj),webrtcdev.log("Assign Record Button ")):(webrtcdev.log("Create Record Button "),createScreenRecordButton(screenrecordobj))):"not-chrome"==extensioninstalled||webrtcdev.error(" screen record extension's state is undefined ")}),webrtcdev.log(" screen record widget loaded ")):screenrecordobj&&!screenrecordobj.active&&(screenrecordobj.button.id&&document.getElementById(screenrecordobj.button.id)&&(document.getElementById(screenrecordobj.button.id).className="inactiveButton"),webrtcdev.log(" screen record widget not loaded ")),screenshareobj.active?(detectExtension(screenshareobj.extensionID,function(e){if(webrtcdev.log("is screenshareobj extension installed  ? ",e),"installed-enabled"==e){createOrAssignScreenshareButton(screenshareobj);hideScreenInstallButton()}else if("installed-disabled"==e){shownotification("chrome extension is installed but disabled.");createOrAssignScreenshareButton(screenshareobj);hideScreenInstallButton()}else"not-installed"==e?($("#screensharedialog").modal("show"),hideScreenShareButton(),screenshareobj.button.installButton.id&&document.getElementById(screenshareobj.button.installButton.id)?assignScreenInstallButton(screenshareobj.extensionID):createScreenInstallButton(screenshareobj.extensionID)):"not-chrome"==e?alert(" Screen share extension only works in Chrome for now "):webrtcdev.error(" screen share extension's state is undefined ")}),webrtcdev.log(" screen share widget loaded ")):webrtcdev.log(" screen share widget not loaded "),reconnectobj&&reconnectobj.active?(reconnectobj.button.id&&document.getElementById(reconnectobj.button.id)?(webrtcdev.log("Rconnect Button Assigned"),assignButtonRedial(reconnectobj.button.id)):(webrtcdev.log("Rconnect Button created"),createButtonRedial(reconnectobj)),webrtcdev.log(" reconnect widget loacded ")):reconnectobj&&!reconnectobj.active&&(reconnectobj.button.id&&document.getElementById(reconnectobj.button.id)&&(document.getElementById(reconnectobj.button.id).className="inactiveButton"),webrtcdev.log(" reconnect widget not loaded ")),cursorobj.active&&(document.getElementById("cursor1").setAttribute("style","display:none"),document.getElementById("cursor2").setAttribute("style","display:none")),listeninobj&&listeninobj.active?(listeninobj.button.id&&document.getElementById(listeninobj.button.id),webrtcdev.log(" listen in widget loaded ")):listeninobj&&!listeninobj.active&&(listeninobj.button.id&&document.getElementById(listeninobj.button.id)&&(document.getElementById(listeninobj.button.id).className="inactiveButton"),webrtcdev.log(" listenein widget not loaded ")),timerobj&&timerobj.active?(timeZone(),activateBttons(timerobj),document.getElementById(timerobj.container.id).hidden=!0):timerobj&&!timerobj.active&&timerobj.button.id&&document.getElementById(timerobj.button.id)&&(document.getElementById(timerobj.button.id).className="inactiveButton"),drawCanvasobj&&drawCanvasobj.active?(drawCanvasobj.container&&drawCanvasobj.container.id&&document.getElementById(drawCanvasobj.container.id)&&(document.getElementById(drawCanvasobj.container.id).hidden=!0),drawCanvasobj.button.id&&document.getElementById(drawCanvasobj.button.id)?assigndrawButton(drawCanvasobj):createdrawButton(drawCanvasobj),CanvasDesigner=function(){var t,o={line:!0,pencil:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,rectangle:!0,arc:!0,bezier:!0,quadratic:!0,text:!0},n="pencil";var r=function(e){webrtcdev.log("syncDataListener",e)};function e(){event.data&&event.data.canvasDesignerSyncData&&r(event.data.canvasDesignerSyncData)}var i=window.addEventListener?"addEventListener":"attachEvent";return(0,window[i])("attachEvent"==i?"onmessage":"message",function(e){webrtcdev.log("CanvasDesigner parent received message : ",e.data),e.data.modalpopup?saveButtonCanvas.click():e.data||e.data.canvasDesignerSyncData?r(e.data.canvasDesignerSyncData):e.data&&e.data.canvasDesignerSyncData||webrtcdev.log("parent received unexpected message")},!1),{appendTo:function(e){(t=document.createElement("iframe")).id="drawboard",t.src="widget.html?tools="+JSON.stringify(o)+"&selectedIcon="+n,t.style.width="100%",t.style.height="100%",t.style.border=0,e.appendChild(t)},destroy:function(){t&&t.parentNode.removeChild(t),window.removeEventListener("message",e)},addSyncListener:function(e){r=e},syncData:function(e){t&&t.contentWindow.postMessage({canvasDesignerSyncData:e},"*")},setTools:function(e){o=e},setSelected:function(e){void 0!==o[e]&&(n=e)}}}(),webrtcdev.log(" draw widget loaded ")):drawCanvasobj&&!drawCanvasobj.active&&(drawCanvasobj.button.id&&document.getElementById(drawCanvasobj.button.id)&&(document.getElementById(drawCanvasobj.button.id).className="inactiveButton"),webrtcdev.log(" draw widget not loaded ")),texteditorobj.active&&createTextEditorButton(),codeeditorobj.active&&createCodeEditorButton(),fileshareobj.active?(webrtcdev.log(" fileshareobj - rtcConn ",o),o.enableFileSharing=!0,o.filesContainer=document.getElementById(fileshareobj.fileShareContainer),fileshareobj.button.id&&document.getElementById(fileshareobj.button.id)?assignFileShareButton(fileshareobj):createFileShareButton(fileshareobj),webrtcdev.log(" File sharing widget loaded ")):webrtcdev.log(" File sharing widget not loaded "),statisticsobj&&statisticsobj.active)try{document.getElementById(statisticsobj.statsConainer).innerHTML=""}catch(e){webrtcdev.error(" statisticsobj statsConainer not found",e)}if(helpobj&&helpobj.active)try{document.getElementById(helpobj.helpContainer).innerHTML=""}catch(e){webrtcdev.error(" helpobj helpContainer not found",e)}e("success")})};function updateWebCallView(e){webrtcdev.log("updateWebCallView - start with peerInfo",e," || role is ",role," ||  indexOf ",e.vid.indexOf("videoundefined"));try{switch(role){case"inspector":for(var t,o=0,n=0;n<remoteVideos.length;n++)webrtcdev.log("Remote Video index array ",n," || ",remoteVideos[n],document.getElementsByName(remoteVideos[n]),document.getElementsByName(remoteVideos[n]).src),remoteVideos[n].src&&o++;var r=document.createElement("video");remoteVideos[o]=r,document.getElementById(remoteobj.videoContainer).appendChild(r),t=remoteVideos[o],webrtcdev.log(" [start.js - updateWebCallView] inspector role , attaching stream",t,e.stream),attachMediaStream(t,e.stream),t.hidden&&(removid.hidden=!1),t.id=e.videoContainer,t.className=remoteobj.videoClass,attachControlButtons(t,e),remoteobj.userDisplay&&e.name&&attachUserDetails(t,e),remoteobj.userMetaDisplay&&e.userid&&attachMetaUserDetails(t,e),document.getElementsByName(localVideo)[0].setAttribute("style","display:none"),document.getElementsByName(selfVideo)[0].setAttribute("style","display:none");break;case"user":case"participant":if(-1<e.vid.indexOf("videolocal"))if(webrtcdev.info(" updateWebCallView - PeerInfo Vid is Local"),localVideo&&document.getElementsByName(localVideo)[0]){var i=document.getElementsByName(localVideo)[0];i.muted=!0,i.className=localobj.videoClass,attachMediaStream(i,e.stream),localobj.userDisplay&&e.name&&attachUserDetails(i,e),localobj.userMetaDisplay&&e.userid&&attachMetaUserDetails(i,e),webrtcdev.info(" User is alone in the session  , hiding remote video container","showing users single video conrainer and attaching attachMediaStream and attachUserDetails ")}else alert(" Please Add a video container in config for single"),webrtcdev.error(" No local video conatainer in localobj -> ",localobj);else if(-1<e.vid.indexOf("videoremote")){if(webrtcdev.info(" updateWebCallView - PeerInfo Vid is Remote"),outgoingVideo&&localVideo&&selfVideo){var a=document.getElementsByName(localVideo)[0],s=document.getElementsByName(selfVideo)[0];0==s.played.length?(0<a.played.lebth?reattachMediaStream(s,a):attachMediaStream(s,webcallpeers[0].stream),s.id=webcallpeers[0].videoContainer,s.className=remoteobj.videoClass,s.muted=!0,attachControlButtons(s,webcallpeers[0]),localobj.userDisplay&&webcallpeers[0].name&&attachUserDetails(s,webcallpeers[0]),localobj.userMetaDisplay&&webcallpeers[0].userid&&attachMetaUserDetails(s,webcallpeers[0])):webrtcdev.log(" not uppdating self video as it is already playing "),webrtcdev.info(" User is joined by a remote peer , hiding local video container","showing users conf video container and attaching attachMediaStream and attachUserDetails ")}else outgoingVideo?(alert(" Please Add a video container in config for video call "),webrtcdev.error(" Local video container not defined ")):webrtcdev.error(" Outgoing Local video is ",outgoingVideo);if(remoteVideos){for(o=0,n=0;n<remoteVideos.length;n++)webrtcdev.log("Remote Video index array ",n," || ",remoteVideos[n],document.getElementsByName(remoteVideos[n]),document.getElementsByName(remoteVideos[n]).src),document.getElementsByName(remoteVideos[n])[0]&&document.getElementsByName(remoteVideos[n])[0].src?o++:remoteVideos[n].video&&remoteVideos[n].video&&o++;try{if("unlimited"==remoteobj.maxAllowed){webrtcdev.log("remote video is unlimited , creating video for remoteVideos array ");r=document.createElement("video");remoteVideos[o]={userid:e.userid,video:r},document.getElementById(remoteobj.dynamicVideos.videoContainer).appendChild(r)}else webrtcdev.log("remote video is limited to size maxAllowed , current index ",o),webrtcdev.log("searching for video with index ",o," in remote video : ",document.getElementsByName(remoteVideos[o])[0]),document.getElementsByName(remoteVideos[o])[0]?remoteVideos[o]={userid:e.userid,video:document.getElementsByName(remoteVideos[o])[0]}:webrtcdev.error(" document.getElementsByName(remoteVideos[vi])[0] doest exist for vi ",o);attachMediaStream(remoteVideos[o].video,e.stream),remoteVideos[o].video.hidden&&(remoteVideos[o].video.hidden=!1),remoteVideos[o].video.id=e.videoContainer,remoteVideos[o].video.className=remoteobj.videoClass,attachControlButtons(remoteVideos[o].video,e),remoteobj.userDisplay&&e.name&&attachUserDetails(remoteVideos[o].video,e),remoteobj.userMetaDisplay&&e.userid&&attachMetaUserDetails(remoteVideos[o].video,e)}catch(e){webrtcdev.error(e)}}else alert("remote Video containers not defined")}else webrtcdev.error(" PeerInfo vid didnt match either case ");break;default:webrtcdev.log(" Switch default case")}}catch(e){webrtcdev.error("[ start.js - update call view ]",e)}webrtcdev.log(" updateWebCallView - finish")}var repeatInitilization=null;function startCall(e){webrtcdev.log(" startCall obj",e),webrtcdev.log(" TURN ",turn),e.startwebrtcdev()}function stopCall(){webrtcdev.log(" stopCall "),rtcConn.closeEntireSession(),localStorage.getItem("channel")||localStorage.removeItem("channel"),localStorage.getItem("userid")||localStorage.removeItem("userid"),localStorage.getItem("remoteUsers")||localStorage.removeItem("remoteUsers")}function updatePeerInfo(e,t,o,n,r,i){for(x in webrtcdev.log("updating peerInfo: ",e,t,o,n,r,i),webcallpeers)if(webcallpeers[x].userid==e)return void webrtcdev.log("UserID is already existing , webcallpeers");peerInfo={videoContainer:"video"+e,videoHeight:null,videoClassName:null,userid:e,name:t,color:o,email:n,role:r,controlBarName:"control-video"+e,filearray:[],vid:"video"+i+"_"+e},fileshareobj.active&&("single"==fileshareobj.props.fileShare?peerInfo.fileShare={outerbox:"widget-filesharing-box",container:"widget-filesharing-container",minButton:"widget-filesharing-minbutton",maxButton:"widget-filesharing-maxbutton",closeButton:"widget-filesharing-closebutton"}:peerInfo.fileShare={outerbox:"widget-filesharing-box"+e,container:"widget-filesharing-container"+e,minButton:"widget-filesharing-minbutton"+e,maxButton:"widget-filesharing-maxbutton"+e,closeButton:"widget-filesharing-closebutton"+e},"single"==fileshareobj.props.fileList?peerInfo.fileList={outerbox:"widget-filelisting-box",container:"widget-filelisting-container"}:peerInfo.fileList={outerbox:"widget-filelisting-box"+e,container:"widget-filelisting-container"+e}),webrtcdev.log("updated peerInfo: ",peerInfo),webcallpeers.push(peerInfo)}function removePeerInfo(e){webrtcdev.log(" [removePeerInfo] Before  ",webcallpeers),webrtcdev.log(" [removePeerInfo] Removing peerInfo: ",e),webcallpeers.splice(e,1),webrtcdev.log(" [removePeerInfo] After removing peerInfo",webcallpeers)}function destroyWebCallView(e,t){webrtcdev.log(" [destroyWebCallView] peerInfo",e),e.videoContainer&&document.getElementById(e.videoContainer)&&(document.getElementById(e.videoContainer).src=""),t(!0)}function clearCaches(){localStorage.clear()}findPeerInfo=function(e){for(x in webcallpeers)if(webcallpeers[x].userid==e)return webcallpeers[x];return null},openWebRTC=function(e,t){webrtcdev.info(" [openWebRTC] channel: ",e),socket.emit("open-channel",{channel:e,sender:tempuserid,maxAllowed:remoteobj.maxAllowed}),shownotification(" Making a new session ")},connectWebRTC=function(e,t,o,n){if(webrtcdev.info(" [start ConnectWebRTC ] type : ",e," , Channel :",t," , Userid : ",o," , remote users : ",n),fileshareobj.active){var r=findPeerInfo(o);if("single"==fileshareobj.props.fileShare)createFileSharingDiv(r),document.getElementById(peerInfo.fileShare.outerbox).style.width="100%";else if("divided"==fileshareobj.props.fileShare){for(x in"inspector"!=role?(webrtcdev.log(" [start connectWebRTC] creating local file sharing"),createFileSharingDiv(r)):webrtcdev.log(" [start] Since it is an inspectors own session , not creating local File viewer and list"),webcallpeers)webcallpeers[x].userid!=o&&"inspector"!=webcallpeers[x].role&&(webrtcdev.log(" [start connectWebRTC] creating remote file sharing "),createFileSharingDiv(webcallpeers[x]));requestOldFiles()}else webrtcdev.error("fileshareobj.props.fileShare undefined ");"single"==fileshareobj.props.fileList?document.getElementById(peerInfo.fileList.outerbox).style.width="100%":"single"!=fileshareobj.props.fileShare?webrtcdev.log("No Seprate div created for this peer since fileshare container is single"):webrtcdev.error("fileshareobj.props.fileShare undefined ")}localStorage.getItem("channel")||localStorage.setItem("channel",t),localStorage.getItem("userid")||localStorage.setItem("userid",o),localStorage.getItem("remoteUsers")||localStorage.setItem("remoteUsers",n)},joinWebRTC=function(e,t){shownotification("Joining an existing session "+e),webrtcdev.info(" [joinWebRTC] channel: ",e),null==selfuserid&&(selfuserid=tempuserid),socket.emit("join-channel",{channel:e,sender:selfuserid,extra:{userid:selfuserid,name:selfusername,color:selfcolor,email:selfemail,role:role}})},leaveWebRTC=function(){shownotification("Leaving the session ")},window.onunload=function(){webrtcdev.log(localStorage.getItem("channel")),alert(" Refreshing the Page will loose the session data")},window.addEventListener("message",function(e){webrtcdev.log("------ message from Extension ",e),e.data.type?"screenshare"==e.data.type?onScreenshareExtensionCallback(e):"screenrecord"==e.data.type&&onScreenrecordExtensionCallback(e):"webrtcdev-extension-getsourceId-audio-plus-tab"==e.data?onScreenrecordExtensionCallback(e):onScreenshareExtensionCallback(e)});
"";var socket,webrtcdevDataObj,usersDataObj,channelsFeed=document.getElementById("channelsFeed"),WebRTCdevadmin=function(e){(socket=io.connect(e)).on("response_to_admin_enquire",function(e){switch(e.response){case"channels":if(webrtcdevDataObj=e.channels,"list"==e.format)for(i in clearList("channellistArea"),Object.keys(webrtcdevDataObj))drawList("channellistArea",webrtcdevDataObj[i]);else"table"==e.format?drawTable("webrtcdevTableBody",webrtcdevDataObj):webrtcdev.error("format not specified ");break;case"users":if(usersDataObj=e.users,"list"==e.format)for(i in clearList("userslistArea"),usersDataObj)drawList("userslistArea",usersDataObj[i]);break;case"all":channelsFeed.innerHTML=JSON.stringify(e.channels,null,4);break;default:webrtcdev.log("unrecognizable response from signaller ",e)}})};function onLoadAdmin(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}function clearList(e){$("#"+e).empty()}function drawList(e,n){$("#"+e).append("<li class='list-group-item'>"+n+"</li>")}function drawTable(e,n){for(i in Object.keys(n)){var t=Object.keys(n)[i];drawTableRow(e,i,n[t].channel,n[t].timestamp,n[t].users,n[t].status,n[t].endtimestamp,0)}}function drawTableRow(e,n,t,a,s,i,c,r){var l=$("<tr class='success' />");l.append($("<td>"+n+"</td>")),l.append($("<td>"+t+"</td>")),l.append($("<td>"+a+"</td>")),l.append($("<td>"+JSON.stringify(s,null,4)+"</td>")),l.append($("<td>"+i+"</td>")),l.append($("<td>"+c+"</td>")),l.append($("<td>"+r+"</td>")),$("#"+e).append(l)}function drawUsersTable(e){var n=document.createElement("table");$("#usersRow").append(n);for(var t=0;t<e.length;t++)drawUsersRow(n,data[t])}function drawUsersRow(e){var n=$("<tr />");$("#table").append(n),n.append($("<td>"+e+"</td>"))}$("#channels_list").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}),$("#channelFindBtn").click(function(){socket.emit("admin_enquire",{ask:"channels",find:$("#channelFindInput").val(),format:"list"})}),$("#users_list").click(function(){socket.emit("admin_enquire",{ask:"users",format:"list"})}),$("#channels_table").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"table"})}),$("#channels_json").click(function(){socket.emit("admin_enquire",{ask:"all",format:"json"})}),$("#channel_clients").click(function(){socket.emit("admin_enquire",{ask:"channel_clients",channel:"https172162010780841524489749781952"})});