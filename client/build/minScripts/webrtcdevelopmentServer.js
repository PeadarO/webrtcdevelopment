module.exports=function(e,n){function o(e,n){console.log(" ---------------> onNewNamespace ",e),s.of("/"+e).on("connection",function(e){var o;s.isConnected&&(s.isConnected=!1,e.emit("connect",!0)),e.on("message",function(s){s.sender==n&&(o||(o=s.data.sender),e.broadcast.emit("message",s.data))}),e.on("disconnect",function(){o&&(e.broadcast.emit("user-left",o),o=null)})})}console.log(n),console.log("< ------------------------realtimecomm-------------------> ");var s=require("socket.io").listen(e,{log:!1,origins:"*:*"});s.set("transports",["websocket"]);var c={};return s.sockets.on("connection",function(e){console.log("connection ");var n="";s.isConnected||(s.isConnected=!0),e.on("namespace",function(e){o(e.channel,e.sender)}),e.on("new-channel",function(e){c[e.channel]||(n=e.channel),console.log("------------new channel------------- ",e.channel," by ",e.sender),c[e.channel]={channel:e.channel,timestamp:(new Date).toLocaleString(),users:[e.sender],status:"active",endtimestamp:0}}),e.on("join-channel",function(e){console.log("------------join channel------------- ",e.channel," by ",e.sender),c[e.channel].users.push(e.sender)}),e.on("presence",function(n){var o=!!c[n.channel];console.log("presence for channel ",o),e.emit("presence",o)}),e.on("disconnect",function(e){}),e.on("admin_enquire",function(n){switch(n.ask){case"channels":e.emit("response_to_admin_enquire",{response:"channels",channels:c,format:n.format});break;case"users":var o=[];console.log("Request for users by Admin");for(i in Object.keys(c)){var t=Object.keys(c)[i];for(j in c[t].users)o.push(c[t].users[j])}console.log(o),e.emit("response_to_admin_enquire",{response:"users",users:o,format:n.format});break;case"channel_clients":e.emit("response_to_admin_enquire",s.of("/"+n.channel).clients());break;default:e.emit("response_to_admin_enquire",c)}})}),module};