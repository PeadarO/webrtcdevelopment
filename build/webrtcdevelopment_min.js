var RTCMultiConnection=function(e,t){function n(t,n){function a(e){return!e.audio&&!e.video&&!e.screen&&e.data}function r(e,n){t.peersBackup[e]||(t.peersBackup[e]={userid:e,extra:{}}),t.peersBackup[e].extra=n}function s(e){if(e.remoteUserId==t.userid){if(t.peers[e.sender]&&t.peers[e.sender].extra!=e.message.extra&&(t.peers[e.sender].extra=e.extra,t.onExtraDataUpdated({userid:e.sender,extra:e.extra}),r(e.sender,e.extra)),e.message.streamSyncNeeded&&t.peers[e.sender]){var n=t.streamEvents[e.message.streamid];if(!n||!n.stream)return;var d=e.message.action;if("ended"===d||"inactive"===d||"stream-removed"===d)return t.peersBackup[n.userid]&&(n.extra=t.peersBackup[n.userid].extra),void t.onstreamended(n);var l="both"==e.message.type?null:e.message.type;return void("function"==typeof n.stream[d]&&n.stream[d](l))}if("dropPeerConnection"===e.message)return void t.deletePeer(e.sender);if(e.message.allParticipants)return-1===e.message.allParticipants.indexOf(e.sender)&&e.message.allParticipants.push(e.sender),void e.message.allParticipants.forEach(function(e){c[t.peers[e]?"renegotiatePeer":"createNewPeer"](e,{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||"one-way"===t.direction,isDataOnly:a(t.session)})});if(e.message.newParticipant)return e.message.newParticipant==t.userid?void 0:t.peers[e.message.newParticipant]?void 0:void c.createNewPeer(e.message.newParticipant,e.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||"one-way"===t.direction,isDataOnly:a(t.session)});if(e.message.readyForOffer&&(t.attachStreams.length&&(t.waitingForLocalMedia=!1),t.waitingForLocalMedia))return void setTimeout(function(){s(e)},1);if(e.message.newParticipationRequest&&e.sender!==t.userid){t.peers[e.sender]&&t.deletePeer(e.sender);var m={extra:e.extra||{},localPeerSdpConstraints:e.message.remotePeerSdpConstraints||{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:e.message.localPeerSdpConstraints||{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"==typeof e.message.isOneWay?!!t.session.oneway||"one-way"===t.direction:e.message.isOneWay,isDataOnly:"undefined"==typeof e.message.isDataOnly?a(t.session):e.message.isDataOnly,dontGetRemoteStream:"undefined"==typeof e.message.isOneWay?!!t.session.oneway||"one-way"===t.direction:e.message.isOneWay,dontAttachLocalStream:!!e.message.dontGetRemoteStream,connectionDescription:e,successCallback:function(){}};return void t.onNewParticipant(e.sender,m)}return e.message.changedUUID&&t.peers[e.message.oldUUID]&&(t.peers[e.message.newUUID]=t.peers[e.message.oldUUID],delete t.peers[e.message.oldUUID]),e.message.userLeft?(c.onUserLeft(e.sender),void(!e.message.autoCloseEntireSession||t.leave())):void c.addNegotiatedMessage(e.message,e.sender)}}console.log(" >>>>s  SocketConnection ",t);var d="";d+="?userid="+t.userid,d+="&sessionid="+t.sessionid,d+="&msgEvent="+t.socketMessageEvent,d+="&socketCustomEvent="+t.socketCustomEvent,d+="&autoCloseEntireSession="+!!t.autoCloseEntireSession,!0===t.session.broadcast&&(d+="&oneToMany=true"),d+="&maxParticipantsAllowed="+t.maxParticipantsAllowed,t.enableScalableBroadcast&&(d+="&enableScalableBroadcast=true",d+="&maxRelayLimitPerUser="+(t.maxRelayLimitPerUser||2)),d+="&extra="+JSON.stringify(t.extra||{}),t.socketCustomParameters&&(d+=t.socketCustomParameters);try{io.sockets={}}catch(t){}if(t.socketURL||(console.log(" >>>>s  socket.io url is missing , using / "),t.socketURL="/"),"/"!=t.socketURL.substr(t.socketURL.length-1,1))throw"\"socketURL\" MUST end with a slash.";t.enableLogs&&("/"==t.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",t.socketURL));try{t.socket=io(t.socketURL+d)}catch(n){t.socket=io.connect(t.socketURL+d,t.socketOptions)}var c=t.multiPeersHandler;t.socket.on("extra-data-updated",function(e,n){t.peers[e]&&(t.peers[e].extra=n,t.onExtraDataUpdated({userid:e,extra:n}),r(e,n))}),t.socket.on(t.socketMessageEvent,s);var l=!1;t.socket.resetProps=function(){l=!1},t.socket.on("connect",function(){l||(l=!0,t.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){t.socket.emit("extra-data-updated",t.extra)},1e3),n&&n(t.socket))}),t.socket.on("disconnect",function(e){t.onSocketDisconnect(e)}),t.socket.on("error",function(e){t.onSocketError(e)}),t.socket.on("user-disconnected",function(e){e===t.userid||(t.onUserStatusChanged({userid:e,status:"offline",extra:t.peers[e]?t.peers[e].extra||{}:{}}),t.deletePeer(e))}),t.socket.on("user-connected",function(e){e===t.userid||t.onUserStatusChanged({userid:e,status:"online",extra:t.peers[e]?t.peers[e].extra||{}:{}})}),t.socket.on("closed-entire-session",function(e,n){t.leave(),t.onEntireSessionClosed({sessionid:e,userid:e,extra:n})}),t.socket.on("userid-already-taken",function(e,n){t.onUserIdAlreadyTaken(e,n)}),t.socket.on("logs",function(e){t.enableLogs&&console.debug("server-logs",e)}),t.socket.on("number-of-broadcast-viewers-updated",function(e){t.onNumberOfBroadcastViewersUpdated(e)}),t.socket.on("set-isInitiator-true",function(e){e!=t.sessionid||(t.isInitiator=!0)})}function a(e){function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}var n=this,a=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var t in this)-1==a.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==a.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var n in this)-1==a.indexOf(n)&&n!=e&&t.push(n);return t},forEach:function(t){this.getAllParticipants().forEach(function(n){t(e.peers[n])})},send:function(t,a){var r=this;if(!g(t.size)&&!g(t.type)){if(e.enableFileSharing)return void n.shareFile(t,a);"string"!=typeof t&&(t=JSON.stringify(t))}if("text"!==t.type&&!(t instanceof ArrayBuffer)&&!(t instanceof DataView))return void F.send({text:t,channel:this,connection:e,remoteUserId:a});if("text"===t.type&&(t=JSON.stringify(t)),a){var s=e.peers[a];if(s)return s.channels.length?void s.channels.forEach(function(e){e.send(t)}):(e.peers[a].createDataChannel(),e.renegotiate(a),void setTimeout(function(){r.send(t,a)},3e3))}this.getAllParticipants().forEach(function(n){return r[n].channels.length?void r[n].channels.forEach(function(e){e.send(t)}):(e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){r[n].channels.forEach(function(e){e.send(t)})},3e3))})}},this.uuid=e.userid,this.getLocalConfig=function(a,r,s){return s||(s={}),{streamsToShare:s.streamsToShare||{},rtcMultiConnection:e,connectionDescription:s.connectionDescription,userid:r,localPeerSdpConstraints:s.localPeerSdpConstraints,remotePeerSdpConstraints:s.remotePeerSdpConstraints,dontGetRemoteStream:!!s.dontGetRemoteStream,dontAttachLocalStream:!!s.dontAttachLocalStream,renegotiatingPeer:!!s.renegotiatingPeer,peerRef:s.peerRef,channels:s.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,r)},onLocalCandidate:function(t){t=D.processCandidates(e,t),t&&n.onNegotiationNeeded(t,r)},remoteSdp:a,onDataChannelMessage:function(a){if(!e.fbr&&e.enableFileSharing&&t(),"string"==typeof a||!e.enableFileSharing)return void n.onDataChannelMessage(a,r);var s=this;return a instanceof ArrayBuffer||a instanceof DataView?void e.fbr.convertToObject(a,function(e){s.onDataChannelMessage(e)}):a.readyForNextChunk?void e.fbr.getNextChunk(a,function(t){e.peers[r].channels.forEach(function(e){e.send(t)})},r):a.chunkMissing?void e.fbr.chunkMissing(a):void e.fbr.addChunk(a,function(t){e.peers[r].peer.channel.send(t)})},onDataChannelError:function(e){n.onDataChannelError(e,r)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,r)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,r)},onRemoteStream:function(t){e.peers[r]&&e.peers[r].streams.push(t),n.onGettingRemoteMedia(t,r)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,r)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(r,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(r,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(r),n.disconnectWith(r))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},!e.isInitiator||!e.session.audio||"two-way"!==e.session.audio||n.streamsToShare||(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var a=this.getLocalConfig(null,t,n);e.peers[t]=new T(a)}},this.createAnsweringPeer=function(t,n,a){a=e.setUserPreferences(a||{},n);var r=this.getLocalConfig(t,n,a);e.peers[n]=new T(r)},this.renegotiatePeer=function(t,n,a){if(!e.peers[t])return void(e.enableLogs&&console.error("Peer ("+t+") does not exist. Renegotiation skipped."));n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var r=this.getLocalConfig(a,t,n);e.peers[t]=new T(r)},this.replaceTrack=function(t,n,a){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var r=e.peers[n].peer;return!!r.getSenders&&"function"==typeof r.getSenders&&r.getSenders().length?void r.getSenders().forEach(function(r){a&&"video"===r.track.kind&&(e.peers[n].peer.lastVideoTrack=r.track,r.replaceTrack(t)),a||"audio"!==r.track.kind||(e.peers[n].peer.lastAudioTrack=r.track,r.replaceTrack(t))}):void(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(n))},this.onNegotiationNeeded=function(){},this.addNegotiatedMessage=function(t,a){if(t.type&&t.sdp)return"answer"==t.type&&e.peers[a]&&e.peers[a].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(a,null,t):this.createAnsweringPeer(t,a)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[a]&&e.peers[a].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){e.session=t.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),t.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var r={};e.attachStreams.forEach(function(e){r[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=r,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},a)}t.readyForOffer&&e.onReadyForOffer(a,t.userPreferences)},this.onGettingRemoteMedia=function(){},this.onRemovingRemoteMedia=function(){},this.onGettingLocalMedia=function(){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(n,a){t(),e.fbr.readAsArrayBuffer(n,function(t){var n=e.getAllParticipants();a&&(n=[a]),n.forEach(function(n){e.fbr.getNextChunk(t,function(t){e.peers[n].channels.forEach(function(e){e.send(t)})},n)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15000:e.chunkSize||0})};new L(e);this.onDataChannelMessage=function(t,n){(void 0).receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){return e.peers[n].channels.length?void(e.peers[n].channels=[t]):void(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(){},this.onNegotiationCompleted=function(){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function r(e,t,n){if("undefined"!=typeof CustomEvent){var a=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(a)}}function s(e,t){if(t.stream&&w(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,a){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:a},t))}})}}}function d(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",function(n){n=e.streamEvents[t.streamid],n.session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)},!1),t.stream.addEventListener("unmute",function(n){n=e.streamEvents[t.streamid],n.session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)},!1))}function c(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,a=e.length;n<a;n++)t+=e[n].toString(36);return t}return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}function l(e,t,n){if(!n.autoCreateMediaElement)return void t({});var a=!1;w(e,"video").length||e.isVideo||e.isScreen||(a=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(a=!1);var r=document.createElement(a?"audio":"video");if(r.srcObject=e,r.setAttribute("autoplay",!0),r.setAttribute("playsinline",!0),r.setAttribute("controls",!0),r.setAttribute("muted",!1),r.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var s="ended";"oninactive"in r&&(s="inactive"),r.addEventListener(s,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){s="ended","oninactive"in e&&(s="inactive"),j.onSyncNeeded(e.streamid,s),n.attachStreams.forEach(function(t,a){e.streamid===t.streamid&&delete n.attachStreams[a]});var t=[];n.attachStreams.forEach(function(e){e&&t.push(e)}),n.attachStreams=t;var a=n.streamEvents[e.streamid];if(a)return void n.onstreamended(a);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var d=r.play();if("undefined"!=typeof d){var c=!1;setTimeout(function(){c||(c=!0,t(r))},1e3),d.then(function(){c||(c=!0,t(r))}).catch(function(){c||(c=!0,t(r))})}else t(r)}function m(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function u(e){var t=[];return e.forEach(function(e){e&&t.push(e)}),t}function p(e){return!e.audio&&!e.video&&!e.screen&&e.data}function g(e){return"undefined"==typeof e}function h(e){return"string"==typeof e}function b(e,t){return!(e.session.audio&&"two-way"===e.session.audio)&&(!("Firefox"!==DetectRTC.browser.name||!1===t)||!("Chrome"!==DetectRTC.browser.name||50>DetectRTC.browser.version)&&(!(!0!==typeof t)||!!("undefined"==typeof t&&e.session.audio&&e.session.screen&&!e.session.video)&&(t=!0,!0)))}function w(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function S(){var t=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=new RTCPeerConnection;try{n.addTransceiver("audio"),t=!0}catch(t){}n.close()}catch(n){t=!1}return t&&C()}function C(){var t=!1;try{var n=new RTCPeerConnection({sdpSemantics:"unified-plan"});try{var e=n.getConfiguration();t=!("unified-plan"!=e.sdpSemantics)||"plan-b"!=e.sdpSemantics&&!1}catch(n){t=!1}}catch(n){t=!1}return t}function E(){if("undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}function R(e){var t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return t}function T(e){function t(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"!==t.readyState||t.internalSend(e)},c.channel=t}function n(t){c[t](B.sdpConstraints).then(function(t){"Safari"!==DetectRTC.browser.name&&(t.sdp=a.processSdp(t.sdp)),c.setLocalDescription(t).then(function(){a.trickleIce&&(e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:a?a.extra:{},streamsToShare:b}),a.onSettingLocalDescription(r))},function(e){a.enableLogs&&console.error("setLocalDescription error",e)})},function(e){!a.enableLogs||console.error("sdp-error",e)})}if(navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),!RTCPeerConnection)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";console.log(" ---------- RTCPeerConnection after -------------- ",RTCPeerConnection);var a=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:a.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){a.addStream(e,r.userid)},this.removeStream=function(e){a.removeStream(e,r.userid)};var r=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var s={};B.sdpConstraints=R({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var d=!!e.renegotiatingPeer,c;e.remoteSdp&&(d=!!e.remoteSdp.renegotiatingPeer);var l=[];if(a.attachStreams.forEach(function(e){!e||l.push(e)}),!d){var m="all";!a.candidates.turn&&!a.candidates.relay||a.candidates.stun||a.candidates.reflexive||a.candidates.host||(m="relay");try{var u={iceServers:a.iceServers,iceTransportPolicy:a.iceTransportPolicy||m};"undefined"!=typeof a.iceCandidatePoolSize&&(u.iceCandidatePoolSize=a.iceCandidatePoolSize),"undefined"!=typeof a.bundlePolicy&&(u.bundlePolicy=a.bundlePolicy),"undefined"!=typeof a.rtcpMuxPolicy&&(u.rtcpMuxPolicy=a.rtcpMuxPolicy),!a.sdpSemantics||(u.sdpSemantics=a.sdpSemantics||"unified-plan"),a.iceServers&&a.iceServers.length||(u=null,a.optionalArgument=null),console.log(" ==================== RTCPeerConnection params ",u," connection.optionalArgument ",a.optionalArgument),c=new RTCPeerConnection(u,a.optionalArgument)}catch(t){try{var u={iceServers:a.iceServers};c=new RTCPeerConnection(u)}catch(t){c=new RTCPeerConnection}}}else c=e.peerRef;!c.getRemoteStreams&&c.getReceivers&&(c.getRemoteStreams=function(){var e=new I;return c.getReceivers().forEach(function(t){e.addTrack(t.track)}),[e]}),!c.getLocalStreams&&c.getSenders&&(c.getLocalStreams=function(){var e=new I;return c.getSenders().forEach(function(t){e.addTrack(t.track)}),[e]}),c.onicecandidate=function(t){if(!t.candidate){if(!a.trickleIce){var n=c.localDescription;e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:a?a.extra:{},streamsToShare:b})}return}a.trickleIce&&e.onLocalCandidate({candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex})},l.forEach(function(t){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(t=a.beforeAddingStream(t,r),t&&(c.getLocalStreams().forEach(function(e){t&&e.id==t.id&&(t=null)}),t&&t.getTracks&&t.getTracks().forEach(function(e){try{c.addTrack(e,t)}catch(t){}})))}),c.oniceconnectionstatechange=c.onsignalingstatechange=function(){var t=r.extra;a.peers[r.userid]&&(t=a.peers[r.userid].extra||t),c&&(e.onPeerStateChanged({iceConnectionState:c.iceConnectionState,iceGatheringState:c.iceGatheringState,signalingState:c.signalingState,extra:t,userid:r.userid}),c&&c.iceConnectionState&&-1!==c.iceConnectionState.search(/closed|failed/gi)&&r.streams instanceof Array&&r.streams.forEach(function(e){var t=a.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};a.onstreamended(t)}))};var p={OfferToReceiveAudio:!!l.length,OfferToReceiveVideo:!!l.length};e.localPeerSdpConstraints&&(p=e.localPeerSdpConstraints),B.sdpConstraints=R(p);var g={};c.ontrack=function(t){if(t&&"track"===t.type){if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),g[t.stream.id]&&"Safari"!==DetectRTC.browser.name)return void(t.track&&(t.track.onended=function(){c&&c.onremovestream(t)}));g[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var a=n[t.stream.id];a?(t.stream.isAudio=a.isAudio,t.stream.isVideo=a.isVideo,t.stream.isScreen=a.isScreen):(t.stream.isVideo=!!w(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,s[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach(function(e){e.onended=function(){c&&c.onremovestream(t)}}),t.stream.onremovetrack=function(){c&&c.onremovestream(t)}}},c.onremovestream=function(t){t.stream.streamid=t.stream.id,s[t.stream.id]&&delete s[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof c.removeStream&&(c.removeStream=function(e){e.getTracks().forEach(function(t){c.removeTrack(t,e)})}),this.addRemoteCandidate=function(e){c.addIceCandidate(new U(e))},this.addRemoteSdp=function(e,t){t=t||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=a.processSdp(e.sdp)),c.setRemoteDescription(new M(e)).then(t,function(n){!a.enableLogs||console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()}).catch(function(n){!a.enableLogs||console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()})};var h=!0;e.remoteSdp&&(h=!1),this.createDataChannel=function(){var e=c.createDataChannel("sctp",{});t(e)},!0!==a.session.data||d||(h?this.createDataChannel():c.ondatachannel=function(e){var n=e.channel;t(n)}),this.enableDisableVideoEncoding=function(e){var t;if(c.getSenders().forEach(function(e){t||"video"!==e.track.kind||(t=e)}),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(p=e.remoteSdp.remotePeerSdpConstraints),B.sdpConstraints=R(p),this.addRemoteSdp(e.remoteSdp,function(){n("createAnswer")})),("two-way"==a.session.audio||"two-way"==a.session.video||"two-way"==a.session.screen)&&(B.sdpConstraints=R({OfferToReceiveAudio:"two-way"==a.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==a.session.video||"two-way"==a.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var b={};c.getLocalStreams().forEach(function(e){b[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),h&&n("createOffer"),c.nativeClose=c.close,c.close=function(){if(c){try{c.nativeClose!==c.close&&c.nativeClose()}catch(t){}c=null,r.peer=null}},this.peer=c}function k(e,t){e.mandatory&&e.mandatory.chromeMediaSource?t.isScreen=!0:e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}function A(e){function t(t,a){k(e.localMediaConstraints,t);var r="ended";"oninactive"in t&&(r="inactive"),t.addEventListener(r,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=u(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:t},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&A(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(t,a)}if(!0===currentUserMediaRequest.mutex)return void currentUserMediaRequest.queueRequests.push(e);currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])t(currentUserMediaRequest.streams[n].stream,!0);else{var a=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(a||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||c(),e.idInstance=n,t(e)},function(t){e.onLocalMediaError(t,e.localMediaConstraints)});if("undefined"==typeof navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var r=function(){},s=function(){},d,l;navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),d=stream},function(e){s(e),l=e}),{then:function(e){return d?void e(d):(r=e,{then:function(e){return l?void e(l):void(s=e)}})}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||c(),e.idInstance=n,t(e)}).catch(function(t){e.onLocalMediaError(t,e.localMediaConstraints)});else if(navigator.getDisplayMedia)navigator.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||c(),e.idInstance=n,t(e)}).catch(function(t){e.onLocalMediaError(t,e.localMediaConstraints)});else throw new Error("getDisplayMedia API is not availabe in this browser.");return}console.log("localMediaConstraints : ",e.localMediaConstraints),navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||c(),e.idInstance=n,t(e)}).catch(function(t){e.onLocalMediaError(t,e.localMediaConstraints)})}}function L(t){var n={};return{receive:function(a,r,s){var d=a.uuid;if(n[d]||(n[d]=[]),n[d].push(a.message),a.last){var c=n[d].join("");a.isobject&&(c=JSON.parse(c));var l=new Date().getTime(),m=l-a.sendingTime,u={data:c,userid:r,extra:s,latency:m};t.autoTranslateText?(u.original=u.data,t.Translator.TranslateText(u.data,function(e){u.data=e,t.onmessage(u)})):t.onmessage(u),delete n[d]}}}}(function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},!global.console&&(global.console={}),"undefined"==typeof global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=e.addEventListener=e.removeEventListener=function(){},e.HTMLVideoElement=e.HTMLMediaElement=function(){}),"undefined"==typeof io&&(e.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},("open-room"===e||"join-room"===e)&&n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})("undefined"==typeof global?null:global),"",function(){function e(){var e=u.appVersion,t=u.userAgent,n=u.appName,a=""+parseFloat(u.appVersion),r=parseInt(u.appVersion,10),s,d,c;if(w&&!S&&-1!==t.indexOf("CriOS")&&(w=!1,S=!0),h){n="Opera";try{a=u.userAgent.split("OPR/")[1].split(" ")[0],r=a.split(".")[0]}catch(t){a="0.0.0.0",r=0}}else C?(d=t.indexOf("rv:"),0<d?a=t.substring(d+3):(d=t.indexOf("MSIE"),a=t.substring(d+5)),n="IE"):S?(d=t.indexOf("Chrome"),n="Chrome",a=t.substring(d+7)):w?(d=t.indexOf("Safari"),n="Safari",a=t.substring(d+7),-1!==(d=t.indexOf("Version"))&&(a=t.substring(d+8)),-1!==u.userAgent.indexOf("Version/")&&(a=u.userAgent.split("Version/")[1].split(" ")[0])):b?(d=t.indexOf("Firefox"),n="Firefox",a=t.substring(d+8)):(s=t.lastIndexOf(" ")+1)<(d=t.lastIndexOf("/"))&&(n=t.substring(s,d),a=t.substring(d+1),n.toLowerCase()===n.toUpperCase()&&(n=u.appName));return g&&(n="Edge",a=u.userAgent.split("Edge/")[1]),-1!==(c=a.search(/[; \)]/))&&(a=a.substring(0,c)),r=parseInt(""+a,10),isNaN(r)&&(a=""+parseFloat(u.appVersion),r=parseInt(u.appVersion,10)),{fullVersion:a,version:r,name:n,isPrivateBrowsing:!1}}function t(e,t){var n=0,a=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),t(a)),50<n++&&(window.clearInterval(r),a=!0,t(a))},10)}function n(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&10<=parseInt(n[1],10))}function a(){for(var e="-",t=u.appVersion,n=u.userAgent,a=e,r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0,d;d=r[s];s++)if(d.r.test(n)){a=d.s;break}var c=e;return /Windows/.test(a)&&(/Windows (.*)/.test(a)&&(c=/Windows (.*)/.exec(a)[1]),a="Windows"),"Mac OS X"===a?/Mac OS X (10[\.\_\d]+)/.test(n)&&(c=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]):"Android"===a?/Android ([\.\_\d]+)/.test(n)&&(c=/Android ([\.\_\d]+)/.exec(n)[1]):"iOS"===a?/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(c=/OS (\d+)_(\d+)_?(\d+)?/.exec(t),c=c[1]+"."+c[2]+"."+(0|c[3])):void 0,{osName:a,osVersion:c}}function r(e){e=(e||u.userAgent).toLowerCase();var t=e.match(/android\s([0-9\.]*)/);return!!t&&t[1]}function s(e,t){function n(t){if(!t)return void e();var n=B.exec(t);if(n){var a=n[1],s=t.match(I);void 0===r[a]&&e(a,s,!0),r[a]=!0}}function a(){var e=m.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&n(e)})}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var r={},s=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!s){var d=document.getElementById("iframe");if(!d)return;var c=d.contentWindow;s=c.RTCPeerConnection||c.mozRTCPeerConnection||c.webkitRTCPeerConnection}if(s){var l=null;"Chrome"===W.browser&&58>W.browser.version&&(l={optional:[{RtpDataChannels:!0}]});var m=new s({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},l);if(t&&(m.addStream?m.addStream(t):m.addTrack&&t.getTracks()[0]&&m.addTrack(t.getTracks()[0],t)),m.onicecandidate=function(e){e.candidate&&e.candidate.candidate?n(e.candidate.candidate):n()},!t)try{m.createDataChannel("sctp",{})}catch(t){}W.isPromisesSupported?m.createOffer().then(function(e){m.setLocalDescription(e).then(a)}):m.createOffer(function(e){m.setLocalDescription(e,a,function(){})},function(){})}}}function d(e){if(!P)return void(e&&e());if(!u.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(u.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!u.enumerateDevices&&u.enumerateDevices&&(u.enumerateDevices=u.enumerateDevices.bind(u)),!u.enumerateDevices)return void(e&&e());M=[],U=[],N=[],D=[],j=!1,F=!1,_=!1,H=!1,V=!1;var t={};u.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var a in e)try{"function"!=typeof e[a]&&(n[a]=e[a])}catch(t){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),!n.deviceId&&(n.deviceId=n.id),!n.id&&(n.id=n.deviceId),n.label?("videoinput"===n.kind&&!V&&(V=!0),"audioinput"===n.kind&&!H&&(H=!0)):(n.isCustomLabel=!0,n.label="videoinput"===n.kind?"Camera "+(D.length+1):"audioinput"===n.kind?"Microphone "+(U.length+1):"audiooutput"===n.kind?"Speaker "+(N.length+1):"Please invoke getUserMedia once.","undefined"!=typeof W&&W.browser.isChrome&&46<=W.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(j=!0,-1===U.indexOf(n)&&U.push(n)),"audiooutput"===n.kind&&(F=!0,-1===N.indexOf(n)&&N.push(n)),"videoinput"===n.kind&&(_=!0,-1===D.indexOf(n)&&D.push(n)),M.push(n),t[n.deviceId+n.label+n.kind]=n)}),"undefined"!=typeof W&&(W.MediaDevices=M,W.hasMicrophone=j,W.hasSpeakers=F,W.hasWebcam=_,W.isWebsiteHasWebcamPermissions=V,W.isWebsiteHasMicrophonePermissions=H,W.audioInputDevices=U,W.audioOutputDevices=N,W.videoInputDevices=D),e&&e()})}var c="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",l="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser;if(l){var m=process.versions.node.toString().replace("v","");c="Nodejs/"+m+" (NodeOS) AppleWebKit/"+m+" (KHTML, like Gecko) Nodejs/"+m+" Nodejs/"+m}(function(e){"undefined"!=typeof window||("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:c,getUserMedia:function(){}},e.window=global):"undefined"==typeof window,"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))})("undefined"==typeof global?window:global);var u=window.navigator;"undefined"==typeof u?u={getUserMedia:function(){},userAgent:c}:("undefined"!=typeof u.webkitGetUserMedia&&(u.getUserMedia=u.webkitGetUserMedia),"undefined"!=typeof u.mozGetUserMedia&&(u.getUserMedia=u.mozGetUserMedia));var p=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(u.userAgent||""),g=-1!==u.userAgent.indexOf("Edge")&&(!!u.msSaveOrOpenBlob||!!u.msSaveBlob),h=!!window.opera||0<=u.userAgent.indexOf(" OPR/"),b="undefined"!=typeof window.InstallTrigger,w=/^((?!chrome|android).)*safari/i.test(u.userAgent),S=!!window.chrome&&!h,C="undefined"!=typeof document&&!!document.documentMode&&!g,E={Android:function(){return u.userAgent.match(/Android/i)},BlackBerry:function(){return u.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return u.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return u.userAgent.match(/Opera Mini/i)},Windows:function(){return u.userAgent.match(/IEMobile/i)},any:function(){return E.Android()||E.BlackBerry()||E.iOS()||E.Opera()||E.Windows()},getOsName:function(){var e="Unknown OS";return E.Android()&&(e="Android"),E.BlackBerry()&&(e="BlackBerry"),E.iOS()&&(e="iOS"),E.Opera()&&(e="Opera Mini"),E.Windows()&&(e="Windows"),e}},R="Unknown OS",T="Unknown OS Version",k=a();k&&k.osName&&"-"!=k.osName?(R=k.osName,T=k.osVersion):E.any()&&(R=E.getOsName(),"Android"==R&&(T=r()));var l="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===R&&l&&(R="Nodejs",T=process.versions.node.toString().replace("v",""));var A=!1,L=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"==typeof document||"function"!=typeof document.createElement||(!A&&e in document.createElement("canvas")&&(A=!0),!L&&e in document.createElement("video")&&(L=!0))});var I=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,B=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,M=[],U=[],N=[],D=[];u.mediaDevices&&u.mediaDevices.enumerateDevices&&(u.enumerateDevices=function(e){var t=u.mediaDevices.enumerateDevices();t&&t.then?u.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var P=!1;"undefined"!=typeof O&&"getSources"in O?P=!0:u.mediaDevices&&!!u.mediaDevices.enumerateDevices&&(P=!0);var j=!1,F=!1,_=!1,H=!1,V=!1,W=window.DetectRTC||{};W.browser=e(),function(e){var a;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){a=!1},function(){a=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var r;try{r=window.indexedDB.open("test"),r.onerror=function(){return!0}}catch(t){a=!0}"undefined"==typeof a&&t(function(){return"done"===r.readyState},function(e){e||(a=!r.result)})}else if(n(window.navigator.userAgent)){a=!1;try{window.indexedDB||(a=!0)}catch(t){a=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(t){a=!0}"undefined"==typeof a&&(a=!1,window.localStorage.removeItem("test"))}}catch(t){a=!1}t(function(){return"undefined"!=typeof a},function(){e(a)})}(function(e){W.browser.isPrivateBrowsing=!!e}),W.browser["is"+W.browser.name]=!0,W.osName=R,W.osVersion=T;var z="object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],G=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){G||e in window&&(G=!0)}),W.isWebRTCSupported=G,W.isORTCSupported="undefined"!=typeof RTCIceGatherer;var q=!1;if(W.browser.isChrome&&35<=W.browser.version?q=!0:W.browser.isFirefox&&34<=W.browser.version?q=!0:W.browser.isEdge&&17<=W.browser.version?q=!0:"Android"===W.osName&&W.browser.isChrome&&(q=!0),!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var Y="undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g);Y&&(W.browser.isChrome||W.browser.isEdge||W.browser.isOpera)?q=!1:W.browser.isFirefox&&(q=!1)}W.isScreenCapturingSupported=q;var J={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){J.isSupported||e in window&&(J.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(J.isCreateMediaStreamSourceSupported=!0))}),W.isAudioContextSupported=J.isSupported,W.isCreateMediaStreamSourceSupported=J.isCreateMediaStreamSourceSupported;var Z=!1;W.browser.isChrome&&31<W.browser.version&&(Z=!0),W.isRtpDataChannelsSupported=Z;var K=!1;W.browser.isFirefox&&28<W.browser.version?K=!0:W.browser.isChrome&&25<W.browser.version?K=!0:W.browser.isOpera&&11<=W.browser.version&&(K=!0),W.isSctpDataChannelsSupported=K,W.isMobileDevice=p;var X=!1;u.getUserMedia?X=!0:u.mediaDevices&&u.mediaDevices.getUserMedia&&(X=!0),W.browser.isChrome&&46<=W.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(X="Requires HTTPs"),"Nodejs"===W.osName&&(X=!1),W.isGetUserMediaSupported=X,W.isCanvasSupportsStreamCapturing=A,W.isVideoSupportsStreamCapturing=L,"Chrome"==W.browser.name&&53<=W.browser.version&&(!W.isCanvasSupportsStreamCapturing&&(W.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),!W.isVideoSupportsStreamCapturing&&(W.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),W.DetectLocalIPAddress=function(e,t){if(W.isWebRTCSupported){var n=!0,a=!0;s(function(t){t?t.match(I)?(n=!1,e("Local: "+t,n,a)):t.match(/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/)?(a=!1,e("Public: "+t,n,a)):e("Public: "+t,n,a):e()},t)}},W.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,W.isWebSocketsBlocked=!W.isWebSocketsSupported,"Nodejs"===W.osName&&(W.isWebSocketsSupported=!0,W.isWebSocketsBlocked=!1),W.checkWebSocketsSupport=function(t){t=t||function(){};try{var n=new WebSocket("wss://echo.websocket.org:443/"),a;n.onopen=function(){W.isWebSocketsBlocked=!1,a=new Date().getTime(),n.send("ping")},n.onmessage=function(){W.WebsocketLatency=new Date().getTime()-a+"ms",t(),n.close(),n=null},n.onerror=function(){W.isWebSocketsBlocked=!0,t()}}catch(n){W.isWebSocketsBlocked=!0,t()}},W.load=function(e){e=e||function(){},d(e)},"function"==typeof d,W.MediaDevices="undefined"==typeof M?[]:M,W.hasMicrophone=j,W.hasSpeakers=F,W.hasWebcam=_,W.isWebsiteHasWebcamPermissions=V,W.isWebsiteHasMicrophonePermissions=H,W.audioInputDevices=U,W.audioOutputDevices=N,W.videoInputDevices=D;var Q=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(Q=!0),W.isSetSinkIdSupported=Q;var ee=!1;W.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(ee=!0):W.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(ee=!0),W.isRTPSenderReplaceTracksSupported=ee;var te=!1;W.browser.isFirefox&&38<W.browser.version&&(te=!0),W.isRemoteStreamProcessingSupported=te;var ne=!1;"undefined"!=typeof O&&"applyConstraints"in O.prototype&&(ne=!0),W.isApplyConstraintsSupported=ne;var ie=!1;W.browser.isFirefox&&43<=W.browser.version&&(ie=!0),W.isMultiMonitorScreenCapturingSupported=ie,W.isPromisesSupported=!!("Promise"in window),W.version="1.3.9","undefined"==typeof W&&(window.DetectRTC={});var ae=window.MediaStream;"undefined"==typeof ae&&"undefined"!=typeof webkitMediaStream&&(ae=webkitMediaStream),W.MediaStream="undefined"!=typeof ae&&"function"==typeof ae&&Object.keys(ae.prototype),W.MediaStreamTrack="undefined"!=typeof O&&Object.keys(O.prototype);var re=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;W.RTCPeerConnection="undefined"!=typeof re&&Object.keys(re.prototype),window.DetectRTC=W,"undefined"!=typeof module&&(module.exports=W),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return W})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,a){e.addEventListener(t,n,a)};var I=window.MediaStream;"undefined"==typeof I&&"undefined"!=typeof webkitMediaStream&&(I=webkitMediaStream),"undefined"==typeof I||"stop"in I.prototype||(I.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",E,!1),E();var B={},M=window.RTCSessionDescription||window.mozRTCSessionDescription,U=window.RTCIceCandidate||window.mozRTCIceCandidate,O=window.MediaStreamTrack,N=function(){function e(e,a){var r=n(e);return r.videoCodecNumbers?"vp8"===a&&r.vp8LineNumber===r.videoCodecNumbers[0]?e:"vp9"===a&&r.vp9LineNumber===r.videoCodecNumbers[0]?e:"h264"===a&&r.h264LineNumber===r.videoCodecNumbers[0]?e:(e=t(e,a,r),e):e}function t(e,t,n,a){var r="";if("vp8"===t){if(!n.vp8LineNumber)return e;r=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;r=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;r=n.h264LineNumber}var s=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",d=[r];return a&&(d=[]),n.videoCodecNumbers.forEach(function(e){e===r||d.push(e)}),s+=d.join(" "),e=e.replace(n.videoCodecNumbersOriginal,s),e}function n(e){var t={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(n){n=n.trim(),n&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),t}function a(e,t,n){return t?"undefined"!=typeof isFirefox&&isFirefox?e:(n&&(t.screen?300>t.screen&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&n&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n")),e):e}function r(e,t,n){return s(e,0,-1,t,n)}function s(e,t,n,a,r){for(var s=-1===n?e.length:n,d=t;d<s;++d)if(0===e[d].indexOf(a)&&(!r||-1!==e[d].toLowerCase().indexOf(r.toLowerCase())))return d;return null}function d(e){var t=e.match(/a=rtpmap:(\d+) \w+\/\d+/);return t&&2===t.length?t[1]:null}function c(e,t){t=t||{};var n=t.min,a=t.max,s=e.split("\r\n"),c=r(s,"a=rtpmap","VP8/90000"),l;if(c&&(l=d(s[c])),!l)return e;var m=r(s,"a=rtpmap","rtx/90000"),u;if(m&&(u=d(s[m])),!m)return e;var p=r(s,"a=fmtp:"+u.toString());if(null!==p){var g="\r\n";g+="a=fmtp:"+l+" x-google-min-bitrate="+(n||"228")+"; x-google-max-bitrate="+(a||"228"),s[p]=s[p].concat(g),e=s.join("\r\n")}return e}function l(e,t){t=t||{};var n=e.split("\r\n"),a=r(n,"a=rtpmap","opus/48000"),s;if(a&&(s=d(n[a])),!s)return e;var c=r(n,"a=fmtp:"+s.toString());if(null===c)return e;var l="";return l+="; stereo="+("undefined"==typeof t.stereo?"1":t.stereo),l+="; sprop-stereo="+("undefined"==typeof t["sprop-stereo"]?"1":t["sprop-stereo"]),"undefined"!=typeof t.maxaveragebitrate&&(l+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),"undefined"!=typeof t.maxplaybackrate&&(l+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),"undefined"!=typeof t.cbr&&(l+="; cbr="+("undefined"==typeof t.cbr?"1":t.cbr)),"undefined"!=typeof t.useinbandfec&&(l+="; useinbandfec="+t.useinbandfec),"undefined"!=typeof t.usedtx&&(l+="; usedtx="+t.usedtx),"undefined"!=typeof t.maxptime&&(l+="\r\na=maxptime:"+t.maxptime),n[c]=n[c].concat(l),e=n.join("\r\n"),e}return{removeVPX:function(e){var a=n(e);return e=t(e,"vp9",a,!0),e=t(e,"vp8",a,!0),e},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n"),e},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach(function(t){for(var n=t.getParameters(),a=0;a<n.codecs.length;a++)if(n.codecs[a].mimeType==e){n.codecs.unshift(n.codecs.splice(a,1));break}t.setParameters(n)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return a(e,t,n)},setVideoBitrates:function(e,t){return c(e,t)},setOpusAttributes:function(e,t){return l(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,a=0;a<t.length;a++)if(-1!==t[a].search("opus/48000")){var r=extractSdp(t[a],/:(\d+) opus\/48000/i);break}for(var a=0;a<t.length;a++)if(-1!==t[a].search("a=fmtp")){var s=extractSdp(t[a],/a=fmtp:(\d+)/);if(s===r){n=a;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"),e)}}}();window.BandwidthHandler=N;var D=function(){return{processCandidates:function(e,t){var n=t.candidate,a=e.candidates,r=a.stun,s=a.turn;if((g(a.reflexive)||(r=a.reflexive),g(a.relay)||(s=a.relay),a.host||!n.match(/typ host/g))&&(s||!n.match(/typ relay/g))&&(r||!n.match(/typ srflx/g))){var d=e.iceProtocols;if(d.udp||!n.match(/ udp /g))return d.tcp||!n.match(/ tcp /g)?(e.enableLogs&&console.debug("Your candidate pairs:",n),{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}):void 0}}}}(),P=function(){return{getIceServers:function(){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){t=t.stream;var n=t.currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=u(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var j=function(){function e(e){return e?"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0:void 0}function t(t,a,s){function d(){if(s.streamEvents[t.streamid].mediaElement){var a=s.streamEvents[t.streamid].mediaElement;a.volume=0,n(200,5,function(){try{a.volume+=.2}catch(t){a.volume=1}})}}if(t&&t.addEventListener){if("undefined"==typeof a||!0==a){var c="ended";"oninactive"in t&&(c="inactive"),t.addEventListener(c,function(){j.onSyncNeeded(this.streamid,c)},!1)}t.mute=function(n,d){n=e(n),"undefined"!=typeof d&&(a=d),("undefined"==typeof n||"audio"==n)&&w(t,"audio").forEach(function(e){e.enabled=!1,s.streamEvents[t.streamid].isAudioMuted=!0}),("undefined"==typeof n||"video"==n)&&w(t,"video").forEach(function(e){e.enabled=!1}),("undefined"==typeof a||!0==a)&&j.onSyncNeeded(t.streamid,"mute",n),s.streamEvents[t.streamid].muteType=n||"both",r(t,"mute",n)},t.unmute=function(n,c){n=e(n),"undefined"!=typeof c&&(a=c),d(),("undefined"==typeof n||"audio"==n)&&w(t,"audio").forEach(function(e){e.enabled=!0,s.streamEvents[t.streamid].isAudioMuted=!1}),("undefined"==typeof n||"video"==n)&&(w(t,"video").forEach(function(e){e.enabled=!0}),"undefined"!=typeof n&&"video"==n&&s.streamEvents[t.streamid].isAudioMuted&&function e(n){n||(n=0),n++,100>n&&s.streamEvents[t.streamid].isAudioMuted&&(t.mute("audio"),setTimeout(function(){e(n)},50))}()),("undefined"==typeof a||!0==a)&&j.onSyncNeeded(t.streamid,"unmute",n),s.streamEvents[t.streamid].unmuteType=n||"both",r(t,"unmute",n)}}}function n(e,t,a,r){r=(r||0)+1;r>=t||setTimeout(function(){a(),n(e,t,a,r)},e)}return{setHandlers:t,onSyncNeeded:function(){}}}(),F={send:function(e){function t(e,s){var c={type:"text",uuid:u,sendingTime:p};e&&(s=e,c.packets=parseInt(s.length/d)),s.length>d?c.message=s.slice(0,d):(c.message=s,c.last=!0,c.isobject=m),a.send(c,r),l=s.slice(c.message.length),l.length&&setTimeout(function(){t(null,l)},n.chunkInterval||100)}var n=e.connection,a=e.channel,r=e.remoteUserId,s=e.text,d=n.chunkSize||1e3,l="",m=!1;h(s)||(m=!0,s=JSON.stringify(s));var u=c(),p=new Date().getTime();t(s)}},_=function(){return{handle:function(e){function t(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}var n={};e.onFileStart=function(t){var a=document.createElement("div");return a.title=t.name,a.innerHTML="<label>0%</label> <progress></progress>",t.remoteUserId&&(a.innerHTML+=" (Sharing with:"+t.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(a,e.filesContainer.firstChild),t.remoteUserId?void(!n[t.uuid]&&(n[t.uuid]={}),n[t.uuid][t.remoteUserId]={div:a,progress:a.querySelector("progress"),label:a.querySelector("label")},n[t.uuid][t.remoteUserId].progress.max=t.maxChunks):(n[t.uuid]={div:a,progress:a.querySelector("progress"),label:a.querySelector("label")},void(n[t.uuid].progress.max=t.maxChunks))},e.onFileProgress=function(e){var a=n[e.uuid];!a||e.remoteUserId&&(a=n[e.uuid][e.remoteUserId],!a)||(a.progress.value=e.currentPosition||e.maxChunks||a.progress.max,t(a.progress,a.label))},e.onFileEnd=function(e){var t=n[e.uuid];if(!t)return void console.error("No such progress-helper element exist.",e);if(!(e.remoteUserId&&(t=n[e.uuid][e.remoteUserId],!t))){var a=t.div;a.innerHTML=-1==e.type.indexOf("image")?"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><iframe src=\""+e.url+"\" title=\""+e.name+"\" style=\"width: 80%;border: 0;height: inherit;margin-top:1em;\"></iframe>":"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><img src=\""+e.url+"\" title=\""+e.name+"\" style=\"max-width: 80%;\">"}}}}}(),H=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var a=document.createElement("script");a.type="text/javascript";var r=encodeURIComponent(t),s="method"+e.token();window[s]=function(e){return e.data&&e.data.translations[0]&&n?void n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\""):e.error?void console.error(e.error.message):void console.error(e)};var d="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+s+"&q="+r;a.src=d,document.getElementsByTagName("head")[0].appendChild(a)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\"");if(e.error)return void console.error(e.error.message);console.error(e)}};var a="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",a,!0),n.send(null)}}}}}();(function(r){function u(e){if(r.socketAutoReConnect=!0,r.socket)return void(e&&e(r.socket));if("undefined"==typeof n)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else if("undefined"!=typeof PubNubConnection)window.SocketConnection=PubNubConnection;else throw"SocketConnection.js seems missed.";new n(r,function(){e&&e(r.socket)})}function g(e,t){r.socket.emit("join-room",{sessionid:r.sessionid,session:r.session,mediaConstraints:r.mediaConstraints,sdpConstraints:r.sdpConstraints,streams:C(),extra:r.extra,password:"undefined"!=typeof r.password&&"object"!=typeof r.password?r.password:""},function(n,a){if(!0===n){if(r.enableLogs&&console.log("isRoomJoined: ",n," roomid: ",r.sessionid),!!r.peers[r.sessionid])return;k.onNegotiationNeeded(e)}!1===n&&(r.enableLogs&&console.warn("isRoomJoined: ",a," roomid: ",r.sessionid),!1),t(n,r.sessionid,a)})}function h(e){r.enableLogs&&console.log("Sending open-room signal to socket.io"),r.waitingForLocalMedia=!1,r.socket.emit("open-room",{sessionid:r.sessionid,session:r.session,mediaConstraints:r.mediaConstraints,sdpConstraints:r.sdpConstraints,streams:C(),extra:r.extra,identifier:r.publicRoomIdentifier,password:"undefined"!=typeof r.password&&"object"!=typeof r.password?r.password:""},function(t,n){!0===t&&(r.enableLogs&&console.log("isRoomOpened: ",t," roomid: ",r.sessionid),e(t,r.sessionid)),!1===t&&(r.enableLogs&&console.warn("isRoomOpened: ",n," roomid: ",r.sessionid),e(t,r.sessionid,n))})}function C(){try{return r.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(t){return[]}}function E(e,t){if(r.dontCaptureUserMedia||e.isDataOnly)return void t();var n={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(n.audio=r.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(n.video=r.mediaConstraints.video);var a=e.session||r.session;return a.oneway&&"two-way"!==a.audio&&"two-way"!==a.video&&"two-way"!==a.screen?void t():void(a.oneway&&a.audio&&"two-way"===a.audio&&(a={audio:!0}),(a.audio||a.video||a.screen)&&(a.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:b(r)}).then(function(e){e.isScreen=!0,k.onGettingLocalMedia(e),(a.audio||a.video)&&!b(r)?r.invokeGetUserMedia(null,t):t(e)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):r.invokeGetUserMedia({audio:b(r),video:!0,isScreen:!0},(a.audio||a.video)&&!b(r)?r.invokeGetUserMedia(null,t):t):(a.audio||a.video)&&r.invokeGetUserMedia(null,t,a)))}function R(e,t){return e?void(t.audio&&w(e,"audio").forEach(function(e){e.applyConstraints(t.audio)}),t.video&&w(e,"video").forEach(function(e){e.applyConstraints(t.video)})):void(!r.enableLogs||console.error("No stream to applyConstraints."))}function T(e,t,n){return t?void k.replaceTrack(e,t,n):void r.peers.getAllParticipants().forEach(function(t){k.replaceTrack(e,t,n)})}t=t||{useDefaultDevices:!0},r.channel=r.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"",r.socketURL=r.socketURL||"/",console.log(" >>>> connection channel ",r.channel);var k=new a(r),L={};k.onGettingLocalMedia=function(e,t){if(t=t||function(){},L[e.streamid])return void t();L[e.streamid]=!0;try{e.type="local"}catch(t){}r.setStreamEndHandler(e),l(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,-1===r.attachStreams.indexOf(e)&&r.attachStreams.push(e),"undefined"!=typeof j&&j.setHandlers(e,!0,r),r.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:r.userid,extra:r.extra,streamid:e.streamid,isAudioMuted:!0};try{s(r,r.streamEvents[e.streamid]),d(r,r.streamEvents[e.streamid]),r.onstream(r.streamEvents[e.streamid])}catch(t){}t()},r)},k.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(t){}r.setStreamEndHandler(e,"remote-stream"),l(e,function(n){n.id=e.streamid,"undefined"!=typeof j&&j.setHandlers(e,!1,r),r.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:r.peers[t]?r.peers[t].extra:{},mediaElement:n,streamid:e.streamid},d(r,r.streamEvents[e.streamid]),r.onstream(r.streamEvents[e.streamid])},r)},k.onRemovingRemoteMedia=function(e,t){var n=r.streamEvents[e.streamid];n||(n={stream:e,type:"remote",userid:t,extra:r.peers[t]?r.peers[t].extra:{},streamid:e.streamid,mediaElement:r.streamEvents[e.streamid]?r.streamEvents[e.streamid].mediaElement:null}),r.peersBackup[n.userid]&&(n.extra=r.peersBackup[n.userid].extra),r.onstreamended(n),delete r.streamEvents[e.streamid]},k.onNegotiationNeeded=function(e,t,n){n=n||function(){},t=t||e.remoteUserId,e=e||"";var a={remoteUserId:t,message:e,sender:r.userid};e.remoteUserId&&e.message&&e.sender&&(a=e),u(function(){r.socket.emit(r.socketMessageEvent,a,n)})},k.onUserLeft=function(e){r.deletePeer(e)},k.disconnectWith=function(e,t){r.socket&&r.socket.emit("disconnect-with",e,t||function(){}),r.deletePeer(e)},r.socketOptions={transport:"polling"},r.openOrJoin=function(e,t){t=t||function(){},r.checkPresence(e,function(e,n){if(e){r.sessionid=n;var a=!1,s=!1,d=!!r.session.oneway,c=p(r.session);s={OfferToReceiveAudio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.sdpConstraints.mandatory.OfferToReceiveVideo},a={OfferToReceiveAudio:d?!!r.session.audio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:d?!!r.session.video||!!r.session.screen:r.sdpConstraints.mandatory.OfferToReceiveVideo};var l={remoteUserId:r.sessionid,message:{newParticipationRequest:!0,isOneWay:d,isDataOnly:c,localPeerSdpConstraints:a,remotePeerSdpConstraints:s},sender:r.userid};return void E(l.message,function(){g(l,t)})}return r.waitingForLocalMedia=!0,r.isInitiator=!0,r.sessionid=n||r.sessionid,p(r.session)?void h(t):void r.captureUserMedia(function(){h(t)})})},r.waitingForLocalMedia=!1,r.open=function(e,t){t=t||function(){},r.waitingForLocalMedia=!0,r.isInitiator=!0,r.sessionid=e||r.sessionid,u(function(){return p(r.session)?void h(t):void r.captureUserMedia(function(){h(t)})})},r.peersBackup={},r.deletePeer=function(e){if(e&&r.peers[e]){var t={userid:e,extra:r.peers[e]?r.peers[e].extra:{}};if(r.peersBackup[t.userid]&&(t.extra=r.peersBackup[t.userid].extra),r.onleave(t),!!r.peers[e]){r.peers[e].streams.forEach(function(e){e.stop()});var n=r.peers[e].peer;if(n&&"closed"!==n.iceConnectionState)try{n.close()}catch(t){}r.peers[e]&&(r.peers[e].peer=null,delete r.peers[e])}}},r.rejoin=function(e){if(!r.isInitiator&&e&&Object.keys(e).length){var t={};r.peers[e.remoteUserId]&&(t=r.peers[e.remoteUserId].extra,r.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(r.join(e.remoteUserId),r.onReConnecting({userid:e.remoteUserId,extra:t}))}},r.join=function(e,t){r.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||r.sessionid,r.sessionid+="";var n=!1,a=!1,s=!1,d=!1;if(e&&e.session||!e||"string"==typeof e){var c=e?e.session||r.session:r.session;s=!!c.oneway,d=p(c),a={OfferToReceiveAudio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r.sdpConstraints.mandatory.OfferToReceiveVideo},n={OfferToReceiveAudio:s?!!r.session.audio:r.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!r.session.video||!!r.session.screen:r.sdpConstraints.mandatory.OfferToReceiveVideo}}t=t||{};var l=function(){};"function"==typeof t&&(l=t,t={}),"undefined"!=typeof t.localPeerSdpConstraints&&(n=t.localPeerSdpConstraints),"undefined"!=typeof t.remotePeerSdpConstraints&&(a=t.remotePeerSdpConstraints),"undefined"!=typeof t.isOneWay&&(s=t.isOneWay),"undefined"!=typeof t.isDataOnly&&(d=t.isDataOnly);var m={remoteUserId:r.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:d,localPeerSdpConstraints:n,remotePeerSdpConstraints:a},sender:r.userid};return E(m.message,function(){u(function(){g(m,l)})}),m},r.publicRoomIdentifier="",r.getUserMedia=r.captureUserMedia=function(e,t){e=e||function(){};var n=t||r.session;return r.dontCaptureUserMedia||p(n)?void e():void((n.audio||n.video||n.screen)&&(n.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:b(r)}).then(function(a){if(a.isScreen=!0,k.onGettingLocalMedia(a),(n.audio||n.video)&&!b(r)){var d={};for(var c in n)"screen"!=c&&(d[c]=n[c]);return void r.invokeGetUserMedia(t,e,d)}e(a)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):r.invokeGetUserMedia({audio:b(r),video:!0,isScreen:!0},function(a){if((n.audio||n.video)&&!b(r)){var d={};for(var c in n)"screen"!=c&&(d[c]=n[c]);return void r.invokeGetUserMedia(t,e,d)}e(a)}):(n.audio||n.video)&&r.invokeGetUserMedia(t,e,n)))},r.onbeforeunload=function(e,t){r.closeBeforeUnload&&(r.peers.getAllParticipants().forEach(function(e){k.onNegotiationNeeded({userLeft:!0},e),r.peers[e]&&r.peers[e].peer&&r.peers[e].peer.close(),delete r.peers[e]}),!t&&r.closeSocket(),r.isInitiator=!1)},window.ignoreBeforeUnload?r.closeBeforeUnload=!1:(r.closeBeforeUnload=!0,window.addEventListener("beforeunload",r.onbeforeunload,!1)),r.userid=c(),r.changeUserId=function(e,t){t=t||function(){},r.userid=e||c(),r.socket.emit("changed-uuid",r.userid,t)},r.extra={},r.attachStreams=[],r.session={audio:!0,video:!0},r.enableFileSharing=!1,r.bandwidth={screen:!1,audio:!1,video:!1},r.codecs={audio:"opus",video:"VP9"},r.processSdp=function(e){return S()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===r.codecs.video.toUpperCase()&&(e=N.preferCodec(e,"vp8")),"VP9"===r.codecs.video.toUpperCase()&&(e=N.preferCodec(e,"vp9")),"H264"===r.codecs.video.toUpperCase()&&(e=N.preferCodec(e,"h264")),"G722"===r.codecs.audio&&(e=N.removeNonG722(e)),"Firefox"===DetectRTC.browser.name)?e:((r.bandwidth.video||r.bandwidth.screen)&&(e=N.setApplicationSpecificBandwidth(e,r.bandwidth,!!r.session.screen)),r.bandwidth.video&&(e=N.setVideoBitrates(e,{min:1024*(8*r.bandwidth.video),max:1024*(8*r.bandwidth.video)})),r.bandwidth.audio&&(e=N.setOpusAttributes(e,{maxaveragebitrate:1024*(8*r.bandwidth.audio),maxplaybackrate:1024*(8*r.bandwidth.audio),stereo:1,maxptime:3})),e)},"undefined"!=typeof N&&(r.BandwidthHandler=r.CodecsHandler=N),r.mediaConstraints={audio:{mandatory:{},optional:r.bandwidth.audio?[{bandwidth:1024*(8*r.bandwidth.audio)||1048576}]:[]},video:{mandatory:{},optional:r.bandwidth.video?[{bandwidth:1024*(8*r.bandwidth.video)||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(r.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,t;if(DetectRTC.MediaDevices.forEach(function(n){"audioinput"===n.kind&&!1!==r.mediaConstraints.audio&&(e=n),"videoinput"===n.kind&&!1!==r.mediaConstraints.video&&(t=n)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0===r.mediaConstraints.audio?r.mediaConstraints.audio={deviceId:e.id}:r.mediaConstraints.audio.deviceId=e.id);!0==r.mediaConstraints.audio&&(r.mediaConstraints.audio={mandatory:{},optional:[]}),r.mediaConstraints.audio.optional||(r.mediaConstraints.audio.optional=[]);var n=[{sourceId:e.id}];r.mediaConstraints.audio.optional=n.concat(r.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0===r.mediaConstraints.video?r.mediaConstraints.video={deviceId:t.id}:r.mediaConstraints.video.deviceId=t.id);!0==r.mediaConstraints.video&&(r.mediaConstraints.video={mandatory:{},optional:[]}),r.mediaConstraints.video.optional||(r.mediaConstraints.video.optional=[]);var n=[{sourceId:t.id}];r.mediaConstraints.video.optional=n.concat(r.mediaConstraints.video.optional)}}),r.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},r.sdpSemantics=null,r.iceCandidatePoolSize=null,r.bundlePolicy=null,r.rtcpMuxPolicy=null,r.iceTransportPolicy=null,r.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},r.iceServers=P.getIceServers(r),r.candidates={host:!0,stun:!0,turn:!0},r.iceProtocols={tcp:!0,udp:!0},r.onopen=function(e){!r.enableLogs||console.info("Data connection has been opened between you & ",e.userid)},r.onclose=function(e){!r.enableLogs||console.warn("Data connection has been closed between you & ",e.userid)},r.onerror=function(e){!r.enableLogs||console.error(e.userid,"data-error",e)},r.onmessage=function(e){!r.enableLogs||console.debug("data-message",e.userid,e.data)},r.send=function(e,t){r.peers.send(e,t)},r.close=r.disconnect=r.leave=function(){r.onbeforeunload(!1,!0)},r.closeEntireSession=function(e){e=e||function(){},r.socket.emit("close-entire-session",function t(){return r.getAllParticipants().length?void setTimeout(t,100):void(r.onEntireSessionClosed({sessionid:r.sessionid,userid:r.userid,extra:r.extra}),r.changeUserId(null,function(){r.close(),e()}))})},r.onEntireSessionClosed=function(e){r.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},r.onstream=function(t){var e=r.videosContainer;e.insertBefore(t.mediaElement,e.firstChild);var n=t.mediaElement.play();return"undefined"==typeof n?void setTimeout(function(){t.mediaElement.play()},2e3):void n.catch(function(){}).then(function(){setTimeout(function(){t.mediaElement.play()},2e3)})},r.onstreamended=function(t){t.mediaElement||(t.mediaElement=document.getElementById(t.streamid)),t.mediaElement&&t.mediaElement.parentNode&&t.mediaElement.parentNode.removeChild(t.mediaElement)},r.direction="many-to-many",r.removeStream=function(e,t){var n;return r.attachStreams.forEach(function(t){t.id===e&&(n=t)}),n?void(r.peers.getAllParticipants().forEach(function(e){if(!(t&&e!==t)){var a=r.peers[e];try{a.peer.removeStream(n)}catch(t){}}}),r.renegotiate()):void console.warn("No such stream exist.",e)},r.addStream=function(e,t){function n(n){e.streamCallback&&e.streamCallback(n),r.renegotiate(t)}return e.getTracks?(-1===r.attachStreams.indexOf(e)&&(!e.streamid&&(e.streamid=e.id),r.attachStreams.push(e)),void r.renegotiate(t)):p(e)?void r.renegotiate(t):void((e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:b(r)}).then(function(t){t.isScreen=!0,k.onGettingLocalMedia(t),(e.audio||e.video)&&!b(r)?r.invokeGetUserMedia(null,function(e){n(e)}):n(t)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):r.invokeGetUserMedia({audio:b(r),video:!0,isScreen:!0},function(t){(e.audio||e.video)&&!b(r)?r.invokeGetUserMedia(null,function(e){n(e)}):n(t)}):(e.audio||e.video)&&r.invokeGetUserMedia(null,n)))};!!navigator.webkitGetUserMedia;r.invokeGetUserMedia=function(e,t,n){n||(n=r.session),e||(e=r.mediaConstraints),console.log(" ======================= invokeGetUserMedia ============= ",n.audio,n.video,e),e.isScreen?A({onGettingLocalMedia:function(n){var a=e.video;a&&(a.mediaSource||a.mozMediaSource?n.isScreen=!0:a.mandatory&&a.mandatory.chromeMediaSource&&(n.isScreen=!0)),n.isScreen||(n.isVideo=!!w(n,"video").length,n.isAudio=!n.isVideo&&w(n,"audio").length),k.onGettingLocalMedia(n,function(){"function"==typeof t&&t(n)})},onLocalMediaError:function(e,t){k.onLocalMediaError(e,t)},localMediaConstraints:e}):A({onGettingLocalMedia:function(n){var a=e.video;a&&(a.mediaSource||a.mozMediaSource?n.isScreen=!0:a.mandatory&&a.mandatory.chromeMediaSource&&(n.isScreen=!0)),n.isScreen||(n.isVideo=!!w(n,"video").length,n.isAudio=!n.isVideo&&w(n,"audio").length),k.onGettingLocalMedia(n,function(){"function"==typeof t&&t(n)})},onLocalMediaError:function(e,t){k.onLocalMediaError(e,t)},localMediaConstraints:{audio:!!n.audio&&e.audio,video:!!n.video&&e.video}})},r.applyConstraints=function(e,t){if(!O||!O.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(t){var n;return r.streamEvents[t]&&(n=r.streamEvents[t].stream),void R(n,e)}r.attachStreams.forEach(function(t){R(t,e)})},r.replaceTrack=function(e,t,n){function a(a){r.replaceTrack(a,t,n||e.video||e.screen)}if(e=e||{},!RTCPeerConnection.prototype.getSenders)return void r.addStream(e);if(e instanceof O)return void T(e,t,n);if(e instanceof I)return w(e,"video").length&&T(w(e,"video")[0],t,!0),void(w(e,"audio").length&&T(w(e,"audio")[0],t,!1));if(p(e)){throw"connection.replaceTrack requires audio and/or video and/or screen."}(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:b(r)}).then(function(t){t.isScreen=!0,k.onGettingLocalMedia(t),(e.audio||e.video)&&!b(r)?r.invokeGetUserMedia(null,a):a(t)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):r.invokeGetUserMedia({audio:b(r),video:!0,isScreen:!0},(e.audio||e.video)&&!b(r)?r.invokeGetUserMedia(null,a):a):(e.audio||e.video)&&r.invokeGetUserMedia(null,a))},r.resetTrack=function(e,t){e||(e=r.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var n=r.peers[e].peer;("undefined"==typeof t||!0===t)&&n.lastVideoTrack&&r.replaceTrack(n.lastVideoTrack,e,!0),("undefined"==typeof t||!1===t)&&n.lastAudioTrack&&r.replaceTrack(n.lastAudioTrack,e,!1)})},r.renegotiate=function(e){return e?void k.renegotiatePeer(e):void r.peers.getAllParticipants().forEach(function(e){k.renegotiatePeer(e)})},r.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var n="ended";"oninactive"in e&&(n="inactive"),e.addEventListener(n,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var n=[];r.attachStreams.forEach(function(t){t.id!=e.id&&n.push(t)}),r.attachStreams=n}var a=r.streamEvents[e.streamid];if(a||(a={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:r.userid,extra:r.extra,mediaElement:r.streamEvents[e.streamid]?r.streamEvents[e.streamid].mediaElement:null}),t&&r.peers[a.userid]){var s=r.peers[a.userid].peer,n=[];s.getRemoteStreams().forEach(function(t){t.id!=e.id&&n.push(t)}),r.peers[a.userid].streams=n}a.userid===r.userid&&"remote"===a.type||(r.peersBackup[a.userid]&&(a.extra=r.peersBackup[a.userid].extra),r.onstreamended(a),delete r.streamEvents[e.streamid])},!1)}},r.onMediaError=function(e,t){!r.enableLogs||console.error(e,t)},r.autoCloseEntireSession=!1,r.filesContainer=r.videosContainer=document.body||document.documentElement,r.isInitiator=!1,r.shareFile=k.shareFile,"undefined"!=typeof _&&_.handle(r),"undefined"!=typeof H&&H.handle(r),r.token=c,r.onNewParticipant=function(e,t){r.acceptParticipationRequest(e,t)},r.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),k.createNewPeer(e,t)},"undefined"!=typeof j&&(r.StreamsHandler=j),r.onleave=function(){},r.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},r.onmute=function(t){if(t&&t.mediaElement)if("both"===t.muteType||"video"===t.muteType){t.mediaElement.src=null;var e=t.mediaElement.pause();"undefined"==typeof e?t.mediaElement.poster=t.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png":e.then(function(){t.mediaElement.poster=t.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})}else"audio"===t.muteType&&(t.mediaElement.muted=!0)},r.onunmute=function(t){t&&t.mediaElement&&t.stream&&("both"===t.unmuteType||"video"===t.unmuteType?(t.mediaElement.poster=null,t.mediaElement.srcObject=t.stream,t.mediaElement.play()):"audio"===t.unmuteType&&(t.mediaElement.muted=!1))},r.onExtraDataUpdated=function(e){e.status="online",r.onUserStatusChanged(e,!0)},r.getAllParticipants=function(e){return r.peers.getAllParticipants(e)},"undefined"!=typeof j&&(j.onSyncNeeded=function(e,t,n){r.peers.getAllParticipants().forEach(function(a){k.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:n||"both"},a)})}),r.connectSocket=function(e){u(e)},r.closeSocket=function(){try{io.sockets={}}catch(t){}r.socket&&("function"==typeof r.socket.disconnect&&r.socket.disconnect(),"function"==typeof r.socket.resetProps&&r.socket.resetProps(),r.socket=null)},r.getSocket=function(e){return!e&&r.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},r.socket?e(r.socket):u(function(){e(r.socket)}),r.socket},r.getRemoteStreams=k.getRemoteStreams;var B=["selectFirst","selectAll","forEach"];if(r.streamEvents={selectFirst:function(e){return r.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var t=[];return Object.keys(r.streamEvents).forEach(function(n){var a=r.streamEvents[n];if(-1===B.indexOf(n)){var s=!0;e.local&&"local"===a.type&&(s=!1),e.remote&&"remote"===a.type&&(s=!1),e.isScreen&&a.stream.isScreen&&(s=!1),e.isVideo&&a.stream.isVideo&&(s=!1),e.isAudio&&a.stream.isAudio&&(s=!1),e.userid&&a.userid===e.userid&&(s=!1),!1==s&&t.push(a)}}),t}},r.socketMessageEvent="@@socketMessageEvent",r.socketCustomEvent="@@socketCustomEvent",r.DetectRTC=DetectRTC,r.setCustomSocketEvent=function(e){e&&(r.socketCustomEvent=e),r.socket&&r.socket.emit("set-custom-socket-event-listener",r.socketCustomEvent)},r.getNumberOfBroadcastViewers=function(e,t){r.socket&&e&&t&&r.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},r.onNumberOfBroadcastViewersUpdated=function(e){r.enableLogs&&r.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},r.onUserStatusChanged=function(e,t){!r.enableLogs||t||console.info(e.userid,e.status)},r.getUserMediaHandler=A,r.multiPeersHandler=k,r.enableLogs=!0,r.setCustomSocketHandler=function(e){"undefined"!=typeof n&&(n=e)},r.chunkSize=40000,r.maxParticipantsAllowed=1e3,r.disconnectWith=k.disconnectWith,r.checkPresence=function(e,t){return e=e||r.sessionid,"SSEConnection"===n.name?void SSEConnection.checkPresence(e,function(e,n,a){return r.socket?void t(e,n):(e||(r.userid=n),void r.connectSocket(function(){t(e,n,a)}))}):r.socket?void r.socket.emit("check-presence",e+"",function(e,n,a){r.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",n),t(e,n,a)}):void r.connectSocket(function(){r.checkPresence(e,t)})},r.onReadyForOffer=function(e,t){r.multiPeersHandler.createNewPeer(e,t)},r.setUserPreferences=function(e){return r.dontAttachStream&&(e.dontAttachLocalStream=!0),r.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},r.updateExtraData=function(){r.socket.emit("extra-data-updated",r.extra)},r.enableScalableBroadcast=!1,r.maxRelayLimitPerUser=3,r.dontCaptureUserMedia=!1,r.dontAttachStream=!1,r.dontGetRemoteStream=!1,r.onReConnecting=function(e){r.enableLogs&&console.info("ReConnecting with",e.userid,"...")},r.beforeAddingStream=function(e){return e},r.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(r.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(r.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(r.getChromeExtensionStatus=getChromeExtensionStatus),r.modifyScreenConstraints=function(e){return e},r.onPeerStateChanged=function(e){r.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},r.isOnline=!0,m("online",function(){r.isOnline=!0}),m("offline",function(){r.isOnline=!1}),r.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(r.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),r.isLowBandwidth)){if(r.bandwidth={audio:!1,video:!1,screen:!1},r.mediaConstraints.audio&&r.mediaConstraints.audio.optional&&r.mediaConstraints.audio.optional.length){var M=[];r.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&M.push(e)}),r.mediaConstraints.audio.optional=M}if(r.mediaConstraints.video&&r.mediaConstraints.video.optional&&r.mediaConstraints.video.optional.length){var M=[];r.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&M.push(e)}),r.mediaConstraints.video.optional=M}}r.getExtraData=function(e,t){if(!e)throw"remoteUserId is required.";return"function"==typeof t?void r.socket.emit("get-remote-user-extra-data",e,function(e,n,a){t(e,n,a)}):r.peers[e]?r.peers[e].extra:r.peersBackup[e]?r.peersBackup[e].extra:{}},!t.autoOpenOrJoin||r.openOrJoin(r.sessionid),r.onUserIdAlreadyTaken=function(e){r.close(),r.closeSocket(),r.isInitiator=!1,r.userid=r.token(),r.join(r.sessionid),r.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",r.userid)},r.trickleIce=!0,r.version="@@version",r.onSettingLocalDescription=function(e){r.enableLogs&&console.info("Set local description for remote user",e.userid)},r.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},r.autoCreateMediaElement=!0,r.password=null,r.setPassword=function(e,t){t=t||function(){},r.socket?r.socket.emit("set-password",e,t):(r.password=e,t(!0,r.sessionid,null))},r.onSocketDisconnect=function(){r.enableLogs&&console.warn("socket.io connection is closed")},r.onSocketError=function(){r.enableLogs&&console.warn("socket.io connection is failed")},r.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection});var webrtcdevlogs=[];function isJSON(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e);return"object"==typeof t}catch(e){return!1}}function toStr(t){try{return JSON.stringify(t,function(e,t){return t&&t.sdp?(log(t.sdp.type,"\t",t.sdp.sdp),""):t},"\t")}catch(n){return t}}function getArgsJson(e){var t="";for(i in e)e[i]&&(t+=toStr(e[i]));return t}var webrtcdevlogger={log:function(){var e="";isJSON(arguments)?(e=JSON.stringify(arguments,void 0,2),webrtcdevlogs.push("<pre style='color:grey'>[LOG]"+e+"</pre>")):(e=getArgsJson(arguments),webrtcdevlogs.push("<p style='color:grey'>[LOG]"+e+"</p>"))},info:function(){var e="";isJSON(arguments)?(e=JSON.stringify(arguments,void 0,2),webrtcdevlogs.push("<pre style='color:blue'>[INFO]"+e+"</pre>")):(e=getArgsJson(arguments),webrtcdevlogs.push("<p style='color:blue'>[INFO]"+e+"</p>")),console.info(arguments)},debug:function(){var e="";isJSON(arguments)?(e=JSON.stringify(arguments,void 0,2),webrtcdevlogs.push("<pre style='color:green'>[DEBUG]"+e+"</pre>")):(e=getArgsJson(arguments),webrtcdevlogs.push("<p style='color:green'>[DEBUG]"+e+"</p>")),console.debug(arguments)},warn:function(){var e="";isJSON(arguments)?(e=JSON.stringify(arguments,void 0,2),webrtcdevlogs.push("<pre style='color:orange'>[WARN]"+e+"</pre>")):(e=getArgsJson(arguments),webrtcdevlogs.push("<p style='color:orange'>[WARN]"+e+"</p>")),console.warn(arguments)},error:function(){var e="";isJSON(arguments)?(e=JSON.stringify(arguments,void 0,2),webrtcdevlogs.push("<pre style='color:red'>[ERROR]"+e+"</pre>")):(e=getArgsJson(arguments),webrtcdevlogs.push("<p style='color:red'>[ERROR]"+e+"</p>")),console.error(arguments)}},webrtcdevcon=function(){var Zt=Math.ceil,Kt=Math.sqrt,Xt=Math.pow,Qt=Math.log,$t=Math.floor,en=Math.round,tn=String.fromCharCode;function a(n,e){return n?"<video src=\""+n+"\" autoplay></vide>":"<img src=\""+e+"\">"}function r(t){if(0==t)return"0 Bytes";var e=parseInt($t(Qt(t)/Qt(1024)));return en(t/Xt(1024,e),2)+" "+["Bytes","KB","MB","GB","TB"][e]}function s(e){var t=document.createElement("script");t.src=e,t.async=!0,document.documentElement.appendChild(t)}function d(){return console.log(" [initjs] funcStartWebrtcdev - webrtcdev",Qn),new Promise(function(e){Qn.log(" [ startJS webrtcdom ] : begin  checkDevices for outgoing and incoming"),Ke(),Qn.log(" [ startJS webrtcdom ] : incoming ",incoming),Qn.log(" [ startJS webrtcdom ] : outgoing ",outgoing),incoming&&(Tn=incoming.audio,kn=incoming.video,xn=incoming.data),outgoing&&(An=outgoing.audio,Ln=outgoing.video,In=outgoing.data),"inspector"==Xn?e("done"):Xe(function(t){console.log("Has Webcam: "+(t?"yes":"no")),t||(alert(" you dont have access to webcam "),Ln=!1),Qe(function(t){console.log("Has Mic: "+(t?"yes":"no")),t||(alert(" you dont have access to Mic "),An=!1),An&&et(),Ln&&$e(),setTimeout(function(){Qn.log(" outgoingAudio ",An," outgoingVideo ",Ln),e("done")},2e3)})})}).then(()=>(Qn.log(" [ startJS webrtcdom ] : sessionid : "+Cn+" and localStorage  ",localStorage),new Promise(function(e){1<=localStorage.length&&localStorage.getItem("channel")!=Cn?(Qn.log("[startjs] Current Session ID "+Cn+" doesnt match cached channel id "+localStorage.getItem("channel")+"-> clearCaches()"),clearCaches()):Qn.log(" no action taken on localStorage"),e("done")}))).then(()=>(Qn.log(" [ startJS webrtcdom ] : localobj ",ni),Qn.log(" [ startJS webrtcdom ] : remoteobj ",ii),new Promise(function(e){pn=ni.video;var t=ii.videoarr;if(Ln&&(gn=t[0]),!ii.dynamicVideos)for(let e=1;e<t.length;e++)hn.push(t[e]);e("done")}))).then(()=>new Promise(function(e){if(ni.hasOwnProperty("userdetails")){let e=ni.userdetails;Qn.info("localobj userdetails ",e),fn=e.username||"LOCAL",bn=e.usercolor||"",vn=e.useremail||"",Xn=e.role||"participant"}else Qn.warn("localobj has no userdetails ");e("done")})).then(()=>Wi(Cn)).then(()=>Vi(an)).then(()=>Jt(an,En,Cn)).catch(e=>{Qn.error(" Promise rejected ",e)})}function c(e){try{return document.getElementById(e)}catch(t){return Qn.error(t),""}}function l(e){try{if(document.getElementsByName(e))return document.getElementsByName(e)[0]}catch(t){return Qn.error(t),""}}function m(e){if(!e)return void Qn.error("show elem undefined");try{Qn.log(" [init] show elem",e," , type ",typeof e," , nodetype ",e.nodeType),"object"==typeof e&&void 0!==e.nodeType?(e.removeAttribute("hidden"),e.setAttribute("style","display:block!important")):c(e)?(e=c(e),e.removeAttribute("hidden"),e.setAttribute("style","display:block")):l(e)?(e=l(e),e[0].removeAttribute("hidden"),e[0].setAttribute("style","display:block")):Qn.warn("elem not found ",e)}catch(e){Qn.error("showeleem",e)}}function u(e){try{"object"==typeof e&&void 0!==e.nodeType?(e.setAttribute("hidden",!0),e.setAttribute("style","display:none!important")):c(e)&&(c(e).setAttribute("hidden",!0),c(e).setAttribute("style","display:none"))}catch(t){Qn.error(e,t)}}function p(e){return!!c(e)}function g(e){let t=Xn;switch(Qn.log("[webcallviewmanager] - updateWebCallView start with "," peerinfo",e," | myrole :",t," | video indexOf : ",e.vid.indexOf("videoundefined")),t){case"inspector":for(var n=0,a=0;a<hn.length;a++)Qn.log(" [webcallviewmanager] Remote Video index array ",a," || ",hn[a],document.getElementsByName(hn[a]),document.getElementsByName(hn[a]).src),hn[a].src&&n++;let l=document.createElement("video");hn[n]=l,document.getElementById(ii.videoContainer).appendChild(l);let u=hn[n];Qn.log(" [webcallviewmanager] updateWebCallView role-inspector , attaching stream",u,e.stream),nt(u,e.stream),u.hidden&&(removid.hidden=!1),u.id=e.videoContainer,u.className=ii.videoClass,ii.userDisplay&&e.name&&K(u,e),ii.userMetaDisplay&&e.userid&&X(u,e);var r=document.getElementsByName(pn)[0];for(a in r&&(r.hidden=!0),ii.videoarr){var s=document.getElementsByName(ii.videoarr[a])[0];s&&s.setAttribute("style","display:none")}for(let e in document.getElementsByClassName("timeBox"))document.getElementsByClassName("timeBox")[e].hidden=!0;break;case"participant":case"host":case"guest":if(-1<e.vid.indexOf("videolocal")){if(Qn.info(" [start.js - updateWebCallView] role-participant , peerinfo Vid is Local"),pn&&document.getElementsByName(pn)[0]){let t=document.getElementsByName(pn)[0];t.muted=!0,t.className=ni.videoClass,nt(t,e.stream),ni.userDisplay&&e.name&&K(t,e),ni.userMetaDisplay&&e.userid&&X(t,e),Qn.info(" User is alone in the session  , hiding remote video container","showing users single video container and attaching attachMediaStream and attachUserDetails ")}else Qn.error(" No local video container in localobj -> ",ni);}else if(-1<e.vid.indexOf("videoremote")){if(Qn.info(" [start.js - updateWebCallView] role-participant , peerinfo Vid is Remote"),Ln&&pn&&gn){var d=document.getElementsByName(pn)[0],c=document.getElementsByName(gn)[0];0==c.played.length?(0<d.played.lebth?it(c,d):nt(c,sn[0].stream),ni.userDisplay&&sn[0].name&&K(c,sn[0]),ni.userMetaDisplay&&sn[0].userid&&X(c,sn[0]),c.id=sn[0].videoContainer,c.className=ii.videoClass,c.muted=!0,G(c,sn[0])):Qn.log(" not updating self video as it is already playing "),Qn.info(" User is joined by a remote peer , hiding local video container","showing users conf video container and attaching attachMediaStream and attachUserDetails ")}else Ln?Qn.error(" Local video container not defined "):Qn.error(" Outgoing Local video is ",Ln);{let t=b(e,hn);h(e,hn,t),nt(hn[t],e.stream),m(hn[t].video),ii.userDisplay&&e.name&&K(hn[t].video,e),ii.userMetaDisplay&&e.userid&&X(hn[t].video,peerInfo),hn[t].video.id=e.videoContainer,hn[t].video.className=ii.videoClass,G(hn[t].video,e)}}else Qn.error("[webcallviewdevmanager]  PeerInfo vid didnt match either case ");break;default:Qn.log("[start.js - updateWebCallView] Switch default case");}Qn.log(" [start.js - updateWebCallView] - finish")}function h(e,t,n){if(Qn.log("[webcallviewmanager updateRemoteVideos ] emptyvideoindex - ",n),!!n){try{if("unlimited"==ii.maxAllowed){Qn.log("[webcallviewmanager updateRemoteVideos ] remote video is unlimited , creating video for remoteVideos array ");let a=document.createElement("video");t[n]={userid:e.userid,stream:e.stream,video:a},document.getElementById(ii.dynamicVideos.videoContainer).appendChild(a)}else{Qn.log("[webcallviewmanager updateRemoteVideos ] Remote video is limited to size maxAllowed , current index ",n);let a=document.getElementsByName(t[n]);Qn.log("[webcallviewmanager updateRemoteVideos ] searching for video with index ",n," in remote video : ",a),0<=a.length?a[0]&&(t[n]={userid:e.userid,stream:e.stream,video:a[0]},Qn.log("[webcallviewmanager updateRemoteVideos ] RemoteVideos["+n+"] updated ",t[n],e.stream)):t[n].userid==e.userid&&""==t[n].stream?(Qn.warn("[webcallviewmanager updateRemoteVideos] since remvideo holder doesnt exist with '' stream just overwrite the stream "),t[n].stream=e.stream):(Qn.warn("[webcallviewmanager updateRemoteVideos] since remvideo holder doesnt exist just overwrite the last remote with the video "),t[t.length-1]={userid:e.userid,stream:e.stream,video:a[0]},Qn.log("[webcallviewmanager updateRemoteVideos ] RemoteVideos["+t.length-1+"] updated ",t[n]))}}catch(e){Qn.error(e)}Qn.log("[webcallviewmanager updateRemoteVideos ] remoteVideos before updating ",t[n])}}function b(e,t){let n=0;for(v in t){if(Qn.log("[webcallviewdevmanager] Remote Video index array ",v," || ",t[v]),t[v].userid==e.userid&&""==t[v].stream&&!!t[v].video&&(Qn.log("[webcallviewdevmanager] Remote Video dom exist already for the userid, checking for srcobject "),!t[v].video.srcObject)){Qn.log("[webcallviewdevmanager] Remote Video dom exist already but without stream",t[v].video),n=v;break}let a=document.getElementsByName(t[v]);if(!!t[v].video)Qn.log("[webcallviewdevmanager] ] Remote Video has json appended ",t[v]),a=t[v].video;else if(Qn.log("[webcallviewdevmanager] ] Remote Video is not appended by json ",a),0>=a.length){Qn.log("[webcallviewdevmanager] Remote video space is empty "),n=v;break}else Qn.log("[webcallviewdevmanager] Remote video space exists ",a[0]),a=a[0];if(console.log(" [webcallviewdevmanager] ] vids.src ",a.src," , vids.srcObject ",a.srcObject," , vids.readyState ",a.readyState," , vids.played.length ",a.played.length),a&&a.srcObject){if(a.srcObject.active)Qn.log("[webcallviewdevmanager] video is already appended and playing ",a," vids.srcObject.active ",a.srcObject.active," move to next iteration"),n++;else{Qn.log("[webcallviewdevmanager] video is already appended , but not playing ",a," vids.srcObject.active ",a.srcObject.active," use this index"),n=v;break}}else if(a&&!a.srcObject){Qn.log("[webcallviewdevmanager] video is not played ",a,"use this index "),n=v;break}else Qn.warn("[webcallviewdevmanager] Not sure whats up with the video ",a," move to next iteration"),n++}return Qn.log("[webcallviewmanager - findEmptyRemoteVideoIndex] emptyvideoindex ",n,t[n]),n}function w(e){widgetholder="topIconHolder_ul";const t=document.createElement("span");t.setAttribute("data-provides","fileinput"),t.className=e.button.class,t.innerHTML=e.button.html,t.onclick=function(){const e=new FileSelector;e.selectSingleFile(function(e){pt(e)})};const n=document.createElement("li");n.appendChild(t),document.getElementById(widgetholder).appendChild(n)}function S(e){let t=document.getElementById(e.button.id);t.onclick=function(){const e=new FileSelector;e.selectSingleFile(function(e){pt(e)})}}function C(e,t,n,a,r,s,d,c){try{if(!t)return void Qn.error(" [filehsraingJs] Progress helpler cannot be added for one peer as its absent");if(!t.fileList.container||!document.getElementById(t.fileList.container))return void Qn.error(" [filehsraingJs] Progress helpler cannot be added , missing fileListcontainer ");Qn.log(" [filehsraingJs] progress helper attributes  attributes : uuid -",e,"peerinfo - ",t,"filename - ",n,"file size - ",a,"progress helper class - ",s,"file to - ",c,"file from - ",d);let l=e+"_"+d+"_"+c;Qn.log(" [startjs] addProgressHelper - progressid ",l);let m=document.createElement("ul");if(m.id=l,m.title=n+" size - "+r.size+" type - "+r.type+" last modified on -"+r.lastModifiedDate,m.setAttribute("type","progressbar"),m.setAttribute("class","row"),Bn){const e=document.createElement("li");e.innerHTML=n+"size - "+r.size+" type - "+r.type+" last modified on -"+r.lastModifiedDate+" from :"+d+" --> to :"+c+"</br>",m.appendChild(e)}let u=document.createElement("li");u.setAttribute("class",s),u.innerHTML="<label>0%</label><progress></progress>",m.appendChild(u),Li[l]={div:u,progress:u.querySelector("progress"),label:u.querySelector("label")},Li[l].progress.max=a;let p=document.createElement("li");p.id="stopuploadButton"+l,p.innerHTML="<i class=\"fa fa-trash-o\"></i>",p.onclick=function(e){Qn.log(" [startjs] addProgressHelper - remove progressid ",l," dom : ",document.getElementById(l)),B(l),gt(l,n,r,c,d),e.target.remove(),M(l),un==n?un==n&&(un=""):(an.send({type:"shareFileStopUpload",_element:l,_filename:n}),un=n)},m.appendChild(p),parentDom=document.getElementById(t.fileList.container),parentDom.insertBefore(m,parentDom.firstChild)}catch(t){Qn.error(" [filehsraingJs] problem in addProgressHelper  ",t)}}function E(t,e){if(-1!=t.position){const a=+t.position.toFixed(2).split(".")[1]||100;e.innerHTML=a+"%"}}function R(e,t,n,a,r){let s;const d=t.fileShare.container,c=t.fileList.container;try{if(!Nn.active)return;Qn.log("[filesharing js] displayList - uuid: ",e," peerinfo :",t,"file url : ",n," file name : ",a," file type :",r);let d=null;"sessionRecording"==r&&(a=a.videoname+"_"+a.audioname,d=a);let l=document.querySelectorAll("ul[id^=\""+e+"\"]");if(0<l.length)for(x in l)Qn.log("[filesharing js] displayList remove progress bar index - ",x," file dom - ",l[x]),"object"==typeof l[x]&&("progressbar"==l[x].type||-1<l[x].indexOf("progressbar"))?t.fileList.container&&document.getElementById(t.fileList.container)?(s=document.getElementById(t.fileList.container),Qn.log("[ filesharing js ] displayList, set up parent dom ",s),s.removeChild(l[x])):(Qn.log("[ filesharing js ] displayList, Not sure what does this do ",l[x]),s=l[x].parentNode.parentNode):console.log("[filesharing js] displayList - cannot remove since , elem is not of type progressbar  ",l[x]);else s=document.getElementById(c)||document.body,Qn.warn("[ filesharing js ] displayList , progress bar area doesnt exist, set parent dom to ",c,document.getElementById(c)," or to document body")}catch(t){Qn.error(" [filesharing js ] Display list exception ",t)}Qn.log(" [filesharing js] displayList set up parent dom  ",s);let l=document.createElement("ul");l.id=a+e,l.type=t.type,l.innerHTML="",l.className="row";let m=document.createElement("li");m.innerHTML=a,m.title=r+" shared by "+t.name,m.className="filenameClass",m.id="name"+a+e;let p=document.createElement("li");if(p.id="downloadButton"+a+e,p.title="Download",Nn.filelist.saveicon){let e=document.createElement("img");e.src=Nn.filelist.downloadicon,p.appendChild(e)}else p.innerHTML="<i class=\"fa fa-download\"></i>";p.onclick=function(){U(e,d,n,_filename,r)};let g=document.createElement("li");if(g.id="saveButton"+a+e,g.title="Save",g.setAttribute("data-toggle","modal"),g.setAttribute("data-target","#saveModal"),Nn.filelist.saveicon){let e=document.createElement("img");e.src=Nn.filelist.saveicon,g.appendChild(e)}else g.innerHTML="<i class=\"fa fa-floppy-o\"></i>";g.onclick=function(){z(r)};let h=document.createElement("li");if(h.id="showButton"+a+e,h.title="Show",Nn.filelist.saveicon){let e=document.createElement("img");e.src=Nn.filelist.showicon,h.appendChild(e)}else h.innerHTML="<i class=\"fa fa-eye-slash\"></i>";let b=0;ln=a,cn="",h.onclick=function(){b++,L(e,d,n,a,r,h,b)};let w=document.createElement("li");w.id="removeButton"+a+e,w.title="Remove",w.innerHTML="<i class=\"fa fa-trash-o\"></i>",w.onclick=function(){if(mn!=a){const t=a+e;B(d,a),an.send({type:"shareFileRemove",_element:t,_filename:a}),M(t),mn=a,Qn.log("[startjs] filedom to be hidden : ",l),l.setAttribute("style","display:none!important")}else mn==a&&(mn="")},t.userid!=on&&u(w),"inspector"==Xn&&((!0).hidden=!0,h.hidden=!0,g.hidden=!0,l.appendChild(m),w.hidden=!0),l.appendChild(m),l.appendChild(p),l.appendChild(h),l.appendChild(g),!0&&l.appendChild(w),Qn.log("[filesharing dom modifier JS ] filedom ",l," | parentdom ",s),s?(s.appendChild(l),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"file",action:"onFileListed"}}))):Qn.error("[filesharing dom modifier JS ] filedom's parent dom not found ")}function T(e,t,n){Qn.log(" [filehsaring js]  - getFileElementDisplayByType ","file type :",e,"file url : ",t,", file name : ",n);let a;if(-1<e.indexOf("msword")||-1<e.indexOf("officedocument")){let e=document.createElement("div");e.className="alert alert-warning",e.innerHTML="Microsoft and Libra word file cannot be opened in browser. Click bottom DOWNLOAD in UF box . File shows up below the UF box. Click arrow on right, then select OPEN  . File Opens in New Window, then 'Save As'.",a=e}else if(-1<e.indexOf("image")){let e=document.createElement("img");e.src=t,e.style.width="100%",e.style.height="100%",e.title=n,e.id="display"+n,a=e}else if("sessionRecording"==e){let e=e.videoname+"_"+e.audioname;const n=document.createElement("div");n.setAttribute("background-color","black"),n.id="display"+e,n.title=e;let r=document.createElement("video");r.src=t.videofileurl,r.setAttribute("type","audvideo/webm"),r.setAttribute("name","videofile"),r.controls="controls",r.title=e.videoname+".webm";let s=document.createElement("audio");s.src=t.audiofileurl,s.setAttribute("type","audio/wav"),s.controls="controls",s.title=e.videoname+".wav",n.appendChild(r),n.appendChild(s),a=n,r.play(),s.play()}else if(-1<e.indexOf("videoScreenRecording")){Qn.log("videoScreenRecording ",t);let e=document.createElement("video");e.src=t,e.setAttribute("controls","controls"),e.style.width="100%",e.title=n,e.id="display"+n,a=e}else if(-1<e.indexOf("video")){Qn.log("videoRecording ",t);let e=document.createElement("video");e.src=t,e.setAttribute("controls","controls"),e.style.width="100%",e.title=n,e.id="display"+n,a=e}else{let e=document.createElement("iframe");e.style.width="100%",e.src=t,e.className="viewerIframeClass",e.title=n,e.id="display"+n,a=e}return a}function k(e,t,n,a,r){Qn.log(" [filehsaring js]  - displayFile  - uuid: ",e," peerinfo :",t,"file url : ",n," file name : ",a," file type :",r);try{if(!t||!t.fileShare)return;let e=document.getElementById(t.fileShare.container),s=T(r,n,a);if(e)I(t.fileShare.container,n,a,r);else if("inspector"==Xn)for(peer in sn){const e=++peer,t=document.getElementById(sn[e].fileShare.container);if(t){I(sn[e].fileShare.container,n,a,r);break}}else document.body.appendChild(s)}catch(e){Qn.error("[filehsaring js] displayFile  has a problem ",e)}}function A(e){const t=document.getElementById(e);for(x in sn)if(t.getAttribute("lastClickedBy")==sn[x].userid)return void t.setAttribute("lastClickedBy","");""==t.getAttribute("lastClickedBy")&&(t.setAttribute("lastClickedBy",an.userid),an.send({type:"buttonclick",buttonName:e}))}function L(e,t,n,a,r,s,d){Qn.log(" [filehsaring js]  - show/hide elementDisplay ",t),Qn.log(" [filehsaring js]  - show/hide button ",a," || ",d),1==d%2?(I(t,n,a,r),s.innerHTML="<i class=\"fa fa-eye-slash\"></i>",Qn.log(" [filehsaring js]  Executed script to show the file")):0==d%2&&(B(t,a),s.innerHTML="<i class=\"fa fa-eye\"></i>",Qn.log(" [filehsaring js]  Executed script to hide the file "))}function I(e,t,n,a){Qn.log("[filehsaring js]  showFile container - ",e,document.getElementById(e));const r=T(a,t,n);Qn.log("[filehsaring js]  showFile  filedom - ",r),p(e)?(document.getElementById(e).innerHTML="",m(e),document.getElementById(e).appendChild(r)):Qn.warn(" [filehsaring js] cant show file as parent DOM fir fileDisplay container doesnt exist ")}function B(e){Qn.log("[filehsaring js]  hidefile ",e),p(e)?(document.getElementById(e).innerHTML="",u(e),Qn.log("[filehsaring js] hidefile done")):Qn.warn(" [filehsaring js]  file is not displayed to hide  ")}function M(e){Qn.log("[filehsaring js]  removeFile ",e),document.getElementById(e).remove()}function U(e,t,n,a,r){if(Qn.log(" downloadButton _filename ",a,"  filetype ",r),"sessionRecording"==r){const e=document.createElement("a");document.body.appendChild(e),e.style="display: none",e.href=n.audiofileurl,e.download=peerinfo.filearray[0]+".wav",e.click(),window.URL.revokeObjectURL(n.audiofileurl);const t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=n.videofileurl,t.download=peerinfo.filearray[1]+".webm",t.click(),window.URL.revokeObjectURL(n.videofileurl)}else window.open(n,"downloadedDocument")}function O(e,t){try{if(Qn.log(" [ filehsreing js ]  createFileSharingBox ",e,t),document.getElementById(e.fileShare.outerbox))return;const n=document.createElement("div");n.className="single"==Nn.props.fileList?"col-md-12 fileviewing-box":"fileviewing-box",n.id=e.fileShare.outerbox;let a=document.createElement("p"),r,s;if(a.id=e.fileShare.container+"controlBar","single"!=Nn.props.fileList&&a.appendChild(document.createTextNode(e.name)),"none"!=Nn.fileshare.minicon){if(r=document.createElement("span"),Nn.fileshare.minicon){let e=Nn.fileshare.minicon;Qn.log(" [fileShare JS ] creating custom minicon",e);let t=document.createElement("img");t.src=e,r.appendChild(t)}else{"<i class=\"fa fa-minus-square\"></i>".innerHTML="<i class=\"fa fa-minus-square\"></i>",Qn.log(" [fileShare JS ] creating default minicon ","<i class=\"fa fa-minus-square\"></i>")}r.id=e.fileShare.minButton,r.title="Minimize",r.style.display="none",r.setAttribute("lastClickedBy",""),r.onclick=function(){H(e.userid,r.id,e.fileShare.outerbox),u(r),m(s)},a.appendChild(r)}else Qn.warn(" [fileShare JS ] minicon is none");if("none"!=Nn.fileshare.maxicon){if(s=document.createElement("span"),Nn.fileshare.maxicon){let e=Nn.fileshare.maxicon;Qn.log(" [fileShare JS ] creating custom maxicon",e);let t=document.createElement("img");t.src=e,s.appendChild(t)}else{s.innerHTML="<i class=\"fa fa-external-link-square\"></i>",Qn.log(" [fileShare JS ] creating default maxicon","<i class=\"fa fa-external-link-square\"></i>")}s.id=e.fileShare.maxButton,s.title="Maximize",s.style.display="block",s.setAttribute("lastClickedBy",""),s.onclick=function(){if(W(e.userid,s.id,e.fileShare.outerbox),"single"!=Nn.props.fileList)for(let t in sn)sn[t].userid!=e.userid&&V(sn[t].userid,"",sn[t].fileShare.outerbox);u(s),m(r)},a.appendChild(s)}else Qn.warn(" [fileShare JS ] maxicon is none");let d=document.createElement("span");if(Nn.fileshare.closeicon){let e=document.createElement("img");e.src=Nn.fileshare.closeicon,d.appendChild(e)}else d.innerHTML="<i class=\"fa fa-times-circle\"></i>";d.id=e.fileShare.closeButton,d.title="Close",d.setAttribute("lastClickedBy",""),d.onclick=function(){_(e.userid,d.id,e.fileShare.container)},a.appendChild(d);let c=0;let l=document.createElement("span");if(Nn.fileshare.rotateicon){let e=document.createElement("img");e.src=Nn.fileshare.rotateicon,l.appendChild(e)}else l.innerHTML="<i class=\"fa fa-mail-forward\"></i>";l.id=e.fileShare.rotateButton,l.title="Rotate",l.onclick=function(){let t=document.getElementById(e.fileShare.container),n=t.firstChild;Qn.log(" [filehsraing ] rotateButton dom ",n,n.nodeName,"dom parent ",t),c=(c+90)%360,n.setAttribute("angle",c),n?"VIDEO"==n.nodeName?N(n,t):"IMG"==n.nodeName?P(n,t):"IFRAME"==n.nodeName?D(n,t):n.setAttribute("orientation",""):Qn.error(" [filehsraing ] rotateButton  , dom doesnt exist")},a.appendChild(l);let p=document.createElement("div");if(p.className="filesharingWidget",p.id=e.fileShare.container,Bn){let e=document.createElement("span");e.innerHTML="<br/>"+p.id+"<br/>",n.appendChild(e)}n.appendChild(a),n.appendChild(p),t.appendChild(n)}catch(t){Qn.error(" createFileSharingBox ",t)}}function N(e,t){const n=e.getAttribute("angle")||0;e.videoWidth>e.videoHeight?(e.setAttribute("style","height:"+t.clientWidth+"px;margin-left: 0px"),orientation="landscape"):orientation="portrait",e.setAttribute("orientation",orientation),e.className="col rotate"+n+e.getAttribute("orientation")}function D(e,t){const n=e.getAttribute("angle")||0;e.setAttribute("style","height:"+t.clientWidth+"px !important;width:100%"),e.setAttribute("orientation","portrait"),e.className="col rotate"+n+e.getAttribute("orientation")}function P(e,t){let n;const a=e.getAttribute("angle")||0;e.width>e.height?(n="landscape",("90"==a||"270"==a)&&(newwidth=e.width/e.height*t.clientWidth,e.setAttribute("style","width:"+newwidth+"px; height:"+t.clientWidth+"px"))):(n="portrait",("90"==a||"270"==a)&&(newwidth=e.width/e.height*t.clientWidth,e.setAttribute("style","height:"+t.clientWidth+"px; max-width:"+newwidth+"px;"))),e.setAttribute("orientation",n),e.className="col rotate"+a+e.getAttribute("orientation")}function j(e,t){try{if(c(e.fileList.outerbox))return;const n=document.createElement("div");n.className="single"==Nn.props.fileList?"col-sm-12 filesharing-box":"col-sm-6 filesharing-box",n.id=e.fileList.outerbox;let a=document.createElement("div");a.id="widget-filelisting-container-header",a.setAttribute("style","background-color:"+e.color),"single"!=Nn.props.fileList&&a.appendChild(document.createTextNode(e.name+"     "));let r,s;"none"!=Nn.filelist.minicon&&(r=document.createElement("span"),r.innerHTML="<i class=\"fa fa-minus\" ></i>",r.id=e.fileShare.minButton,r.setAttribute("lastClickedBy",""),r.onclick=function(){V(e.userid,r.id,e.fileList.container),u(r),m(s)},a.appendChild(r)),"none"!=Nn.filelist.maxicon&&(s=document.createElement("span"),s.innerHTML="<i class=\"fa fa-plus\" ></i>",s.id=e.fileShare.maxButton,s.setAttribute("lastClickedBy",""),s.onclick=function(){W(e.userid,s.id,e.fileList.container),u(s),m(r)},a.appendChild(s),u(s));const d=document.createElement("div");d.id=e.fileList.container;let l=document.createElement("div");if(Bn){let e=document.createElement("span");e.innerHTML=d.id,n.appendChild(e)}n.appendChild(a),n.appendChild(d),n.appendChild(l),t.appendChild(n)}catch(e){Qn.error("[filesharing dom modifier] createFileListingBox ",e)}}function F(e){if(Qn.log("[filesharing dom modifier] createFileSharingDiv  ",e),"inspector"!=e.role||"inspector"==Xn){if("single"!=Nn.props.fileList){let e="";for(i in sn)"remote"==sn[i].type&&(e+=webcapppeers[i].userid);if(2<=document.getElementById("fileListingRow").childElementCount){Qn.warn("more than 1 file listing rows prresent , remove the ones for peers that are no longer in session  ");let t=document.getElementById("fileListingRow"),n=t.childNodes;for(x in n){if(Qn.log(" check if this dom by id is required .  filelistingboxes[x].id ",n[x]),!n[x].id)break;fid=n[x].id.split("widget-filelisting-box"),e.includes(fid[1])||(Qn.warn(" File list boxes belonging to userid ",fid[1]," need to be removed  "),t.removeChild(n[x]))}}if(2<=document.getElementById("fileSharingRow").childElementCount){Qn.warn("more than 1 file listing rows present , remove the ones for peers that are no longer in session  ");let t=document.getElementById("fileSharingRow"),n=t.childNodes;for(x in n){if(Qn.log(" check if this dom by id is required .filelistingboxes[x].id ",n[x]),!n[x].id)break;fid=n[x].id.split("widget-sharing-box"),e.includes(fid[1])||(Qn.warn(" File list boxes belonging to userid ",fid[1]," need to be removed  "),t.removeChild(n[x]))}}}if(!c(e.fileShare.outerbox)){let t=c(Nn.fileShareContainer);O(e,t)}if(!c(e.fileList.outerbox)){let t=c(Nn.fileListContainer);j(e,t)}}}function _(e,t,n){c(n).innerHTML=""}function H(e,t,n){for(x in sn)sn[x].fileShare.outerbox==n?(m(n),c(n).style.width="50%"):(m(sn[x].fileShare.outerbox),c(sn[x].fileShare.outerbox).style.width="50%")}function V(e,t,n){u(n)}function W(e,t,n){m(n)}function z(e){Qn.log(" create Modal popup for filetype ",e);const t=c("mainDiv");c("saveModal")&&t.removeChild(document.getElementById("saveModal"));const n=document.createElement("div");n.className="modal fade",n.setAttribute("role","dialog"),n.id="saveModal";const a=document.createElement("div");a.className="modal-dialog";const r=document.createElement("div");r.className="modal-content";const s=document.createElement("div");s.className="modal-header";const d=document.createElement("button");d.className="close",d.setAttribute("data-dismiss","modal"),d.innerHTML="&times;";const l=document.createElement("h4");l.className="modal-title",l.innerHTML="Save File",l.setAttribute("float","left"),s.appendChild(l),s.appendChild(d);const m=document.createElement("div");m.className="modal-body",m.innerHTML="";const u=document.createElement("div");switch(e){case"blobcanvas":l.innerHTML="Save Drawing";var p=document.createElement("div");p.innerHTML="Right Click on Save, pop up window gives following info: Right Click on Draw image, Click Save As when window opens up.",u.appendChild(p);break;case"application/pdf":l.innerHTML="Save PDF";var p=document.createElement("div");p.innerHTML="Click DOWNLOAD on top of the doc . Click SAVE AS when window opens up";const t=document.createElement("img");t.src="images/savefile.PNG",u.appendChild(p),u.appendChild(t);break;case"image/jpeg":case"image/png":case"video/mov":case"video/webm":case"imagesnapshot":l.innerHTML="Save Picture / Video";var p=document.createElement("div");p.innerHTML="Right Click on the FILE . Click SAVE AS when window opens up",u.appendChild(p);break;case"audio/mp3":l.innerHTML="Save Music File";var p=document.createElement("div");p.innerHTML="Right Click on the FILE (play display line). Click SAVE AS when window opens up",u.appendChild(p);break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"video/x-ms-wmv":l.innerHTML="Save Microsoft Office / Libra / Open Office Documents";var p=document.createElement("div");p.innerHTML="Click bottom DOWNLOAD in Uploaded Files box . File shows up below the Uploaded Files box. Click arrow on right, then select OPEN  . File Opens in New Window, then 'Save As'.",u.appendChild(p);break;case"sessionRecording":l.innerHTML="Save Session Recording";var p=document.createElement("div");p.innerHTML="Extract the video and audio recording from the dowloaded compresed file and play together ",u.appendChild(p);break;default:var p=document.createElement("div");p.innerHTML="Document is Unrecognizable, cannot be saved, but can be shared with Remote. Use/Click Screen Share for Remote to view your screen. Then open the document on your screen.",u.appendChild(p);}m.appendChild(u),r.appendChild(s),r.appendChild(m),a.appendChild(r),n.appendChild(a),t.appendChild(n)}function G(t,n){var a=n.stream,r=n.streamid,s=n.controlBarName,d=n.fileSharingContainer,l=t.parentNode.childNodes;for(i=0;i<l.length;i++)"DIV"==l[i].nodeName&&null!=l[i].id&&-1<l[i].id.indexOf("control")&&(Qn.log("control bar exists already  , delete the previous one before adding new one"),t.parentNode.removeChild(l[i]));let c=document.createElement("div");if(c.id=s,c.className="local"==n.type?"localVideoControlBarClass":"remoteVideoControlBarClass",Bn){let e=document.createElement("div");e.innerHTML=t.id,c.appendChild(e)}if(Gn.active&&(Gn.audio.active&&c.appendChild(J(s,n)),Gn.video.active&&c.appendChild(Z(s,n))),Pn.active&&c.appendChild(Ve(s,n)),jn.active&&c.appendChild(at(s,n,r,a)),zn.active&&c.appendChild(xt(s,n)),qn.active){c.appendChild(q(s,n,r,a)),nameBoxid="#videoheaders"+n.userid;let t=document.querySelectorAll(nameBoxid);for(e in t)t[e].appendChild&&t[e].appendChild(Y(s,n,r,a))}t.parentNode.appendChild(c)}function q(e,t){let n=document.createElement("span");return n.id=e+"fullscreeButton",n.setAttribute("title","Full Screen"),n.className=qn.max.button.class_off,n.innerHTML=qn.max.button.html_off,n.onclick=function(){if(n.className==qn.max.button.class_off){var e=document.getElementById(t.videoContainer);e.webkitRequestFullScreen(),n.className=qn.max.button.class_on,n.innerHTML=qn.max.button.html_on}else n.className=qn.max.button.class_off,n.innerHTML=qn.max.button.html_off},n}function Y(e,t){let n=document.createElement("span");n.id=e+"minmizevideoButton",n.setAttribute("title","Minimize Video"),n.className=qn.min.button.class_off,n.innerHTML=qn.min.button.html_off;var a=document.getElementById(t.videoContainer);return n.onclick=function(){n.className==qn.min.button.class_off?(u(a),n.className=qn.min.button.class_on,n.innerHTML=qn.min.button.html_on):(m(a),n.className=qn.min.button.class_off,n.innerHTML=qn.min.button.html_off)},Qn.log("[_media_dommodifier ] createMinimizeVideoButton - button",n," vid ",a),n}function J(e,t){let n=document.createElement("span");return n.id=e+"audioButton",n.setAttribute("data-val","mute"),n.setAttribute("title","Toggle Audio"),n.className=Gn.audio.button.class_on,n.innerHTML=Gn.audio.button.html_on,n.onclick=function(){n.className==Gn.audio.button.class_on?(t.stream.mute({audio:!0}),n.className=Gn.audio.button.class_off,n.innerHTML=Gn.audio.button.html_off):(t.stream.unmute({audio:!0}),n.className=Gn.audio.button.class_on,n.innerHTML=Gn.audio.button.html_on),A(n.id)},n}function Z(e,t){let n=document.createElement("span");return n.id=e+"videoButton",n.setAttribute("title","Toggle Video"),n.setAttribute("data-container","body"),n.className=Gn.video.button.class_on,n.innerHTML=Gn.video.button.html_on,n.onclick=function(){n.className==Gn.video.button.class_on?(t.stream.mute({video:!0}),n.innerHTML=Gn.video.button.html_off,n.className=Gn.video.button.class_off):(t.stream.unmute({video:!0}),n.innerHTML=Gn.video.button.html_on,n.className=Gn.video.button.class_on),A(n.id)},n}function K(e,t){if(Qn.log("[media_dommanager] attachUserDetails - ",t.userid,":",t.type),0<e.parentNode.querySelectorAll(".videoHeaderClass").length)if(Qn.warn("[media_dommanager] video header already present ",e.parentNode.querySelectorAll(".videoHeaderClass")),0<e.parentNode.querySelectorAll("videoheaders"+t.userid).length)return void Qn.warn("[media_dommanager] user's video header already present ","videoheaders"+t.userid);else{Qn.warn("[media_dommanager] video header already present for diff user , overwrite with ","videoheaders"+t.userid);let n=e.parentNode.querySelectorAll(".videoHeaderClass")[0];n.remove()}let n=document.createElement("div");n.className="videoHeaderClass",n.innerHTML=t.name,n.id="videoheaders"+t.userid,e.parentNode.insertBefore(n,e.parentNode.firstChild)}function X(e,t){Qn.log("[media_dommanager] attachMetaUserDetails - ",t.userid,":",t.type);let n=document.createElement("span");n.setAttribute("style","background-color:"+t.color),n.innerHTML=t.userid+":"+t.type+"<br/>",e.parentNode.insertBefore(n,e.parentNode.firstChild)}function Q(e,t){if(e&&"undefined"!=e)if(document.getElementById("alertBox")){var n=document.createElement("div");n.className="warning"==t?"alert alert-warning fade in":"crtical"==t?"alert alert-crtical":"alert alert-success fade in",n.innerHTML="<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>"+e,document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").appendChild(n),setTimeout(function(){document.getElementById("alertBox").hidden=!0},3e3)}else alert(e)}function ee(e){if(e&&"undefined"!=e&&Bn)if(document.getElementById("alertBox")){var t=document.createElement("div");t.className="alert alert-warning fade in",t.innerHTML="<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>"+e,document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",document.getElementById("alertBox").appendChild(t),setTimeout(function(){document.getElementById("alertBox").hidden=!0},3e3)}else alert(e)}function te(e){Qn.log("assignScreenShareButton",e);let t=c(e.id);return t.onclick=function(){if(t.className==e.class_off){let n=new Date().getUTCMilliseconds();pi="screenshare_"+Cn+"_"+n,Ee(pi),t.className=e.class_on,t.innerHTML=e.html_on}else t.className==e.class_on?(t.className=e.class_off,t.innerHTML=e.html_off,Te()):Qn.warn("[screenshare js] createScreenshareButton,classname neither on nor off",e.className)},t}function ne(e,t){if(!c("alertBox"))alert(e);else if(c("alertBox").innerHTML="","screenshareBegin"==t){let e=document.createElement("div");xe(),e.className="alert alert-info",e.innerHTML="<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>You have begun sharing screen , waiting for peer to view",c("alertBox").appendChild(e),setTimeout(function(){let e=document.createElement("div");xe(),e.className="alert alert-danger",e.innerHTML="<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>Peer was not able to view screen , please retry",c("alertBox").appendChild(e)},2e4)}else if("screenshareStartedViewing"==t);else if("screenshareError"==t){let e=document.createElement("div");xe(),e.className="alert alert-danger",e.innerHTML="<a href=\"#\" class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>There was a error while sharing screen , please contact support ",c("alertBox").appendChild(e)}else;}function ie(e){let t=document.getElementById(e.button.id);t.onclick=function(){t.className==e.button.class_on?(t.className=e.button.class_off,t.innerHTML=e.button.html_off,st()):t.className==e.button.class_off&&(t.className=e.button.class_on,t.innerHTML=e.button.html_on,dt())}}function ae(){var e=document.createElement("div");let t=document.createElement("input");t.setAttribute("type","text"),t.className="form-control chatInputClass",t.id="chatInput",t.onkeypress=function(n){13==n.keyCode&&(Ge(t.value),t.value="")};let n=document.createElement("span");n.className="btn btn-primary",n.innerHTML="Enter",n.onclick=function(){let e=document.getElementById("chatInput");Ge(e.value),e.value=""};let a=document.createElement("div");a.className="whoTypingClass",a.id="whoTyping",e.appendChild(t),e.appendChild(n),e.appendChild(a),document.getElementById(On.container.id).appendChild(e);let r=document.createElement("div");r.className="chatMessagesClass",r.setAttribute("contenteditable",!0),r.id=On.chatBox.id,document.getElementById(On.container.id).appendChild(r)}function re(){var e=document.getElementById(On.inputBox.text_id);if(e.onkeypress=function(t){if(13==t.keyCode){var n=Hi(on);Qn.log(" chat ",on,n),Ge(e.value,n),e.value=""}},document.getElementById(On.inputBox.sendbutton_id)){var t=document.getElementById(On.inputBox.sendbutton_id);t.onclick=function(){var e=Hi(on),t=document.getElementById(On.inputBox.text_id);Ge(t.value,e),t.value=""}}if(document.getElementById(On.inputBox.minbutton_id)){var n=document.getElementById(On.inputBox.minbutton_id);n.onclick=function(){document.getElementById(On.container.id).hidden?m(On.container.id):u(On.container.id)}}}function oe(e){document.getElementById("whoTyping").innerHTML=e}function se(e){document.getElementById(e.button.id)?document.getElementById(e.button.id).click():Qn.error("[draw dom modifier] Received sync board event but no button id found")}function de(e){let t=document.createElement("span");t.className=e.button.class_off,t.innerHTML=e.button.html_off,t.onclick=function(){if(t.className==e.button.class_off&&document.getElementById(e.drawCanvasContainer).hidden){if(alert(" Draw Board Opened "),t.className=e.button.class_on,t.innerHTML=e.button.html_on,document.getElementById(e.container.id)?document.getElementById(e.container.id).hidden=!1:Qn.error("Draw : container-",e.container.id," doesnt exist"),document.getElementById(e.drawCanvasContainer)){document.getElementById(e.drawCanvasContainer).hidden=!1,document.getElementById(e.drawCanvasContainer).focus();var n={event:"open",from:"remote",board:e.drawCanvasContainer,button:e.button};an.send({type:"canvas",board:n})}else Qn.error("Draw : canvascontainer-",e.drawCanvasContainer," doesnt exist");yt(e)}else t.className!=e.button.class_on||document.getElementById(e.drawCanvasContainer).hidden||(t.className=e.button.class_off,t.innerHTML=e.button.html_off,document.getElementById(e.container.id)?document.getElementById(e.container.id).hidden=!0:Qn.error("Draw : container-",e.container.id," doesnt exist"),document.getElementById(e.drawCanvasContainer)?document.getElementById(e.drawCanvasContainer).hidden=!0:Qn.error("Draw : canvascontainer-",e.drawCanvasContainer," doesnt exist"))};var n=document.createElement("li");n.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(n)}function ce(e){Qn.log("[draw] dom modifier] drawCanvasobj ",e);let t=document.getElementById(e.button.id);t.className=e.button.class_off,t.innerHTML=e.button.html_off,t.onclick=function(){t.className==e.button.class_off&&document.getElementById(e.drawCanvasContainer).hidden?(m(e.container.id),Qn.log("[draw dom modifier] Draw Board Opened "),t.className=e.button.class_on,t.innerHTML=e.button.html_on,document.getElementById(e.drawCanvasContainer)?(m(e.drawCanvasContainer),document.getElementById(e.drawCanvasContainer).focus(),vt()):Qn.error("[drawjs] canvascontainer-",e.drawCanvasContainer," doesnt exist")):t.className==e.button.class_on&&!document.getElementById(e.drawCanvasContainer).hidden&&(Qn.log("[draw dom modifier] Draw Board Closed "),u(e.container.id),t.className=e.button.class_off,t.innerHTML=e.button.html_off,document.getElementById(e.drawCanvasContainer)?(u(e.drawCanvasContainer),bt()):Qn.error("[drawjs] canvascontainer-",e.drawCanvasContainer," doesnt exist"))}}function le(e){if(e.container.minbutton_id&&c(e.container.minbutton_id)){var t=c(e.container.minbutton_id);t.onclick=function(){c(e.container.id).hidden=!c(e.container.id).hidden}}}function me(){Qn.log("[timerjs] startForwardTimer");var e=Fi,t=ji,n=parseInt(e.innerHTML,10),a=parseInt(t.innerHTML,10);pe(e,n,t,a)}function ue(){Qn.log("[timerjs] startBackwardTimer",Pi,ji,Fi);let e=Fi,t=ji,n=parseInt(e.innerHTML,10),a=parseInt(t.innerHTML,10);ge(e,n,t,a)}function pe(e,t,n,a){setInterval(function(){t++,Fi.innerHTML=t,60==t&&(t=0,a++,ji.innerHTML=a)},1e3)}function ge(e,t,n,a){var r=setInterval(function(){t--,Fi.innerHTML=t,0==t&&(t=60,a--,ji.innerHTML=a,0>a&&clearInterval(r))},1e3)}function he(){if(Mn.span.currentTimeZone&&l(Mn.span.currentTimeZone)){let e=l(Mn.span.currentTimeZone);e.innerHTML=Vt()}else Qn.error(" [timer js ] timerobj.span.currentTimeZone DOM doesnt exist ")}function fe(e){if(!c("remoteTimeZone_"+e.userid))for(x in Mn.span.remoteTimeZone){let t=x+1;if(t>sn.length)return;let n;Mn.span.remoteTimeZone[x]?(Qn.info(" [timer js] showRemoteTimeZone -timerobj.span.remoteTimeZone",Mn.span.remoteTimeZone[x]," exist for remote"),n=l(Mn.span.remoteTimeZone[x])):(Qn.info(" [timer js] showRemoteTimeZone -timerobj.span.remoteTimeZone getting created for local and remotes"),n=document.createElement("li")),n.id="remoteTimeZone_"+e.userid,n.innerHTML=e.zone+" , "}}function ve(){try{if(Mn.span.currentTime&&l(Mn.span.currentTime)){let e=l(Mn.span.currentTime);e.innerHTML=new Date().toLocaleTimeString();setTimeout(ve,1e3)}else Qn.error("[timer js ] startTime - No place for timerobj.span.currentTime_id")}catch(e){Qn.error("[timer js ]",e)}}function be(e){let t=document.createElement("ul");t.id="remoteTimerArea_"+e;var n=Hi(e);if(c(n.videoContainer)){var a=c(n.videoContainer).parentNode;return a.appendChild(t),t}return null}function ye(e){let t={hour:"numeric",minute:"numeric",second:"numeric",hour12:!1,timeZone:e.zone},n;if(Mn.span.remoteTime[x])Qn.info(" [timer js] startPeersTime - timerobj.span.remoteTime dom ",Mn.span.remoteTime[x]," exist for remotes"),n=l(Mn.span.remoteTime[x]),n.id="remoteTime_"+e.userid,n.innerHTML=new Date().toLocaleString("en-US",t);else{if(Qn.info(" timerobj.span.remoteTime - timerobj.span.remoteTime dom  ",Mn.span.remoteTime[x]," does not exist, creating it"),c("remoteTimeDate_"+e.userid))return;n=document.createElement("span"),n.id="remoteTime_"+e.userid,n.innerHTML=new Date().toLocaleString("en-US",t);var a;a=c("remoteTimerArea_"+e.userid)?c("remoteTimerArea_"+e.userid):be(e.userid),a.appendChild(n)}}function we(e,t,n){function a(t){Qn.log("peer ",r),r.getStats()&&(navigator.mozGetUserMedia?r.getStats(e,function(e){var n=[];e.forEach(function(e){n.push(e)}),t(n)},t):r.getStats(function(e){var n=[];e.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),t(n)}))}var r=this;if(arguments[0]instanceof RTCMultiConnection){if(r=arguments[0],!navigator.mozGetUserMedia||(e=arguments[1],t=arguments[2],n=arguments[3]),!(e instanceof MediaStreamTrack)&&!!navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack.";}else if(!(e instanceof MediaStreamTrack)&&!!navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var s={audio:{},video:{}},d=!1;(function e(){a(function(a){for(var c={audio:{},video:{},results:a,nomore:function(){d=!0}},l=0,m;l<a.length;++l){if(m=a[l],m.datachannelid&&"datachannel"===m.type&&(c.datachannel={state:m.state}),"googLibjingleSession"===m.type&&(c.isOfferer=m.googInitiator),"googCertificate"==m.type&&(c.encryption=m.googFingerprintAlgorithm),"opus"==m.googCodecName&&m.bytesSent){var u=0;if(!!m.bytesSent){s.audio.prevBytesSent||(s.audio.prevBytesSent=m.bytesSent);var p=m.bytesSent-s.audio.prevBytesSent;s.audio.prevBytesSent=m.bytesSent,u=p/1024}c.audio||(c.audio=m),c.audio.availableBandwidth=u.toFixed(1)}if("VP8"==m.googCodecName){var u=0;if(!!m.bytesSent){s.video.prevBytesSent||(s.video.prevBytesSent=m.bytesSent);var p=m.bytesSent-s.video.prevBytesSent;s.video.prevBytesSent=m.bytesSent,u=p/1024}c.video||(c.video=m),c.video.availableBandwidth=u.toFixed(1),m.googFrameHeightReceived&&m.googFrameWidthReceived&&(c.resolutions={width:m.googFrameWidthReceived,height:m.googFrameHeightReceived})}"VideoBwe"==m.type&&(c.video.bandwidth={googActualEncBitrate:m.googActualEncBitrate,googAvailableSendBandwidth:m.googAvailableSendBandwidth,googAvailableReceiveBandwidth:m.googAvailableReceiveBandwidth,googRetransmitBitrate:m.googRetransmitBitrate,googTargetEncBitrate:m.googTargetEncBitrate,googBucketDelay:m.googBucketDelay,googTransmitBitrate:m.googTransmitBitrate}),"googCandidatePair"==m.type&&"true"==m.googActiveConnection&&(c.connectionType={local:{candidateType:m.googLocalCandidateType,ipAddress:m.googLocalAddress},remote:{candidateType:m.googRemoteCandidateType,ipAddress:m.googRemoteAddress},transport:m.googTransportType});var g=((navigator.connection||{}).type||"unknown").toString().toLowerCase();"localcandidate"===m.type&&(!c.connectionType&&(c.connectionType={}),c.connectionType.local={candidateType:m.candidateType,ipAddress:m.ipAddress+":"+m.portNumber,networkType:m.networkType||"unknown",transport:m.transport}),"remotecandidate"===m.type&&(!c.connectionType&&(c.connectionType={}),c.connectionType.local={candidateType:m.candidateType,ipAddress:m.ipAddress+":"+m.portNumber,networkType:m.networkType||g,transport:m.transport})}try{-1!==r.iceConnectionState.search(/failed|closed/gi)&&(d=!0)}catch(t){d=!0}!0===d&&(c.datachannel&&(c.datachannel.state="close"),c.ended=!0),t(c),!d&&null!=typeof n&&n&&setTimeout(e,n||1e3)})})()}function Se(){try{for(x=0;x<an.peers.getLength();x++){var e=an.peers.getAllParticipants()[x],t=JSON.stringify(an.peers[e],void 0,2);document.getElementById(Kn.statsConainer).innerHTML+="<pre >"+t+"</pre>"}}catch(t){Qn.error("[stats] rtpstats",t)}}function Ce(e){return localStorage.setItem("screenRoomid ",e),Qn.log("[screenshare JS] webrtcdevPrepareScreenShare - screenRoomid : ",e),Qn.log("[screenshare JS] webrtcdevPrepareScreenShare - filling up iceServers : ",ti,Rn),rn=new RTCMultiConnection,rn.channel=e,rn.socketURL=location.hostname+":8085/",rn.session={screen:!0,oneway:!0},rn.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!0},rn.onMediaError=function(e,t){Qn.error(e,t),ee(e.name)},rn.onstream=function(t){if(Qn.log("[screenshareJS] on stream in _screenshare :",t),Bn){let t=document.createElement("span");t.innerHTML="<br/>"+e+"<br/>",c(Jn.screenshareContainer).appendChild(t)}if("remote"==t.type&&"local"!=t.type){ee("started streaming remote's screen"),Qn.log("[screensharejs] on stream remote "),t.stream.streamid?(Qn.log("remote screen event.stream.streamId "+t.stream.streamId),ui=t.stream.streamid):t.streamid&&(Qn.log("remote screen event.streamid "+t.streamid),ui=t.streamid);let n=document.createElement("video"),a=t.stream;nt(n,a),console.log("========================= getElementById screenshareobj.screenshareContainer ",c(Jn.screenshareContainer)),c(Jn.screenshareContainer).appendChild(n),m(Jn.screenshareContainer),an.send({type:"screenshare",screenid:e,message:"screenshareStartedViewing"})}else ee("started streaming local screen"),Qn.log("[screenshareJS] on stream local "),an.send({type:"screenshare",screenid:e,screenStreamid:ui,message:"startscreenshare"});window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"screenshare",action:"onScreenShareStarted"}}))},rn.onstreamended=function(e){e&&Qn.log("[screenshare JS] onstreamended -",e);let t=Jn.button.shareButton.id;t&&document.getElementById(t)&&(document.getElementById(t).className=Jn.button.shareButton.class_off,document.getElementById(t).innerHTML=Jn.button.shareButton.html_off),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"screenshare",action:"onScreenShareEnded"}}))},rn.onopen=function(){Qn.log("[screensharejs] scrConn onopen - ",rn.connectionType)},rn.onerror=function(e){Qn.error("[screensharejs] scrConn error - ",e)},rn.onEntireSessionClosed=function(e){Qn.log("[screensharejs] scrConn onEntireSessionClosed - ",e)},rn.socketMessageEvent="scrRTCMultiConnection-Message",rn.socketCustomEvent="scrRTCMultiConnection-Custom-Message",ti&&"none"!=ti&&(!Rn&&(Qn.error("[screensharejs] ICE server not found yet in screenshare session"),alert("ICE server not found yet in screenshare session ")),rn.iceServers=Rn),rn}function Ee(e){return Qn.log("[screenshareJS] webrtcdevSharescreen, preparing screenshare by initiating ScrConn , scrroomid - ",e),new Promise(t=>{rn=Ce(e),t(e)}).then(function(e){socket?(Qn.log("[screenshare JS] open-channel-screenshare on - ",socket.io.uri),socket.emit("open-channel-screenshare",{channel:e,sender:on,maxAllowed:6}),Q("Making a new session for screenshare"+e)):Qn.error("[screenshare JS] parent socket doesnt exist "),socket.on("open-channel-screenshare-resp",function(t){Qn.log("[screenshare JS] open-channel-screenshare-response -",t),t.status&&t.channel==e&&rn.open(e,function(){Qn.log("[screenshare JS] webrtcdevSharescreen, opened up room for screen share ")})})})}function Re(e,t){return Qn.log("[screenshareJS] connectScrWebRTC, first preparing screenshare by initiating ScrConn , scrroomid - ",t),new Promise(e=>{Ce(t),e(t)}).then(function(t){Qn.log("[screenshare JS] connectScrWebRTC -> ",e,t),"join"==e?(rn.join(t),Q("Connected with existing Screenshare channel "+t)):(Q("Connection type not found for Screenshare "),Qn.error("[screenshare JS] connectScrWebRTC - Connection type not found for Screenshare "))})}function Te(){try{an.send({type:"screenshare",message:"stoppedscreenshare"}),rn.closeEntireSession(),Qn.log("[screenshare JS] Sender stopped: screenRoomid ",pi,"| Screen stopped ",rn,"| container ",c(Jn.screenshareContainer)),mi&&(mi.stop(),mi=null);let e=rn.streamEvents.selectFirst();e.stream.getTracks().forEach(e=>e.stop()),ke()}catch(e){Qn.error("[screensharejs] webrtcdevStopShareScreen - ",e)}}function ke(e){try{rn.onstreamended(),rn.removeStream(e),rn.close(),rn=null,Jn.screenshareContainer&&c(Jn.screenshareContainer)&&(c(Jn.screenshareContainer).innerHTML="")}catch(e){Qn.error("[screensharejs] webrtcdevStopShareScreen - ",e)}}function xe(){c("alertBox").hidden=!1,c("alertBox").innerHTML=""}function Ae(e){if(!e)throw"MediaStream is mandatory.";this.start=function(n){var a=gi?window.StereoRecorder:window.MediaRecorderWrapper;-1!=this.mimeType.indexOf("video")&&(a=gi?window.WhammyRecorder:window.MediaRecorderWrapper),"image/gif"===this.mimeType&&(a=window.GifRecorder),t=new a(e),t.ondataavailable=this.ondataavailable,t.onstop=this.onstop,t.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,t=Le(t,this),t.start(n)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.stop=function(){t&&t.stop()},this.ondataavailable=function(e){Qn.log("ondataavailable..",e)},this.onstop=function(e){Qn.warn("stopped..",e)};var t}function s(e,t){var n=window.MediaStreamRecorderScriptsDir,a=document.createElement("script");a.src=n+e,a.onload=t||function(){},document.documentElement.appendChild(a)}function Le(e,n){for(var a in n=Ie(n),n)"function"!=typeof n[a]&&(e[a]=n[a]);return e}function Ie(e){var t={};for(var n in e)if(-1!=n.indexOf("-")){var a=n.split("-"),r=a[0]+a[1].split("")[0].toUpperCase()+a[1].substr(1);t[r]=e[n]}else t[n]=e[n];return t}function Be(e,t){function n(e,t){for(var n=e.length+t.length,a=new Float32Array(n),r=0,s=0;s<n;)a[s++]=e[r],a[s++]=t[r],r++;return a}function a(e,t){for(var n=new Float32Array(t),a=0,r=e.length,s=0,d;s<r;s++)d=e[s],n.set(d,a),a+=d.length;return n}function s(e,t,n){for(var a=n.length,r=0;r<a;r++)e.setUint8(t+r,n.charCodeAt(r))}var d=[],c=[],l=!1,m=0,u=44100,p=t.mono?1:2,g,h,b,w,S;this.record=function(){l=!0,d.length=c.length=0,m=0},this.requestData=function(){if(0==m)return void(E=!1);E=!0;var e=d.slice(0),l=c.slice(0),g=m;d.length=c.length=[],m=0,E=!1;var h=a(e,g),b=a(e,g);if(2===p)var w=n(h,b);else var w=h;var S=new ArrayBuffer(44+2*w.length),C=new DataView(S);s(C,0,"RIFF"),C.setUint32(4,44+2*w.length,!0),s(C,8,"WAVE"),s(C,12,"fmt "),C.setUint32(16,16,!0),C.setUint16(20,1,!0),C.setUint16(22,p,!0),C.setUint32(24,u,!0),C.setUint32(28,4*u,!0),C.setUint16(32,2*p,!0),C.setUint16(34,16,!0),s(C,36,"data"),C.setUint32(40,2*w.length,!0);for(var R=w.length,T=44,k=0;k<R;k++)C.setInt16(T,w[k]*(32767*1),!0),T+=2;var A=new Blob([C],{type:"audio/wav"});Qn.debug("audio recorded blob size:",r(A.size)),t.ondataavailable(A)},this.stop=function(){l=!1,this.requestData()};var w=hi.AudioContext;hi.AudioContextConstructor||(hi.AudioContextConstructor=new w);var S=hi.AudioContextConstructor;hi.VolumeGainNode||(hi.VolumeGainNode=S.createGain());var h=hi.VolumeGainNode;hi.AudioInput||(hi.AudioInput=S.createMediaStreamSource(e));var b=hi.AudioInput;b.connect(h);var C=t.bufferSize||2048;if(0==t.bufferSize&&(C=0),S.createJavaScriptNode)g=S.createJavaScriptNode(C,p,p);else if(S.createScriptProcessor)g=S.createScriptProcessor(C,p,p);else throw"WebAudio API has no support on this browser.";C=g.bufferSize,Qn.debug("using audio buffer-size:",C);var E=!1;window.scriptprocessornode=g,1==p&&Qn.debug("It seems mono audio. All right-channels are skipped."),g.onaudioprocess=function(t){if(l&&!E){var e=t.inputBuffer.getChannelData(0);if(d.push(new Float32Array(e)),2==p){var n=t.inputBuffer.getChannelData(1);c.push(new Float32Array(n))}m+=C}},h.connect(g),g.connect(S.destination)}function Me(e,t){function n(){if(!m){if(d)return setTimeout(n,100);var e=new Date().getTime()-b;return e?void(b=new Date().getTime(),p.drawImage(h,0,0,u.width,u.height),!m&&c.push({duration:e,image:u.toDataURL("image/webp")}),!l&&!a(c[c.length-1])&&(l=!0,t.onStartedDrawingNonBlankFrames()),setTimeout(n,10)):n()}}function a(e,t,n){var a=document.createElement("canvas");a.width=u.width,a.height=u.height;var r=a.getContext("2d"),s={r:0,g:0,b:0},d=Kt(Xt(255,2)+Xt(255,2)+Xt(255,2)),c=t&&0<=t&&1>=t?t:0,l=n&&0<=n&&1>=n?n:0,m=new Image,p,g,h;m.src=e.image,r.drawImage(m,0,0,u.width,u.height);var b=r.getImageData(0,0,u.width,u.height);p=0,g=b.data.length,h=b.data.length/4;for(var w=0;w<g;w+=4){var S={r:b.data[w],g:b.data[w+1],b:b.data[w+2]},C=Kt(Xt(S.r-s.r,2)+Xt(S.g-s.g,2)+Xt(S.b-s.b,2));C<=d*c&&p++}return!(h-p<=h*l)}function s(e,t,n,a){var r=document.createElement("canvas");r.width=u.width,r.height=u.height;for(var s=r.getContext("2d"),d=[],c=t&&0<t&&t<=e.length?t:e.length,l={r:0,g:0,b:0},m=Kt(Xt(255,2)+Xt(255,2)+Xt(255,2)),p=n&&0<=n&&1>=n?n:0,g=a&&0<=a&&1>=a?a:0,h=!1,b=0;b<c;b++){var w,S,C;if(!h){var E=new Image;E.src=e[b].image,s.drawImage(E,0,0,u.width,u.height);var R=s.getImageData(0,0,u.width,u.height);w=0,S=R.data.length,C=R.data.length/4;for(var T=0;T<S;T+=4){var k={r:R.data[T],g:R.data[T+1],b:R.data[T+2]},A=Kt(Xt(k.r-l.r,2)+Xt(k.g-l.g,2)+Xt(k.b-l.b,2));A<=m*p&&w++}}!h&&C-w<=C*g||(-1===t&&(h=!0),d.push(e[b]))}return d=d.concat(e.slice(c)),0>=d.length&&d.push(e[e.length-1]),d}this.record=function(){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(!this.width&&(this.width=h.videoWidth||320),!this.height&&(this.height=h.videoHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),u.width=this.canvas.width,u.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?h=this.video.cloneNode():(h=document.createElement("video"),h.src=wi.createObjectURL(e),h.width=this.video.width,h.height=this.video.height),h.muted=!0,h.play(),b=new Date().getTime(),w=new fi.Video,Qn.log("canvas resolutions",u.width,"*",u.height),Qn.log("video width/height",h.width||u.width,"*",h.height||u.height),n()},this.clearOldRecordedFrames=function(){c=[]};var d=!1;this.requestData=function(){if(!c.length)return void(d=!1);d=!0;var e=c.slice(0);c=[],w.frames=s(e,-1);var n=w.compile();t.ondataavailable(n),Qn.debug("video recorded blob size:",r(n.size)),d=!1};var c=[],l=!1,m=!1;this.stop=function(){m=!0,this.requestData()};var u=document.createElement("canvas"),p=u.getContext("2d"),g=this,h,b,w}function Ue(e){this.start=function(a){for(var r in a=a||1e3,t=new Me(e,this),this)"function"!=typeof this[r]&&(t[r]=this[r]);t.record(),n=setInterval(function(){t.requestData()},a)},this.stop=function(){t&&(t.stop(),clearTimeout(n))},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.ondataavailable=function(){};var t,n}function Oe(e){function t(){Date.now();var e=new Blob([new Uint8Array(m.stream().bin)],{type:"image/gif"});n.ondataavailable(e),m.stream().bin=[]}if(!window.GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.start=function(e){function n(e){d=vi(n),void 0===typeof l&&(l=e),90>e-l||(r.drawImage(s,0,0,p,g),m.addFrame(r),l=e)}e=e||1e3;var p=this.videoWidth||320,g=this.videoHeight||240;a.width=s.width=p,a.height=s.height=g,m=new GIFEncoder,m.setRepeat(0),m.setDelay(this.frameRate||200),m.setQuality(this.quality||1),m.start(),c=Date.now(),d=vi(n),u=setTimeout(t,e)},this.stop=function(){d&&(bi(d),clearTimeout(u),t())},this.ondataavailable=function(){},this.onstop=function(){};var n=this,a=document.createElement("canvas"),r=a.getContext("2d"),s=document.createElement("video");s.muted=!0,s.autoplay=!0,s.src=wi.createObjectURL(e),s.play();var d=null,c,l,m,u}function r(e){if(0===e)return"0 Bytes";var t=parseInt($t(Qt(e)/Qt(1000)),10);return(e/Xt(1000,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a JavaScript-based media-recording library for modern web-browsers (supporting WebRTC getUserMedia API). It is optimized for different devices and browsers to bring all client-side (pluginfree) recording solutions in single place.
 * @summary JavaScript audio/video recording library runs top over WebRTC getUserMedia API.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recordRTC = RecordRTC(mediaStream, {
 *     type: 'video' // audio or video or gif or canvas
 * });
 *
 * // or, you can also use the "new" keyword
 * var recordRTC = new RecordRTC(mediaStream[, config]);
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function Ne(e,t){function n(){return(t.disableLogs||Qn.debug("started recording "+t.type+" stream."),b)?(b.clearRecordedData(),b.resume(),p.recordingDuration&&u(),p):(a(function(){p.recordingDuration&&u()}),p)}function a(n){n&&(t.initCallback=function(){n(),n=t.initCallback=null});var a=new Pe(e,t);b=new a(e,t),b.record(),t.disableLogs||Qn.debug("Initialized recorderType:",b.constructor.name,"for output-type:",t.type)}function s(e){function n(n){for(var s in b)p&&(p[s]=b[s]),a&&(a[s]=b[s]);var d=b.blob;if(!d)if(n)b.blob=d=n;else throw"Recording failed.";if(e){var c=wi.createObjectURL(d);e(c)}d&&!t.disableLogs&&Qn.debug(d.type,"->",r(d.size)),t.autoWriteToDisk&&m(function(e){var n={};n[t.type+"Blob"]=e,Ri.Store(n)})}if(!b)return Qn.warn(g);var a=this;t.disableLogs||Qn.warn("Stopped recording "+t.type+" stream."),"gif"===t.type?(b.stop(),n()):b.stop(n)}function d(){return b?void(b.pause(),!t.disableLogs&&Qn.debug("Paused recording.")):Qn.warn(g)}function c(){return b?void(b.resume(),!t.disableLogs&&Qn.debug("Resumed recording.")):Qn.warn(g)}function l(e){postMessage(new FileReaderSync().readAsDataURL(e))}function m(e,n){function a(e){var t=wi.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(t);return wi.revokeObjectURL(t),n}if(!e)throw"Pass a callback function over getDataURL.";var r=n?n.blob:(b||{}).blob;if(!r)return t.disableLogs||Qn.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){m(e,n)},1e3);if("undefined"!=typeof Worker&&!navigator.mozGetUserMedia){var s=a(l);s.onmessage=function(t){e(t.data)},s.postMessage(r)}else{var d=new FileReader;d.readAsDataURL(r),d.onload=function(t){e(t.target.result)}}}function u(){setTimeout(function(){s(p.onRecordingStopped)},p.recordingDuration)}if(!e)throw"MediaStream is mandatory.";t=t||{type:"video"},t=new De(e,t);var p=this,g="It seems that \"startRecording\" is not invoked for "+t.type+" recorder.",h={startRecording:n,stopRecording:s,pauseRecording:d,resumeRecording:c,initRecorder:a,setRecordingDuration:function(e,t){if("undefined"==typeof e)throw"milliseconds is required.";if("number"!=typeof e)throw"milliseconds must be a number.";return p.recordingDuration=e,p.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){p.onRecordingStopped=e}}},clearRecordedData:function(){return b?void(b.clearRecordedData(),!t.disableLogs&&Qn.debug("Cleared old recorded data.")):Qn.warn(g)},getBlob:function(){return b?b.blob:Qn.warn(g)},getDataURL:m,toURL:function(){return b?wi.createObjectURL(b.blob):Qn.warn(g)},save:function(e){return b?void Fe(b.blob,e):Qn.warn(g)},getFromDisk:function(e){return b?void Ne.getFromDisk(t.type,e):Qn.warn(g)},setAdvertisementArray:function(e){t.advertisement=[];for(var n=e.length,a=0;a<n;a++)t.advertisement.push({duration:a,image:e[a]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null},b;if(!this)return p=h,h;for(var w in h)this[w]=h[w];return p=this,h}/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function De(e,t){return t.recorderType&&!t.type&&(t.recorderType===Ue||t.recorderType===He?t.type="video":t.recorderType===Oe?t.type="gif":t.recorderType===Be?t.type="audio":t.recorderType===Ae&&(e.getAudioTracks().length&&e.getVideoTracks().length?t.type="video":e.getAudioTracks().length&&!e.getVideoTracks().length?t.type="audio":!e.getAudioTracks().length&&e.getVideoTracks().length&&(t.type="audio"))),"undefined"!=typeof Ae&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(!t.mimeType&&(t.mimeType="video/webm"),!t.type&&(t.type=t.mimeType.split("/")[0]),!t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),!t.type&&(t.type="audio")),t}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function Pe(e,t){var n;return(ci||Si||di)&&(n=Be),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!ci&&(n=Ae),"video"===t.type&&(ci||di)&&(n=Ue),"gif"===t.type&&(n=Oe),"canvas"===t.type&&(n=He),_e()&&n!==He&&n!==Oe&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&e.getVideoTracks().length&&(n=Ae),t.recorderType&&(n=t.recorderType),t.disableLogs||!n||!n.name||Qn.debug("Using recorderType:",n.name||n.constructor.name),n}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 */function je(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t=this.mediaType,n=this.mimeType||{audio:null,video:null,gif:null},a;if("function"!=typeof t.audio&&_e()&&e.getAudioTracks&&!e.getAudioTracks().length&&(t.audio=!1),"function"!=typeof t.video&&_e()&&e.getVideoTracks&&!e.getVideoTracks().length&&(t.video=!1),!t.audio&&!t.video)throw"MediaStream must have either audio or video tracks.";if(!t.audio||(a=null,"function"==typeof t.audio&&(a=t.audio),this.audioRecorder=new Ne(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:a,mimeType:n.audio}),!t.video&&this.audioRecorder.startRecording()),!!t.video){a=null,"function"==typeof t.video&&(a=t.video);var r=e;if(_e()&&!!t.audio&&"function"==typeof t.audio){var s=e.getVideoTracks()[0];navigator.mozGetUserMedia?(r=new Ci,r.addTrack(s),a&&a===Ue&&(a=Ae)):r=new Ci([s])}this.videoRecorder=new Ne(r,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:a,mimeType:n.video}),t.audio||this.videoRecorder.startRecording()}if(!!t.audio&&!!t.video){var d=this;_e()?(d.audioRecorder=null,d.videoRecorder.startRecording()):d.videoRecorder.initRecorder(function(){d.audioRecorder.initRecorder(function(){d.videoRecorder.startRecording(),d.audioRecorder.startRecording()})})}!t.gif||(a=null,"function"==typeof t.gif&&(a=t.gif),this.gifRecorder=new Ne(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:a,mimeType:n.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var a=n(function(e){postMessage(new FileReaderSync().readAsDataURL(e))});a.onmessage=function(e){t(e.data)},a.postMessage(e)}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}}function n(e){var t=wi.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(t),a;if("undefined"!=typeof wi)a=wi;else if("undefined"!=typeof webkitURL)a=webkitURL;else throw"Neither URL nor webkitURL detected.";return a.revokeObjectURL(t),n}this.getBlob(function(n){n.audio&&n.video?t(n.audio,function(a){t(n.video,function(t){e({audio:a,video:t})})}):n.audio?t(n.audio,function(t){e({audio:t})}):n.video&&t(n.video,function(t){e({video:t})})})},this.writeToDisk=function(){Ne.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},!!e.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),!!e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),!!e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}function r(e){if(0===e)return"0 Bytes";var t=parseInt($t(Qt(e)/Qt(1000)),10);return(e/Xt(1000,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function Fe(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(t){}var n=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var a=t.split(".");t=a[0],n=a[1]}var r=(t||en(9999999999*Math.random())+888888888)+"."+n;if("undefined"!=typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,r);if("undefined"!=typeof navigator.msSaveBlob)return navigator.msSaveBlob(e,r);var s=document.createElement("a");s.href=wi.createObjectURL(e),s.target="_blank",s.download=r,!navigator.mozGetUserMedia||(s.onclick=function(){(document.body||document.documentElement).removeChild(s)},(document.body||document.documentElement).appendChild(s));var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});s.dispatchEvent(d),navigator.mozGetUserMedia||wi.revokeObjectURL(s.href)}/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */function _e(){var e=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t=!!window.chrome&&!e,n="undefined"!=typeof window.InstallTrigger;if(n)return!0;var a=navigator.appVersion,r=navigator.userAgent,s=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10),c,l;return(t||e)&&(c=r.indexOf("Chrome"),s=r.substring(c+7)),-1!==(l=s.indexOf(";"))&&(s=s.substring(0,l)),-1!==(l=s.indexOf(" "))&&(s=s.substring(0,l)),d=parseInt(""+s,10),isNaN(d)&&(s=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10)),49<=d}/**
 * MediaStreamRecorder is an abstraction layer for "MediaRecorder API". It is used by {@link RecordRTC} to record MediaStream(s) in Firefox.
 * @summary Runs top over MediaRecorder API.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/mp4', // audio/ogg or video/webm
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     getNativeBlob: true // by default it is false
 * }
 * var recorder = new MediaStreamRecorder(MediaStream, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", onAudioProcessStarted: function}
 */function Ae(t,n){function a(){if("active"in t){if(!t.active)return!1;}else if("ended"in t&&t.ended)return!1;return!0}var r=this;if(n=n||{mimeType:"video/webm"},"audio"===n.type){if(t.getVideoTracks().length&&t.getAudioTracks().length){var s;navigator.mozGetUserMedia?(s=new Ci,s.addTrack(t.getAudioTracks()[0])):s=new Ci(t.getAudioTracks()),t=s}n.mimeType&&-1!==n.mimeType.toString().toLowerCase().indexOf("audio")||(n.mimeType=ci?"audio/webm":"audio/ogg"),n.mimeType&&"audio/ogg"!==n.mimeType.toString().toLowerCase()&&!!navigator.mozGetUserMedia&&(n.mimeType="audio/ogg")}this.record=function(){r.blob=null;var e=n;n.disableLogs||Qn.log("Passing following config over MediaRecorder API.",e),d&&(d=null),ci&&!_e()&&(e="video/vp8");try{d=new MediaRecorder(t,e)}catch(n){d=new MediaRecorder(t)}"canRecordMimeType"in d&&!1===d.canRecordMimeType(n.mimeType)&&!n.disableLogs&&Qn.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType),d.ignoreMutedMedia=n.ignoreMutedMedia||!1,d.ondataavailable=function(t){r.dontFireOnDataAvailableEvent||!t.data||!t.data.size||100>t.data.size||r.blob||(r.blob=n.getNativeBlob?t.data:new Blob([t.data],{type:n.mimeType||"video/webm"}),r.recordingCallback&&(r.recordingCallback(r.blob),r.recordingCallback=null))},d.onerror=function(e){n.disableLogs||("InvalidState"===e.name?Qn.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?Qn.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?Qn.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?Qn.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?Qn.error("The UA cannot provide the codec or recording option that has been requested.",e):Qn.error("MediaRecorder Error",e)),"inactive"!==d.state&&"stopped"!==d.state&&d.stop()},d.start(36e5),n.onAudioProcessStarted&&n.onAudioProcessStarted(),n.initCallback&&n.initCallback()},this.stop=function(e){d&&(this.recordingCallback=function(t){d=null,e&&e(t)},"recording"===d.state&&d.stop())},this.pause=function(){d&&("recording"!==d.state||d.pause())},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=n.disableLogs;return n.disableLogs=!0,this.record(),void(n.disableLogs=e)}d&&("paused"!==d.state||d.resume())},this.clearRecordedData=function(){d&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var r=this,d;(function e(){return d?!1===a()?(n.disableLogs||Qn.log("MediaStream seems stopped."),void r.stop()):void setTimeout(e,1e3):void 0})()}/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function Be(e,t){function n(){if("active"in e){if(!e.active)return!1;}else if("ended"in e&&e.ended)return!1;return!0}function a(e,t){function n(e,t){function n(e,t){for(var n=new Float64Array(t),a=0,r=e.length,s=0,d;s<r;s++)d=e[s],n.set(d,a),a+=d.length;return n}function a(e,t){for(var n=e.length+t.length,a=new Float64Array(n),r=0,s=0;s<n;)a[s++]=e[r],a[s++]=t[r],r++;return a}function r(e,t,n){for(var a=n.length,r=0;r<a;r++)e.setUint8(t+r,n.charCodeAt(r))}var s=e.numberOfAudioChannels,d=e.leftBuffers.slice(0),c=e.rightBuffers.slice(0),l=e.sampleRate,m=e.internalInterleavedLength;2===s&&(d=n(d,m),c=n(c,m)),1===s&&(d=n(d,m));var u;2===s&&(u=a(d,c)),1===s&&(u=d);var p=u.length,g=new ArrayBuffer(44+2*p),h=new DataView(g);r(h,0,"RIFF"),h.setUint32(4,44+2*p,!0),r(h,8,"WAVE"),r(h,12,"fmt "),h.setUint32(16,16,!0),h.setUint16(20,1,!0),h.setUint16(22,s,!0),h.setUint32(24,l,!0),h.setUint32(28,2*l,!0),h.setUint16(32,2*s,!0),h.setUint16(34,16,!0),r(h,36,"data"),h.setUint32(40,2*p,!0);for(var b=44,w=0;w<p;w++)h.setInt16(b,u[w]*(32767*1),!0),b+=2;return t?t({buffer:g,view:h}):void postMessage({buffer:g,view:h})}if(!ci)return void n(e,function(e){t(e.buffer,e.view)});var a=r(n);a.onmessage=function(e){t(e.data.buffer,e.data.view),wi.revokeObjectURL(a.workerURL)},a.postMessage(e)}function r(e){var t=wi.createObjectURL(new Blob([e.toString(),";this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(t);return n.workerURL=t,n}function s(a){if(!E){if(!1===n()&&(!t.disableLogs&&Qn.log("MediaStream seems stopped."),g.disconnect(),m=!1),!m)return void b.disconnect();R||(R=!0,t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback());var e=a.inputBuffer.getChannelData(0);if(c.push(new Float32Array(e)),2===p){var r=a.inputBuffer.getChannelData(1);l.push(new Float32Array(r))}u+=S}}if(!e.getAudioTracks().length)throw"Your stream has no audio tracks.";t=t||{};var d=this,c=[],l=[],m=!1,u=0,p=2,g;!0===t.leftChannel&&(p=1),1===t.numberOfAudioChannels&&(p=1),t.disableLogs||Qn.debug("StereoAudioRecorder is set to record number of channels: ",p),this.record=function(){if(!1===n())throw"Please make sure MediaStream is active.";c.length=l.length=0,u=0,b&&b.connect(g),R=E=!1,m=!0},this.stop=function(e){m=!1,a({sampleRate:C,numberOfAudioChannels:p,internalInterleavedLength:u,leftBuffers:c,rightBuffers:1===p?[]:l},function(t,n){d.blob=new Blob([n],{type:"audio/wav"}),d.buffer=new ArrayBuffer(n.buffer.byteLength),d.view=n,d.sampleRate=C,d.bufferSize=S,d.length=u,e&&e(),R=!1})},Ei.AudioContextConstructor||(Ei.AudioContextConstructor=new Ei.AudioContext);var h=Ei.AudioContextConstructor,b=h.createMediaStreamSource(e),w=[0,256,512,1024,2048,4096,8192,16384],S="undefined"==typeof t.bufferSize?4096:t.bufferSize;if(-1!==w.indexOf(S)||t.disableLogs||Qn.warn("Legal values for buffer-size are "+JSON.stringify(w,null,"\t")),h.createJavaScriptNode)g=h.createJavaScriptNode(S,p,p);else if(h.createScriptProcessor)g=h.createScriptProcessor(S,p,p);else throw"WebAudio API has no support on this browser.";b.connect(g),t.bufferSize||(S=g.bufferSize);var C="undefined"==typeof t.sampleRate?h.sampleRate||44100:t.sampleRate;(22050>C||96e3<C)&&!t.disableLogs&&Qn.warn("sample-rate must be under range 22050 and 96000."),t.disableLogs||(Qn.log("sample-rate",C),Qn.log("buffer-size",S));var E=!1;this.pause=function(){E=!0},this.resume=function(){if(!1===n())throw"Please make sure MediaStream is active.";return m?void(E=!1):(t.disableLogs||Qn.info("Seems recording has been restarted."),void this.record())},this.clearRecordedData=function(){this.pause(),c.length=l.length=0,u=0};var R=!1;g.onaudioprocess=s,g.connect(h.destination)}/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function He(e,t){function n(){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t}function a(){if(p)return g=new Date().getTime(),setTimeout(a,500);if("canvas"===e.nodeName.toLowerCase()){var r=new Date().getTime()-g;return g=new Date().getTime(),h.frames.push({image:n(),duration:r}),void(u&&setTimeout(a,t.frameInterval))}html2canvas(e,{grabMouse:"undefined"==typeof t.showMousePointer||t.showMousePointer,onrendered:function(e){var n=new Date().getTime()-g;return n?void(g=new Date().getTime(),h.frames.push({image:e.toDataURL("image/webp",1),duration:n}),u&&setTimeout(a,t.frameInterval)):setTimeout(a,t.frameInterval)}})}if("undefined"==typeof html2canvas&&"canvas"!==e.nodeName.toLowerCase())throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";t=t||{},t.frameInterval||(t.frameInterval=10);var r=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(r=!0)});var s=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,d=50,c=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);s&&c&&c[2]&&(d=parseInt(c[2],10)),s&&52>d&&(r=!1);var l,m;if(!r)!navigator.mozGetUserMedia||t.disableLogs||Qn.error("Canvas recording is NOT supported in Firefox.");else if(t.disableLogs||Qn.debug("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)l=e;else if(e instanceof CanvasRenderingContext2D)l=e.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";var u;this.record=function(){if(u=!0,r){var e;"captureStream"in l?e=l.captureStream(25):"mozCaptureStream"in l?e=l.mozCaptureStream(25):"webkitCaptureStream"in l&&(e=l.webkitCaptureStream(25));try{var n=new Ci;n.addTrack(e.getVideoTracks()[0]),e=n}catch(t){}if(!e)throw"captureStream API are NOT available.";m=new Ae(e,{mimeType:"video/webm"}),m.record()}else h.frames=[],g=new Date().getTime(),a();t.initCallback&&t.initCallback()},this.getWebPImages=function(n){if("canvas"!==e.nodeName.toLowerCase())return void n();var a=h.frames.length;h.frames.forEach(function(e,n){var r=a-n;t.disableLogs||Qn.debug(r+"/"+a+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(r,a);var s=e.image.toDataURL("image/webp",1);h.frames[n].image=s}),t.disableLogs||Qn.debug("Generating WebM"),n()},this.stop=function(e){u=!1;var n=this;return r&&m?void m.stop(e):void this.getWebPImages(function(){h.compile(function(a){t.disableLogs||Qn.debug("Recording finished!"),n.blob=a,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob),h.frames=[]})})};var p=!1;this.pause=function(){p=!0},this.resume=function(){p=!1,u||this.record()},this.clearRecordedData=function(){this.pause(),h.frames=[]};var g=new Date().getTime(),h=new fi.Video(100)}/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function Ue(e,t){function n(e){e="undefined"==typeof e?10:e;var t=new Date().getTime()-u;return t?d?(u=new Date().getTime(),setTimeout(n,100)):void(u=new Date().getTime(),m.paused&&m.play(),l.drawImage(m,0,0,c.width,c.height),p.frames.push({duration:t,image:c.toDataURL("image/webp")}),!s&&setTimeout(n,e,e)):setTimeout(n,e,e)}function a(e){var t=-1,n=e.length,a=function(){return t++,t===n?void e.callback():void e.functionToLoop(a,t)};a()}function r(e,t,n,r,s){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var l=d.getContext("2d"),m=[],u=t&&0<t&&t<=e.length?t:e.length,p={r:0,g:0,b:0},g=Kt(Xt(255,2)+Xt(255,2)+Xt(255,2)),h=n&&0<=n&&1>=n?n:0,b=r&&0<=r&&1>=r?r:0,w=!1;a({length:u,functionToLoop:function(n,a){var r=function(){!w&&u-s<=u*b||(-1===t&&(w=!0),m.push(e[a])),n()},s,d,u;if(!w){var S=new Image;S.onload=function(){l.drawImage(S,0,0,c.width,c.height);var e=l.getImageData(0,0,c.width,c.height);s=0,d=e.data.length,u=e.data.length/4;for(var t=0;t<d;t+=4){var n={r:e.data[t],g:e.data[t+1],b:e.data[t+2]},a=Kt(Xt(n.r-p.r,2)+Xt(n.g-p.g,2)+Xt(n.b-p.b,2));a<=g*h&&s++}r()},S.src=e[a].image}else r()},callback:function(){m=m.concat(e.slice(u)),0>=m.length&&m.push(e[e.length-1]),s(m)}})}t=t||{},t.frameInterval||(t.frameInterval=10),t.disableLogs||Qn.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),c.width=t.canvas.width,c.height=t.canvas.height,l=c.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(m=t.video.cloneNode(),t.initCallback&&t.initCallback()):(m=document.createElement("video"),"undefined"==typeof m.srcObject?m.src=wi.createObjectURL(e):m.srcObject=e,m.onloadedmetadata=function(){t.initCallback&&t.initCallback()},m.width=t.video.width,m.height=t.video.height),m.muted=!0,m.play(),u=new Date().getTime(),p=new fi.Video,t.disableLogs||(Qn.log("canvas resolutions",c.width,"*",c.height),Qn.log("video width/height",m.width||c.width,"*",m.height||c.height)),n(t.frameInterval)};var s=!1;this.stop=function(e){s=!0;var n=this;setTimeout(function(){r(p.frames,-1,null,null,function(a){p.frames=a,t.advertisement&&t.advertisement.length&&(p.frames=t.advertisement.concat(p.frames)),p.compile(function(t){n.blob=t,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob)})})},10)};var d=!1;this.pause=function(){d=!0},this.resume=function(){d=!1,s&&this.record()},this.clearRecordedData=function(){this.pause(),p.frames=[]};var c=document.createElement("canvas"),l=c.getContext("2d"),m,u,p}/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function Oe(e,t){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";t=t||{};var n=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){function e(l){return a?setTimeout(function(){e(l)},100):void(c=vi(e),void 0===typeof u&&(u=l),90>l-u||(!n&&d.paused&&d.play(),!n&&s.drawImage(d,0,0,r.width,r.height),t.onGifPreview&&t.onGifPreview(r.toDataURL("image/png")),p.addFrame(s),u=l))}n||(!t.width&&(t.width=d.offsetWidth||320),!this.height&&(t.height=d.offsetHeight||240),!t.video&&(t.video={width:t.width,height:t.height}),!t.canvas&&(t.canvas={width:t.width,height:t.height}),r.width=t.canvas.width,r.height=t.canvas.height,d.width=t.video.width,d.height=t.video.height),p=new GIFEncoder,p.setRepeat(0),p.setDelay(t.frameRate||200),p.setQuality(t.quality||10),p.start(),l=Date.now();this;c=vi(e),t.initCallback&&t.initCallback()},this.stop=function(){c&&bi(c),m=Date.now(),this.blob=new Blob([new Uint8Array(p.stream().bin)],{type:"image/gif"}),p.stream().bin=[]};var a=!1;this.pause=function(){a=!0},this.resume=function(){a=!1},this.clearRecordedData=function(){p&&(this.pause(),p.stream().bin=[])};var r=document.createElement("canvas"),s=r.getContext("2d");if(n&&(e instanceof CanvasRenderingContext2D?(s=e,r=s.canvas):e instanceof HTMLCanvasElement&&(s=e.getContext("2d"),r=e)),!n){var d=document.createElement("video");d.muted=!0,d.autoplay=!0,"undefined"==typeof d.srcObject?d.src=wi.createObjectURL(e):d.srcObject=e,d.play()}var c=null,l,m,u,p}function Ve(e,t){var n=document.createElement("div");return n.id=e+"snapshotButton",n.setAttribute("title","Snapshot"),n.className=Pn.button.class_on,n.innerHTML=Pn.button.html_on,n.onclick=function(){We(t,function(e){var t="snapshot"+new Date().getTime(),n;n=on?Hi(on):Hi(an.userid),n.filearray.push(t);var a=document.createElement("div");a.value=n.filearray.length,Nn.active?(ze(e,"imagesnapshot",t),R(n.uuid,n,e,t,"imagesnapshot"),k(n.uuid,n,e,t,"imagesnapshot")):k(n.uuid,n,e,t,"imagesnapshot")})},n}function We(e,t){try{return e.videoContainer?function(e){if(e){var n=document.createElement("canvas");n.width=e.videoWidth||e.clientWidth,n.height=e.videoHeight||e.clientHeight;var a=n.getContext("2d");a.drawImage(e,0,0,n.width,n.height),t(n.toDataURL("image/png"))}else t("")}(document.getElementById(e.videoContainer)):"empty"}catch(t){Qn.error(" [Snapshot - take snapshot] ",t)}}function ze(e,t,n){an.send({type:t,message:e,name:n})}function Ge(e,t){Ye({header:an.extra.username,message:e,userinfo:t,color:an.extra.color}),an.send({type:"chat",userinfo:t,message:e})}function qe(e){return e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>")}function Ye(t){""!=t.message&&" "!=t.message&&Ze("chat-message self msg-avatar",t.userinfo,t.message,On.chatBox.id)}function Je(t){""!=t.message&&" "!=t.message&&Ze("chat-message user msg-avatar",t.userinfo,t.message,On.chatBox.id)}function Ze(e,t,a,r){var s=document.createElement("div");s.className=e,Qn.log("addNewMessagelocal",t),We(t,function(e){var n=document.createElement("img");n.src=e,n.setAttribute("style","border-radius: 50%;height:40px");var r=document.createElement("span");r.className="cm-msg-text",r.innerHTML=qe(a),s.appendChild(n),s.appendChild(r)}),document.getElementById(r).insertBefore(s,document.getElementById(r).firstChild)}function Ke(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){Qn.log("[sessionmanager] checkDevices ",e.kind,": ",e.label," id = ",e.deviceId)})}).catch(function(e){Qn.error("[sessionmanager] checkDevices ",e.name,": ",e.message)}):void Qn.warn("enumerateDevices() not supported.")}function Xe(e){let t=navigator.mediaDevices;return t&&t.enumerateDevices?void t.enumerateDevices().then(t=>{e(t.some(e=>"videoinput"===e.kind))}):e(!1)}function Qe(e){let t=navigator.mediaDevices;return t&&t.enumerateDevices?void t.enumerateDevices().then(t=>{e(t.some(e=>"audioinput"===e.kind))}):e(!1)}async function $e(){let e=null;try{if(e=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}),0<e.getVideoTracks().length)return Qn.log("--------------------------------- Video Permission obtained "),void(Ln=!0)}catch(e){Qn.error(e.name+": "+e.message)}Ln=!1}async function et(){let e=null;try{if(e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),0<e.getAudioTracks().length)return Qn.log("--------------------------------- Audio Permission obtained "),void(An=!0)}catch(e){Qn.error(e.name+": "+e.message)}An=!1}function tt(e){return e.dontAttachStream=!1,e.dontGetRemoteStream=!1,Qn.log(" [startJS] getCamMedia  role :",Xn),Qn.log(" start getusermedia - outgoingVideo "+Ln+" outgoingAudio "+An),new Promise(function(t){"inspector"==Xn?(e.dontCaptureUserMedia=!0,console.log("[_mediacontrol.js] getCamMedia  - Joining as inspector without camera Video")):Ln&&An?(e.dontCaptureUserMedia=!1,Qn.log("[_mediacontrol.js] getCamMedia  - Capture Media "),e.getUserMedia()):!Ln&&An?(e.dontCaptureUserMedia=!1,Qn.warn("[_mediacontrol.js] getCamMedia  - Dont Capture Webcam only Mic "),e.getUserMedia()):(e.dontCaptureUserMedia=!0,Qn.error(" [_mediacontrol.js] getCamMedia - dont Capture outgoing video ",Ln),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"session",action:"onNoCameraCard"}}))),t("success")}).catch(e=>{Qn.error("[_mediacontrol.js] getCamMedia  - rejected promise ("+e+")")})}function nt(e,t){try{let n="";if(Qn.log("[ Mediacontrol - attachMediaStream ] element ",e),0<document.getElementsByName(e).length)n=document.getElementsByName(e)[0];else if(e.video)n=e.video;else if("VIDEO"==e.nodeName)n=e;else return;Qn.log("[ Mediacontrol - attachMediaStream ] stream ",t),t?(n.srcObject=t,n.play(),Qn.log("[ Mediacontrol - attachMediaStream ] Media Stream attached to ",n," successfully")):("srcObject"in n?n.srcObject=null:n.src=null,Qn.warn("[ Mediacontrol - attachMediaStream ] Media Stream empty '' attached to ",n," as stream is not valid ",t))}catch(e){Qn.error(" [ Mediacontrol - attachMediaStream ]  error",e)}}function it(e,t){e.src=t.src}function at(e,t,n,a){let r=document.createElement("div");return r.id=e+"recordButton",r.setAttribute("title","Record"),r.className=jn.button.class_off,r.innerHTML=jn.button.html_off,r.onclick=function(){r.className==jn.button.class_on?(r.className=jn.button.class_off,r.innerHTML=jn.button.html_off,ot(t,n,a)):r.className==jn.button.class_off&&(r.className=jn.button.class_on,r.innerHTML=jn.button.html_on,rt(t,n,a))},r}function rt(e,t,n){let a=Ne(n,{type:"video",recorderType:Ae});a.startRecording(),Ti[t]=a}function ot(e,t){Ti[t]||Qn.log("wrong stream id ");let n=Ti[t];n.stopRecording(function(){let t=n.getBlob();e=on?Hi(on):Hi(an.userid);let a="recordedvideo"+new Date().getTime();e.filearray.push(a);let r=document.createElement("div");r.value=e.filearray.length;let s=wi.createObjectURL(t);R(e.uuid,e,s,a,"videoRecording"),k(e.uuid,e,s,a,"videoRecording")})}async function st(){Qn.log("[screenrecord js] webrtcdevRecordScreen");try{ki=await navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen",mandatory:{maxWidth:1920<window.screen.width?window.screen.width:1920,maxHeight:1080<window.screen.height?window.screen.height:1080},optional:[]}}),Qn.log("[screenrecord js] stream",ki)}catch(e){Qn.error("[screenrecord js] Error in webrtcdevRecordScreen ",e)}ki.addEventListener("inactive",t=>{Qn.log("Capture stream inactive - stop recording!"),dt(t)});try{xi=new MediaRecorder(ki,{mimeType:"video/webm"}),xi.addEventListener("dataavailable",e=>{e.data&&0<e.data.size&&Ai.push(e.data)}),xi.start(10),Qn.log("[screenrecord js] mediaRecorder",xi)}catch(e){Qn.error("[screenrecord js] Error in mediaRecorder ",e)}}function dt(e){Qn.log("webrtcdevStopRecordScreen",e),xi.stop(),xi=null,ki.getTracks().forEach(e=>e.stop()),ki=null;let t=window.URL.createObjectURL(new Blob(Ai,{type:"video/webm"}));ct(t)}function ct(e){var t=null;t=e instanceof Blob?wi.createObjectURL(blob):e;var n=on?Hi(on):Hi(an.userid);var a="recordedvideo"+new Date().getTime();n.filearray.push(a);var r=document.createElement("div");r.value=n.filearray.length,R(n.uuid,n,t,a,"videoScreenRecording"),k(n.uuid,n,t,a,"videoScreenRecording")}function lt(e){Qn.log("[flesharing JS] on File start ",e),Qn.log("[flesharing JS] on File start description  , name :",e.name," from -> ",e.userid," to ->",e.remoteUserId);let t=e.uuid+"_"+e.userid+"_"+e.remoteUserId,n=Hi(e.userid);n.filearray.includes("name : file.name")||(n.filearray.push({pid:t,name:e.name,status:"progress",from:e.userid,to:e.remoteUserId}),C(e.uuid,n,e.name,e.maxChunks,e,"fileBoxClass",e.userid,e.remoteUserId)),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"file",action:"onFileShareStart"}}))}function mt(t){try{if(t.currentPosition>t.maxChunks)return;let e=t.uuid+"_"+t.userid+"_"+t.remoteUserId,n=Li[e];n&&(n.progress.value=t.currentPosition||t.maxChunks||n.progress.max,E(n.progress,n.label))}catch(e){Qn.error("[flesharing JS] Problem in onFileProgress ",e)}}function ut(e){Qn.log("[flesharing JS] On file End description , file :",e," from -> ",e.userid," to ->",e.remoteUserId),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"file",action:"onFileShareEnded"}}));let t=e.uuid+"_"+e.userid+"_"+e.remoteUserId,n=e.name;var a=Hi(e.userid);if(null!=a)for(x in a.filearray)a.filearray[x].name==n&&a.filearray[x].pid==t&&(a.filearray[x].status="finished",u("stopuploadButton"+t));Qn.log("[flesharing JS] onFileEnd - Display on File Viewer and List -",e.url,n,e.type),k(e.uuid,a,e.url,n,e.type),Qn.log("[flesharing JS] onFileEnd - Display List -",n+e.uuid,document.getElementById(n+e.uuid)),on==e.userid&&document.getElementById(n+e.uuid)||(R(e.uuid,a,e.url,n,e.type),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"file",action:"onFileShareEnded"}})))}function pt(e){Qn.log(" [filehsraing js] Send file - ",e),an.send(e)}function gt(e,t,n){Qn.log(" [filehsraing js] Stop Sending file - ",n);var a=Hi(n.userid);for(y in a.filearray)a.filearray[y].pid==e&&(a.filearray[y].status="stop",Qn.log(" [filesharing js ] stopSendFile - filename ",a.filearray[y].name," | status ",a.filearray[y].status))}function ht(){try{an.send({type:"syncOldFiles"})}catch(t){Qn.error("[filesharing js ] syncOldFiles",t)}}function ft(){var e=[];for(x in sn){Qn.log("[flesharing JS] Checking Old Files in index ",x);var t=sn[x];if(t.filearray&&0<t.filearray.length)for(y in t.filearray){for(o in e)if(e[o].name==t.filearray[y].name)break;Qn.log("[filehsraing js] user.filearray[y]",t.filearray[y]),e.push(t.filearray[y])}}setTimeout(function(){if(0<e.length)for(f in Qn.log("[filehsraing js] sendOldFiles ",e),e)pt(e[f])},2e4)}function vt(){Ii=!0;let e={event:"open",from:"remote",board:Fn.drawCanvasContainer,button:Fn.button};an.send({type:"canvas",board:e}),yt(Fn),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"draw",action:"onDrawBoardActive"}}))}function bt(){Ii=!1;let e={event:"close",from:"remote",board:Fn.drawCanvasContainer,button:Fn.button};an.send({type:"canvas",board:e}),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"draw",action:"onDrawBoardTerminate"}}))}function yt(e){if(Qn.log("[drawjs] drawCanvasobj.drawCanvasContainer ",e.drawCanvasContainer),0>document.getElementById(e.drawCanvasContainer).innerHTML.indexOf("iframe"))try{Bi.addSyncListener(function(e){an.send({type:"canvas",draw:e})}),Bi.setSelected("pencil"),Bi.setTools({pencil:!0,eraser:!0}),Bi.appendTo(document.getElementById(e.drawCanvasContainer))}catch(t){Qn.error(" Canvas drawing not supported ",t)}else Qn.log("[drawjs] CanvasDesigner already started iframe is attached ")}function wt(){var e=document.createElement("span");e.className=Wn.button.class,e.innerHTML=Wn.button.html,e.onclick=function(){var e=confirm("Do you want to reconnet ?");!0==e&&($(this).html("<img src=\"http://www.bba-reman.com/images/fbloader.gif\" />"),setTimeout(function(){$(this).html(Wn.button.html)},3e3))};var t=document.createElement("li");t.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(t)}function St(e){document.getElementById(e).onclick=function(){var t=confirm("Do you want to reconnect ?");if(!0==t){if(!an.peers[an.connectionDescription.remoteUserId])return;an.peers[an.connectionDescription.remoteUserId].peer.close(),an.rejoin(an.connectionDescription),$(this).html("<img src=\"http://www.bba-reman.com/images/fbloader.gif\" />"),setTimeout(function(){document.getElementById(e).innerHTML=Wn.button.html},3e3)}else;}}function Ct(){document.body.setAttribute("style","pointer-events: none;")}function Et(e,t,n){e.style.position="absolute",e.style.left=t+"px",e.style.top=n+"px"}function Rt(){document.getElementById("cursor1").setAttribute("style","display:block"),document.onmousemove=function(t){Oi=t.pageX+10,Ni=t.pageY},Di=setInterval(kt,500)}function Tt(){document.getElementById("cursor1").setAttribute("style","display:none"),an.send({type:"pointer",action:"stopCursor"}),clearInterval(Di)}function kt(){var e=document.getElementById("cursor1");e.hidden=!1,Et(e,Oi,Ni),an.send({type:"pointer",action:"startCursor",corX:Oi,corY:Ni})}function xt(e){var t=document.createElement("span");return t.id=e+"cursorButton",t.setAttribute("data-val","mute"),t.setAttribute("title","Cursor"),t.className=zn.button.class_on,t.innerHTML=zn.button.html_on,t.onclick=function(){var e=t.id,n;n=on?Hi(on):Hi(an.userid),-1<e.indexOf(n.controlBarName)?t.className==zn.button.class_on?(Rt(),t.className=zn.button.class_off,t.innerHTML=zn.button.html_off):t.className==zn.button.class_off&&(Tt(),t.className=zn.button.class_on,t.innerHTML=zn.button.html_on):alert(" Use Local Pointer button ")},t}function At(){var e=document.createElement("span");for(x in e.className=Hn.button.class_off,e.innerHTML=Hn.button.html_off,Hn.languages)document.getElementById("CodeStyles").innerHTML=document.getElementById("CodeStyles").innerHTML+Hn.languages[x];document.getElementById("codeArea").value;Vn=CodeMirror.fromTextArea(document.getElementById("codeArea"),{mode:"text/javascript",styleActiveLine:!0,lineNumbers:!1,lineWrapping:!0}),Vn.setOption("theme","mdn-like"),e.onclick=function(){e.className==Hn.button.class_off?(e.className=Hn.button.class_on,e.innerHTML=Hn.button.html_on,Mt(),document.getElementById(Hn.codeeditorContainer).hidden=!1):e.className==Hn.button.class_on&&(e.className=Hn.button.class_off,e.innerHTML=Hn.button.html_off,Ut(),document.getElementById(Hn.codeeditorContainer).hidden=!0)};var t=document.createElement("li");t.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(t)}function Lt(e){if(37==e.which||38==e.which||39==e.which||40==e.which||17==e.which||18==e.which||16==e.which)return!0;var t={option:"text",codeContent:Vn.getValue()};Qn.log(" sending ",t),rtcMultiConnection.send({type:"codeeditor",data:t})}function It(){$("#CodeStyles option:selected").each(function(){var e=CodeMirror.findModeByMIME($(this).attr("mime"));e&&(mode=e.mode,spec=$(this).attr("mime"),Vn.setOption("mode",spec),CodeMirror.autoLoadMode(Vn,mode))});var e={option:"menu",codeMode:mode,codeSpec:spec};Qn.log(" sending ",e),rtcMultiConnection.send({type:"codeeditor",data:e})}function Bt(e){if(Qn.log("codeeditor ",e),"text"==e.option){var t=Vn.getCursor();Vn.setValue(e.codeContent),Vn.setCursor(t)}else"menu"==e.option&&(Vn.setOption("mode",evt.data.codeSpec),CodeMirror.autoLoadMode(Vn,evt.data.codeMode))}function Mt(){document.getElementById(Hn.codeeditorContainer).addEventListener("keyup",Lt,!1),document.getElementById("CodeStyles").addEventListener("change",It,!1)}function Ut(){document.getElementById(Hn.codeeditorContainer).removeEventListener("keyup",Lt,!1)}function Ot(){var e=document.createElement("span");e.className=_n.button.class_off,e.innerHTML=_n.button.html_off,e.onclick=function(){e.className==_n.button.class_off?(e.className=_n.button.class_on,e.innerHTML=_n.button.html_on,Pt(),document.getElementById(_n.texteditorContainer).hidden=!1):e.className==_n.button.class_on&&(e.className=_n.button.class_off,e.innerHTML=_n.button.html_off,jt(),document.getElementById(_n.texteditorContainer).hidden=!0)};var t=document.createElement("li");t.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(t)}function Nt(e){if(37==e.which||38==e.which||39==e.which||40==e.which||17==e.which||18==e.which||16==e.which)return!0;var t={option:"text",content:document.getElementById(_n.texteditorContainer).value};Qn.log(" sending ",document.getElementById(_n.texteditorContainer).value),rtcMultiConnection.send({type:"texteditor",data:t})}function Dt(e){Qn.log("texteditor ",e),"text"==e.option&&(document.getElementById(_n.texteditorContainer).value=e.content)}function Pt(){document.getElementById(_n.texteditorContainer).addEventListener("keyup",Nt,!1)}function jt(){document.getElementById(_n.texteditorContainer).removeEventListener("keyup",Nt,!1)}function Ft(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"==typeof XDomainRequest?n=null:(n=new XDomainRequest,n.open(e,t)),n}function _t(){var e=Ft("PUT","https://global.xirsys.net/_turn/Amplechat/");e.onload=function(){Qn.log("[turn Js] Response from Xirsys ",e.responseText),null==JSON.parse(e.responseText).v?(Rn="err",Q("Media will not able to pass through "+JSON.parse(e.responseText).e)):(Rn=JSON.parse(e.responseText).v.iceServers,Qn.log("Obtained iceServers",Rn))},e.onerror=function(){Qn.error("Woops, there was an error making xhr request.")},e.setRequestHeader("Authorization","Basic "+btoa("farookafsari:e35af4d2-dbd5-11e7-b927-0c3f27cba33f")),e.send()}function Ht(e){Qn.log("[ timerobj] startsessionTimer ",e),e.counter.hours&&e.counter.minutes&&e.counter.seconds?(Pi=c(e.counter.hours),ji=c(e.counter.minutes),Fi=c(e.counter.seconds),"forward"==e.type?(me(),Pi.innerHTML=0,ji.innerHTML=0,Fi.innerHTML=0):"backward"==e.type&&(Pi.innerHTML=0,ji.innerHTML=3,Fi.innerHTML=0,ue())):Qn.error(" [timerobj] counter DOM elemnents not found ")}function Vt(){try{return Mi=Intl.DateTimeFormat().resolvedOptions().timeZone,sn[0].zone=Mi,Mi}catch(e){Qn.error("[timer js ]",e)}}function Wt(){try{var e={type:"timer",userid:sn[0].userid,time:new Date().toJSON(),zone:sn[0].zone};Qn.log("[timerjs] shareTimePeer ",e),an.send(e)}catch(t){Qn.error(t)}}function zt(e,t){try{Qn.log("[timerjs] peerTimeZone -- ",e,t),Gt(t,"zone",e);var n=Hi(t);Qn.log("[timerjs] peerTimeZone , updated peerinfo with zone-- ",n),fe(n)}catch(e){Qn.error("[timerjs] ",e)}}function Gt(e,t){for(x in sn)sn[x].userid==e&&(sn[x].key=t)}function qt(e){return new Promise(function(t){Qn.log(" [peerinfomanager] removePeerInfo - remove index: ",e,sn[e]),sn.splice(e,1),t("done")}).catch(e=>{Qn.error("[peerinfomanager] removePeerInfo - Promise rejected ",e),reject("err")})}function Yt(e,t,n,a,r,s){Qn.log("[peerinfomanager] updating peerInfo: ",e,t,n,a,r,s);var d=-1;return new Promise(function(c,l){if(!e)return console.error("[peerinfomanager] userid is null / undefined, cannot create PeerInfo"),void l("userid is null / undefined, cannot create PeerInfo");for(var m in sn)if(sn[m].userid==e){Qn.log("[peerinfomanager] UserID is already existing in webcallpeers, update the fields only at index ",m),d=m;break}peerInfo={videoContainer:"video"+e,videoHeight:null,videoClassName:null,userid:e,name:t,color:n,email:a,role:r,controlBarName:"control-video"+e,filearray:[],vid:"video"+s+"_"+e},Nn.active&&(peerInfo.fileShare="single"==Nn.props.fileShare?{outerbox:"widget-filesharing-box",container:"widget-filesharing-container",minButton:"widget-filesharing-minbutton",maxButton:"widget-filesharing-maxbutton",rotateButton:"widget-filesharing-rotatebutton",closeButton:"widget-filesharing-closebutton"}:{outerbox:"widget-filesharing-box"+e,container:"widget-filesharing-container"+e,minButton:"widget-filesharing-minbutton"+e,maxButton:"widget-filesharing-maxbutton"+e,rotateButton:"widget-filesharing-rotatebutton"+e,closeButton:"widget-filesharing-closebutton"+e},peerInfo.fileList="single"==Nn.props.fileList?{outerbox:"widget-filelisting-box",container:"widget-filelisting-container"}:{outerbox:"widget-filelisting-box"+e,container:"widget-filelisting-container"+e}),-1<d?(sn[d]=peerInfo,Qn.log("[peerinfomanager] updated peerInfo: ",peerInfo)):(sn.push(peerInfo),Qn.log("[peerinfomanager] created peerInfo: ",peerInfo)),c("done")}).catch(e=>{Qn.error("[peerinfomanager] Promise rejected ",e)})}function Jt(e,t,n){return Qn.log("[sessionmanager] startSocketSession , set selfuserid ",e.userid),on?Qn.warn("[sessionmanager] trying to overwrite remoteobj.userdetails.usercolorelfuserid"):on=e.userid,new Promise((a,r)=>{try{let e="/";"/"!=t&&(e=t),Qn.log("[sessionmanager] StartSession"+n," on address ",e),socket=io.connect(e,{transports:["websocket"]})}catch(e){throw Qn.error(" problem in socket connnection",e)," problem in socket connnection"}if(n)Q("Checking status of  : "+n),socket.emit("presence",{channel:n});else return Q("Invalid session"),void Qn.error("[sessionmanager] Session id undefined ");socket.on("connect",function(){socket.on("disconnected",function(){Q("Disconnected from signaller ")})}),socket.on("presence",function(e){Bn&&showUserStats(),Qn.log("[sessionmanager] presence for sessionid ",e),e?qi(n,on):zi(n,on,ii.maxAllowed||10)}),socket.on("open-channel-resp",function(t){if(Qn.log("[sessionmanager] --------------open-channel-resp---------------------  ",t),t.status&&t.channel==n){new Promise(function(n){Qn.log(" [open-channel-resp] "," Session video:",Ln," audio: ",An," data: ",In," OfferToReceiveAudio: ",Tn," OfferToReceiveVideo: ",kn),e.connectionType="open",e.session={video:Ln,audio:An,data:In},e.sdpConstraints.mandatory={OfferToReceiveAudio:Tn,OfferToReceiveVideo:kn},e.open(t.channel,function(){Qn.log(" [sessionmanager] offer/answer webrtc ",on," with role ",Xn)}),n("ok")}).then(function(){Yt(on,fn,bn,vn,Xn,"local"),Qn.log(" [sessionmanager] updated local peerinfo for open-channel ")}).catch(e=>{Qn.error(" [sessionmanager] Handle rejected promise ("+e+")")});tt(e),Qn.log(" [sessionmanager] open-channel-resp -  done cam media ")}else alert("Could not open this channel, Server refused"),Qn.error(" [sessionmanager] Could not open this channel, Server refused");t.message&&Q(t.msgtype+" : "+t.message)}),socket.on("join-channel-resp",function(t){if(Qn.log("[sessionmanager] --------------join-channel-resp---------------------  ",t),t.status&&t.channel==n){let n=new Promise(function(n){Qn.log(" [ join-channel-resp ] "," Session video:",Ln," audio: ",An," data: ",In," OfferToReceiveAudio: ",Tn," OfferToReceiveVideo: ",kn),e.connectionType="join",e.session={video:Ln,audio:An,data:In},e.sdpConstraints.mandatory={OfferToReceiveAudio:Tn,OfferToReceiveVideo:kn},e.remoteUsers=t.users,n()});n.then(e.connectionDescription=e.join(t.channel),Qn.info(" [sessionmanager] offer/answer webrtc  ",on," with role ",Xn)).then(Yt(on,fn,bn,vn,Xn,"local"),Qn.log(" [sessionmanager] updated local peerinfo for join-channel ")).catch(e=>{Qn.error("Handle rejected promise ("+e+")")}),tt(e),Qn.log(" [sessionmanager] join-channel-resp -  done cam media "),t.message&&Q(t.msgtype+" : "+t.message)}else Qn.error(" [sessionmanager] Could not join this channel, Server refused"),alert("Could not join this channel, Server refused ")}),socket.on("channel-event",function(e){if(Qn.log("[sessionmanager] --------------channel-event---------------------  ",e),"new-join"!=e.type||"error"==e.msgtype)Qn.warn(" unhandled channel event ");else if(Qn.log("[session manager ] - new-join-channel "),"unlimited"!=ii.maxAllowed&&sn.length<=ii.maxAllowed){Qn.log("[sessionmanager] channel-event : peer length "+sn.length+" is less than max capacity of session  of the session "+ii.maxAllowed);let t=e.data.sender;t||(Qn.error("[sartjs] channel-event : userid not present in channel-event:"+e.type),r("userid not found"));let n=Hi(t),a=e.data.extra.name,s=e.data.extra.color,d=e.data.extra.email,c=e.data.extra.role;n?(Qn.log(" [sartjs] channel-event : PeerInfo was already present, this is s rejoin, update the peerinfo "),Yt(t,a,s,d,c,"remote"),Q(e.data.extra.role+" "+e.type)):(Qn.log(" [sartjs] channel-event : PeerInfo not already present, create new peerinfo"),"LOCAL"==a&&(a="REMOTE"),Yt(t,a,s,d,c,"remote"),Q(e.data.extra.role+"  "+e.type)),n||(n=Hi(t)),n.type="remote",n.stream="",n.streamid="",g(n),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"session",action:"onLocalConnect"}}))}else Qn.error("[sartjs] channel-event : max capacity of session is reached ",ii.maxAllowed),Q("Another user is trying to join this channel but max count [ "+ii.maxAllowed+" ] is reached","warning")}),a("done")}).catch(e=>{Qn.error("[sessionmanager] startSocketSession error -",e),reject(e)})}var nn="",e="",an=null,rn=null,on=null,sn=[],dn={},cn=null,ln=null,mn=null,un=null,pn=null,gn=null,hn=[],dn={},fn="",vn="",bn="",yn="",wn="",Sn="",Cn=null,En="/",Rn=[],Tn=!0,kn=!0,xn=!0,An=!0,Ln=!0,In=!0,Bn=!1,Mn=!1,Un=!1,On=!1,Nn=!1,Dn=!1,Pn=!1,jn=!1,Fn=!1,_n=!1,Hn=!1,Vn=null,Wn=!1,zn=!1,Gn=!1,qn=!1,Yn=!1,Jn=!1,Zn=!1,Kn=!1,Xn="participant",Qn=webrtcdevlogger,$n;this.sessionid="",this.makesessionid=function(e,t){e&&!location.hash.replace("#","").length?(location.href=location.href.split("#")[0]+"#"+(100*Math.random()).toString().replace(".",""),location.reload()):e&&location.href.replace("#","").length?(Cn=-1<location.href.indexOf("?")?location.hash.substring(0,location.hash.indexOf("?")).replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""):location.hash.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),t(Cn)):(Cn=prompt("Enter session ",""),t(Cn))};var ei=null,ti="none",ni={},ii={},ai=[];if(this.connectionStatus=null,this.setsession=function(e,t,n,a,r,s){return this.sessionid=Cn=r.sessionid,En=r.socketAddr,ni=e,ii=t,Qn.log("[startjs] WebRTCdev Session - ",r),ti=r.hasOwnProperty("turn")?r.turn:null,Qn.log("[ startjs] WebRTCdev TURN - ",ti),ti&&"none"!=ti?ti.active&&ti.iceServers?(Qn.log("WebRTCdev - Getting preset static ICE servers ",ti.iceServers),Rn=ti.iceServers):(Qn.info("WebRTCdev - Calling API to fetch dynamic ICE servers "),_t()):Qn.log("WebRTCdev - TURN not applied "),s&&(Qn.log(" WebRTCdev - widgets  ",s),s.debug&&(Bn=s.debug||!1),s.chat&&(On=s.chat||null),s.fileShare&&(Nn=s.fileShare||null),s.screenrecord&&(Dn=s.screenrecord||null),s.screenshare&&(Jn=s.screenshare||null),s.snapshot&&(Pn=s.snapshot||null),s.videoRecord&&(jn=s.videoRecord||null),s.reconnect&&(Wn=s.reconnect||null),s.drawCanvas&&(Fn=s.drawCanvas||null),s.texteditor&&(_n=s.texteditor||null),s.codeeditor&&(Hn=s.codeeditor||null),s.mute&&(Gn=s.mute||null),s.timer&&(Mn=s.timer||null),s.listenin&&(Yn=s.listenin||null),s.cursor&&(zn=s.cursor||null),s.minmax&&(qn=s.minmax||null),s.help&&(Zn=s.help||null),s.statistics&&(Kn=s.statistics||null)),{sessionid:Cn,socketAddr:En,turn:ti,widgets:s,startwebrtcdev:d,rtcConn:an}},this.issafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.startCall=function(e){Qn.log(" startCall obj",e),Qn.log(" TURN ",ti),e.startwebrtcdev()},this.stopCall=function(){Qn.log(" stopCall "),an.closeEntireSession(),localStorage.getItem("channel")||localStorage.removeItem("channel"),localStorage.getItem("userid")||localStorage.removeItem("userid"),localStorage.getItem("remoteUsers")||localStorage.removeItem("remoteUsers"),this.connectionStatus="closed"},Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=this.length-1;0<=e;e--)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])},this.showdesktopnotification=showdesktopnotification=function(e,t){if(!("Notification"in window))alert("This browser does not support desktop notification");else if("granted"===Notification.permission){new Notification(e,{body:t})}else"denied"!==Notification.permission&&Qn.warn(" [notify.js] notification denied")},null!=typeof Notification)try{Notification.requestPermission().then(function(e){Qn.log("[notify.js] notification requestPermission ",e)})}catch(e){if(e instanceof TypeError)Notification.requestPermission(e=>{Qn.log("[notify.js] notification requestPermission safari",e)});else throw e}var ri=document.createElement("div"),oi;ri.id="saveButtonCanvasDraw",ri.setAttribute("data-toggle","modal"),ri.setAttribute("data-target","#saveModal"),ri.onclick=function(){z("blobcanvas")},document.body.appendChild(ri),"undefined"!=typeof module&&(module.exports=we),"undefined"!=typeof window&&(window.getStats=we),this.showRtcConn=function(){an?(Qn.info(" ========================================================================="),Qn.info("[stats] rtcConn : ",an),Qn.info("[stats] rtcConn.peers.getAllParticipants() : ",an.peers.getAllParticipants()),Qn.info(" =========================================================================")):Qn.debug(" rtcConn doesnt exist ")};var si="undefined"!=typeof window.InstallTrigger,di=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),ci=!!window.chrome&&!di,li=[],mi=null,ui,$n,pi;this.showScrConn=function(){rn?(Qn.info(" ========================================================================="),Qn.info(" srcConn : ",rn),Qn.info(" srcConn.peers.getAllParticipants() : ",rn.peers.getAllParticipants()),Qn.info(" =========================================================================")):Qn.debug(" Screen share is not active ")},"",function(){function e(){function e(e,t){var a=Math.min;function n(e,n,d){h=Zt(n.byteLength/s);for(var c=0,l;c<h;c++)l=c*s,g[p]=n.slice(l,a(l+s,n.byteLength)),t({uuid:r.uuid,buffer:g[p],currentPosition:p,maxChunks:u,size:r.size,name:r.name,lastModifiedDate:r.lastModifiedDate.toString(),type:r.type}),p++;p==u&&(b=!0),d()}t=t||function(e){postMessage(e)};var r=e.file;r.uuid||(r.uuid=(100*Math.random()).toString().replace(/\./g,""));var s=e.chunkSize||15000;e.extra&&e.extra.chunkSize&&(s=e.extra.chunkSize);var d=0,c=s,l=$t(a(1e8,c)/s),m=l*s,u=Zt(r.size/s);r.maxChunks=u;var p=0,g=[],h,b;t({currentPosition:p,uuid:r.uuid,maxChunks:u,size:r.size,name:r.name,type:r.type,lastModifiedDate:r.lastModifiedDate.toString(),start:!0});var w=new FileReader,S;w.onloadend=function(e){e.target.readyState==FileReader.DONE&&n(r.name,e.target.result,function(){d++,(d+1)*m<r.size?(S=r.slice(d*m,(d+1)*m),w.readAsArrayBuffer(S)):d*m<r.size?(S=r.slice(d*m,r.size),w.readAsArrayBuffer(S)):(r.url=wi.createObjectURL(r),t({currentPosition:p,uuid:r.uuid,maxChunks:u,size:r.size,name:r.name,lastModifiedDate:r.lastModifiedDate.toString(),url:wi.createObjectURL(r),type:r.type,end:!0}))})},p+=1,S=r.slice(d*m,(d+1)*m),w.readAsArrayBuffer(S)}var t=this;t.readAsArrayBuffer=function(t,n){function a(e){t.chunks[e.uuid]||(t.chunks[e.uuid]={currentPosition:-1}),n.extra=n.extra||{userid:0},e.userid=n.userid||n.extra.userid||0,e.extra=n.extra,t.chunks[e.uuid][e.currentPosition]=e,e.end&&r&&(r(e.uuid),r=null),200<e.maxChunks&&200==e.currentPosition&&r&&(r(e.uuid),r=null)}var r=n.earlyCallback;delete n.earlyCallback,e(n,a)}}function t(e){function t(r,s){if(!r.uuid)return void e.convertToObject(r,function(e){t(e)});if(r.start&&!a.chunks[r.uuid]&&(a.chunks[r.uuid]={},e.onBegin&&e.onBegin(r)),!r.end&&r.buffer&&(a.chunks[r.uuid][r.currentPosition]=r.buffer),r.end){var d=a.chunks[r.uuid],c=[];Object.keys(d).forEach(function(e){c.push(d[e])});var l=new Blob(c,{type:r.type});l=n(l,r),l.url=wi.createObjectURL(l),l.uuid=r.uuid,l.size||Qn.error("Something went wrong. Blob Size is 0."),e.onEnd&&e.onEnd(l),delete a.chunks[r.uuid],delete a.chunksWaiters[r.uuid]}r.buffer&&e.onProgress&&e.onProgress(r),r.end||(s(r),a.chunksWaiters[r.uuid]=function(){function e(){r.buffer&&a.chunks[r.uuid]&&(r.currentPosition==r.maxChunks||a.chunks[r.uuid][r.currentPosition]||(s(r),setTimeout(e,5e3)))}setTimeout(e,5e3)},a.chunksWaiters[r.uuid]())}var a=this;a.chunks={},a.chunksWaiters={},a.receive=t}function n(e,t){if(e||(e={}),!t)return e;for(var n in t)try{e[n]=t[n]}catch(t){}return e}var a={ConvertToArrayBuffer:function(e,t){R.pack(e,function(e){t(e.buffer)})},ConvertToObject:function(e,t){R.unpack(e,t)}},r=!1,s=!1,d=Uint8Array.BYTES_PER_ELEMENT,c=Uint16Array.BYTES_PER_ELEMENT,l=Uint32Array.BYTES_PER_ELEMENT,m={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17};if(r)var u=["NULL","UNDEFINED","STRING","NUMBER","BOOLEAN","ARRAY","OBJECT","INT8ARRAY","INT16ARRAY","INT32ARRAY","UINT8ARRAY","UINT16ARRAY","UINT32ARRAY","FLOAT32ARRAY","FLOAT64ARRAY","ARRAYBUFFER","BLOB","BUFFER"];var p=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],g=function(e,t,n){var a=[];a[0]=[];for(var r=0;40>r;r++)a[0][r]=10>r?"0"+r.toString(10):r.toString(10);for(r=0;r<n;r++){var d=e.getUint8(t+r,s),c=~~(r/40)+1;"undefined"==typeof a[c]&&(a[c]=[]),a[c][r%40]=16>d?"0"+d.toString(16):d.toString(16)}for(Qn.log("%c"+a[0].join(" "),"font-weight: bold;"),r=1;r<a.length;r++)Qn.log(a[r].join(" "))},h=function(e){var t;if(void 0===e)t=m.UNDEFINED;else if(null===e)t=m.NULL;else{var n=e.constructor.name;if(void 0!==n)t=m[n.toUpperCase()];else switch(typeof e){case"string":t=m.STRING;break;case"number":t=m.NUMBER;break;case"boolean":t=m.BOOLEAN;break;case"object":e instanceof Array?t=m.ARRAY:e instanceof Int8Array?t=m.INT8ARRAY:e instanceof Int16Array?t=m.INT16ARRAY:e instanceof Int32Array?t=m.INT32ARRAY:e instanceof Uint8Array?t=m.UINT8ARRAY:e instanceof Uint16Array?t=m.UINT16ARRAY:e instanceof Uint32Array?t=m.UINT32ARRAY:e instanceof Float32Array?t=m.FLOAT32ARRAY:e instanceof Float64Array?t=m.FLOAT64ARRAY:e instanceof ArrayBuffer?t=m.ARRAYBUFFER:e instanceof Blob?t=m.BLOB:e instanceof Buffer?t=m.BUFFER:e instanceof Object&&(t=m.OBJECT);break;default:}}return t},b=function(e){var t=0,n=0,a=0,h=s,b=new ArrayBuffer(e[0].byte_length+e[0].header_size),w=new DataView(b);for(n=0;n<e.length;n++){var S=t,C=e[n].header_size,E=e[n].type,R=e[n].length,T=e[n].value,k=e[n].byte_length,A=p[E],L=null===A?0:window[A+"Array"].BYTES_PER_ELEMENT;switch(E===m.BUFFER?w.setUint8(t,m.BLOB,h):w.setUint8(t,E,h),t+=d,r&&Qn.info("Packing",E,u[E]),(E===m.ARRAY||E===m.OBJECT)&&(w.setUint16(t,R,h),t+=c,r&&Qn.info("Content Length",R)),w.setUint32(t,k,h),t+=l,r&&(Qn.info("Header Size",C,"bytes"),Qn.info("Byte Length",k,"bytes")),E){case m.NULL:case m.UNDEFINED:break;case m.STRING:for(r&&Qn.info("Actual Content %c\""+T+"\"","font-weight:bold;"),a=0;a<R;a++,t+=L)w.setUint16(t,T.charCodeAt(a),h);break;case m.NUMBER:case m.BOOLEAN:r&&Qn.info("%c"+T.toString(),"font-weight:bold;"),w["set"+A](t,T,h),t+=L;break;case m.INT8ARRAY:case m.INT16ARRAY:case m.INT32ARRAY:case m.UINT8ARRAY:case m.UINT16ARRAY:case m.UINT32ARRAY:case m.FLOAT32ARRAY:case m.FLOAT64ARRAY:var I=new Uint8Array(w.buffer,t,k);I.set(new Uint8Array(T.buffer)),t+=k;break;case m.ARRAYBUFFER:case m.BUFFER:var I=new Uint8Array(w.buffer,t,k);I.set(new Uint8Array(T)),t+=k;break;case m.BLOB:case m.ARRAY:case m.OBJECT:break;default:throw"TypeError: Unexpected type found.";}r&&g(w,S,t-S)}return w},w=function(e,t){var n=0,a=s,h=t,b,S,C,E,R;b=e.getUint8(t,a),t+=d,r&&Qn.info("Unpacking",b,u[b]),(b===m.ARRAY||b===m.OBJECT)&&(S=e.getUint16(t,a),t+=c,r&&Qn.info("Content Length",S)),C=e.getUint32(t,a),t+=l,r&&Qn.info("Byte Length",C,"bytes");var T=p[b],k=null===T?0:window[T+"Array"].BYTES_PER_ELEMENT;switch(b){case m.NULL:case m.UNDEFINED:r&&g(e,h,t-h),E=null;break;case m.STRING:S=C/k;var A=[];for(n=0;n<S;n++){var L=e.getUint16(t,a);t+=k,A.push(tn(L))}E=A.join(""),r&&(Qn.info("Actual Content %c\""+E+"\"","font-weight:bold;"),g(e,h,t-h));break;case m.NUMBER:E=e.getFloat64(t,a),t+=k,r&&(Qn.info("Actual Content %c\""+E.toString()+"\"","font-weight:bold;"),g(e,h,t-h));break;case m.BOOLEAN:E=1===e.getUint8(t,a),t+=k,r&&(Qn.info("Actual Content %c\""+E.toString()+"\"","font-weight:bold;"),g(e,h,t-h));break;case m.INT8ARRAY:case m.INT16ARRAY:case m.INT32ARRAY:case m.UINT8ARRAY:case m.UINT16ARRAY:case m.UINT32ARRAY:case m.FLOAT32ARRAY:case m.FLOAT64ARRAY:case m.ARRAYBUFFER:R=e.buffer.slice(t,t+C),t+=C,E=b===m.ARRAYBUFFER?R:new window[T+"Array"](R),r&&g(e,h,t-h);break;case m.BLOB:if(r&&g(e,h,t-h),window.Blob){var I=w(e,t),B=w(e,I.cursor);t=B.cursor,E=new Blob([B.value],{type:I.value})}else R=e.buffer.slice(t,t+C),t+=C,E=new Buffer(R);break;case m.ARRAY:for(r&&g(e,h,t-h),E=[],n=0;n<S;n++)R=w(e,t),t=R.cursor,E.push(R.value);break;case m.OBJECT:for(r&&g(e,h,t-h),E={},n=0;n<S;n++){var M=w(e,t),U=w(e,M.cursor);t=U.cursor,E[M.value]=U.value}break;default:throw"TypeError: Type not supported.";}return{value:E,cursor:t}},S=function(e,t){for(var n=e.length,a=[],r=0,s=0,d=0;d<e.length;d++)(function(d){C(e[d],function(e){if(a[d]=e,s+=e[0].header_size+e[0].byte_length,++r===n){for(var c=[],l=0;l<a.length;l++)c=c.concat(a[l]);t(c,s)}})})(d)},C=function(e,t){var n=1,a=d+l,r=0,s=0,u;switch(u=h(e),n=void 0===p[u]||null===p[u]?0:window[p[u]+"Array"].BYTES_PER_ELEMENT,u){case m.UNDEFINED:case m.NULL:break;case m.NUMBER:case m.BOOLEAN:r=n;break;case m.STRING:s=e.length,r+=s*n;break;case m.INT8ARRAY:case m.INT16ARRAY:case m.INT32ARRAY:case m.UINT8ARRAY:case m.UINT16ARRAY:case m.UINT32ARRAY:case m.FLOAT32ARRAY:case m.FLOAT64ARRAY:s=e.length,r+=s*n;break;case m.ARRAY:return void S(e,function(n,r){t([{type:u,length:e.length,header_size:a+c,byte_length:r,value:null}].concat(n))});case m.OBJECT:var g=[];for(var b in e)e.hasOwnProperty(b)&&(g.push(b),g.push(e[b]),s++);return void S(g,function(e,n){t([{type:u,length:s,header_size:a+c,byte_length:n,value:null}].concat(e))});case m.ARRAYBUFFER:r+=e.byteLength;break;case m.BLOB:var w=e.type,C=new FileReader;return C.onload=function(n){S([w,n.target.result],function(e,n){t([{type:u,length:s,header_size:a,byte_length:n,value:null}].concat(e))})},C.onerror=function(t){throw"FileReader Error: "+t},void C.readAsArrayBuffer(e);case m.BUFFER:r+=e.length;break;default:throw"TypeError: Type \""+e.constructor.name+"\" not supported.";}t([{type:u,length:s,header_size:a,byte_length:r,value:e}].concat([]))},E=function(e){var t=e instanceof DataView?e:new DataView(e),n=w(t,0);return n.value};r&&(window.Test={BIG_ENDIAN:s,LITTLE_ENDIAN:!0,Types:m,pack:b,unpack:w,serialize:C,deserialize:E});var R={pack:function(e,t){try{r&&Qn.info("%cPacking Start","font-weight: bold; color: red;",e),C(e,function(e){r&&Qn.info("Serialized Object",e),t(b(e))})}catch(t){throw t}},unpack:function(e,t){try{r&&Qn.info("%cUnpacking Start","font-weight: bold; color: red;",e);var n=E(e);r&&Qn.info("Deserialized Object",n),t(n)}catch(t){throw t}}};window.FileConverter=a,window.FileSelector=function(){function e(e,a){var r=document.createElement("input");r.type="file",a&&(r.multiple=!0),r.accept=n.accept,r.onchange=function(){return a?r.files.length?void e(r.files):void Qn.error("No file selected."):r.files[0]?void(e(r.files[0]),r.parentNode.removeChild(r)):void Qn.error("No file selected.")},r.style.display="none",(document.body||document.documentElement).appendChild(r),t(r)}function t(e){var t=new window.MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,button:0,buttons:0,mozInputSource:1}),n=e.dispatchEvent(t)}var n=this;n.selectSingleFile=e,n.selectMultipleFiles=function(t){e(t,!0)},n.accept="*.*"},window.FileBufferReader=function(){function n(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var a in t=t||new e.constructor,e)t[a]="undefined"==typeof t[a]?n(e[a],null):t[a];return t}var r=this,s=new e;r.chunks={},r.users={},r.readAsArrayBuffer=function(e,t,a){s.readAsArrayBuffer(r,{file:e,earlyCallback:function(e){t(n(e,{currentPosition:-1}))},extra:a||{userid:0}})},r.getNextChunk=function(e,t,a){try{for(x in sn)if(sn[x].userid==on)for(y in sn[x].filearray)sn[x].filearray[y].pid||console.warn("[ fbr.getNextChunk ] pid does mot exist "),sn[x].filearray[y].pid.includes(e)&&"stop"==sn[x].filearray[y].status&&(sn[x].filearray[y].status="stopped")}catch(t){console.log(t)}var s;"undefined"!=typeof e.currentPosition&&(s=e.currentPosition,e=e.uuid);var d=r.chunks[e];if(d){"undefined"==typeof a?("undefined"!=typeof s&&(r.chunks[e].currentPosition=s),r.chunks[e].currentPosition++,s=r.chunks[e].currentPosition):(!r.users[a+""]&&(r.users[a+""]={fileUUID:e,userid:a,currentPosition:-1}),"undefined"!=typeof s&&(r.users[a+""].currentPosition=s),r.users[a+""].currentPosition++,s=r.users[a+""].currentPosition);var c=d[s];return c?void(c=n(c),"undefined"!=typeof a&&(c.remoteUserId=a+""),!!c.start&&r.onBegin(c),!!c.end&&r.onEnd(c),r.onProgress(c),r.convertToArrayBuffer(c,function(e){return c.currentPosition==c.maxChunks?void t(e,!0):void t(e,!1)})):(delete r.chunks[e],void r.convertToArrayBuffer({chunkMissing:!0,currentPosition:s,uuid:e},t))}};var d=new t(r);r.addChunk=function(e,t){e&&d.receive(e,function(e){r.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:e.currentPosition,uuid:e.uuid},t)})},r.chunkMissing=function(e){delete d.chunks[e.uuid],delete d.chunksWaiters[e.uuid]},r.onBegin=function(){},r.onEnd=function(){},r.onProgress=function(){},r.convertToObject=a.ConvertToObject,r.convertToArrayBuffer=a.ConvertToArrayBuffer,r.setMultipleUsers=function(){}}}(),window.requestAnimationFrame||(vi=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),window.cancelAnimationFrame||(bi=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame),window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext),wi=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream);var gi=!!navigator.webkitGetUserMedia;console.log(" IsChrome ",gi);var hi={AudioContext:window.AudioContext||window.webkitAudioContext},fi=function(){function e(e){for(var n=t(e),a=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:m(n.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:n.width,id:176},{data:n.height,id:186}]}]}]}]}],r=0,c=0;r<e.length;){var l=[],u=0;do l.push(e[r]),u+=e[r].duration,r++;while(r<e.length&&u<3e4);var p=0,g={id:524531317,data:[{data:c,id:231}].concat(l.map(function(e){var t=d({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:en(p)});return p+=e.duration,{data:t,id:163}}))};a[1].data.push(g),c+=u}return s(a)}function t(e){if(!e[0])return void Qn.warn("Something went wrong. Maybe WebP format is not supported in the current browser.");for(var t=e[0].width,n=e[0].height,a=e[0].duration,r=1;r<e.length;r++)a+=e[r].duration;return{duration:a,width:t,height:n}}function n(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function a(e){return new Uint8Array(e.split("").map(function(t){return t.charCodeAt(0)}))}function r(e){var t=[],n=e.length%8?Array(9-e.length%8).join("0"):"";e=n+e;for(var a=0;a<e.length;a+=8)t.push(parseInt(e.substr(a,8),2));return new Uint8Array(t)}function s(e){for(var t=[],d=0,c;d<e.length;d++){c=e[d].data,"object"==typeof c&&(c=s(c)),"number"==typeof c&&(c=r(c.toString(2))),"string"==typeof c&&(c=a(c));var l=c.size||c.byteLength||c.length,m=Zt(Zt(Qt(l)/Qt(2))/8),u=l.toString(2),p=Array(7*m+7+1-u.length).join("0")+u,g=Array(m).join("0")+"1"+p;t.push(n(e[d].id)),t.push(r(g)),t.push(c)}return new Blob(t,{type:"video/webm"})}function d(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),127<e.trackNum)throw"TrackNumber > 127 not supported";var n=[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(t){return tn(t)}).join("")+e.frame;return n}function c(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("\x9D\x01*"),a=0,r=[];4>a;a++)r[a]=t.charCodeAt(n+3+a);var s,d,c;return c=r[1]<<8|r[0],s=16383&c,c=r[3]<<8|r[2],d=16383&c,{width:s,height:d,data:t,riff:e}}function l(e){for(var t=0,n={};t<e.length;){var a=e.substr(t,4),r=parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return Array(8-t.length+1).join("0")+t}).join(""),2),s=e.substr(t+4+4,r);t+=8+r,n[a]=n[a]||[],"RIFF"==a||"LIST"==a?n[a].push(l(s)):n[a].push(s)}return n}function m(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(t){return tn(t)}).reverse().join("")}function u(e){this.frames=[],this.duration=e||1,this.quality=100}return u.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},u.prototype.compile=function(){return new e(this.frames.map(function(e){var t=c(l(atob(e.image.slice(23))));return t.duration=e.duration,t}))},{Video:u,toWebM:e}}();"",Ne.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";Qn.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),Ri.Fetch(function(n,a){"all"!==e&&a===e+"Blob"&&t&&t(n),"all"===e&&t&&t(n,a.replace("Blob",""))})},Ne.writeToDisk=function(e){Qn.log("Writing recorded blob(s) to disk!"),e=e||{},e.audio&&e.video&&e.gif?e.audio.getDataURL(function(t){e.video.getDataURL(function(n){e.gif.getDataURL(function(e){Ri.Store({audioBlob:t,videoBlob:n,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){Ri.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){Ri.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){Ri.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){Ri.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){Ri.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){Ri.Store({gifBlob:e})})},"undefined"!=typeof module&&(module.exports=Ne),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return Ne}),je.getFromDisk=Ne.getFromDisk,je.writeToDisk=Ne.writeToDisk,"undefined"!=typeof Ne&&(Ne.MRecordRTC=je);(function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},!global.webrtcdev&&(global.webrtcdev={}),"undefined"==typeof global.webrtcdev.debug&&(global.webrtcdev.debug=global.webrtcdev.info=global.webrtcdev.error=global.webrtcdev.log=global.webrtcdev.log||function(){Qn.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof $n&&(e.screen={width:0,height:0}),"undefined"==typeof wi&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})("undefined"==typeof global?null:global);var vi=window.requestAnimationFrame;"undefined"==typeof vi&&("undefined"!=typeof webkitRequestAnimationFrame&&(vi=webkitRequestAnimationFrame),"undefined"!=typeof mozRequestAnimationFrame&&(vi=mozRequestAnimationFrame));var bi=window.cancelAnimationFrame;"undefined"==typeof bi&&("undefined"!=typeof webkitCancelAnimationFrame&&(bi=webkitCancelAnimationFrame),"undefined"!=typeof mozCancelAnimationFrame&&(bi=mozCancelAnimationFrame));var yi=window.AudioContext;"undefined"==typeof yi&&("undefined"!=typeof webkitAudioContext&&(yi=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(yi=mozAudioContext));var wi=window.URL;"undefined"==typeof wi&&"undefined"!=typeof webkitURL&&(wi=webkitURL),"undefined"!=typeof navigator&&"undefined"==typeof navigator.getUserMedia&&("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var Si=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),di=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),ci=!di&&!Si&&!!navigator.webkitGetUserMedia,Ci=window.MediaStream;"undefined"==typeof Ci&&"undefined"!=typeof webkitMediaStream&&(Ci=webkitMediaStream),"undefined"!=typeof Ci&&(!("getVideoTracks"in Ci.prototype)&&(Ci.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){-1!==t.kind.toString().indexOf("video")&&e.push(t)}),e},Ci.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){-1!==t.kind.toString().indexOf("audio")&&e.push(t)}),e}),!("stop"in Ci.prototype)&&(Ci.prototype.stop=function(){this.getAudioTracks().forEach(function(e){!e.stop||e.stop()}),this.getVideoTracks().forEach(function(e){!e.stop||e.stop()})}));var Ei={};"undefined"==typeof yi?"undefined"!=typeof webkitAudioContext&&(Ei.AudioContext=webkitAudioContext):Ei.AudioContext=yi,"undefined"!=typeof Ne&&(Ne.Storage=Ei),"undefined"!=typeof Ne&&(Ne.MediaStreamRecorder=Ae),"undefined"!=typeof Ne&&(Ne.StereoAudioRecorder=Be),"undefined"!=typeof Ne&&(Ne.CanvasRecorder=He),"undefined"!=typeof Ne&&(Ne.WhammyRecorder=Ue);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var fi=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){var t=wi.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(t);return wi.revokeObjectURL(t),n}function n(e){function t(e,t,n){return[{data:e,id:231}].concat(n.map(function(e){var n=c({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:en(t)});return t+=e.duration,{data:n,id:163}}))}function n(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,n=e[0].height,a=e[0].duration,r=1;r<e.length;r++)a+=e[r].duration;return{duration:a,width:t,height:n}}function a(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e){return new Uint8Array(e.split("").map(function(t){return t.charCodeAt(0)}))}function s(e){var t=[],n=e.length%8?Array(9-e.length%8).join("0"):"";e=n+e;for(var a=0;a<e.length;a+=8)t.push(parseInt(e.substr(a,8),2));return new Uint8Array(t)}function d(e){for(var t=[],n=0,c;n<e.length;n++){c=e[n].data,"object"==typeof c&&(c=d(c)),"number"==typeof c&&(c=s(c.toString(2))),"string"==typeof c&&(c=r(c));var l=c.size||c.byteLength||c.length,m=Zt(Zt(Qt(l)/Qt(2))/8),u=l.toString(2),p=Array(7*m+7+1-u.length).join("0")+u,g=Array(m).join("0")+"1"+p;t.push(a(e[n].id)),t.push(s(g)),t.push(c)}return new Blob(t,{type:"video/webm"})}function c(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),127<e.trackNum)throw"TrackNumber > 127 not supported";var n=[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(t){return tn(t)}).join("")+e.frame;return n}function l(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("\x9D\x01*"),a=0,r=[];4>a;a++)r[a]=t.charCodeAt(n+3+a);var s,d,c;return c=r[1]<<8|r[0],s=16383&c,c=r[3]<<8|r[2],d=16383&c,{width:s,height:d,data:t,riff:e}}function m(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return Array(8-t.length+1).join("0")+t}).join(""),2)}function u(e){for(var t=0,n={};t<e.length;){var a=e.substr(t,4),r=m(e,t),s=e.substr(t+4+4,r);t+=8+r,n[a]=n[a]||[],"RIFF"===a||"LIST"===a?n[a].push(u(s)):n[a].push(s)}return n}function p(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(t){return tn(t)}).reverse().join("")}var g=new function(e){var a=n(e);if(!a)return[];for(var r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:p(a.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:a.width,id:176},{data:a.height,id:186}]}]}]}]}],s=0,c=0;s<e.length;){var l=[],m=0;do l.push(e[s]),m+=e[s].duration,s++;while(s<e.length&&m<3e4);var u={id:524531317,data:t(c,0,l)};r[1].data.push(u),c+=m}return d(r)}(e.map(function(e){var t=l(u(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(g)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var a=t(n);a.onmessage=function(t){return t.data.error?void Qn.error(t.data.error):void e(t.data)},a.postMessage(this.frames)},{Video:e}}();"undefined"!=typeof Ne&&(Ne.Whammy=fi);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC#license|MIT}
 * @author {@link http://www.MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var Ri={init:function(){function e(e){e.createObjectStore(n.dataStoreName)}function t(){function e(e){t.objectStore(n.dataStoreName).get(e).onsuccess=function(t){n.callback&&n.callback(t.target.result,e)}}var t=s.transaction([n.dataStoreName],"readwrite");n.videoBlob&&t.objectStore(n.dataStoreName).put(n.videoBlob,"videoBlob"),n.gifBlob&&t.objectStore(n.dataStoreName).put(n.gifBlob,"gifBlob"),n.audioBlob&&t.objectStore(n.dataStoreName).put(n.audioBlob,"audioBlob"),e("audioBlob"),e("videoBlob"),e("gifBlob")}var n=this;if("undefined"==typeof indexedDB||"undefined"==typeof indexedDB.open)return void Qn.error("IndexedDB API are not available in this browser.");var a=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),r=indexedDB.open(a,1),s;r.onerror=n.onError,r.onsuccess=function(){if(s=r.result,s.onerror=n.onError,!s.setVersion)t();else if(1!==s.version){var a=s.setVersion(1);a.onsuccess=function(){e(s),t()}}else t()},r.onupgradeneeded=function(t){e(t.target.result)}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){Qn.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};"undefined"!=typeof Ne&&(Ne.DiskStorage=Ri),"undefined"!=typeof Ne&&(Ne.GifRecorder=Oe),navigator.geolocation?(Sn=navigator.platform,navigator.geolocation.getCurrentPosition(function(e){Qn.log("Latitude: "+e.coords.latitude+"<br>Longitude: "+e.coords.longitude),yn=e.coords.latitude,wn=e.coords.longitude},function(e){switch(e.code){case e.PERMISSION_DENIED:Q("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:Q("Location information is unavailable.");break;case e.TIMEOUT:Q("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:Q("An unknown error occurred.");}})):x.innerHTML="Geolocation is not supported by this browser.";var Ti={},ki=null,xi=null,Ai=[],Li={},Ii=!1,Bi;this.getlisteninlink=function(){Cn||console.error("cant generate listenin link , no session id found ");try{Qn.log(" Current Session ",window.origin);let e=window.origin+"/#"+Cn+"?appname=webrtcwebcall&role=inspector&audio=0&video=0";return e}catch(t){return Qn.error("ListenIn :",t),!1}},this.sendlisteninlink=function(e,t,n,a){var r={apikey:t,senderuseremail:n,receiveruseremail:a,webrtcsessionid:webrtcdevobj.sessionid,connectiontype:1};return fetch(e,{method:"post",crossDomain:!0,headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:t,"Access-Control-Allow-Origin":window.location.origin,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify(r)}).then(e=>e.json()).then(e=>console.log("Listenin API response ",e)).catch(e=>console.error("Listenin API response ",e))};var li=[],Mi="",Ui=null,Oi,Ni,Di,Pi,ji,Fi,nn;try{Ui=new Worker("js/timekeeper.js"),Ui.addEventListener("message",function(t){Qn.log("[timerjs] webworker message ",t.data);let e=c(t.data.remotetime);t.data.remotetime&&e&&(e.innerHTML=t.data.time)},!1)}catch(e){Qn.error("[timerjs]",e)}var _i=function(){try{var e=[];for(x in sn){let t=sn[+x+1];if(!t)break;Qn.debug(" [timer js] startPeersTime for ",t.userid),ye(t),e.push({zone:t.zone,userid:t.userid,remotetime:"remoteTime_"+t.userid}),Un=!0}Qn.info("[timerjs] Final tobj ",e),0<e.length&&Ui.postMessage(e)}catch(t){Qn.error(t)}};this.getwebrtcdevlogs=function(){return webrtcdevlogs?webrtcdevlogs:null},this.sendwebrtcdevLogs=function(e,t,n){const a=new FormData;a.append("name",username||"no name"),document.getElementById("help-screenshot-body")&&a.append("scimage",document.getElementById("help-screenshot-body").src),console.log("=========================== message",n),a.append("apikey",t),a.append("useremail",vn),a.append("sessionid",Cn),a.append("message",n);{a.append("logfileContent",webrtcdevlogs)}return fetch(e,{method:"POST",body:a}).then(e=>e.json()).then(e=>console.log("Listenin API response ",e)).catch(e=>console.error("Listenin API response ",e))},this.showUserStats=showUserStats=function(){var e=" userid-"+on+" Email-"+vn+" Audio-"+outgoing.audio+" Video-"+outgoing.video+" Role- "+Xn;document.getElementById("userstatus")?document.getElementById("userstatus").innerHTML=e:document.getElementById("mainDiv").prepend(e)},this.getscreenshot=function(e){var t=document.querySelector(e);html2canvas(t).then(e=>e.toDataURL())};var Hi=function(e){for(x in sn)if(sn[x].userid==e)return sn[x];return null};this.getwebcallpeers=function(){return sn};var Vi=function(e){return new Promise(function(t){if(On.active?(On.inputBox&&On.inputBox.text_id&&document.getElementById(On.inputBox.text_id)?(Qn.log("[sessionmanager]Assign chat Box "),re(On)):(Qn.log("[sessionmanager]Create chat Box "),ae(On)),Qn.log("[sessionmanager] chat widget loaded ")):Qn.log("[sessionmanager] chat widget deactivated  "),Dn&&Dn.active&&"inspector"!=Xn?(Dn.button.id&&document.getElementById(Dn.button.id)?(Qn.log("[sessionmanager] Assign Screen Record Button "),ie(Dn)):(Qn.log("[sessionmanager] Create Screen Record Button "),createScreenRecordButton(Dn)),Qn.log(" [sessionmanager] Screen record widget loaded ")):Dn&&!Dn.active&&(Dn.button&&Dn.button.id&&document.getElementById(Dn.button.id)&&(document.getElementById(Dn.button.id).className="inactiveButton"),Qn.warn("[sessionmanager] Screen record widget deactivated")),Jn.active?(Jn.button.shareButton.id&&c(Jn.button.shareButton.id)?(Qn.log("[sessionmanager] Assign screenshare Button "),te(Jn.button.shareButton)):(Qn.log("[sessionmanager] Create screenshare Button "),createScreenShareButton(Jn)),Qn.log(" [sessionmanager]screen share widget loaded ")):Qn.warn("[sessionmanager] screen share widget deactivated "),Wn&&Wn.active?(Wn.button.id&&document.getElementById(Wn.button.id)?(Qn.log("[sessionmanager] Reconnect Button Assigned"),St(Wn.button.id)):(Qn.log("[sessionmanager]Rconnect Button created"),wt(Wn)),Qn.log(" [sessionmanager]reconnect widget loaded ")):Wn&&!Wn.active&&(Wn.button&&Wn.button.id&&document.getElementById(Wn.button.id)&&(document.getElementById(Wn.button.id).className="inactiveButton"),Qn.warn(" [sessionmanager] reconnect widget deactivated ")),zn&&zn.active?(u("cursor1"),u("cursor2"),Qn.log(" [sessionmanager] cursor widget not loaded ")):Qn.warn(" [sessionmanager] cursor widget deactivated "),Yn&&Yn.active?(Yn.button.id&&document.getElementById(Yn.button.id),Qn.log("[widget js] listenin widget loaded ")):Yn&&!Yn.active&&(Yn.button&&Yn.button.id&&document.getElementById(Yn.button.id)&&(document.getElementById(Yn.button.id).className="inactiveButton"),Qn.warn("[widget js] listenin widget deactivated ")),Mn&&Mn.active?(le(Mn),u(Mn.container.id)):Mn&&!Mn.active&&(Mn.button.id&&document.getElementById(Mn.button.id)&&(document.getElementById(Mn.button.id).className="inactiveButton"),Qn.warn("[widget js] timer widget deactivated ")),Fn&&Fn.active?(Fn.container&&Fn.container.id&&document.getElementById(Fn.container.id)&&(document.getElementById(Fn.container.id).hidden=!0),Fn.button&&Fn.button.id&&document.getElementById(Fn.button.id)?ce(Fn):de(Fn),Bi=function(){function e(e){n&&n.contentWindow.postMessage({canvasDesignerSyncData:e},"*")}function t(){event.data&&event.data.canvasDesignerSyncData&&s(event.data.canvasDesignerSyncData)}var n;let a={line:!0,pencil:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,rectangle:!0,arc:!0,bezier:!0,quadratic:!0,text:!0};var r="pencil",s=function(e){Qn.log("syncDataListener",e)},d=window.addEventListener?"addEventListener":"attachEvent",c=window[d],l="attachEvent"==d?"onmessage":"message";return c(l,function(t){Qn.log("CanvasDesigner parent received message : ",t.data),t.data.modalpopup?ri.click():t.data||t.data.canvasDesignerSyncData?s(t.data.canvasDesignerSyncData):(!t.data||!t.data.canvasDesignerSyncData)&&Qn.log("parent received unexpected message")},!1),{appendTo:function(e){n=document.createElement("iframe"),n.id="drawboard",n.src="widget.html?tools="+JSON.stringify(a)+"&selectedIcon="+r,n.style.width="100%",n.style.height="100%",n.allowtransparency=!0,n.style.border=0,e.appendChild(n)},destroy:function(){n&&n.parentNode.removeChild(n),window.removeEventListener("message",t)},addSyncListener:function(e){s=e},syncData:e,setTools:function(e){a=e},setSelected:function(e){"undefined"!=typeof a[e]&&(r=e)}}}(),Qn.log("[sessionmanager] draw widget loaded ")):Fn&&!Fn.active&&(Fn.button&&Fn.button.id&&document.getElementById(Fn.button.id)&&(document.getElementById(Fn.button.id).className="inactiveButton"),Qn.warn("[sessionmanager] draw widget ndeactivated ")),_n.active&&Ot(),Hn.active&&At(),Nn.active?(Qn.log("[sessionmnagare] fileshareobj "),e.enableFileSharing=!0,e.filesContainer=document.getElementById(Nn.fileShareContainer),Nn.button.id&&document.getElementById(Nn.button.id)?S(Nn):w(Nn),Qn.log(" [sessionmanager] File sharing widget loaded ")):Qn.warn("[sessionmanager] File sharing widget not loaded "),Kn&&Kn.active)try{document.getElementById(Kn.statsConainer).innerHTML=""}catch(t){Qn.error("[sessionmanager] statisticsobj statsConainer not found",t)}if(Zn&&Zn.active)try{document.getElementById(Zn.helpContainer).innerHTML=""}catch(e){Qn.error("[sessionmanager] helpobj helpContainer not found",e)}t("success")})},Wi=function(e){return new Promise((t,n)=>{Qn.log("[sessionmanager - setRtcConn] initiating RtcConn"),an=new RTCMultiConnection,an.channel=this.sessionid,an.socketURL=location.hostname+":8085/",Qn.log("info","[sessionmanager] set dontAttachStream , dontCaptureUserMedia , dontGetRemoteStream as true "),an.dontAttachStream=!0,an.dontCaptureUserMedia=!0,an.dontGetRemoteStream=!0,an.onNewParticipant=function(e,t){Qn.log("[sartjs] rtcconn onNewParticipant, participantId -  ",e," , userPreferences - ",t),an.acceptParticipationRequest(e,t)},an.onopen=function(t){Qn.log("[sessionmanager] rtconn onopen - ",t);try{if(Qn.log("[sessionmanager onopen] selfuserid ",on),remoteUsers=an.peers.getAllParticipants(),Qn.log(" [sessionmanager onopen] Collecting remote peers",remoteUsers),Qn.log(" [sessionmanager onopen] webcallpeers length ",sn.length),1<sn.length-remoteUsers.length)for(x in sn)Qn.log(" [sessionmanager onopen] webcallpeers["+x+"]",sn[x]),remoteUsers.includes(sn[x].userid)||sn[x].userid==on||(console.warn("[sessionmanager] remove PeerInfo - ",sn[x].userid," which neither exists in remote peer and not is selfuserid"),qt(x));for(x in Qn.log(" [sessionmanager] removePeerInfo  After  ",sn),remoteUsers){if(Qn.log(" [sessionmanager] join-channel. Adding remote peer ",remoteUsers[x]),remoteUsers[x]==t.userid){let e=t.extra.role||"participant",n=t.extra.color,a=t.extra.email,r="LOCAL"==t.extra.name?"REMOTE":t.extra.name;Yt(remoteUsers[x],r,n,a,e,"remote"),"inspector"==e&&ee("This session is being inspected ");break}Qn.log(" [sessionmanager onopen] created/updated local peerinfo for open-channel ")}Qn.log(" [sessionmanager onopen] setting cache - channel "+e+" with self-userid "+on+" and remoteUsers "+remoteUsers),Bn||(!localStorage.getItem("userid")&&localStorage.setItem("userid",on),!localStorage.getItem("remoteUsers")&&localStorage.setItem("remoteUsers",remoteUsers),!localStorage.getItem("channel")&&localStorage.setItem("channel",e)),Qn.log(" [sessionmanager onopen] webcallpeers ",sn),"open"==an.connectionType?Gi("open",e,on,[]):"join"==an.connectionType?Gi("join",e,on,remoteUsers):Q("connnection type is neither open nor join","warning"),Q(t.extra.name+" joined session ","info"),showdesktopnotification(document.title,t.extra.name+" joined session "),Mn&&Mn.active&&(Ht(Mn),Wt()),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"session",action:"onSessionConnect"}})),Kn&&Kn.active&&Se()}catch(e){Q("problem in session open ","warning"),Qn.error("problem in session open",e)}},an.onMediaError=function(e,t){Qn.error("[sessionmanager] onMediaError - ",e," constraints ",t),Qn.warn("[sessionmanager] onMediaError- Joining without camera Stream"),Q(e.name+" Joining without camera Stream ","warning"),ei=!1;let n=sn[0];n.type="Local",n.stream="",n.streamid="",g(n),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"session",action:"onLocalConnect"}}))},an.onstream=function(e){Qn.log("[sessionmanager onstream ] on stream Started event ",e),"local"==e.type&&(ei=!0);var t=Hi(e.userid);t?"inspector"==Xn&&"local"==e.type&&Qn.info("[sessionmanager] onstream - ignore any incoming stream from inspector"):(Qn.error("[sartjs] onstream - PeerInfo not present in webcallpeers ",e.userid," creating it now "),Yt(e.userid,e.extra.name,e.extra.color,e.extra.email,e.extra.role,e.type),Qn.log(" [sessionmanager] onstream - updated local peerinfo for open-channel "),t=Hi(e.userid)),t.type=e.type,t.stream=e.stream,t.streamid=e.stream.streamid,g(t),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"session",action:"onLocalConnect"}}))},an.onstreamended=function(e){Qn.log(" On streamEnded event ",e);let t=document.getElementById(e.streamid);t&&t.parentNode.removeChild(t)},an.chunkSize=50000,an.onmessage=function(t){if(Qn.log("[sessionmanager] on message ",t),t.data.typing)oe(t.extra.name+" is typing ...");else if(t.data.stoppedTyping)oe("");else{let l=Hi(t.userid);switch(t.data.type){case"screenshare":if("startscreenshare"==t.data.message){let e=t.data.screenid;Q("Starting screen share ",e);let n=document.getElementById(Jn.button.shareButton.id);n.className=Jn.button.shareButton.class_busy,n.innerHTML=Jn.button.shareButton.html_busy,n.disabled=!0,Re("join",e)}else if("screenshareStartedViewing"==t.data.message)ne("","screenshareStartedViewing");else if("stoppedscreenshare"==t.data.message){Q("Screenshare has stopped : "+t.data.screenStreamid);let e=document.getElementById(Jn.button.shareButton.id);e.className=Jn.button.shareButton.class_off,e.innerHTML=Jn.button.shareButton.html_off,e.disabled=!1,ke(t.data.screenStreamid)}else Qn.warn(" unrecognized screenshare message ",t.data.message);break;case"chat":oe(t.extra.name+" has send message"),Je({header:t.extra.name,message:t.data.message,userinfo:t.data.userinfo,color:t.extra.color}),window.dispatchEvent(new CustomEvent("webrtcdev",{detail:{servicetype:"chat",action:"onchat"}}));break;case"imagesnapshot":R(null,l,t.data.message,t.data.name,"imagesnapshot"),k(null,l,t.data.message,t.data.name,"imagesnapshot");break;case"videoRecording":R(null,l,t.data.message,t.data.name,"videoRecording"),k(null,l,t.data.message,t.data.name,"videoRecording");break;case"videoScreenRecording":R(null,l,t.data.message,t.data.name,"videoScreenRecording"),k(null,l,t.data.message,t.data.name,"videoScreenRecording");break;case"file":Je({header:t.extra.name,message:t.data.message,userinfo:a(an.blobURLs[t.userid],"chat-message.png"),color:t.extra.color});break;case"canvas":t.data.draw?Bi.syncData(t.data.draw):t.data.board?(Qn.log(" Canvas : ",t.data),"remote"==t.data.board.from&&("open"==t.data.board.event&&!0!=Ii?se(t.data.board):"close"==t.data.board.event&&!0==Ii&&se(t.data.board))):Qn.warn(" Board data mismatch",t.data);break;case"texteditor":Dt(t.data.data);break;case"codeeditor":Bt(t.data.data);break;case"pointer":var e=document.getElementById("cursor2");e?"startCursor"==t.data.action?(e.setAttribute("style","display:block"),Et(e,t.data.corX,t.data.corY)):"stopCursor"==t.data.action&&e.setAttribute("style","display:none"):alert(" Cursor for remote is not present ");break;case"timer":l&&(!l.time&&(l.time=t.data.time),!l.zone&&(l.zone=t.data.zone),Qn.log("[sessionmanager] webcallpeers appended with zone and datetime ",l)),Qn.log("[sessionmanager] peerTimerStarted, start peerTimeZone and startPeersTime"),zt(t.data.zone,t.userid),_i(t.data.time,t.data.zone,t.userid);break;case"buttonclick":var n=c(t.data.buttonName);n.getAttribute("lastClickedBy")!=an.userid&&(n.setAttribute("lastClickedBy",t.userid),n.click());break;case"syncOldFiles":ft();break;case"shareFileRemove":Qn.log(" [sessionmanager] shareFileRemove - remove file : ",t.data._filename);var r=t.data._element,s=t.data._filename;let m="removeButton"+r;if(document.getElementById("display"+s)&&u("display"+s),document.getElementById(r))u(r),M(r),Qn.log(" [sessionmanager] shareFileRemove done");else return void Qn.log(" [sessionmanager] shareFileRemove already done since ",r,"element doesnt exist ");document.getElementById(m).click(),u(m);break;case"shareFileStopUpload":var d=t.data._element;for(x in Qn.log(" [sessionmanager] shareFileStopUpload",d),sn)for(y in sn[x].filearray)if(sn[x].filearray[y].pid==d)return console.log("[ sessionmanager ] shareFileStopUpload -  filepid ",sn[x].filearray[y].pid," | status ",sn[x].filearray[y].status),sn[x].filearray[y].status="stopped",B(d),void M(d);break;default:Qn.warn(" unrecognizable message from peer  ",t);}}},an.sendMessage=function(e){Qn.log(" sendMessage ",e),e.userid=an.userid,e.extra=an.extra,an.sendCustomMessage(e)},an.onleave=function(t){var e=Hi(t.userid);Qn.log(" RTCConn onleave user",t," his peerinfo ",e," from webcallpeers ",sn),"undefined"!=t.extra.name&&Q(t.extra.name+"  left the conversation.")},an.onclose=function(t){Qn.warn(" RTCConn on close conversation ",t)},an.onEntireSessionClosed=function(){an.attachStreams.forEach(function(e){e.stop()}),Q("Session Disconneted")},an.onFileStart=function(e){Qn.log("onFileStart",e),lt(e)},an.onFileProgress=function(e){mt(e)},an.onFileEnd=function(e){ut(e)},an.takeSnapshot=function(e,t){We({userid:e,connection:connection,callback:t})},an.connectionType=null,an.remoteUsers=[],an.extra={uuid:an.userid,name:fn||"",color:"undefined"==typeof ii.userdetails?"":ii.userdetails.usercolor,email:vn||"",role:Xn||"participant"},an.socketMessageEvent="RTCMultiConnection-Message",an.socketCustomEvent="RTCMultiConnection-Custom-Message",an.enableFileSharing=!0,an.filesContainer=document.body||document.documentElement,an.iceServers=Rn,Qn.log(" [sessionmanager] rtcConn : ",an),an?t("done"):n("failed")}).catch(e=>{Qn.error("setRtcConn",e),reject(e)})},zi=function(e,t,n){Qn.info("[sessionmanager] -openWebRTC channel: ",e),socket.emit("open-channel",{channel:e,sender:t,maxAllowed:n}),Q(" Making a new session ")},Gi=function(e,t,n,a){if(Qn.info(" [sessionmanager] ConnectWebRTC type : ",e," , Channel :",t," , self-Userid : ",n," , and remote users : ",a),Bn&&showUserStats(),Yn.active&&"inspector"==Xn&&(Qn.info(" [sessionmanage] freezing screen for role inspector "),Ct()),Nn.active)try{var r=Hi(n);if(!r)throw"self peerinfo missing in webcallpeers for "+n;if("single"==Nn.props.fileShare)F(r),document.getElementById(r.fileShare.outerbox).style.width="100%";else if("divided"==Nn.props.fileShare){for(x in"inspector"==Xn?Qn.log("[sessionmanager] Since it is an inspector's own session , not creating local File viewer and list"):(Qn.log(" [sessionmanager] creating local file sharing"),F(r)),sn)sn[x].userid!=n&&"inspector"!=sn[x].role&&(Qn.log(" [start connectWebRTC] creating remote file sharing "),F(sn[x]));Nn.sendOldFiles&&ht()}else Qn.error("[sessionmanager] fileshareobj.props.fileShare undefined ");"single"==Nn.props.fileList?document.getElementById(r.fileList.outerbox).style.width="100%":"single"==Nn.props.fileShare?Qn.error("fileshareobj.props.fileShare undefined "):Qn.log("No Seprate div created for this peer since fileshare container is single")}catch(e){Qn.error("[sessionmanager] connectwebrtc -",e)}Mn&&Mn.active&&(ve(),he())},qi=function(e,t){Q("Joining an existing session "+e),Qn.info(" [sessionmanager] joinWebRTC channel: ",e),Bn&&showUserStats(),socket.emit("join-channel",{channel:e,sender:t,extra:{userid:t,name:fn||"",color:bn||"",email:vn||"",role:Xn||"participant"}})};this.clearCaches=clearCaches=function(){localStorage.clear()};window.onunload=function(){Qn.log("[startjs] onunload ",localStorage.getItem("channel")),alert(" Refreshing the Page will loose the session data")}};"undefined"!=typeof module&&(module.exports=exports=webrtcdevcon);var channelsFeed=document.getElementById("channelsFeed"),WebRTCdevadmin=function(e){console.log("[adminjs] connect to ",e);try{socket=io.connect(e),socket.on("response_to_admin_enquire",function(e){switch(console.log("[adminjs] response_to_admin_enquire -",e),e.response){case"channels":console.log("[adminjs] chnanels ");let t=e.channelinfo;if("list"==e.format)for(i in clearList("channellistArea"),Object.keys(t))drawList("channellistArea",t[i]);else"table"==e.format?drawTable("webrtcdevTableBody",t):webrtcdev.error("format not specified ");break;case"users":if(console.log("[adminjs] users "),users=e.users,"list"==e.format)for(i in clearList("userslistArea"),usersDataObj)drawList("userslistArea",usersDataObj[i]);break;case"all":channelsFeed.innerHTML=JSON.stringify(e.channels,null,4);break;default:webrtcdev.log("unrecognizable response from signaller ",e);}})}catch(t){console.error(t)}},socket,webrtcdevDataObj,usersDataObj;function onLoadAdmin(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}$("#channels_list").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}),$("#channelFindBtn").click(function(){socket.emit("admin_enquire",{ask:"channels",find:$("#channelFindInput").val(),format:"list"})}),$("#users_list").click(function(){socket.emit("admin_enquire",{ask:"users",format:"list"})}),$("#channels_table").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"table"})}),$("#channels_json").click(function(){socket.emit("admin_enquire",{ask:"all",format:"json"})}),$("#channel_clients").click(function(){socket.emit("admin_enquire",{ask:"channel_clients",channel:"https172162010780841524489749781952"})});function clearList(e){$("#"+e).empty()}function drawList(e,t){$("#"+e).append("<li className='list-group-item'>"+t+"</li>")}function drawTable(e,t){for(i in Object.keys(t)){var n=Object.keys(t)[i];drawTableRow(e,i,t[n].channel,t[n].timestamp,t[n].users,t[n].status,t[n].endtimestamp,0)}}function drawTableRow(e,t,n,a,r,s,d,c){var l=$("<tr className='success' />");l.append($("<td>"+t+"</td>")),l.append($("<td>"+n+"</td>")),l.append($("<td>"+a+"</td>")),l.append($("<td>"+JSON.stringify(r,null,4)+"</td>")),l.append($("<td>"+s+"</td>")),l.append($("<td>"+d+"</td>")),l.append($("<td>"+c+"</td>")),$("#"+e).append(l)}function drawUsersTable(e){var t=document.createElement("table");$("#usersRow").append(t);for(var n=0;n<e.length;n++)drawUsersRow(t,data[n])}function drawUsersRow(e){var t=$("<tr />");$("#table").append(t),t.append($("<td>"+e+"</td>"))}